/*!
 * @toast-ui/editor
 * @version 3.0.1 | Tue Jul 13 2021
 * @author NHN FE Development Lab <dl_javascript@nhn.com>
 * @license MIT
 */
!function webpackUniversalModuleDefinition(root,factory){"object"==typeof exports&&"object"==typeof module?module.exports=factory():"function"==typeof define&&define.amd?define([],factory):"object"==typeof exports?exports.toastui=factory():(root.toastui=root.toastui||{},root.toastui.Editor=factory())}(window,(function(){return function(){"use strict";var __webpack_modules__={928:function(module,__unused_webpack_exports,__webpack_require__){var isArray=__webpack_require__(322);function inArray(searchElement,array,startIndex){var i,length;if(startIndex=startIndex||0,!isArray(array))return-1;if(Array.prototype.indexOf)return Array.prototype.indexOf.call(array,searchElement,startIndex);for(length=array.length,i=startIndex;startIndex>=0&&i<length;i+=1)if(array[i]===searchElement)return i;return-1}module.exports=inArray},690:function(module,__unused_webpack_exports,__webpack_require__){var isArray=__webpack_require__(322),forEachArray=__webpack_require__(893),forEachOwnProperties=__webpack_require__(956);function forEach(obj,iteratee,context){isArray(obj)?forEachArray(obj,iteratee,context):forEachOwnProperties(obj,iteratee,context)}module.exports=forEach},893:function(module){function forEachArray(arr,iteratee,context){var index=0,len=arr.length;for(context=context||null;index<len&&!1!==iteratee.call(context,arr[index],index,arr);index+=1);}module.exports=forEachArray},956:function(module){function forEachOwnProperties(obj,iteratee,context){var key;for(key in context=context||null,obj)if(obj.hasOwnProperty(key)&&!1===iteratee.call(context,obj[key],key,obj))break}module.exports=forEachOwnProperties},990:function(module,__unused_webpack_exports,__webpack_require__){var forEachArray=__webpack_require__(893);function toArray(arrayLike){var arr;try{arr=Array.prototype.slice.call(arrayLike)}catch(e){arr=[],forEachArray(arrayLike,(function(value){arr.push(value)}))}return arr}module.exports=toArray},755:function(module){var EVENT_KEY="_feEventKey";function safeEvent(element,type){var events=element[EVENT_KEY],handlers;return events||(events=element[EVENT_KEY]={}),(handlers=events[type])||(handlers=events[type]=[]),handlers}module.exports=safeEvent},349:function(module,__unused_webpack_exports,__webpack_require__){var isString=__webpack_require__(758),forEach=__webpack_require__(690),safeEvent=__webpack_require__(755);function off(element,types,handler){isString(types)?forEach(types.split(/\s+/g),(function(type){unbindEvent(element,type,handler)})):forEach(types,(function(func,type){unbindEvent(element,type,func)}))}function unbindEvent(element,type,handler){var events=safeEvent(element,type),index;handler?(forEach(events,(function(item,idx){return handler!==item.handler||(removeHandler(element,type,item.wrappedHandler),index=idx,!1)})),events.splice(index,1)):(forEach(events,(function(item){removeHandler(element,type,item.wrappedHandler)})),events.splice(0,events.length))}function removeHandler(element,type,handler){"removeEventListener"in element?element.removeEventListener(type,handler):"detachEvent"in element&&element.detachEvent("on"+type,handler)}module.exports=off},348:function(module,__unused_webpack_exports,__webpack_require__){var isString=__webpack_require__(758),forEach=__webpack_require__(690),safeEvent=__webpack_require__(755);function on(element,types,handler,context){isString(types)?forEach(types.split(/\s+/g),(function(type){bindEvent(element,type,handler,context)})):forEach(types,(function(func,type){bindEvent(element,type,func,handler)}))}function bindEvent(element,type,handler,context){function eventHandler(e){handler.call(context||element,e||window.event)}"addEventListener"in element?element.addEventListener(type,eventHandler):"attachEvent"in element&&element.attachEvent("on"+type,eventHandler),memorizeHandler(element,type,handler,eventHandler)}function memorizeHandler(element,type,handler,wrappedHandler){var events=safeEvent(element,type),existInEvents=!1;forEach(events,(function(obj){return obj.handler!==handler||(existInEvents=!0,!1)})),existInEvents||events.push({handler:handler,wrappedHandler:wrappedHandler})}module.exports=on},24:function(module,__unused_webpack_exports,__webpack_require__){var isArray=__webpack_require__(322),isUndefined=__webpack_require__(929);function setClassName(element,cssClass){cssClass=(cssClass=isArray(cssClass)?cssClass.join(" "):cssClass).replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),isUndefined(element.className.baseVal)?element.className=cssClass:element.className.baseVal=cssClass}module.exports=setClassName},204:function(module,__unused_webpack_exports,__webpack_require__){var forEach=__webpack_require__(690),inArray=__webpack_require__(928),getClass=__webpack_require__(902),setClassName=__webpack_require__(24);function addClass(element){var cssClass=Array.prototype.slice.call(arguments,1),classList=element.classList,newClass=[],origin;classList?forEach(cssClass,(function(name){element.classList.add(name)})):((origin=getClass(element))&&(cssClass=[].concat(origin.split(/\s+/),cssClass)),forEach(cssClass,(function(cls){inArray(cls,newClass)<0&&newClass.push(cls)})),setClassName(element,newClass))}module.exports=addClass},522:function(module,__unused_webpack_exports,__webpack_require__){var isString=__webpack_require__(758),forEach=__webpack_require__(690);function css(element,key,value){var style=element.style;isString(key)?style[key]=value:forEach(key,(function(v,k){style[k]=v}))}module.exports=css},902:function(module,__unused_webpack_exports,__webpack_require__){var isUndefined=__webpack_require__(929);function getClass(element){return element&&element.className?isUndefined(element.className.baseVal)?element.className:element.className.baseVal:""}module.exports=getClass},714:function(module,__unused_webpack_exports,__webpack_require__){var inArray=__webpack_require__(928),getClass=__webpack_require__(902);function hasClass(element,cssClass){var origin;return element.classList?element.classList.contains(cssClass):(origin=getClass(element).split(/\s+/),inArray(cssClass,origin)>-1)}module.exports=hasClass},471:function(module,__unused_webpack_exports,__webpack_require__){var inArray=__webpack_require__(928),toArray=__webpack_require__(990),elProto=Element.prototype,matchSelector=elProto.matches||elProto.webkitMatchesSelector||elProto.mozMatchesSelector||elProto.msMatchesSelector||function(selector){var doc=this.document||this.ownerDocument;return inArray(this,toArray(doc.querySelectorAll(selector)))>-1};function matches(element,selector){return matchSelector.call(element,selector)}module.exports=matches},462:function(module,__unused_webpack_exports,__webpack_require__){var forEachArray=__webpack_require__(893),inArray=__webpack_require__(928),getClass=__webpack_require__(902),setClassName=__webpack_require__(24);function removeClass(element){var cssClass=Array.prototype.slice.call(arguments,1),classList=element.classList,origin,newClass;classList?forEachArray(cssClass,(function(name){classList.remove(name)})):(origin=getClass(element).split(/\s+/),newClass=[],forEachArray(origin,(function(name){inArray(name,cssClass)<0&&newClass.push(name)})),setClassName(element,newClass))}module.exports=removeClass},969:function(module){function extend(target,objects){var hasOwnProp=Object.prototype.hasOwnProperty,source,prop,i,len;for(i=1,len=arguments.length;i<len;i+=1)for(prop in source=arguments[i])hasOwnProp.call(source,prop)&&(target[prop]=source[prop]);return target}module.exports=extend},254:function(module,__unused_webpack_exports,__webpack_require__){var forEachOwnProperties=__webpack_require__(956);function imagePing(url,trackingInfo){var trackingElement=document.createElement("img"),queryString="";return forEachOwnProperties(trackingInfo,(function(value,key){queryString+="&"+key+"="+value})),queryString=queryString.substring(1),trackingElement.src=url+"?"+queryString,trackingElement.style.display="none",document.body.appendChild(trackingElement),document.body.removeChild(trackingElement),trackingElement}module.exports=imagePing},391:function(module,__unused_webpack_exports,__webpack_require__){var isUndefined=__webpack_require__(929),imagePing=__webpack_require__(254),ms7days=6048e5;function isExpired(date){var now;return(new Date).getTime()-date>6048e5}function sendHostname(appName,trackingId){var url="https://www.google-analytics.com/collect",hostname=location.hostname,hitType="event",eventCategory="use",applicationKeyForStorage="TOAST UI "+appName+" for "+hostname+": Statistics",date=window.localStorage.getItem(applicationKeyForStorage);(isUndefined(window.tui)||!1!==window.tui.usageStatistics)&&(date&&!isExpired(date)||(window.localStorage.setItem(applicationKeyForStorage,(new Date).getTime()),setTimeout((function(){"interactive"!==document.readyState&&"complete"!==document.readyState||imagePing(url,{v:1,t:"event",tid:trackingId,cid:hostname,dp:hostname,dh:appName,el:appName,ec:"use"})}),1e3)))}module.exports=sendHostname},516:function(module){function debounce(fn,delay){var timer,args;function debounced(){args=Array.prototype.slice.call(arguments),window.clearTimeout(timer),timer=window.setTimeout((function(){fn.apply(null,args)}),delay)}return delay=delay||0,debounced}module.exports=debounce},423:function(module,__unused_webpack_exports,__webpack_require__){var debounce=__webpack_require__(516);function throttle(fn,interval){var base,isLeading=!0,tick=function(_args){fn.apply(null,_args),base=null},debounced,stamp,args;function throttled(){if(args=Array.prototype.slice.call(arguments),isLeading)return tick(args),void(isLeading=!1);stamp=Number(new Date),base=base||stamp,debounced(args),stamp-base>=interval&&tick(args)}function reset(){isLeading=!0,base=null}return debounced=debounce(tick,interval=interval||0),throttled.reset=reset,throttled}module.exports=throttle},322:function(module){function isArray(obj){return obj instanceof Array}module.exports=isArray},326:function(module){function isBoolean(obj){return"boolean"==typeof obj||obj instanceof Boolean}module.exports=isBoolean},65:function(module,__unused_webpack_exports,__webpack_require__){var isUndefined=__webpack_require__(929),isNull=__webpack_require__(934);function isExisty(param){return!isUndefined(param)&&!isNull(param)}module.exports=isExisty},404:function(module,__unused_webpack_exports,__webpack_require__){var isTruthy=__webpack_require__(790);function isFalsy(obj){return!isTruthy(obj)}module.exports=isFalsy},294:function(module){function isFunction(obj){return obj instanceof Function}module.exports=isFunction},934:function(module){function isNull(obj){return null===obj}module.exports=isNull},321:function(module){function isNumber(obj){return"number"==typeof obj||obj instanceof Number}module.exports=isNumber},73:function(module){function isObject(obj){return obj===Object(obj)}module.exports=isObject},758:function(module){function isString(obj){return"string"==typeof obj||obj instanceof String}module.exports=isString},790:function(module,__unused_webpack_exports,__webpack_require__){var isExisty=__webpack_require__(65);function isTruthy(obj){return isExisty(obj)&&!1!==obj}module.exports=isTruthy},929:function(module){function isUndefined(obj){return void 0===obj}module.exports=isUndefined}},__webpack_module_cache__={};function __webpack_require__(moduleId){var cachedModule=__webpack_module_cache__[moduleId];if(void 0!==cachedModule)return cachedModule.exports;var module=__webpack_module_cache__[moduleId]={exports:{}};return __webpack_modules__[moduleId](module,module.exports,__webpack_require__),module.exports}__webpack_require__.n=function(module){var getter=module&&module.__esModule?function(){return module.default}:function(){return module};return __webpack_require__.d(getter,{a:getter}),getter},__webpack_require__.d=function(exports,definition){for(var key in definition)__webpack_require__.o(definition,key)&&!__webpack_require__.o(exports,key)&&Object.defineProperty(exports,key,{enumerable:!0,get:definition[key]})},__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),__webpack_require__.o=function(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)};var __webpack_exports__={};return function(){__webpack_require__.d(__webpack_exports__,{default:function(){return src}});
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(d[p]=b[p])})(d,b)};function __extends(d,b){if("function"!=typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}var __assign=function(){return(__assign=Object.assign||function __assign(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)};function __rest(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]]);return t}function __decorate(decorators,target,key,desc){var c=arguments.length,r=c<3?target:null===desc?desc=Object.getOwnPropertyDescriptor(target,key):desc,d;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)(d=decorators[i])&&(r=(c<3?d(r):c>3?d(target,key,r):d(target,key))||r);return c>3&&r&&Object.defineProperty(target,key,r),r}function __param(paramIndex,decorator){return function(target,key){decorator(target,key,paramIndex)}}function __metadata(metadataKey,metadataValue){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(metadataKey,metadataValue)}function __awaiter(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))}function __generator(thisArg,body){var _={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}}var __createBinding=Object.create?function(o,m,k,k2){void 0===k2&&(k2=k),Object.defineProperty(o,k2,{enumerable:!0,get:function(){return m[k]}})}:function(o,m,k,k2){void 0===k2&&(k2=k),o[k2]=m[k]};function __exportStar(m,o){for(var p in m)"default"===p||Object.prototype.hasOwnProperty.call(o,p)||__createBinding(o,m,p)}function __values(o){var s="function"==typeof Symbol&&Symbol.iterator,m=s&&o[s],i=0;if(m)return m.call(o);if(o&&"number"==typeof o.length)return{next:function(){return o&&i>=o.length&&(o=void 0),{value:o&&o[i++],done:!o}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")}function __read(o,n){var m="function"==typeof Symbol&&o[Symbol.iterator];if(!m)return o;var i=m.call(o),r,ar=[],e;try{for(;(void 0===n||n-- >0)&&!(r=i.next()).done;)ar.push(r.value)}catch(error){e={error:error}}finally{try{r&&!r.done&&(m=i.return)&&m.call(i)}finally{if(e)throw e.error}}return ar}function __spread(){for(var ar=[],i=0;i<arguments.length;i++)ar=ar.concat(__read(arguments[i]));return ar}function __spreadArrays(){for(var s=0,i=0,il=arguments.length;i<il;i++)s+=arguments[i].length;for(var r=Array(s),k=0,i=0;i<il;i++)for(var a=arguments[i],j=0,jl=a.length;j<jl;j++,k++)r[k]=a[j];return r}function __spreadArray(to,from){for(var i=0,il=from.length,j=to.length;i<il;i++,j++)to[j]=from[i];return to}function __await(v){return this instanceof __await?(this.v=v,this):new __await(v)}function __asyncGenerator(thisArg,_arguments,generator){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var g=generator.apply(thisArg,_arguments||[]),i,q=[];return i={},verb("next"),verb("throw"),verb("return"),i[Symbol.asyncIterator]=function(){return this},i;function verb(n){g[n]&&(i[n]=function(v){return new Promise((function(a,b){q.push([n,v,a,b])>1||resume(n,v)}))})}function resume(n,v){try{step(g[n](v))}catch(e){settle(q[0][3],e)}}function step(r){r.value instanceof __await?Promise.resolve(r.value.v).then(fulfill,reject):settle(q[0][2],r)}function fulfill(value){resume("next",value)}function reject(value){resume("throw",value)}function settle(f,v){f(v),q.shift(),q.length&&resume(q[0][0],q[0][1])}}function __asyncDelegator(o){var i,p;return i={},verb("next"),verb("throw",(function(e){throw e})),verb("return"),i[Symbol.iterator]=function(){return this},i;function verb(n,f){i[n]=o[n]?function(v){return(p=!p)?{value:__await(o[n](v)),done:"return"===n}:f?f(v):v}:f}}function __asyncValues(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var m=o[Symbol.asyncIterator],i;return m?m.call(o):(o=__values(o),i={},verb("next"),verb("throw"),verb("return"),i[Symbol.asyncIterator]=function(){return this},i);function verb(n){i[n]=o[n]&&function(v){return new Promise((function(resolve,reject){settle(resolve,reject,(v=o[n](v)).done,v.value)}))}}function settle(resolve,reject,d,v){Promise.resolve(v).then((function(v){resolve({value:v,done:d})}),reject)}}function __makeTemplateObject(cooked,raw){return Object.defineProperty?Object.defineProperty(cooked,"raw",{value:raw}):cooked.raw=raw,cooked}var __setModuleDefault=Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v};function __importStar(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)"default"!==k&&Object.prototype.hasOwnProperty.call(mod,k)&&__createBinding(result,mod,k);return __setModuleDefault(result,mod),result}function __importDefault(mod){return mod&&mod.__esModule?mod:{default:mod}}function __classPrivateFieldGet(receiver,privateMap){if(!privateMap.has(receiver))throw new TypeError("attempted to get private field on non-instance");return privateMap.get(receiver)}function __classPrivateFieldSet(receiver,privateMap,value){if(!privateMap.has(receiver))throw new TypeError("attempted to set private field on non-instance");return privateMap.set(receiver,value),value}function OrderedMap(content){this.content=content}OrderedMap.prototype={constructor:OrderedMap,find:function(key){for(var i=0;i<this.content.length;i+=2)if(this.content[i]===key)return i;return-1},get:function(key){var found=this.find(key);return-1==found?void 0:this.content[found+1]},update:function(key,value,newKey){var self=newKey&&newKey!=key?this.remove(newKey):this,found=self.find(key),content=self.content.slice();return-1==found?content.push(newKey||key,value):(content[found+1]=value,newKey&&(content[found]=newKey)),new OrderedMap(content)},remove:function(key){var found=this.find(key);if(-1==found)return this;var content=this.content.slice();return content.splice(found,2),new OrderedMap(content)},addToStart:function(key,value){return new OrderedMap([key,value].concat(this.remove(key).content))},addToEnd:function(key,value){var content=this.remove(key).content.slice();return content.push(key,value),new OrderedMap(content)},addBefore:function(place,key,value){var without=this.remove(key),content=without.content.slice(),found=without.find(place);return content.splice(-1==found?content.length:found,0,key,value),new OrderedMap(content)},forEach:function(f){for(var i=0;i<this.content.length;i+=2)f(this.content[i],this.content[i+1])},prepend:function(map){return(map=OrderedMap.from(map)).size?new OrderedMap(map.content.concat(this.subtract(map).content)):this},append:function(map){return(map=OrderedMap.from(map)).size?new OrderedMap(this.subtract(map).content.concat(map.content)):this},subtract:function(map){var result=this;map=OrderedMap.from(map);for(var i=0;i<map.content.length;i+=2)result=result.remove(map.content[i]);return result},get size(){return this.content.length>>1}},OrderedMap.from=function(value){if(value instanceof OrderedMap)return value;var content=[];if(value)for(var prop in value)content.push(prop,value[prop]);return new OrderedMap(content)};var orderedmap,index_es=OrderedMap;function findDiffStart(a,b,pos){for(var i=0;;i++){if(i==a.childCount||i==b.childCount)return a.childCount==b.childCount?null:pos;var childA=a.child(i),childB=b.child(i);if(childA!=childB){if(!childA.sameMarkup(childB))return pos;if(childA.isText&&childA.text!=childB.text){for(var j=0;childA.text[j]==childB.text[j];j++)pos++;return pos}if(childA.content.size||childB.content.size){var inner=findDiffStart(childA.content,childB.content,pos+1);if(null!=inner)return inner}pos+=childA.nodeSize}else pos+=childA.nodeSize}}function findDiffEnd(a,b,posA,posB){for(var iA=a.childCount,iB=b.childCount;;){if(0==iA||0==iB)return iA==iB?null:{a:posA,b:posB};var childA=a.child(--iA),childB=b.child(--iB),size=childA.nodeSize;if(childA!=childB){if(!childA.sameMarkup(childB))return{a:posA,b:posB};if(childA.isText&&childA.text!=childB.text){for(var same=0,minSize=Math.min(childA.text.length,childB.text.length);same<minSize&&childA.text[childA.text.length-same-1]==childB.text[childB.text.length-same-1];)same++,posA--,posB--;return{a:posA,b:posB}}if(childA.content.size||childB.content.size){var inner=findDiffEnd(childA.content,childB.content,posA-1,posB-1);if(inner)return inner}posA-=size,posB-=size}else posA-=size,posB-=size}}var Fragment=function Fragment(content,size){if(this.content=content,this.size=size||0,null==size)for(var i=0;i<content.length;i++)this.size+=content[i].nodeSize},prototypeAccessors={firstChild:{configurable:!0},lastChild:{configurable:!0},childCount:{configurable:!0}};Fragment.prototype.nodesBetween=function nodesBetween(from,to,f,nodeStart,parent){void 0===nodeStart&&(nodeStart=0);for(var i=0,pos=0;pos<to;i++){var child=this.content[i],end=pos+child.nodeSize;if(end>from&&!1!==f(child,nodeStart+pos,parent,i)&&child.content.size){var start=pos+1;child.nodesBetween(Math.max(0,from-start),Math.min(child.content.size,to-start),f,nodeStart+start)}pos=end}},Fragment.prototype.descendants=function descendants(f){this.nodesBetween(0,this.size,f)},Fragment.prototype.textBetween=function textBetween(from,to,blockSeparator,leafText){var text="",separated=!0;return this.nodesBetween(from,to,(function(node,pos){node.isText?(text+=node.text.slice(Math.max(from,pos)-pos,to-pos),separated=!blockSeparator):node.isLeaf&&leafText?(text+=leafText,separated=!blockSeparator):!separated&&node.isBlock&&(text+=blockSeparator,separated=!0)}),0),text},Fragment.prototype.append=function append(other){if(!other.size)return this;if(!this.size)return other;var last=this.lastChild,first=other.firstChild,content=this.content.slice(),i=0;for(last.isText&&last.sameMarkup(first)&&(content[content.length-1]=last.withText(last.text+first.text),i=1);i<other.content.length;i++)content.push(other.content[i]);return new Fragment(content,this.size+other.size)},Fragment.prototype.cut=function cut(from,to){if(null==to&&(to=this.size),0==from&&to==this.size)return this;var result=[],size=0;if(to>from)for(var i=0,pos=0;pos<to;i++){var child=this.content[i],end=pos+child.nodeSize;end>from&&((pos<from||end>to)&&(child=child.isText?child.cut(Math.max(0,from-pos),Math.min(child.text.length,to-pos)):child.cut(Math.max(0,from-pos-1),Math.min(child.content.size,to-pos-1))),result.push(child),size+=child.nodeSize),pos=end}return new Fragment(result,size)},Fragment.prototype.cutByIndex=function cutByIndex(from,to){return from==to?Fragment.empty:0==from&&to==this.content.length?this:new Fragment(this.content.slice(from,to))},Fragment.prototype.replaceChild=function replaceChild(index,node){var current=this.content[index];if(current==node)return this;var copy=this.content.slice(),size=this.size+node.nodeSize-current.nodeSize;return copy[index]=node,new Fragment(copy,size)},Fragment.prototype.addToStart=function addToStart(node){return new Fragment([node].concat(this.content),this.size+node.nodeSize)},Fragment.prototype.addToEnd=function addToEnd(node){return new Fragment(this.content.concat(node),this.size+node.nodeSize)},Fragment.prototype.eq=function eq(other){if(this.content.length!=other.content.length)return!1;for(var i=0;i<this.content.length;i++)if(!this.content[i].eq(other.content[i]))return!1;return!0},prototypeAccessors.firstChild.get=function(){return this.content.length?this.content[0]:null},prototypeAccessors.lastChild.get=function(){return this.content.length?this.content[this.content.length-1]:null},prototypeAccessors.childCount.get=function(){return this.content.length},Fragment.prototype.child=function child(index){var found=this.content[index];if(!found)throw new RangeError("Index "+index+" out of range for "+this);return found},Fragment.prototype.maybeChild=function maybeChild(index){return this.content[index]},Fragment.prototype.forEach=function forEach(f){for(var i=0,p=0;i<this.content.length;i++){var child=this.content[i];f(child,p,i),p+=child.nodeSize}},Fragment.prototype.findDiffStart=function findDiffStart$1(other,pos){return void 0===pos&&(pos=0),findDiffStart(this,other,pos)},Fragment.prototype.findDiffEnd=function findDiffEnd$1(other,pos,otherPos){return void 0===pos&&(pos=this.size),void 0===otherPos&&(otherPos=other.size),findDiffEnd(this,other,pos,otherPos)},Fragment.prototype.findIndex=function findIndex(pos,round){if(void 0===round&&(round=-1),0==pos)return retIndex(0,pos);if(pos==this.size)return retIndex(this.content.length,pos);if(pos>this.size||pos<0)throw new RangeError("Position "+pos+" outside of fragment ("+this+")");for(var i=0,curPos=0;;i++){var cur,end=curPos+this.child(i).nodeSize;if(end>=pos)return end==pos||round>0?retIndex(i+1,end):retIndex(i,curPos);curPos=end}},Fragment.prototype.toString=function toString(){return"<"+this.toStringInner()+">"},Fragment.prototype.toStringInner=function toStringInner(){return this.content.join(", ")},Fragment.prototype.toJSON=function toJSON(){return this.content.length?this.content.map((function(n){return n.toJSON()})):null},Fragment.fromJSON=function fromJSON(schema,value){if(!value)return Fragment.empty;if(!Array.isArray(value))throw new RangeError("Invalid input for Fragment.fromJSON");return new Fragment(value.map(schema.nodeFromJSON))},Fragment.fromArray=function fromArray(array){if(!array.length)return Fragment.empty;for(var joined,size=0,i=0;i<array.length;i++){var node=array[i];size+=node.nodeSize,i&&node.isText&&array[i-1].sameMarkup(node)?(joined||(joined=array.slice(0,i)),joined[joined.length-1]=node.withText(joined[joined.length-1].text+node.text)):joined&&joined.push(node)}return new Fragment(joined||array,size)},Fragment.from=function from(nodes){if(!nodes)return Fragment.empty;if(nodes instanceof Fragment)return nodes;if(Array.isArray(nodes))return this.fromArray(nodes);if(nodes.attrs)return new Fragment([nodes],nodes.nodeSize);throw new RangeError("Can not convert "+nodes+" to a Fragment"+(nodes.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))},Object.defineProperties(Fragment.prototype,prototypeAccessors);var found={index:0,offset:0};function retIndex(index,offset){return found.index=index,found.offset=offset,found}function compareDeep(a,b){if(a===b)return!0;if(!a||"object"!=typeof a||!b||"object"!=typeof b)return!1;var array=Array.isArray(a);if(Array.isArray(b)!=array)return!1;if(array){if(a.length!=b.length)return!1;for(var i=0;i<a.length;i++)if(!compareDeep(a[i],b[i]))return!1}else{for(var p in a)if(!(p in b&&compareDeep(a[p],b[p])))return!1;for(var p$1 in b)if(!(p$1 in a))return!1}return!0}Fragment.empty=new Fragment([],0);var Mark=function Mark(type,attrs){this.type=type,this.attrs=attrs};function ReplaceError(message){var err=Error.call(this,message);return err.__proto__=ReplaceError.prototype,err}Mark.prototype.addToSet=function addToSet(set){for(var copy,placed=!1,i=0;i<set.length;i++){var other=set[i];if(this.eq(other))return set;if(this.type.excludes(other.type))copy||(copy=set.slice(0,i));else{if(other.type.excludes(this.type))return set;!placed&&other.type.rank>this.type.rank&&(copy||(copy=set.slice(0,i)),copy.push(this),placed=!0),copy&&copy.push(other)}}return copy||(copy=set.slice()),placed||copy.push(this),copy},Mark.prototype.removeFromSet=function removeFromSet(set){for(var i=0;i<set.length;i++)if(this.eq(set[i]))return set.slice(0,i).concat(set.slice(i+1));return set},Mark.prototype.isInSet=function isInSet(set){for(var i=0;i<set.length;i++)if(this.eq(set[i]))return!0;return!1},Mark.prototype.eq=function eq(other){return this==other||this.type==other.type&&compareDeep(this.attrs,other.attrs)},Mark.prototype.toJSON=function toJSON(){var obj={type:this.type.name};for(var _ in this.attrs){obj.attrs=this.attrs;break}return obj},Mark.fromJSON=function fromJSON(schema,json){if(!json)throw new RangeError("Invalid input for Mark.fromJSON");var type=schema.marks[json.type];if(!type)throw new RangeError("There is no mark type "+json.type+" in this schema");return type.create(json.attrs)},Mark.sameSet=function sameSet(a,b){if(a==b)return!0;if(a.length!=b.length)return!1;for(var i=0;i<a.length;i++)if(!a[i].eq(b[i]))return!1;return!0},Mark.setFrom=function setFrom(marks){if(!marks||0==marks.length)return Mark.none;if(marks instanceof Mark)return[marks];var copy=marks.slice();return copy.sort((function(a,b){return a.type.rank-b.type.rank})),copy},Mark.none=[],ReplaceError.prototype=Object.create(Error.prototype),ReplaceError.prototype.constructor=ReplaceError,ReplaceError.prototype.name="ReplaceError";var Slice=function Slice(content,openStart,openEnd){this.content=content,this.openStart=openStart,this.openEnd=openEnd},prototypeAccessors$1={size:{configurable:!0}};function removeRange(content,from,to){var ref=content.findIndex(from),index=ref.index,offset=ref.offset,child=content.maybeChild(index),ref$1=content.findIndex(to),indexTo=ref$1.index,offsetTo=ref$1.offset;if(offset==from||child.isText){if(offsetTo!=to&&!content.child(indexTo).isText)throw new RangeError("Removing non-flat range");return content.cut(0,from).append(content.cut(to))}if(index!=indexTo)throw new RangeError("Removing non-flat range");return content.replaceChild(index,child.copy(removeRange(child.content,from-offset-1,to-offset-1)))}function insertInto(content,dist,insert,parent){var ref=content.findIndex(dist),index=ref.index,offset=ref.offset,child=content.maybeChild(index);if(offset==dist||child.isText)return parent&&!parent.canReplace(index,index,insert)?null:content.cut(0,dist).append(insert).append(content.cut(dist));var inner=insertInto(child.content,dist-offset-1,insert);return inner&&content.replaceChild(index,child.copy(inner))}function replace($from,$to,slice){if(slice.openStart>$from.depth)throw new ReplaceError("Inserted content deeper than insertion position");if($from.depth-slice.openStart!=$to.depth-slice.openEnd)throw new ReplaceError("Inconsistent open depths");return replaceOuter($from,$to,slice,0)}function replaceOuter($from,$to,slice,depth){var index=$from.index(depth),node=$from.node(depth);if(index==$to.index(depth)&&depth<$from.depth-slice.openStart){var inner=replaceOuter($from,$to,slice,depth+1);return node.copy(node.content.replaceChild(index,inner))}if(slice.content.size){if(slice.openStart||slice.openEnd||$from.depth!=depth||$to.depth!=depth){var ref=prepareSliceForReplace(slice,$from),start,end;return index_es_close(node,replaceThreeWay($from,ref.start,ref.end,$to,depth))}var parent=$from.parent,content=parent.content;return index_es_close(parent,content.cut(0,$from.parentOffset).append(slice.content).append(content.cut($to.parentOffset)))}return index_es_close(node,replaceTwoWay($from,$to,depth))}function checkJoin(main,sub){if(!sub.type.compatibleContent(main.type))throw new ReplaceError("Cannot join "+sub.type.name+" onto "+main.type.name)}function joinable($before,$after,depth){var node=$before.node(depth);return checkJoin(node,$after.node(depth)),node}function addNode(child,target){var last=target.length-1;last>=0&&child.isText&&child.sameMarkup(target[last])?target[last]=child.withText(target[last].text+child.text):target.push(child)}function addRange($start,$end,depth,target){var node=($end||$start).node(depth),startIndex=0,endIndex=$end?$end.index(depth):node.childCount;$start&&(startIndex=$start.index(depth),$start.depth>depth?startIndex++:$start.textOffset&&(addNode($start.nodeAfter,target),startIndex++));for(var i=startIndex;i<endIndex;i++)addNode(node.child(i),target);$end&&$end.depth==depth&&$end.textOffset&&addNode($end.nodeBefore,target)}function index_es_close(node,content){if(!node.type.validContent(content))throw new ReplaceError("Invalid content for node "+node.type.name);return node.copy(content)}function replaceThreeWay($from,$start,$end,$to,depth){var openStart=$from.depth>depth&&joinable($from,$start,depth+1),openEnd=$to.depth>depth&&joinable($end,$to,depth+1),content=[];return addRange(null,$from,depth,content),openStart&&openEnd&&$start.index(depth)==$end.index(depth)?(checkJoin(openStart,openEnd),addNode(index_es_close(openStart,replaceThreeWay($from,$start,$end,$to,depth+1)),content)):(openStart&&addNode(index_es_close(openStart,replaceTwoWay($from,$start,depth+1)),content),addRange($start,$end,depth,content),openEnd&&addNode(index_es_close(openEnd,replaceTwoWay($end,$to,depth+1)),content)),addRange($to,null,depth,content),new Fragment(content)}function replaceTwoWay($from,$to,depth){var content=[],type;(addRange(null,$from,depth,content),$from.depth>depth)&&addNode(index_es_close(joinable($from,$to,depth+1),replaceTwoWay($from,$to,depth+1)),content);return addRange($to,null,depth,content),new Fragment(content)}function prepareSliceForReplace(slice,$along){for(var extra=$along.depth-slice.openStart,parent,node=$along.node(extra).copy(slice.content),i=extra-1;i>=0;i--)node=$along.node(i).copy(Fragment.from(node));return{start:node.resolveNoCache(slice.openStart+extra),end:node.resolveNoCache(node.content.size-slice.openEnd-extra)}}prototypeAccessors$1.size.get=function(){return this.content.size-this.openStart-this.openEnd},Slice.prototype.insertAt=function insertAt(pos,fragment){var content=insertInto(this.content,pos+this.openStart,fragment,null);return content&&new Slice(content,this.openStart,this.openEnd)},Slice.prototype.removeBetween=function removeBetween(from,to){return new Slice(removeRange(this.content,from+this.openStart,to+this.openStart),this.openStart,this.openEnd)},Slice.prototype.eq=function eq(other){return this.content.eq(other.content)&&this.openStart==other.openStart&&this.openEnd==other.openEnd},Slice.prototype.toString=function toString(){return this.content+"("+this.openStart+","+this.openEnd+")"},Slice.prototype.toJSON=function toJSON(){if(!this.content.size)return null;var json={content:this.content.toJSON()};return this.openStart>0&&(json.openStart=this.openStart),this.openEnd>0&&(json.openEnd=this.openEnd),json},Slice.fromJSON=function fromJSON(schema,json){if(!json)return Slice.empty;var openStart=json.openStart||0,openEnd=json.openEnd||0;if("number"!=typeof openStart||"number"!=typeof openEnd)throw new RangeError("Invalid input for Slice.fromJSON");return new Slice(Fragment.fromJSON(schema,json.content),openStart,openEnd)},Slice.maxOpen=function maxOpen(fragment,openIsolating){void 0===openIsolating&&(openIsolating=!0);for(var openStart=0,openEnd=0,n=fragment.firstChild;n&&!n.isLeaf&&(openIsolating||!n.type.spec.isolating);n=n.firstChild)openStart++;for(var n$1=fragment.lastChild;n$1&&!n$1.isLeaf&&(openIsolating||!n$1.type.spec.isolating);n$1=n$1.lastChild)openEnd++;return new Slice(fragment,openStart,openEnd)},Object.defineProperties(Slice.prototype,prototypeAccessors$1),Slice.empty=new Slice(Fragment.empty,0,0);var ResolvedPos=function ResolvedPos(pos,path,parentOffset){this.pos=pos,this.path=path,this.depth=path.length/3-1,this.parentOffset=parentOffset},prototypeAccessors$2={parent:{configurable:!0},doc:{configurable:!0},textOffset:{configurable:!0},nodeAfter:{configurable:!0},nodeBefore:{configurable:!0}};ResolvedPos.prototype.resolveDepth=function resolveDepth(val){return null==val?this.depth:val<0?this.depth+val:val},prototypeAccessors$2.parent.get=function(){return this.node(this.depth)},prototypeAccessors$2.doc.get=function(){return this.node(0)},ResolvedPos.prototype.node=function node(depth){return this.path[3*this.resolveDepth(depth)]},ResolvedPos.prototype.index=function index(depth){return this.path[3*this.resolveDepth(depth)+1]},ResolvedPos.prototype.indexAfter=function indexAfter(depth){return depth=this.resolveDepth(depth),this.index(depth)+(depth!=this.depth||this.textOffset?1:0)},ResolvedPos.prototype.start=function start(depth){return 0==(depth=this.resolveDepth(depth))?0:this.path[3*depth-1]+1},ResolvedPos.prototype.end=function end(depth){return depth=this.resolveDepth(depth),this.start(depth)+this.node(depth).content.size},ResolvedPos.prototype.before=function before(depth){if(!(depth=this.resolveDepth(depth)))throw new RangeError("There is no position before the top-level node");return depth==this.depth+1?this.pos:this.path[3*depth-1]},ResolvedPos.prototype.after=function after(depth){if(!(depth=this.resolveDepth(depth)))throw new RangeError("There is no position after the top-level node");return depth==this.depth+1?this.pos:this.path[3*depth-1]+this.path[3*depth].nodeSize},prototypeAccessors$2.textOffset.get=function(){return this.pos-this.path[this.path.length-1]},prototypeAccessors$2.nodeAfter.get=function(){var parent=this.parent,index=this.index(this.depth);if(index==parent.childCount)return null;var dOff=this.pos-this.path[this.path.length-1],child=parent.child(index);return dOff?parent.child(index).cut(dOff):child},prototypeAccessors$2.nodeBefore.get=function(){var index=this.index(this.depth),dOff=this.pos-this.path[this.path.length-1];return dOff?this.parent.child(index).cut(0,dOff):0==index?null:this.parent.child(index-1)},ResolvedPos.prototype.posAtIndex=function posAtIndex(index,depth){depth=this.resolveDepth(depth);for(var node=this.path[3*depth],pos=0==depth?0:this.path[3*depth-1]+1,i=0;i<index;i++)pos+=node.child(i).nodeSize;return pos},ResolvedPos.prototype.marks=function marks(){var parent=this.parent,index=this.index();if(0==parent.content.size)return Mark.none;if(this.textOffset)return parent.child(index).marks;var main=parent.maybeChild(index-1),other=parent.maybeChild(index);if(!main){var tmp=main;main=other,other=tmp}for(var marks=main.marks,i=0;i<marks.length;i++)!1!==marks[i].type.spec.inclusive||other&&marks[i].isInSet(other.marks)||(marks=marks[i--].removeFromSet(marks));return marks},ResolvedPos.prototype.marksAcross=function marksAcross($end){var after=this.parent.maybeChild(this.index());if(!after||!after.isInline)return null;for(var marks=after.marks,next=$end.parent.maybeChild($end.index()),i=0;i<marks.length;i++)!1!==marks[i].type.spec.inclusive||next&&marks[i].isInSet(next.marks)||(marks=marks[i--].removeFromSet(marks));return marks},ResolvedPos.prototype.sharedDepth=function sharedDepth(pos){for(var depth=this.depth;depth>0;depth--)if(this.start(depth)<=pos&&this.end(depth)>=pos)return depth;return 0},ResolvedPos.prototype.blockRange=function blockRange(other,pred){if(void 0===other&&(other=this),other.pos<this.pos)return other.blockRange(this);for(var d=this.depth-(this.parent.inlineContent||this.pos==other.pos?1:0);d>=0;d--)if(other.pos<=this.end(d)&&(!pred||pred(this.node(d))))return new NodeRange(this,other,d)},ResolvedPos.prototype.sameParent=function sameParent(other){return this.pos-this.parentOffset==other.pos-other.parentOffset},ResolvedPos.prototype.max=function max(other){return other.pos>this.pos?other:this},ResolvedPos.prototype.min=function min(other){return other.pos<this.pos?other:this},ResolvedPos.prototype.toString=function toString(){for(var str="",i=1;i<=this.depth;i++)str+=(str?"/":"")+this.node(i).type.name+"_"+this.index(i-1);return str+":"+this.parentOffset},ResolvedPos.resolve=function resolve(doc,pos){if(!(pos>=0&&pos<=doc.content.size))throw new RangeError("Position "+pos+" out of range");for(var path=[],start=0,parentOffset=pos,node=doc;;){var ref=node.content.findIndex(parentOffset),index=ref.index,offset=ref.offset,rem=parentOffset-offset;if(path.push(node,index,start+offset),!rem)break;if((node=node.child(index)).isText)break;parentOffset=rem-1,start+=offset+1}return new ResolvedPos(pos,path,parentOffset)},ResolvedPos.resolveCached=function resolveCached(doc,pos){for(var i=0;i<resolveCache.length;i++){var cached=resolveCache[i];if(cached.pos==pos&&cached.doc==doc)return cached}var result=resolveCache[resolveCachePos]=ResolvedPos.resolve(doc,pos);return resolveCachePos=(resolveCachePos+1)%resolveCacheSize,result},Object.defineProperties(ResolvedPos.prototype,prototypeAccessors$2);var resolveCache=[],resolveCachePos=0,resolveCacheSize=12,NodeRange=function NodeRange($from,$to,depth){this.$from=$from,this.$to=$to,this.depth=depth},prototypeAccessors$1$1={start:{configurable:!0},end:{configurable:!0},parent:{configurable:!0},startIndex:{configurable:!0},endIndex:{configurable:!0}};prototypeAccessors$1$1.start.get=function(){return this.$from.before(this.depth+1)},prototypeAccessors$1$1.end.get=function(){return this.$to.after(this.depth+1)},prototypeAccessors$1$1.parent.get=function(){return this.$from.node(this.depth)},prototypeAccessors$1$1.startIndex.get=function(){return this.$from.index(this.depth)},prototypeAccessors$1$1.endIndex.get=function(){return this.$to.indexAfter(this.depth)},Object.defineProperties(NodeRange.prototype,prototypeAccessors$1$1);var emptyAttrs=Object.create(null),index_es_Node=function Node(type,attrs,content,marks){this.type=type,this.attrs=attrs,this.content=content||Fragment.empty,this.marks=marks||Mark.none},prototypeAccessors$3={nodeSize:{configurable:!0},childCount:{configurable:!0},textContent:{configurable:!0},firstChild:{configurable:!0},lastChild:{configurable:!0},isBlock:{configurable:!0},isTextblock:{configurable:!0},inlineContent:{configurable:!0},isInline:{configurable:!0},isText:{configurable:!0},isLeaf:{configurable:!0},isAtom:{configurable:!0}};prototypeAccessors$3.nodeSize.get=function(){return this.isLeaf?1:2+this.content.size},prototypeAccessors$3.childCount.get=function(){return this.content.childCount},index_es_Node.prototype.child=function child(index){return this.content.child(index)},index_es_Node.prototype.maybeChild=function maybeChild(index){return this.content.maybeChild(index)},index_es_Node.prototype.forEach=function forEach(f){this.content.forEach(f)},index_es_Node.prototype.nodesBetween=function nodesBetween(from,to,f,startPos){void 0===startPos&&(startPos=0),this.content.nodesBetween(from,to,f,startPos,this)},index_es_Node.prototype.descendants=function descendants(f){this.nodesBetween(0,this.content.size,f)},prototypeAccessors$3.textContent.get=function(){return this.textBetween(0,this.content.size,"")},index_es_Node.prototype.textBetween=function textBetween(from,to,blockSeparator,leafText){return this.content.textBetween(from,to,blockSeparator,leafText)},prototypeAccessors$3.firstChild.get=function(){return this.content.firstChild},prototypeAccessors$3.lastChild.get=function(){return this.content.lastChild},index_es_Node.prototype.eq=function eq(other){return this==other||this.sameMarkup(other)&&this.content.eq(other.content)},index_es_Node.prototype.sameMarkup=function sameMarkup(other){return this.hasMarkup(other.type,other.attrs,other.marks)},index_es_Node.prototype.hasMarkup=function hasMarkup(type,attrs,marks){return this.type==type&&compareDeep(this.attrs,attrs||type.defaultAttrs||emptyAttrs)&&Mark.sameSet(this.marks,marks||Mark.none)},index_es_Node.prototype.copy=function copy(content){return void 0===content&&(content=null),content==this.content?this:new this.constructor(this.type,this.attrs,content,this.marks)},index_es_Node.prototype.mark=function mark(marks){return marks==this.marks?this:new this.constructor(this.type,this.attrs,this.content,marks)},index_es_Node.prototype.cut=function cut(from,to){return 0==from&&to==this.content.size?this:this.copy(this.content.cut(from,to))},index_es_Node.prototype.slice=function slice(from,to,includeParents){if(void 0===to&&(to=this.content.size),void 0===includeParents&&(includeParents=!1),from==to)return Slice.empty;var $from=this.resolve(from),$to=this.resolve(to),depth=includeParents?0:$from.sharedDepth(to),start=$from.start(depth),node,content=$from.node(depth).content.cut($from.pos-start,$to.pos-start);return new Slice(content,$from.depth-depth,$to.depth-depth)},index_es_Node.prototype.replace=function replace$1(from,to,slice){return replace(this.resolve(from),this.resolve(to),slice)},index_es_Node.prototype.nodeAt=function nodeAt(pos){for(var node=this;;){var ref=node.content.findIndex(pos),index=ref.index,offset=ref.offset;if(!(node=node.maybeChild(index)))return null;if(offset==pos||node.isText)return node;pos-=offset+1}},index_es_Node.prototype.childAfter=function childAfter(pos){var ref=this.content.findIndex(pos),index=ref.index,offset=ref.offset;return{node:this.content.maybeChild(index),index:index,offset:offset}},index_es_Node.prototype.childBefore=function childBefore(pos){if(0==pos)return{node:null,index:0,offset:0};var ref=this.content.findIndex(pos),index=ref.index,offset=ref.offset;if(offset<pos)return{node:this.content.child(index),index:index,offset:offset};var node=this.content.child(index-1);return{node:node,index:index-1,offset:offset-node.nodeSize}},index_es_Node.prototype.resolve=function resolve(pos){return ResolvedPos.resolveCached(this,pos)},index_es_Node.prototype.resolveNoCache=function resolveNoCache(pos){return ResolvedPos.resolve(this,pos)},index_es_Node.prototype.rangeHasMark=function rangeHasMark(from,to,type){var found=!1;return to>from&&this.nodesBetween(from,to,(function(node){return type.isInSet(node.marks)&&(found=!0),!found})),found},prototypeAccessors$3.isBlock.get=function(){return this.type.isBlock},prototypeAccessors$3.isTextblock.get=function(){return this.type.isTextblock},prototypeAccessors$3.inlineContent.get=function(){return this.type.inlineContent},prototypeAccessors$3.isInline.get=function(){return this.type.isInline},prototypeAccessors$3.isText.get=function(){return this.type.isText},prototypeAccessors$3.isLeaf.get=function(){return this.type.isLeaf},prototypeAccessors$3.isAtom.get=function(){return this.type.isAtom},index_es_Node.prototype.toString=function toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);var name=this.type.name;return this.content.size&&(name+="("+this.content.toStringInner()+")"),wrapMarks(this.marks,name)},index_es_Node.prototype.contentMatchAt=function contentMatchAt(index){var match=this.type.contentMatch.matchFragment(this.content,0,index);if(!match)throw new Error("Called contentMatchAt on a node with invalid content");return match},index_es_Node.prototype.canReplace=function canReplace(from,to,replacement,start,end){void 0===replacement&&(replacement=Fragment.empty),void 0===start&&(start=0),void 0===end&&(end=replacement.childCount);var one=this.contentMatchAt(from).matchFragment(replacement,start,end),two=one&&one.matchFragment(this.content,to);if(!two||!two.validEnd)return!1;for(var i=start;i<end;i++)if(!this.type.allowsMarks(replacement.child(i).marks))return!1;return!0},index_es_Node.prototype.canReplaceWith=function canReplaceWith(from,to,type,marks){if(marks&&!this.type.allowsMarks(marks))return!1;var start=this.contentMatchAt(from).matchType(type),end=start&&start.matchFragment(this.content,to);return!!end&&end.validEnd},index_es_Node.prototype.canAppend=function canAppend(other){return other.content.size?this.canReplace(this.childCount,this.childCount,other.content):this.type.compatibleContent(other.type)},index_es_Node.prototype.check=function check(){if(!this.type.validContent(this.content))throw new RangeError("Invalid content for node "+this.type.name+": "+this.content.toString().slice(0,50));for(var copy=Mark.none,i=0;i<this.marks.length;i++)copy=this.marks[i].addToSet(copy);if(!Mark.sameSet(copy,this.marks))throw new RangeError("Invalid collection of marks for node "+this.type.name+": "+this.marks.map((function(m){return m.type.name})));this.content.forEach((function(node){return node.check()}))},index_es_Node.prototype.toJSON=function toJSON(){var obj={type:this.type.name};for(var _ in this.attrs){obj.attrs=this.attrs;break}return this.content.size&&(obj.content=this.content.toJSON()),this.marks.length&&(obj.marks=this.marks.map((function(n){return n.toJSON()}))),obj},index_es_Node.fromJSON=function fromJSON(schema,json){if(!json)throw new RangeError("Invalid input for Node.fromJSON");var marks=null;if(json.marks){if(!Array.isArray(json.marks))throw new RangeError("Invalid mark data for Node.fromJSON");marks=json.marks.map(schema.markFromJSON)}if("text"==json.type){if("string"!=typeof json.text)throw new RangeError("Invalid text node in JSON");return schema.text(json.text,marks)}var content=Fragment.fromJSON(schema,json.content);return schema.nodeType(json.type).create(json.attrs,content,marks)},Object.defineProperties(index_es_Node.prototype,prototypeAccessors$3);var TextNode=function(Node){function TextNode(type,attrs,content,marks){if(Node.call(this,type,attrs,null,marks),!content)throw new RangeError("Empty text nodes are not allowed");this.text=content}Node&&(TextNode.__proto__=Node),TextNode.prototype=Object.create(Node&&Node.prototype),TextNode.prototype.constructor=TextNode;var prototypeAccessors$1={textContent:{configurable:!0},nodeSize:{configurable:!0}};return TextNode.prototype.toString=function toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):wrapMarks(this.marks,JSON.stringify(this.text))},prototypeAccessors$1.textContent.get=function(){return this.text},TextNode.prototype.textBetween=function textBetween(from,to){return this.text.slice(from,to)},prototypeAccessors$1.nodeSize.get=function(){return this.text.length},TextNode.prototype.mark=function mark(marks){return marks==this.marks?this:new TextNode(this.type,this.attrs,this.text,marks)},TextNode.prototype.withText=function withText(text){return text==this.text?this:new TextNode(this.type,this.attrs,text,this.marks)},TextNode.prototype.cut=function cut(from,to){return void 0===from&&(from=0),void 0===to&&(to=this.text.length),0==from&&to==this.text.length?this:this.withText(this.text.slice(from,to))},TextNode.prototype.eq=function eq(other){return this.sameMarkup(other)&&this.text==other.text},TextNode.prototype.toJSON=function toJSON(){var base=Node.prototype.toJSON.call(this);return base.text=this.text,base},Object.defineProperties(TextNode.prototype,prototypeAccessors$1),TextNode}(index_es_Node);function wrapMarks(marks,str){for(var i=marks.length-1;i>=0;i--)str=marks[i].type.name+"("+str+")";return str}var ContentMatch=function ContentMatch(validEnd){this.validEnd=validEnd,this.next=[],this.wrapCache=[]},prototypeAccessors$4={inlineContent:{configurable:!0},defaultType:{configurable:!0},edgeCount:{configurable:!0}};ContentMatch.parse=function parse(string,nodeTypes){var stream=new TokenStream(string,nodeTypes);if(null==stream.next)return ContentMatch.empty;var expr=parseExpr(stream);stream.next&&stream.err("Unexpected trailing text");var match=dfa(nfa(expr));return checkForDeadEnds(match,stream),match},ContentMatch.prototype.matchType=function matchType(type){for(var i=0;i<this.next.length;i+=2)if(this.next[i]==type)return this.next[i+1];return null},ContentMatch.prototype.matchFragment=function matchFragment(frag,start,end){void 0===start&&(start=0),void 0===end&&(end=frag.childCount);for(var cur=this,i=start;cur&&i<end;i++)cur=cur.matchType(frag.child(i).type);return cur},prototypeAccessors$4.inlineContent.get=function(){var first=this.next[0];return!!first&&first.isInline},prototypeAccessors$4.defaultType.get=function(){for(var i=0;i<this.next.length;i+=2){var type=this.next[i];if(!type.isText&&!type.hasRequiredAttrs())return type}},ContentMatch.prototype.compatible=function compatible(other){for(var i=0;i<this.next.length;i+=2)for(var j=0;j<other.next.length;j+=2)if(this.next[i]==other.next[j])return!0;return!1},ContentMatch.prototype.fillBefore=function fillBefore(after,toEnd,startIndex){void 0===toEnd&&(toEnd=!1),void 0===startIndex&&(startIndex=0);var seen=[this];function search(match,types){var finished=match.matchFragment(after,startIndex);if(finished&&(!toEnd||finished.validEnd))return Fragment.from(types.map((function(tp){return tp.createAndFill()})));for(var i=0;i<match.next.length;i+=2){var type=match.next[i],next=match.next[i+1];if(!type.isText&&!type.hasRequiredAttrs()&&-1==seen.indexOf(next)){seen.push(next);var found=search(next,types.concat(type));if(found)return found}}}return search(this,[])},ContentMatch.prototype.findWrapping=function findWrapping(target){for(var i=0;i<this.wrapCache.length;i+=2)if(this.wrapCache[i]==target)return this.wrapCache[i+1];var computed=this.computeWrapping(target);return this.wrapCache.push(target,computed),computed},ContentMatch.prototype.computeWrapping=function computeWrapping(target){for(var seen=Object.create(null),active=[{match:this,type:null,via:null}];active.length;){var current=active.shift(),match=current.match;if(match.matchType(target)){for(var result=[],obj=current;obj.type;obj=obj.via)result.push(obj.type);return result.reverse()}for(var i=0;i<match.next.length;i+=2){var type=match.next[i];type.isLeaf||type.hasRequiredAttrs()||type.name in seen||current.type&&!match.next[i+1].validEnd||(active.push({match:type.contentMatch,type:type,via:current}),seen[type.name]=!0)}}},prototypeAccessors$4.edgeCount.get=function(){return this.next.length>>1},ContentMatch.prototype.edge=function edge(n){var i=n<<1;if(i>=this.next.length)throw new RangeError("There's no "+n+"th edge in this content match");return{type:this.next[i],next:this.next[i+1]}},ContentMatch.prototype.toString=function toString(){var seen=[];function scan(m){seen.push(m);for(var i=1;i<m.next.length;i+=2)-1==seen.indexOf(m.next[i])&&scan(m.next[i])}return scan(this),seen.map((function(m,i){for(var out=i+(m.validEnd?"*":" ")+" ",i$1=0;i$1<m.next.length;i$1+=2)out+=(i$1?", ":"")+m.next[i$1].name+"->"+seen.indexOf(m.next[i$1+1]);return out})).join("\n")},Object.defineProperties(ContentMatch.prototype,prototypeAccessors$4),ContentMatch.empty=new ContentMatch(!0);var TokenStream=function TokenStream(string,nodeTypes){this.string=string,this.nodeTypes=nodeTypes,this.inline=null,this.pos=0,this.tokens=string.split(/\s*(?=\b|\W|$)/),""==this.tokens[this.tokens.length-1]&&this.tokens.pop(),""==this.tokens[0]&&this.tokens.shift()},prototypeAccessors$1$2={next:{configurable:!0}};function parseExpr(stream){var exprs=[];do{exprs.push(parseExprSeq(stream))}while(stream.eat("|"));return 1==exprs.length?exprs[0]:{type:"choice",exprs:exprs}}function parseExprSeq(stream){var exprs=[];do{exprs.push(parseExprSubscript(stream))}while(stream.next&&")"!=stream.next&&"|"!=stream.next);return 1==exprs.length?exprs[0]:{type:"seq",exprs:exprs}}function parseExprSubscript(stream){for(var expr=parseExprAtom(stream);;)if(stream.eat("+"))expr={type:"plus",expr:expr};else if(stream.eat("*"))expr={type:"star",expr:expr};else if(stream.eat("?"))expr={type:"opt",expr:expr};else{if(!stream.eat("{"))break;expr=parseExprRange(stream,expr)}return expr}function parseNum(stream){/\D/.test(stream.next)&&stream.err("Expected number, got '"+stream.next+"'");var result=Number(stream.next);return stream.pos++,result}function parseExprRange(stream,expr){var min=parseNum(stream),max=min;return stream.eat(",")&&(max="}"!=stream.next?parseNum(stream):-1),stream.eat("}")||stream.err("Unclosed braced range"),{type:"range",min:min,max:max,expr:expr}}function resolveName(stream,name){var types=stream.nodeTypes,type=types[name];if(type)return[type];var result=[];for(var typeName in types){var type$1=types[typeName];type$1.groups.indexOf(name)>-1&&result.push(type$1)}return 0==result.length&&stream.err("No node type or group '"+name+"' found"),result}function parseExprAtom(stream){if(stream.eat("(")){var expr=parseExpr(stream);return stream.eat(")")||stream.err("Missing closing paren"),expr}if(!/\W/.test(stream.next)){var exprs=resolveName(stream,stream.next).map((function(type){return null==stream.inline?stream.inline=type.isInline:stream.inline!=type.isInline&&stream.err("Mixing inline and block content"),{type:"name",value:type}}));return stream.pos++,1==exprs.length?exprs[0]:{type:"choice",exprs:exprs}}stream.err("Unexpected token '"+stream.next+"'")}function nfa(expr){var nfa=[[]];return connect(compile(expr,0),node()),nfa;function node(){return nfa.push([])-1}function edge(from,to,term){var edge={term:term,to:to};return nfa[from].push(edge),edge}function connect(edges,to){edges.forEach((function(edge){return edge.to=to}))}function compile(expr,from){if("choice"==expr.type)return expr.exprs.reduce((function(out,expr){return out.concat(compile(expr,from))}),[]);if("seq"==expr.type)for(var i=0;;i++){var next=compile(expr.exprs[i],from);if(i==expr.exprs.length-1)return next;connect(next,from=node())}else{if("star"==expr.type){var loop=node();return edge(from,loop),connect(compile(expr.expr,loop),loop),[edge(loop)]}if("plus"==expr.type){var loop$1=node();return connect(compile(expr.expr,from),loop$1),connect(compile(expr.expr,loop$1),loop$1),[edge(loop$1)]}if("opt"==expr.type)return[edge(from)].concat(compile(expr.expr,from));if("range"==expr.type){for(var cur=from,i$1=0;i$1<expr.min;i$1++){var next$1=node();connect(compile(expr.expr,cur),next$1),cur=next$1}if(-1==expr.max)connect(compile(expr.expr,cur),cur);else for(var i$2=expr.min;i$2<expr.max;i$2++){var next$2=node();edge(cur,next$2),connect(compile(expr.expr,cur),next$2),cur=next$2}return[edge(cur)]}if("name"==expr.type)return[edge(from,null,expr.value)]}}}function cmp(a,b){return b-a}function nullFrom(nfa,node){var result=[];return scan(node),result.sort(cmp);function scan(node){var edges=nfa[node];if(1==edges.length&&!edges[0].term)return scan(edges[0].to);result.push(node);for(var i=0;i<edges.length;i++){var ref=edges[i],term=ref.term,to=ref.to;term||-1!=result.indexOf(to)||scan(to)}}}function dfa(nfa){var labeled=Object.create(null);return explore(nullFrom(nfa,0));function explore(states){var out=[];states.forEach((function(node){nfa[node].forEach((function(ref){var term=ref.term,to=ref.to;if(term){var known=out.indexOf(term),set=known>-1&&out[known+1];nullFrom(nfa,to).forEach((function(node){set||out.push(term,set=[]),-1==set.indexOf(node)&&set.push(node)}))}}))}));for(var state=labeled[states.join(",")]=new ContentMatch(states.indexOf(nfa.length-1)>-1),i=0;i<out.length;i+=2){var states$1=out[i+1].sort(cmp);state.next.push(out[i],labeled[states$1.join(",")]||explore(states$1))}return state}}function checkForDeadEnds(match,stream){for(var i=0,work=[match];i<work.length;i++){for(var state=work[i],dead=!state.validEnd,nodes=[],j=0;j<state.next.length;j+=2){var node=state.next[j],next=state.next[j+1];nodes.push(node.name),!dead||node.isText||node.hasRequiredAttrs()||(dead=!1),-1==work.indexOf(next)&&work.push(next)}dead&&stream.err("Only non-generatable nodes ("+nodes.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function defaultAttrs(attrs){var defaults=Object.create(null);for(var attrName in attrs){var attr=attrs[attrName];if(!attr.hasDefault)return null;defaults[attrName]=attr.default}return defaults}function computeAttrs(attrs,value){var built=Object.create(null);for(var name in attrs){var given=value&&value[name];if(void 0===given){var attr=attrs[name];if(!attr.hasDefault)throw new RangeError("No value supplied for attribute "+name);given=attr.default}built[name]=given}return built}function initAttrs(attrs){var result=Object.create(null);if(attrs)for(var name in attrs)result[name]=new Attribute(attrs[name]);return result}prototypeAccessors$1$2.next.get=function(){return this.tokens[this.pos]},TokenStream.prototype.eat=function eat(tok){return this.next==tok&&(this.pos++||!0)},TokenStream.prototype.err=function err(str){throw new SyntaxError(str+" (in content expression '"+this.string+"')")},Object.defineProperties(TokenStream.prototype,prototypeAccessors$1$2);var NodeType=function NodeType(name,schema,spec){this.name=name,this.schema=schema,this.spec=spec,this.groups=spec.group?spec.group.split(" "):[],this.attrs=initAttrs(spec.attrs),this.defaultAttrs=defaultAttrs(this.attrs),this.contentMatch=null,this.markSet=null,this.inlineContent=null,this.isBlock=!(spec.inline||"text"==name),this.isText="text"==name},prototypeAccessors$5={isInline:{configurable:!0},isTextblock:{configurable:!0},isLeaf:{configurable:!0},isAtom:{configurable:!0}};prototypeAccessors$5.isInline.get=function(){return!this.isBlock},prototypeAccessors$5.isTextblock.get=function(){return this.isBlock&&this.inlineContent},prototypeAccessors$5.isLeaf.get=function(){return this.contentMatch==ContentMatch.empty},prototypeAccessors$5.isAtom.get=function(){return this.isLeaf||this.spec.atom},NodeType.prototype.hasRequiredAttrs=function hasRequiredAttrs(){for(var n in this.attrs)if(this.attrs[n].isRequired)return!0;return!1},NodeType.prototype.compatibleContent=function compatibleContent(other){return this==other||this.contentMatch.compatible(other.contentMatch)},NodeType.prototype.computeAttrs=function computeAttrs$1(attrs){return!attrs&&this.defaultAttrs?this.defaultAttrs:computeAttrs(this.attrs,attrs)},NodeType.prototype.create=function create(attrs,content,marks){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new index_es_Node(this,this.computeAttrs(attrs),Fragment.from(content),Mark.setFrom(marks))},NodeType.prototype.createChecked=function createChecked(attrs,content,marks){if(content=Fragment.from(content),!this.validContent(content))throw new RangeError("Invalid content for node "+this.name);return new index_es_Node(this,this.computeAttrs(attrs),content,Mark.setFrom(marks))},NodeType.prototype.createAndFill=function createAndFill(attrs,content,marks){if(attrs=this.computeAttrs(attrs),(content=Fragment.from(content)).size){var before=this.contentMatch.fillBefore(content);if(!before)return null;content=before.append(content)}var after=this.contentMatch.matchFragment(content).fillBefore(Fragment.empty,!0);return after?new index_es_Node(this,attrs,content.append(after),Mark.setFrom(marks)):null},NodeType.prototype.validContent=function validContent(content){var result=this.contentMatch.matchFragment(content);if(!result||!result.validEnd)return!1;for(var i=0;i<content.childCount;i++)if(!this.allowsMarks(content.child(i).marks))return!1;return!0},NodeType.prototype.allowsMarkType=function allowsMarkType(markType){return null==this.markSet||this.markSet.indexOf(markType)>-1},NodeType.prototype.allowsMarks=function allowsMarks(marks){if(null==this.markSet)return!0;for(var i=0;i<marks.length;i++)if(!this.allowsMarkType(marks[i].type))return!1;return!0},NodeType.prototype.allowedMarks=function allowedMarks(marks){if(null==this.markSet)return marks;for(var copy,i=0;i<marks.length;i++)this.allowsMarkType(marks[i].type)?copy&&copy.push(marks[i]):copy||(copy=marks.slice(0,i));return copy?copy.length?copy:Mark.empty:marks},NodeType.compile=function compile(nodes,schema){var result=Object.create(null);nodes.forEach((function(name,spec){return result[name]=new NodeType(name,schema,spec)}));var topType=schema.spec.topNode||"doc";if(!result[topType])throw new RangeError("Schema is missing its top node type ('"+topType+"')");if(!result.text)throw new RangeError("Every schema needs a 'text' type");for(var _ in result.text.attrs)throw new RangeError("The text node type should not have attributes");return result},Object.defineProperties(NodeType.prototype,prototypeAccessors$5);var Attribute=function Attribute(options){this.hasDefault=Object.prototype.hasOwnProperty.call(options,"default"),this.default=options.default},prototypeAccessors$1$3={isRequired:{configurable:!0}};prototypeAccessors$1$3.isRequired.get=function(){return!this.hasDefault},Object.defineProperties(Attribute.prototype,prototypeAccessors$1$3);var MarkType=function MarkType(name,rank,schema,spec){this.name=name,this.schema=schema,this.spec=spec,this.attrs=initAttrs(spec.attrs),this.rank=rank,this.excluded=null;var defaults=defaultAttrs(this.attrs);this.instance=defaults&&new Mark(this,defaults)};MarkType.prototype.create=function create(attrs){return!attrs&&this.instance?this.instance:new Mark(this,computeAttrs(this.attrs,attrs))},MarkType.compile=function compile(marks,schema){var result=Object.create(null),rank=0;return marks.forEach((function(name,spec){return result[name]=new MarkType(name,rank++,schema,spec)})),result},MarkType.prototype.removeFromSet=function removeFromSet(set){for(var i=0;i<set.length;i++)set[i].type==this&&(set=set.slice(0,i).concat(set.slice(i+1)),i--);return set},MarkType.prototype.isInSet=function isInSet(set){for(var i=0;i<set.length;i++)if(set[i].type==this)return set[i]},MarkType.prototype.excludes=function excludes(other){return this.excluded.indexOf(other)>-1};var Schema=function Schema(spec){for(var prop in this.spec={},spec)this.spec[prop]=spec[prop];this.spec.nodes=index_es.from(spec.nodes),this.spec.marks=index_es.from(spec.marks),this.nodes=NodeType.compile(this.spec.nodes,this),this.marks=MarkType.compile(this.spec.marks,this);var contentExprCache=Object.create(null);for(var prop$1 in this.nodes){if(prop$1 in this.marks)throw new RangeError(prop$1+" can not be both a node and a mark");var type=this.nodes[prop$1],contentExpr=type.spec.content||"",markExpr=type.spec.marks;type.contentMatch=contentExprCache[contentExpr]||(contentExprCache[contentExpr]=ContentMatch.parse(contentExpr,this.nodes)),type.inlineContent=type.contentMatch.inlineContent,type.markSet="_"==markExpr?null:markExpr?gatherMarks(this,markExpr.split(" ")):""!=markExpr&&type.inlineContent?null:[]}for(var prop$2 in this.marks){var type$1=this.marks[prop$2],excl=type$1.spec.excludes;type$1.excluded=null==excl?[type$1]:""==excl?[]:gatherMarks(this,excl.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached=Object.create(null),this.cached.wrappings=Object.create(null)};function gatherMarks(schema,marks){for(var found=[],i=0;i<marks.length;i++){var name=marks[i],mark=schema.marks[name],ok=mark;if(mark)found.push(mark);else for(var prop in schema.marks){var mark$1=schema.marks[prop];("_"==name||mark$1.spec.group&&mark$1.spec.group.split(" ").indexOf(name)>-1)&&found.push(ok=mark$1)}if(!ok)throw new SyntaxError("Unknown mark type: '"+marks[i]+"'")}return found}Schema.prototype.node=function node(type,attrs,content,marks){if("string"==typeof type)type=this.nodeType(type);else{if(!(type instanceof NodeType))throw new RangeError("Invalid node type: "+type);if(type.schema!=this)throw new RangeError("Node type from different schema used ("+type.name+")")}return type.createChecked(attrs,content,marks)},Schema.prototype.text=function text(text$1,marks){var type=this.nodes.text;return new TextNode(type,type.defaultAttrs,text$1,Mark.setFrom(marks))},Schema.prototype.mark=function mark(type,attrs){return"string"==typeof type&&(type=this.marks[type]),type.create(attrs)},Schema.prototype.nodeFromJSON=function nodeFromJSON(json){return index_es_Node.fromJSON(this,json)},Schema.prototype.markFromJSON=function markFromJSON(json){return Mark.fromJSON(this,json)},Schema.prototype.nodeType=function nodeType(name){var found=this.nodes[name];if(!found)throw new RangeError("Unknown node type: "+name);return found};var DOMParser=function DOMParser(schema,rules){var this$1=this;this.schema=schema,this.rules=rules,this.tags=[],this.styles=[],rules.forEach((function(rule){rule.tag?this$1.tags.push(rule):rule.style&&this$1.styles.push(rule)})),this.normalizeLists=!this.tags.some((function(r){if(!/^(ul|ol)\b/.test(r.tag)||!r.node)return!1;var node=schema.nodes[r.node];return node.contentMatch.matchType(node)}))};DOMParser.prototype.parse=function parse(dom,options){void 0===options&&(options={});var context=new ParseContext(this,options,!1);return context.addAll(dom,null,options.from,options.to),context.finish()},DOMParser.prototype.parseSlice=function parseSlice(dom,options){void 0===options&&(options={});var context=new ParseContext(this,options,!0);return context.addAll(dom,null,options.from,options.to),Slice.maxOpen(context.finish())},DOMParser.prototype.matchTag=function matchTag(dom,context,after){for(var i=after?this.tags.indexOf(after)+1:0;i<this.tags.length;i++){var rule=this.tags[i];if(matches(dom,rule.tag)&&(void 0===rule.namespace||dom.namespaceURI==rule.namespace)&&(!rule.context||context.matchesContext(rule.context))){if(rule.getAttrs){var result=rule.getAttrs(dom);if(!1===result)continue;rule.attrs=result}return rule}}},DOMParser.prototype.matchStyle=function matchStyle(prop,value,context,after){for(var i=after?this.styles.indexOf(after)+1:0;i<this.styles.length;i++){var rule=this.styles[i];if(!(0!=rule.style.indexOf(prop)||rule.context&&!context.matchesContext(rule.context)||rule.style.length>prop.length&&(61!=rule.style.charCodeAt(prop.length)||rule.style.slice(prop.length+1)!=value))){if(rule.getAttrs){var result=rule.getAttrs(value);if(!1===result)continue;rule.attrs=result}return rule}}},DOMParser.schemaRules=function schemaRules(schema){var result=[];function insert(rule){for(var priority=null==rule.priority?50:rule.priority,i=0;i<result.length;i++){var next=result[i],nextPriority;if((null==next.priority?50:next.priority)<priority)break}result.splice(i,0,rule)}var loop=function(name){var rules=schema.marks[name].spec.parseDOM;rules&&rules.forEach((function(rule){insert(rule=copy(rule)),rule.mark=name}))};for(var name in schema.marks)loop(name);var loop$1=function(name){var rules$1=schema.nodes[name$1].spec.parseDOM;rules$1&&rules$1.forEach((function(rule){insert(rule=copy(rule)),rule.node=name$1}))};for(var name$1 in schema.nodes)loop$1();return result},DOMParser.fromSchema=function fromSchema(schema){return schema.cached.domParser||(schema.cached.domParser=new DOMParser(schema,DOMParser.schemaRules(schema)))};var blockTags={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},ignoreTags={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},listTags={ol:!0,ul:!0},OPT_PRESERVE_WS=1,OPT_PRESERVE_WS_FULL=2,OPT_OPEN_LEFT=4;function wsOptionsFor(preserveWhitespace){return(preserveWhitespace?1:0)|("full"===preserveWhitespace?2:0)}var NodeContext=function NodeContext(type,attrs,marks,pendingMarks,solid,match,options){this.type=type,this.attrs=attrs,this.solid=solid,this.match=match||(4&options?null:type.contentMatch),this.options=options,this.content=[],this.marks=marks,this.activeMarks=Mark.none,this.pendingMarks=pendingMarks,this.stashMarks=[]};NodeContext.prototype.findWrapping=function findWrapping(node){if(!this.match){if(!this.type)return[];var fill=this.type.contentMatch.fillBefore(Fragment.from(node));if(!fill){var start=this.type.contentMatch,wrap;return(wrap=start.findWrapping(node.type))?(this.match=start,wrap):null}this.match=this.type.contentMatch.matchFragment(fill)}return this.match.findWrapping(node.type)},NodeContext.prototype.finish=function finish(openEnd){if(!(1&this.options)){var last=this.content[this.content.length-1],m;last&&last.isText&&(m=/[ \t\r\n\u000c]+$/.exec(last.text))&&(last.text.length==m[0].length?this.content.pop():this.content[this.content.length-1]=last.withText(last.text.slice(0,last.text.length-m[0].length)))}var content=Fragment.from(this.content);return!openEnd&&this.match&&(content=content.append(this.match.fillBefore(Fragment.empty,!0))),this.type?this.type.create(this.attrs,content,this.marks):content},NodeContext.prototype.popFromStashMark=function popFromStashMark(mark){for(var i=this.stashMarks.length-1;i>=0;i--)if(mark.eq(this.stashMarks[i]))return this.stashMarks.splice(i,1)[0]},NodeContext.prototype.applyPending=function applyPending(nextType){for(var i=0,pending=this.pendingMarks;i<pending.length;i++){var mark=pending[i];(this.type?this.type.allowsMarkType(mark.type):markMayApply(mark.type,nextType))&&!mark.isInSet(this.activeMarks)&&(this.activeMarks=mark.addToSet(this.activeMarks),this.pendingMarks=mark.removeFromSet(this.pendingMarks))}};var ParseContext=function ParseContext(parser,options,open){this.parser=parser,this.options=options,this.isOpen=open;var topNode=options.topNode,topContext,topOptions=wsOptionsFor(options.preserveWhitespace)|(open?4:0);topContext=topNode?new NodeContext(topNode.type,topNode.attrs,Mark.none,Mark.none,!0,options.topMatch||topNode.type.contentMatch,topOptions):new NodeContext(open?null:parser.schema.topNodeType,null,Mark.none,Mark.none,!0,null,topOptions),this.nodes=[topContext],this.open=0,this.find=options.findPositions,this.needsBlock=!1},prototypeAccessors$6={top:{configurable:!0},currentPos:{configurable:!0}};function normalizeList(dom){for(var child=dom.firstChild,prevItem=null;child;child=child.nextSibling){var name=1==child.nodeType?child.nodeName.toLowerCase():null;name&&listTags.hasOwnProperty(name)&&prevItem?(prevItem.appendChild(child),child=prevItem):"li"==name?prevItem=child:name&&(prevItem=null)}}function matches(dom,selector){return(dom.matches||dom.msMatchesSelector||dom.webkitMatchesSelector||dom.mozMatchesSelector).call(dom,selector)}function parseStyles(style){for(var re=/\s*([\w-]+)\s*:\s*([^;]+)/g,m,result=[];m=re.exec(style);)result.push(m[1],m[2].trim());return result}function copy(obj){var copy={};for(var prop in obj)copy[prop]=obj[prop];return copy}function markMayApply(markType,nodeType){var nodes=nodeType.schema.nodes,loop=function(name){var parent=nodes[name];if(parent.allowsMarkType(markType)){var seen=[],scan=function(match){seen.push(match);for(var i=0;i<match.edgeCount;i++){var ref=match.edge(i),type=ref.type,next=ref.next;if(type==nodeType)return!0;if(seen.indexOf(next)<0&&scan(next))return!0}};return scan(parent.contentMatch)?{v:!0}:void 0}};for(var name in nodes){var returned=loop(name);if(returned)return returned.v}}function findSameMarkInSet(mark,set){for(var i=0;i<set.length;i++)if(mark.eq(set[i]))return set[i]}prototypeAccessors$6.top.get=function(){return this.nodes[this.open]},ParseContext.prototype.addDOM=function addDOM(dom){if(3==dom.nodeType)this.addTextNode(dom);else if(1==dom.nodeType){var style=dom.getAttribute("style"),marks=style?this.readStyles(parseStyles(style)):null,top=this.top;if(null!=marks)for(var i=0;i<marks.length;i++)this.addPendingMark(marks[i]);if(this.addElement(dom),null!=marks)for(var i$1=0;i$1<marks.length;i$1++)this.removePendingMark(marks[i$1],top)}},ParseContext.prototype.addTextNode=function addTextNode(dom){var value=dom.nodeValue,top=this.top;if(2&top.options||(top.type?top.type.inlineContent:top.content.length&&top.content[0].isInline)||/[^ \t\r\n\u000c]/.test(value)){if(1&top.options)value=2&top.options?value.replace(/\r\n?/g,"\n"):value.replace(/\r?\n|\r/g," ");else if(value=value.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(value)&&this.open==this.nodes.length-1){var nodeBefore=top.content[top.content.length-1],domNodeBefore=dom.previousSibling;(!nodeBefore||domNodeBefore&&"BR"==domNodeBefore.nodeName||nodeBefore.isText&&/[ \t\r\n\u000c]$/.test(nodeBefore.text))&&(value=value.slice(1))}value&&this.insertNode(this.parser.schema.text(value)),this.findInText(dom)}else this.findInside(dom)},ParseContext.prototype.addElement=function addElement(dom,matchAfter){var name=dom.nodeName.toLowerCase(),ruleID;listTags.hasOwnProperty(name)&&this.parser.normalizeLists&&normalizeList(dom);var rule=this.options.ruleFromNode&&this.options.ruleFromNode(dom)||(ruleID=this.parser.matchTag(dom,this,matchAfter));if(rule?rule.ignore:ignoreTags.hasOwnProperty(name))this.findInside(dom),this.ignoreFallback(dom);else if(!rule||rule.skip||rule.closeParent){rule&&rule.closeParent?this.open=Math.max(0,this.open-1):rule&&rule.skip.nodeType&&(dom=rule.skip);var sync,top=this.top,oldNeedsBlock=this.needsBlock;if(blockTags.hasOwnProperty(name))sync=!0,top.type||(this.needsBlock=!0);else if(!dom.firstChild)return void this.leafFallback(dom);this.addAll(dom),sync&&this.sync(top),this.needsBlock=oldNeedsBlock}else this.addElementByRule(dom,rule,!1===rule.consuming?ruleID:null)},ParseContext.prototype.leafFallback=function leafFallback(dom){"BR"==dom.nodeName&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(dom.ownerDocument.createTextNode("\n"))},ParseContext.prototype.ignoreFallback=function ignoreFallback(dom){"BR"!=dom.nodeName||this.top.type&&this.top.type.inlineContent||this.findPlace(this.parser.schema.text("-"))},ParseContext.prototype.readStyles=function readStyles(styles){var marks=Mark.none;style:for(var i=0;i<styles.length;i+=2)for(var after=null;;){var rule=this.parser.matchStyle(styles[i],styles[i+1],this,after);if(!rule)continue style;if(rule.ignore)return null;if(marks=this.parser.schema.marks[rule.mark].create(rule.attrs).addToSet(marks),!1!==rule.consuming)break;after=rule}return marks},ParseContext.prototype.addElementByRule=function addElementByRule(dom,rule,continueAfter){var this$1=this,sync,nodeType,markType,mark;rule.node?(nodeType=this.parser.schema.nodes[rule.node]).isLeaf?this.insertNode(nodeType.create(rule.attrs))||this.leafFallback(dom):sync=this.enter(nodeType,rule.attrs,rule.preserveWhitespace):(mark=(markType=this.parser.schema.marks[rule.mark]).create(rule.attrs),this.addPendingMark(mark));var startIn=this.top;if(nodeType&&nodeType.isLeaf)this.findInside(dom);else if(continueAfter)this.addElement(dom,continueAfter);else if(rule.getContent)this.findInside(dom),rule.getContent(dom,this.parser.schema).forEach((function(node){return this$1.insertNode(node)}));else{var contentDOM=rule.contentElement;"string"==typeof contentDOM?contentDOM=dom.querySelector(contentDOM):"function"==typeof contentDOM&&(contentDOM=contentDOM(dom)),contentDOM||(contentDOM=dom),this.findAround(dom,contentDOM,!0),this.addAll(contentDOM,sync)}sync&&(this.sync(startIn),this.open--),mark&&this.removePendingMark(mark,startIn)},ParseContext.prototype.addAll=function addAll(parent,sync,startIndex,endIndex){for(var index=startIndex||0,dom=startIndex?parent.childNodes[startIndex]:parent.firstChild,end=null==endIndex?null:parent.childNodes[endIndex];dom!=end;dom=dom.nextSibling,++index)this.findAtPoint(parent,index),this.addDOM(dom),sync&&blockTags.hasOwnProperty(dom.nodeName.toLowerCase())&&this.sync(sync);this.findAtPoint(parent,index)},ParseContext.prototype.findPlace=function findPlace(node){for(var route,sync,depth=this.open;depth>=0;depth--){var cx=this.nodes[depth],found=cx.findWrapping(node);if(found&&(!route||route.length>found.length)&&(route=found,sync=cx,!found.length))break;if(cx.solid)break}if(!route)return!1;this.sync(sync);for(var i=0;i<route.length;i++)this.enterInner(route[i],null,!1);return!0},ParseContext.prototype.insertNode=function insertNode(node){if(node.isInline&&this.needsBlock&&!this.top.type){var block=this.textblockFromContext();block&&this.enterInner(block)}if(this.findPlace(node)){this.closeExtra();var top=this.top;top.applyPending(node.type),top.match&&(top.match=top.match.matchType(node.type));for(var marks=top.activeMarks,i=0;i<node.marks.length;i++)top.type&&!top.type.allowsMarkType(node.marks[i].type)||(marks=node.marks[i].addToSet(marks));return top.content.push(node.mark(marks)),!0}return!1},ParseContext.prototype.enter=function enter(type,attrs,preserveWS){var ok=this.findPlace(type.create(attrs));return ok&&this.enterInner(type,attrs,!0,preserveWS),ok},ParseContext.prototype.enterInner=function enterInner(type,attrs,solid,preserveWS){this.closeExtra();var top=this.top;top.applyPending(type),top.match=top.match&&top.match.matchType(type,attrs);var options=null==preserveWS?-5&top.options:wsOptionsFor(preserveWS);4&top.options&&0==top.content.length&&(options|=4),this.nodes.push(new NodeContext(type,attrs,top.activeMarks,top.pendingMarks,solid,null,options)),this.open++},ParseContext.prototype.closeExtra=function closeExtra(openEnd){var i=this.nodes.length-1;if(i>this.open){for(;i>this.open;i--)this.nodes[i-1].content.push(this.nodes[i].finish(openEnd));this.nodes.length=this.open+1}},ParseContext.prototype.finish=function finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)},ParseContext.prototype.sync=function sync(to){for(var i=this.open;i>=0;i--)if(this.nodes[i]==to)return void(this.open=i)},prototypeAccessors$6.currentPos.get=function(){this.closeExtra();for(var pos=0,i=this.open;i>=0;i--){for(var content=this.nodes[i].content,j=content.length-1;j>=0;j--)pos+=content[j].nodeSize;i&&pos++}return pos},ParseContext.prototype.findAtPoint=function findAtPoint(parent,offset){if(this.find)for(var i=0;i<this.find.length;i++)this.find[i].node==parent&&this.find[i].offset==offset&&(this.find[i].pos=this.currentPos)},ParseContext.prototype.findInside=function findInside(parent){if(this.find)for(var i=0;i<this.find.length;i++)null==this.find[i].pos&&1==parent.nodeType&&parent.contains(this.find[i].node)&&(this.find[i].pos=this.currentPos)},ParseContext.prototype.findAround=function findAround(parent,content,before){if(parent!=content&&this.find)for(var i=0;i<this.find.length;i++){var pos;if(null==this.find[i].pos&&1==parent.nodeType&&parent.contains(this.find[i].node))content.compareDocumentPosition(this.find[i].node)&(before?2:4)&&(this.find[i].pos=this.currentPos)}},ParseContext.prototype.findInText=function findInText(textNode){if(this.find)for(var i=0;i<this.find.length;i++)this.find[i].node==textNode&&(this.find[i].pos=this.currentPos-(textNode.nodeValue.length-this.find[i].offset))},ParseContext.prototype.matchesContext=function matchesContext(context){var this$1=this;if(context.indexOf("|")>-1)return context.split(/\s*\|\s*/).some(this.matchesContext,this);var parts=context.split("/"),option=this.options.context,useRoot=!(this.isOpen||option&&option.parent.type!=this.nodes[0].type),minDepth=-(option?option.depth+1:0)+(useRoot?0:1),match=function(i,depth){for(;i>=0;i--){var part=parts[i];if(""==part){if(i==parts.length-1||0==i)continue;for(;depth>=minDepth;depth--)if(match(i-1,depth))return!0;return!1}var next=depth>0||0==depth&&useRoot?this$1.nodes[depth].type:option&&depth>=minDepth?option.node(depth-minDepth).type:null;if(!next||next.name!=part&&-1==next.groups.indexOf(part))return!1;depth--}return!0};return match(parts.length-1,this.open)},ParseContext.prototype.textblockFromContext=function textblockFromContext(){var $context=this.options.context;if($context)for(var d=$context.depth;d>=0;d--){var deflt=$context.node(d).contentMatchAt($context.indexAfter(d)).defaultType;if(deflt&&deflt.isTextblock&&deflt.defaultAttrs)return deflt}for(var name in this.parser.schema.nodes){var type=this.parser.schema.nodes[name];if(type.isTextblock&&type.defaultAttrs)return type}},ParseContext.prototype.addPendingMark=function addPendingMark(mark){var found=findSameMarkInSet(mark,this.top.pendingMarks);found&&this.top.stashMarks.push(found),this.top.pendingMarks=mark.addToSet(this.top.pendingMarks)},ParseContext.prototype.removePendingMark=function removePendingMark(mark,upto){for(var depth=this.open;depth>=0;depth--){var level=this.nodes[depth],found;if(level.pendingMarks.lastIndexOf(mark)>-1)level.pendingMarks=mark.removeFromSet(level.pendingMarks);else{level.activeMarks=mark.removeFromSet(level.activeMarks);var stashMark=level.popFromStashMark(mark);stashMark&&level.type&&level.type.allowsMarkType(stashMark.type)&&(level.activeMarks=stashMark.addToSet(level.activeMarks))}if(level==upto)break}},Object.defineProperties(ParseContext.prototype,prototypeAccessors$6);var DOMSerializer=function DOMSerializer(nodes,marks){this.nodes=nodes||{},this.marks=marks||{}};function gatherToDOM(obj){var result={};for(var name in obj){var toDOM=obj[name].spec.toDOM;toDOM&&(result[name]=toDOM)}return result}function doc(options){return options.document||window.document}DOMSerializer.prototype.serializeFragment=function serializeFragment(fragment,options,target){var this$1=this;void 0===options&&(options={}),target||(target=doc(options).createDocumentFragment());var top=target,active=null;return fragment.forEach((function(node){if(active||node.marks.length){active||(active=[]);for(var keep=0,rendered=0;keep<active.length&&rendered<node.marks.length;){var next=node.marks[rendered];if(this$1.marks[next.type.name]){if(!next.eq(active[keep])||!1===next.type.spec.spanning)break;keep+=2,rendered++}else rendered++}for(;keep<active.length;)top=active.pop(),active.pop();for(;rendered<node.marks.length;){var add=node.marks[rendered++],markDOM=this$1.serializeMark(add,node.isInline,options);markDOM&&(active.push(add,top),top.appendChild(markDOM.dom),top=markDOM.contentDOM||markDOM.dom)}}top.appendChild(this$1.serializeNode(node,options))})),target},DOMSerializer.prototype.serializeNode=function serializeNode(node,options){void 0===options&&(options={});var ref=DOMSerializer.renderSpec(doc(options),this.nodes[node.type.name](node)),dom=ref.dom,contentDOM=ref.contentDOM;if(contentDOM){if(node.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");options.onContent?options.onContent(node,contentDOM,options):this.serializeFragment(node.content,options,contentDOM)}return dom},DOMSerializer.prototype.serializeNodeAndMarks=function serializeNodeAndMarks(node,options){void 0===options&&(options={});for(var dom=this.serializeNode(node,options),i=node.marks.length-1;i>=0;i--){var wrap=this.serializeMark(node.marks[i],node.isInline,options);wrap&&((wrap.contentDOM||wrap.dom).appendChild(dom),dom=wrap.dom)}return dom},DOMSerializer.prototype.serializeMark=function serializeMark(mark,inline,options){void 0===options&&(options={});var toDOM=this.marks[mark.type.name];return toDOM&&DOMSerializer.renderSpec(doc(options),toDOM(mark,inline))},DOMSerializer.renderSpec=function renderSpec(doc,structure,xmlNS){if(void 0===xmlNS&&(xmlNS=null),"string"==typeof structure)return{dom:doc.createTextNode(structure)};if(null!=structure.nodeType)return{dom:structure};if(structure.dom&&null!=structure.dom.nodeType)return structure;var tagName=structure[0],space=tagName.indexOf(" ");space>0&&(xmlNS=tagName.slice(0,space),tagName=tagName.slice(space+1));var contentDOM=null,dom=xmlNS?doc.createElementNS(xmlNS,tagName):doc.createElement(tagName),attrs=structure[1],start=1;if(attrs&&"object"==typeof attrs&&null==attrs.nodeType&&!Array.isArray(attrs))for(var name in start=2,attrs)if(null!=attrs[name]){var space$1=name.indexOf(" ");space$1>0?dom.setAttributeNS(name.slice(0,space$1),name.slice(space$1+1),attrs[name]):dom.setAttribute(name,attrs[name])}for(var i=start;i<structure.length;i++){var child=structure[i];if(0===child){if(i<structure.length-1||i>start)throw new RangeError("Content hole must be the only child of its parent node");return{dom:dom,contentDOM:dom}}var ref=DOMSerializer.renderSpec(doc,child,xmlNS),inner=ref.dom,innerContent=ref.contentDOM;if(dom.appendChild(inner),innerContent){if(contentDOM)throw new RangeError("Multiple content holes");contentDOM=innerContent}}return{dom:dom,contentDOM:contentDOM}},DOMSerializer.fromSchema=function fromSchema(schema){return schema.cached.domSerializer||(schema.cached.domSerializer=new DOMSerializer(this.nodesFromSchema(schema),this.marksFromSchema(schema)))},DOMSerializer.nodesFromSchema=function nodesFromSchema(schema){var result=gatherToDOM(schema.nodes);return result.text||(result.text=function(node){return node.text}),result},DOMSerializer.marksFromSchema=function marksFromSchema(schema){return gatherToDOM(schema.marks)};var forEachOwnProperties=__webpack_require__(956),forEachOwnProperties_default=__webpack_require__.n(forEachOwnProperties),extend=__webpack_require__(969),extend_default=__webpack_require__.n(extend),css=__webpack_require__(522),css_default=__webpack_require__.n(css),addClass=__webpack_require__(204),addClass_default=__webpack_require__.n(addClass),removeClass=__webpack_require__(462),removeClass_default=__webpack_require__.n(removeClass),type_isString=__webpack_require__(758),isString_default=__webpack_require__.n(type_isString),isNumber=__webpack_require__(321),isNumber_default=__webpack_require__.n(isNumber),isUndefined=__webpack_require__(929),isUndefined_default=__webpack_require__.n(isUndefined),isNull=__webpack_require__(934),isNull_default=__webpack_require__.n(isNull),sendHostname=__webpack_require__(391),sendHostname_default=__webpack_require__.n(sendHostname),isMac=/Mac/.test(navigator.platform);function sendHostName(){sendHostname_default()("editor","UA-129966929-1")}function common_includes(arr,targetItem){return-1!==arr.indexOf(targetItem)}var availableLinkAttributes=["rel","target","hreflang","type"];function sanitizeLinkAttribute(attribute){if(!attribute)return null;var linkAttributes={};return availableLinkAttributes.forEach((function(key){isUndefined_default()(attribute[key])||(linkAttributes[key]=attribute[key])})),linkAttributes}function repeat(text,count){for(var result="",i=0;i<count;i+=1)result+=text;return result}function common_escape(text,startOfLine){var result=text.replace(/[`*\\~[\]]/g,"\\$&");return startOfLine?result.replace(/^[:#\-*+]/,"\\$&").replace(/^(\d+)\./,"$1\\."):result}function quote(text){var result;return(result=-1===text.indexOf('"')?'""':-1===text.indexOf("'")?"''":"()")[0]+text+result[1]}function isNil(value){return isNull_default()(value)||isUndefined_default()(value)}function shallowEqual(o1,o2){if(null===o1&&o1===o2)return!0;if("object"!=typeof o1||"object"!=typeof o2||isNil(o1)||isNil(o2))return o1===o2;for(var key in o1)if(o1[key]!==o2[key])return!1;for(var key in o2)if(!(key in o1))return!1;return!0}function last(arr){return arr[arr.length-1]}function between(value,min,max){return value>=min&&value<=max}function isObject(obj){return"object"==typeof obj&&null!==obj}function deepMergedCopy(targetObj,obj){var resultObj=__assign({},targetObj);return targetObj&&obj&&Object.keys(obj).forEach((function(prop){isObject(resultObj[prop])?Array.isArray(obj[prop])?resultObj[prop]=deepCopyArray(obj[prop]):resultObj.hasOwnProperty(prop)?resultObj[prop]=deepMergedCopy(resultObj[prop],obj[prop]):resultObj[prop]=deepCopy(obj[prop]):resultObj[prop]=obj[prop]})),resultObj}function deepCopyArray(items){return items.map((function(item){return isObject(item)?Array.isArray(item)?deepCopyArray(item):deepCopy(item):item}))}function deepCopy(obj){var keys=Object.keys(obj);return keys.length?keys.reduce((function(acc,prop){return isObject(obj[prop])?acc[prop]=Array.isArray(obj[prop])?deepCopyArray(obj[prop]):deepCopy(obj[prop]):acc[prop]=obj[prop],acc}),{}):obj}function common_assign(targetObj,obj){return void 0===obj&&(obj={}),Object.keys(obj).forEach((function(prop){targetObj.hasOwnProperty(prop)&&"object"==typeof targetObj[prop]?Array.isArray(obj[prop])?targetObj[prop]=obj[prop]:common_assign(targetObj[prop],obj[prop]):targetObj[prop]=obj[prop]})),targetObj}function getSortedNumPair(valueA,valueB){return valueA>valueB?[valueB,valueA]:[valueA,valueB]}var lower16=65535,factor16=Math.pow(2,16);function makeRecover(index,offset){return index+offset*factor16}function recoverIndex(value){return 65535&value}function recoverOffset(value){return(value-(65535&value))/factor16}var MapResult=function MapResult(pos,deleted,recover){void 0===deleted&&(deleted=!1),void 0===recover&&(recover=null),this.pos=pos,this.deleted=deleted,this.recover=recover},StepMap=function StepMap(ranges,inverted){void 0===inverted&&(inverted=!1),this.ranges=ranges,this.inverted=inverted};StepMap.prototype.recover=function recover(value){var diff=0,index=recoverIndex(value);if(!this.inverted)for(var i=0;i<index;i++)diff+=this.ranges[3*i+2]-this.ranges[3*i+1];return this.ranges[3*index]+diff+recoverOffset(value)},StepMap.prototype.mapResult=function mapResult(pos,assoc){return void 0===assoc&&(assoc=1),this._map(pos,assoc,!1)},StepMap.prototype.map=function map(pos,assoc){return void 0===assoc&&(assoc=1),this._map(pos,assoc,!0)},StepMap.prototype._map=function _map(pos,assoc,simple){for(var diff=0,oldIndex=this.inverted?2:1,newIndex=this.inverted?1:2,i=0;i<this.ranges.length;i+=3){var start=this.ranges[i]-(this.inverted?diff:0);if(start>pos)break;var oldSize=this.ranges[i+oldIndex],newSize=this.ranges[i+newIndex],end=start+oldSize;if(pos<=end){var side,result=start+diff+((oldSize?pos==start?-1:pos==end?1:assoc:assoc)<0?0:newSize);if(simple)return result;var recover=pos==(assoc<0?start:end)?null:makeRecover(i/3,pos-start);return new MapResult(result,assoc<0?pos!=start:pos!=end,recover)}diff+=newSize-oldSize}return simple?pos+diff:new MapResult(pos+diff)},StepMap.prototype.touches=function touches(pos,recover){for(var diff=0,index=recoverIndex(recover),oldIndex=this.inverted?2:1,newIndex=this.inverted?1:2,i=0;i<this.ranges.length;i+=3){var start=this.ranges[i]-(this.inverted?diff:0);if(start>pos)break;var oldSize=this.ranges[i+oldIndex],end;if(pos<=start+oldSize&&i==3*index)return!0;diff+=this.ranges[i+newIndex]-oldSize}return!1},StepMap.prototype.forEach=function forEach(f){for(var oldIndex=this.inverted?2:1,newIndex=this.inverted?1:2,i=0,diff=0;i<this.ranges.length;i+=3){var start=this.ranges[i],oldStart=start-(this.inverted?diff:0),newStart=start+(this.inverted?0:diff),oldSize=this.ranges[i+oldIndex],newSize=this.ranges[i+newIndex];f(oldStart,oldStart+oldSize,newStart,newStart+newSize),diff+=newSize-oldSize}},StepMap.prototype.invert=function invert(){return new StepMap(this.ranges,!this.inverted)},StepMap.prototype.toString=function toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)},StepMap.offset=function offset(n){return 0==n?StepMap.empty:new StepMap(n<0?[0,-n,0]:[0,0,n])},StepMap.empty=new StepMap([]);var Mapping=function Mapping(maps,mirror,from,to){this.maps=maps||[],this.from=from||0,this.to=null==to?this.maps.length:to,this.mirror=mirror};function TransformError(message){var err=Error.call(this,message);return err.__proto__=TransformError.prototype,err}Mapping.prototype.slice=function slice(from,to){return void 0===from&&(from=0),void 0===to&&(to=this.maps.length),new Mapping(this.maps,this.mirror,from,to)},Mapping.prototype.copy=function copy(){return new Mapping(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)},Mapping.prototype.appendMap=function appendMap(map,mirrors){this.to=this.maps.push(map),null!=mirrors&&this.setMirror(this.maps.length-1,mirrors)},Mapping.prototype.appendMapping=function appendMapping(mapping){for(var i=0,startSize=this.maps.length;i<mapping.maps.length;i++){var mirr=mapping.getMirror(i);this.appendMap(mapping.maps[i],null!=mirr&&mirr<i?startSize+mirr:null)}},Mapping.prototype.getMirror=function getMirror(n){if(this.mirror)for(var i=0;i<this.mirror.length;i++)if(this.mirror[i]==n)return this.mirror[i+(i%2?-1:1)]},Mapping.prototype.setMirror=function setMirror(n,m){this.mirror||(this.mirror=[]),this.mirror.push(n,m)},Mapping.prototype.appendMappingInverted=function appendMappingInverted(mapping){for(var i=mapping.maps.length-1,totalSize=this.maps.length+mapping.maps.length;i>=0;i--){var mirr=mapping.getMirror(i);this.appendMap(mapping.maps[i].invert(),null!=mirr&&mirr>i?totalSize-mirr-1:null)}},Mapping.prototype.invert=function invert(){var inverse=new Mapping;return inverse.appendMappingInverted(this),inverse},Mapping.prototype.map=function map(pos,assoc){if(void 0===assoc&&(assoc=1),this.mirror)return this._map(pos,assoc,!0);for(var i=this.from;i<this.to;i++)pos=this.maps[i].map(pos,assoc);return pos},Mapping.prototype.mapResult=function mapResult(pos,assoc){return void 0===assoc&&(assoc=1),this._map(pos,assoc,!1)},Mapping.prototype._map=function _map(pos,assoc,simple){for(var deleted=!1,i=this.from;i<this.to;i++){var map,result=this.maps[i].mapResult(pos,assoc);if(null!=result.recover){var corr=this.getMirror(i);if(null!=corr&&corr>i&&corr<this.to){i=corr,pos=this.maps[corr].recover(result.recover);continue}}result.deleted&&(deleted=!0),pos=result.pos}return simple?pos:new MapResult(pos,deleted)},TransformError.prototype=Object.create(Error.prototype),TransformError.prototype.constructor=TransformError,TransformError.prototype.name="TransformError";var Transform=function Transform(doc){this.doc=doc,this.steps=[],this.docs=[],this.mapping=new Mapping},index_es_prototypeAccessors={before:{configurable:!0},docChanged:{configurable:!0}};function mustOverride(){throw new Error("Override me")}index_es_prototypeAccessors.before.get=function(){return this.docs.length?this.docs[0]:this.doc},Transform.prototype.step=function step(object){var result=this.maybeStep(object);if(result.failed)throw new TransformError(result.failed);return this},Transform.prototype.maybeStep=function maybeStep(step){var result=step.apply(this.doc);return result.failed||this.addStep(step,result.doc),result},index_es_prototypeAccessors.docChanged.get=function(){return this.steps.length>0},Transform.prototype.addStep=function addStep(step,doc){this.docs.push(this.doc),this.steps.push(step),this.mapping.appendMap(step.getMap()),this.doc=doc},Object.defineProperties(Transform.prototype,index_es_prototypeAccessors);var stepsByID=Object.create(null),Step=function Step(){};Step.prototype.apply=function apply(_doc){return mustOverride()},Step.prototype.getMap=function getMap(){return StepMap.empty},Step.prototype.invert=function invert(_doc){return mustOverride()},Step.prototype.map=function map(_mapping){return mustOverride()},Step.prototype.merge=function merge(_other){return null},Step.prototype.toJSON=function toJSON(){return mustOverride()},Step.fromJSON=function fromJSON(schema,json){if(!json||!json.stepType)throw new RangeError("Invalid input for Step.fromJSON");var type=stepsByID[json.stepType];if(!type)throw new RangeError("No step type "+json.stepType+" defined");return type.fromJSON(schema,json)},Step.jsonID=function jsonID(id,stepClass){if(id in stepsByID)throw new RangeError("Duplicate use of step JSON ID "+id);return stepsByID[id]=stepClass,stepClass.prototype.jsonID=id,stepClass};var StepResult=function StepResult(doc,failed){this.doc=doc,this.failed=failed};StepResult.ok=function ok(doc){return new StepResult(doc,null)},StepResult.fail=function fail(message){return new StepResult(null,message)},StepResult.fromReplace=function fromReplace(doc,from,to,slice){try{return StepResult.ok(doc.replace(from,to,slice))}catch(e){if(e instanceof ReplaceError)return StepResult.fail(e.message);throw e}};var ReplaceStep=function(Step){function ReplaceStep(from,to,slice,structure){Step.call(this),this.from=from,this.to=to,this.slice=slice,this.structure=!!structure}return Step&&(ReplaceStep.__proto__=Step),ReplaceStep.prototype=Object.create(Step&&Step.prototype),ReplaceStep.prototype.constructor=ReplaceStep,ReplaceStep.prototype.apply=function apply(doc){return this.structure&&contentBetween(doc,this.from,this.to)?StepResult.fail("Structure replace would overwrite content"):StepResult.fromReplace(doc,this.from,this.to,this.slice)},ReplaceStep.prototype.getMap=function getMap(){return new StepMap([this.from,this.to-this.from,this.slice.size])},ReplaceStep.prototype.invert=function invert(doc){return new ReplaceStep(this.from,this.from+this.slice.size,doc.slice(this.from,this.to))},ReplaceStep.prototype.map=function map(mapping){var from=mapping.mapResult(this.from,1),to=mapping.mapResult(this.to,-1);return from.deleted&&to.deleted?null:new ReplaceStep(from.pos,Math.max(from.pos,to.pos),this.slice)},ReplaceStep.prototype.merge=function merge(other){if(!(other instanceof ReplaceStep)||other.structure||this.structure)return null;if(this.from+this.slice.size!=other.from||this.slice.openEnd||other.slice.openStart){if(other.to!=this.from||this.slice.openStart||other.slice.openEnd)return null;var slice$1=this.slice.size+other.slice.size==0?Slice.empty:new Slice(other.slice.content.append(this.slice.content),other.slice.openStart,this.slice.openEnd);return new ReplaceStep(other.from,this.to,slice$1,this.structure)}var slice=this.slice.size+other.slice.size==0?Slice.empty:new Slice(this.slice.content.append(other.slice.content),this.slice.openStart,other.slice.openEnd);return new ReplaceStep(this.from,this.to+(other.to-other.from),slice,this.structure)},ReplaceStep.prototype.toJSON=function toJSON(){var json={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(json.slice=this.slice.toJSON()),this.structure&&(json.structure=!0),json},ReplaceStep.fromJSON=function fromJSON(schema,json){if("number"!=typeof json.from||"number"!=typeof json.to)throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new ReplaceStep(json.from,json.to,Slice.fromJSON(schema,json.slice),!!json.structure)},ReplaceStep}(Step);Step.jsonID("replace",ReplaceStep);var ReplaceAroundStep=function(Step){function ReplaceAroundStep(from,to,gapFrom,gapTo,slice,insert,structure){Step.call(this),this.from=from,this.to=to,this.gapFrom=gapFrom,this.gapTo=gapTo,this.slice=slice,this.insert=insert,this.structure=!!structure}return Step&&(ReplaceAroundStep.__proto__=Step),ReplaceAroundStep.prototype=Object.create(Step&&Step.prototype),ReplaceAroundStep.prototype.constructor=ReplaceAroundStep,ReplaceAroundStep.prototype.apply=function apply(doc){if(this.structure&&(contentBetween(doc,this.from,this.gapFrom)||contentBetween(doc,this.gapTo,this.to)))return StepResult.fail("Structure gap-replace would overwrite content");var gap=doc.slice(this.gapFrom,this.gapTo);if(gap.openStart||gap.openEnd)return StepResult.fail("Gap is not a flat range");var inserted=this.slice.insertAt(this.insert,gap.content);return inserted?StepResult.fromReplace(doc,this.from,this.to,inserted):StepResult.fail("Content does not fit in gap")},ReplaceAroundStep.prototype.getMap=function getMap(){return new StepMap([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])},ReplaceAroundStep.prototype.invert=function invert(doc){var gap=this.gapTo-this.gapFrom;return new ReplaceAroundStep(this.from,this.from+this.slice.size+gap,this.from+this.insert,this.from+this.insert+gap,doc.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)},ReplaceAroundStep.prototype.map=function map(mapping){var from=mapping.mapResult(this.from,1),to=mapping.mapResult(this.to,-1),gapFrom=mapping.map(this.gapFrom,-1),gapTo=mapping.map(this.gapTo,1);return from.deleted&&to.deleted||gapFrom<from.pos||gapTo>to.pos?null:new ReplaceAroundStep(from.pos,to.pos,gapFrom,gapTo,this.slice,this.insert,this.structure)},ReplaceAroundStep.prototype.toJSON=function toJSON(){var json={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(json.slice=this.slice.toJSON()),this.structure&&(json.structure=!0),json},ReplaceAroundStep.fromJSON=function fromJSON(schema,json){if("number"!=typeof json.from||"number"!=typeof json.to||"number"!=typeof json.gapFrom||"number"!=typeof json.gapTo||"number"!=typeof json.insert)throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new ReplaceAroundStep(json.from,json.to,json.gapFrom,json.gapTo,Slice.fromJSON(schema,json.slice),json.insert,!!json.structure)},ReplaceAroundStep}(Step);function contentBetween(doc,from,to){for(var $from=doc.resolve(from),dist=to-from,depth=$from.depth;dist>0&&depth>0&&$from.indexAfter(depth)==$from.node(depth).childCount;)depth--,dist--;if(dist>0)for(var next=$from.node(depth).maybeChild($from.indexAfter(depth));dist>0;){if(!next||next.isLeaf)return!0;next=next.firstChild,dist--}return!1}function canCut(node,start,end){return(0==start||node.canReplace(start,node.childCount))&&(end==node.childCount||node.canReplace(0,end))}function index_es_liftTarget(range){for(var parent,content=range.parent.content.cutByIndex(range.startIndex,range.endIndex),depth=range.depth;;--depth){var node=range.$from.node(depth),index=range.$from.index(depth),endIndex=range.$to.indexAfter(depth);if(depth<range.depth&&node.canReplace(index,endIndex,content))return depth;if(0==depth||node.type.spec.isolating||!canCut(node,index,endIndex))break}}function index_es_findWrapping(range,nodeType,attrs,innerRange){void 0===innerRange&&(innerRange=range);var around=findWrappingOutside(range,nodeType),inner=around&&findWrappingInside(innerRange,nodeType);return inner?around.map(withAttrs).concat({type:nodeType,attrs:attrs}).concat(inner.map(withAttrs)):null}function withAttrs(type){return{type:type,attrs:null}}function findWrappingOutside(range,type){var parent=range.parent,startIndex=range.startIndex,endIndex=range.endIndex,around=parent.contentMatchAt(startIndex).findWrapping(type);if(!around)return null;var outer=around.length?around[0]:type;return parent.canReplaceWith(startIndex,endIndex,outer)?around:null}function findWrappingInside(range,type){var parent=range.parent,startIndex=range.startIndex,endIndex=range.endIndex,inner=parent.child(startIndex),inside=type.contentMatch.findWrapping(inner.type);if(!inside)return null;for(var lastType,innerMatch=(inside.length?inside[inside.length-1]:type).contentMatch,i=startIndex;innerMatch&&i<endIndex;i++)innerMatch=innerMatch.matchType(parent.child(i).type);return innerMatch&&innerMatch.validEnd?inside:null}function canChangeType(doc,pos,type){var $pos=doc.resolve(pos),index=$pos.index();return $pos.parent.canReplaceWith(index,index+1,type)}function canSplit(doc,pos,depth,typesAfter){void 0===depth&&(depth=1);var $pos=doc.resolve(pos),base=$pos.depth-depth,innerType=typesAfter&&typesAfter[typesAfter.length-1]||$pos.parent;if(base<0||$pos.parent.type.spec.isolating||!$pos.parent.canReplace($pos.index(),$pos.parent.childCount)||!innerType.type.validContent($pos.parent.content.cutByIndex($pos.index(),$pos.parent.childCount)))return!1;for(var d=$pos.depth-1,i=depth-2;d>base;d--,i--){var node=$pos.node(d),index$1=$pos.index(d);if(node.type.spec.isolating)return!1;var rest=node.content.cutByIndex(index$1,node.childCount),after=typesAfter&&typesAfter[i]||node;if(after!=node&&(rest=rest.replaceChild(0,after.type.create(after.attrs))),!node.canReplace(index$1+1,node.childCount)||!after.type.validContent(rest))return!1}var index=$pos.indexAfter(base),baseType=typesAfter&&typesAfter[0];return $pos.node(base).canReplaceWith(index,index,baseType?baseType.type:$pos.node(base+1).type)}function index_es_canJoin(doc,pos){var $pos=doc.resolve(pos),index=$pos.index();return index_es_joinable($pos.nodeBefore,$pos.nodeAfter)&&$pos.parent.canReplace(index,index+1)}function index_es_joinable(a,b){return a&&b&&!a.isLeaf&&a.canAppend(b)}function index_es_joinPoint(doc,pos,dir){void 0===dir&&(dir=-1);for(var $pos=doc.resolve(pos),d=$pos.depth;;d--){var before=void 0,after=void 0,index=$pos.index(d);if(d==$pos.depth?(before=$pos.nodeBefore,after=$pos.nodeAfter):dir>0?(before=$pos.node(d+1),index++,after=$pos.node(d).maybeChild(index)):(before=$pos.node(d).maybeChild(index-1),after=$pos.node(d+1)),before&&!before.isTextblock&&index_es_joinable(before,after)&&$pos.node(d).canReplace(index,index+1))return pos;if(0==d)break;pos=dir<0?$pos.before(d):$pos.after(d)}}function insertPoint(doc,pos,nodeType){var $pos=doc.resolve(pos);if($pos.parent.canReplaceWith($pos.index(),$pos.index(),nodeType))return pos;if(0==$pos.parentOffset)for(var d=$pos.depth-1;d>=0;d--){var index=$pos.index(d);if($pos.node(d).canReplaceWith(index,index,nodeType))return $pos.before(d+1);if(index>0)return null}if($pos.parentOffset==$pos.parent.content.size)for(var d$1=$pos.depth-1;d$1>=0;d$1--){var index$1=$pos.indexAfter(d$1);if($pos.node(d$1).canReplaceWith(index$1,index$1,nodeType))return $pos.after(d$1+1);if(index$1<$pos.node(d$1).childCount)return null}}function dropPoint(doc,pos,slice){var $pos=doc.resolve(pos);if(!slice.content.size)return pos;for(var content=slice.content,i=0;i<slice.openStart;i++)content=content.firstChild.content;for(var pass=1;pass<=(0==slice.openStart&&slice.size?2:1);pass++)for(var d=$pos.depth;d>=0;d--){var bias=d==$pos.depth?0:$pos.pos<=($pos.start(d+1)+$pos.end(d+1))/2?-1:1,insertPos=$pos.index(d)+(bias>0?1:0);if(1==pass?$pos.node(d).canReplace(insertPos,insertPos,content):$pos.node(d).contentMatchAt(insertPos).findWrapping(content.firstChild.type))return 0==bias?$pos.pos:bias<0?$pos.before(d+1):$pos.after(d+1)}return null}function mapFragment(fragment,f,parent){for(var mapped=[],i=0;i<fragment.childCount;i++){var child=fragment.child(i);child.content.size&&(child=child.copy(mapFragment(child.content,f,child))),child.isInline&&(child=f(child,parent,i)),mapped.push(child)}return Fragment.fromArray(mapped)}Step.jsonID("replaceAround",ReplaceAroundStep),Transform.prototype.lift=function(range,target){for(var $from=range.$from,$to=range.$to,depth=range.depth,gapStart=$from.before(depth+1),gapEnd=$to.after(depth+1),start=gapStart,end=gapEnd,before=Fragment.empty,openStart=0,d=depth,splitting=!1;d>target;d--)splitting||$from.index(d)>0?(splitting=!0,before=Fragment.from($from.node(d).copy(before)),openStart++):start--;for(var after=Fragment.empty,openEnd=0,d$1=depth,splitting$1=!1;d$1>target;d$1--)splitting$1||$to.after(d$1+1)<$to.end(d$1)?(splitting$1=!0,after=Fragment.from($to.node(d$1).copy(after)),openEnd++):end++;return this.step(new ReplaceAroundStep(start,end,gapStart,gapEnd,new Slice(before.append(after),openStart,openEnd),before.size-openStart,!0))},Transform.prototype.wrap=function(range,wrappers){for(var content=Fragment.empty,i=wrappers.length-1;i>=0;i--)content=Fragment.from(wrappers[i].type.create(wrappers[i].attrs,content));var start=range.start,end=range.end;return this.step(new ReplaceAroundStep(start,end,start,end,new Slice(content,0,0),wrappers.length,!0))},Transform.prototype.setBlockType=function(from,to,type,attrs){var this$1=this;if(void 0===to&&(to=from),!type.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");var mapFrom=this.steps.length;return this.doc.nodesBetween(from,to,(function(node,pos){if(node.isTextblock&&!node.hasMarkup(type,attrs)&&canChangeType(this$1.doc,this$1.mapping.slice(mapFrom).map(pos),type)){this$1.clearIncompatible(this$1.mapping.slice(mapFrom).map(pos,1),type);var mapping=this$1.mapping.slice(mapFrom),startM=mapping.map(pos,1),endM=mapping.map(pos+node.nodeSize,1);return this$1.step(new ReplaceAroundStep(startM,endM,startM+1,endM-1,new Slice(Fragment.from(type.create(attrs,null,node.marks)),0,0),1,!0)),!1}})),this},Transform.prototype.setNodeMarkup=function(pos,type,attrs,marks){var node=this.doc.nodeAt(pos);if(!node)throw new RangeError("No node at given position");type||(type=node.type);var newNode=type.create(attrs,null,marks||node.marks);if(node.isLeaf)return this.replaceWith(pos,pos+node.nodeSize,newNode);if(!type.validContent(node.content))throw new RangeError("Invalid content for node type "+type.name);return this.step(new ReplaceAroundStep(pos,pos+node.nodeSize,pos+1,pos+node.nodeSize-1,new Slice(Fragment.from(newNode),0,0),1,!0))},Transform.prototype.split=function(pos,depth,typesAfter){void 0===depth&&(depth=1);for(var $pos=this.doc.resolve(pos),before=Fragment.empty,after=Fragment.empty,d=$pos.depth,e=$pos.depth-depth,i=depth-1;d>e;d--,i--){before=Fragment.from($pos.node(d).copy(before));var typeAfter=typesAfter&&typesAfter[i];after=Fragment.from(typeAfter?typeAfter.type.create(typeAfter.attrs,after):$pos.node(d).copy(after))}return this.step(new ReplaceStep(pos,pos,new Slice(before.append(after),depth,depth),!0))},Transform.prototype.join=function(pos,depth){void 0===depth&&(depth=1);var step=new ReplaceStep(pos-depth,pos+depth,Slice.empty,!0);return this.step(step)};var AddMarkStep=function(Step){function AddMarkStep(from,to,mark){Step.call(this),this.from=from,this.to=to,this.mark=mark}return Step&&(AddMarkStep.__proto__=Step),AddMarkStep.prototype=Object.create(Step&&Step.prototype),AddMarkStep.prototype.constructor=AddMarkStep,AddMarkStep.prototype.apply=function apply(doc){var this$1=this,oldSlice=doc.slice(this.from,this.to),$from=doc.resolve(this.from),parent=$from.node($from.sharedDepth(this.to)),slice=new Slice(mapFragment(oldSlice.content,(function(node,parent){return node.isAtom&&parent.type.allowsMarkType(this$1.mark.type)?node.mark(this$1.mark.addToSet(node.marks)):node}),parent),oldSlice.openStart,oldSlice.openEnd);return StepResult.fromReplace(doc,this.from,this.to,slice)},AddMarkStep.prototype.invert=function invert(){return new RemoveMarkStep(this.from,this.to,this.mark)},AddMarkStep.prototype.map=function map(mapping){var from=mapping.mapResult(this.from,1),to=mapping.mapResult(this.to,-1);return from.deleted&&to.deleted||from.pos>=to.pos?null:new AddMarkStep(from.pos,to.pos,this.mark)},AddMarkStep.prototype.merge=function merge(other){if(other instanceof AddMarkStep&&other.mark.eq(this.mark)&&this.from<=other.to&&this.to>=other.from)return new AddMarkStep(Math.min(this.from,other.from),Math.max(this.to,other.to),this.mark)},AddMarkStep.prototype.toJSON=function toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},AddMarkStep.fromJSON=function fromJSON(schema,json){if("number"!=typeof json.from||"number"!=typeof json.to)throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new AddMarkStep(json.from,json.to,schema.markFromJSON(json.mark))},AddMarkStep}(Step);Step.jsonID("addMark",AddMarkStep);var RemoveMarkStep=function(Step){function RemoveMarkStep(from,to,mark){Step.call(this),this.from=from,this.to=to,this.mark=mark}return Step&&(RemoveMarkStep.__proto__=Step),RemoveMarkStep.prototype=Object.create(Step&&Step.prototype),RemoveMarkStep.prototype.constructor=RemoveMarkStep,RemoveMarkStep.prototype.apply=function apply(doc){var this$1=this,oldSlice=doc.slice(this.from,this.to),slice=new Slice(mapFragment(oldSlice.content,(function(node){return node.mark(this$1.mark.removeFromSet(node.marks))})),oldSlice.openStart,oldSlice.openEnd);return StepResult.fromReplace(doc,this.from,this.to,slice)},RemoveMarkStep.prototype.invert=function invert(){return new AddMarkStep(this.from,this.to,this.mark)},RemoveMarkStep.prototype.map=function map(mapping){var from=mapping.mapResult(this.from,1),to=mapping.mapResult(this.to,-1);return from.deleted&&to.deleted||from.pos>=to.pos?null:new RemoveMarkStep(from.pos,to.pos,this.mark)},RemoveMarkStep.prototype.merge=function merge(other){if(other instanceof RemoveMarkStep&&other.mark.eq(this.mark)&&this.from<=other.to&&this.to>=other.from)return new RemoveMarkStep(Math.min(this.from,other.from),Math.max(this.to,other.to),this.mark)},RemoveMarkStep.prototype.toJSON=function toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},RemoveMarkStep.fromJSON=function fromJSON(schema,json){if("number"!=typeof json.from||"number"!=typeof json.to)throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new RemoveMarkStep(json.from,json.to,schema.markFromJSON(json.mark))},RemoveMarkStep}(Step);function replaceStep(doc,from,to,slice){if(void 0===to&&(to=from),void 0===slice&&(slice=Slice.empty),from==to&&!slice.size)return null;var $from=doc.resolve(from),$to=doc.resolve(to);return fitsTrivially($from,$to,slice)?new ReplaceStep(from,to,slice):new Fitter($from,$to,slice).fit()}function fitsTrivially($from,$to,slice){return!slice.openStart&&!slice.openEnd&&$from.start()==$to.start()&&$from.parent.canReplace($from.index(),$to.index(),slice.content)}Step.jsonID("removeMark",RemoveMarkStep),Transform.prototype.addMark=function(from,to,mark){var this$1=this,removed=[],added=[],removing=null,adding=null;return this.doc.nodesBetween(from,to,(function(node,pos,parent){if(node.isInline){var marks=node.marks;if(!mark.isInSet(marks)&&parent.type.allowsMarkType(mark.type)){for(var start=Math.max(pos,from),end=Math.min(pos+node.nodeSize,to),newSet=mark.addToSet(marks),i=0;i<marks.length;i++)marks[i].isInSet(newSet)||(removing&&removing.to==start&&removing.mark.eq(marks[i])?removing.to=end:removed.push(removing=new RemoveMarkStep(start,end,marks[i])));adding&&adding.to==start?adding.to=end:added.push(adding=new AddMarkStep(start,end,mark))}}})),removed.forEach((function(s){return this$1.step(s)})),added.forEach((function(s){return this$1.step(s)})),this},Transform.prototype.removeMark=function(from,to,mark){var this$1=this;void 0===mark&&(mark=null);var matched=[],step=0;return this.doc.nodesBetween(from,to,(function(node,pos){if(node.isInline){step++;var toRemove=null;if(mark instanceof MarkType)for(var set=node.marks,found;found=mark.isInSet(set);)(toRemove||(toRemove=[])).push(found),set=found.removeFromSet(set);else mark?mark.isInSet(node.marks)&&(toRemove=[mark]):toRemove=node.marks;if(toRemove&&toRemove.length)for(var end=Math.min(pos+node.nodeSize,to),i=0;i<toRemove.length;i++){for(var style=toRemove[i],found$1=void 0,j=0;j<matched.length;j++){var m=matched[j];m.step==step-1&&style.eq(matched[j].style)&&(found$1=m)}found$1?(found$1.to=end,found$1.step=step):matched.push({style:style,from:Math.max(pos,from),to:end,step:step})}}})),matched.forEach((function(m){return this$1.step(new RemoveMarkStep(m.from,m.to,m.style))})),this},Transform.prototype.clearIncompatible=function(pos,parentType,match){void 0===match&&(match=parentType.contentMatch);for(var node=this.doc.nodeAt(pos),delSteps=[],cur=pos+1,i=0;i<node.childCount;i++){var child=node.child(i),end=cur+child.nodeSize,allowed=match.matchType(child.type,child.attrs);if(allowed){match=allowed;for(var j=0;j<child.marks.length;j++)parentType.allowsMarkType(child.marks[j].type)||this.step(new RemoveMarkStep(cur,end,child.marks[j]))}else delSteps.push(new ReplaceStep(cur,end,Slice.empty));cur=end}if(!match.validEnd){var fill=match.fillBefore(Fragment.empty,!0);this.replace(cur,cur,new Slice(fill,0,0))}for(var i$1=delSteps.length-1;i$1>=0;i$1--)this.step(delSteps[i$1]);return this},Transform.prototype.replace=function(from,to,slice){void 0===to&&(to=from),void 0===slice&&(slice=Slice.empty);var step=replaceStep(this.doc,from,to,slice);return step&&this.step(step),this},Transform.prototype.replaceWith=function(from,to,content){return this.replace(from,to,new Slice(Fragment.from(content),0,0))},Transform.prototype.delete=function(from,to){return this.replace(from,to,Slice.empty)},Transform.prototype.insert=function(pos,content){return this.replaceWith(pos,pos,content)};var Fitter=function Fitter($from,$to,slice){this.$to=$to,this.$from=$from,this.unplaced=slice,this.frontier=[];for(var i=0;i<=$from.depth;i++){var node=$from.node(i);this.frontier.push({type:node.type,match:node.contentMatchAt($from.indexAfter(i))})}this.placed=Fragment.empty;for(var i$1=$from.depth;i$1>0;i$1--)this.placed=Fragment.from($from.node(i$1).copy(this.placed))},index_es_prototypeAccessors$1={depth:{configurable:!0}};function dropFromFragment(fragment,depth,count){return 0==depth?fragment.cutByIndex(count):fragment.replaceChild(0,fragment.firstChild.copy(dropFromFragment(fragment.firstChild.content,depth-1,count)))}function addToFragment(fragment,depth,content){return 0==depth?fragment.append(content):fragment.replaceChild(fragment.childCount-1,fragment.lastChild.copy(addToFragment(fragment.lastChild.content,depth-1,content)))}function contentAt(fragment,depth){for(var i=0;i<depth;i++)fragment=fragment.firstChild.content;return fragment}function closeNodeStart(node,openStart,openEnd){if(openStart<=0)return node;var frag=node.content;return openStart>1&&(frag=frag.replaceChild(0,closeNodeStart(frag.firstChild,openStart-1,1==frag.childCount?openEnd-1:0))),openStart>0&&(frag=node.type.contentMatch.fillBefore(frag).append(frag),openEnd<=0&&(frag=frag.append(node.type.contentMatch.matchFragment(frag).fillBefore(Fragment.empty,!0)))),node.copy(frag)}function contentAfterFits($to,depth,type,match,open){var node=$to.node(depth),index=open?$to.indexAfter(depth):$to.index(depth);if(index==node.childCount&&!type.compatibleContent(node.type))return null;var fit=match.fillBefore(node.content,!0,index);return fit&&!invalidMarks(type,node.content,index)?fit:null}function invalidMarks(type,fragment,start){for(var i=start;i<fragment.childCount;i++)if(!type.allowsMarks(fragment.child(i).marks))return!0;return!1}function closeFragment(fragment,depth,oldOpen,newOpen,parent){if(depth<oldOpen){var first=fragment.firstChild;fragment=fragment.replaceChild(0,first.copy(closeFragment(first.content,depth+1,oldOpen,newOpen,first)))}if(depth>newOpen){var match=parent.contentMatchAt(0),start=match.fillBefore(fragment).append(fragment);fragment=start.append(match.matchFragment(start).fillBefore(Fragment.empty,!0))}return fragment}function coveredDepths($from,$to){for(var result=[],minDepth,d=Math.min($from.depth,$to.depth);d>=0;d--){var start=$from.start(d);if(start<$from.pos-($from.depth-d)||$to.end(d)>$to.pos+($to.depth-d)||$from.node(d).type.spec.isolating||$to.node(d).type.spec.isolating)break;start==$to.start(d)&&result.push(d)}return result}index_es_prototypeAccessors$1.depth.get=function(){return this.frontier.length-1},Fitter.prototype.fit=function fit(){for(;this.unplaced.size;){var fit=this.findFittable();fit?this.placeNodes(fit):this.openMore()||this.dropNode()}var moveInline=this.mustMoveInline(),placedSize=this.placed.size-this.depth-this.$from.depth,$from=this.$from,$to=this.close(moveInline<0?this.$to:$from.doc.resolve(moveInline));if(!$to)return null;for(var content=this.placed,openStart=$from.depth,openEnd=$to.depth;openStart&&openEnd&&1==content.childCount;)content=content.firstChild.content,openStart--,openEnd--;var slice=new Slice(content,openStart,openEnd);return moveInline>-1?new ReplaceAroundStep($from.pos,moveInline,this.$to.pos,this.$to.end(),slice,placedSize):slice.size||$from.pos!=this.$to.pos?new ReplaceStep($from.pos,$to.pos,slice):void 0},Fitter.prototype.findFittable=function findFittable(){for(var pass=1;pass<=2;pass++)for(var sliceDepth=this.unplaced.openStart;sliceDepth>=0;sliceDepth--)for(var fragment=void 0,parent=void 0,first=(fragment=sliceDepth?(parent=contentAt(this.unplaced.content,sliceDepth-1).firstChild).content:this.unplaced.content).firstChild,frontierDepth=this.depth;frontierDepth>=0;frontierDepth--){var ref=this.frontier[frontierDepth],type=ref.type,match=ref.match,wrap=void 0,inject=void 0;if(1==pass&&(first?match.matchType(first.type)||(inject=match.fillBefore(Fragment.from(first),!1)):type.compatibleContent(parent.type)))return{sliceDepth:sliceDepth,frontierDepth:frontierDepth,parent:parent,inject:inject};if(2==pass&&first&&(wrap=match.findWrapping(first.type)))return{sliceDepth:sliceDepth,frontierDepth:frontierDepth,parent:parent,wrap:wrap};if(parent&&match.matchType(parent.type))break}},Fitter.prototype.openMore=function openMore(){var ref=this.unplaced,content=ref.content,openStart=ref.openStart,openEnd=ref.openEnd,inner=contentAt(content,openStart);return!(!inner.childCount||inner.firstChild.isLeaf)&&(this.unplaced=new Slice(content,openStart+1,Math.max(openEnd,inner.size+openStart>=content.size-openEnd?openStart+1:0)),!0)},Fitter.prototype.dropNode=function dropNode(){var ref=this.unplaced,content=ref.content,openStart=ref.openStart,openEnd=ref.openEnd,inner=contentAt(content,openStart);if(inner.childCount<=1&&openStart>0){var openAtEnd=content.size-openStart<=openStart+inner.size;this.unplaced=new Slice(dropFromFragment(content,openStart-1,1),openStart-1,openAtEnd?openStart-1:openEnd)}else this.unplaced=new Slice(dropFromFragment(content,openStart,1),openStart,openEnd)},Fitter.prototype.placeNodes=function placeNodes(ref){for(var sliceDepth=ref.sliceDepth,frontierDepth=ref.frontierDepth,parent=ref.parent,inject=ref.inject,wrap=ref.wrap;this.depth>frontierDepth;)this.closeFrontierNode();if(wrap)for(var i=0;i<wrap.length;i++)this.openFrontierNode(wrap[i]);var slice=this.unplaced,fragment=parent?parent.content:slice.content,openStart=slice.openStart-sliceDepth,taken=0,add=[],ref$1=this.frontier[frontierDepth],match=ref$1.match,type=ref$1.type;if(inject){for(var i$1=0;i$1<inject.childCount;i$1++)add.push(inject.child(i$1));match=match.matchFragment(inject)}for(var openEndCount=fragment.size+sliceDepth-(slice.content.size-slice.openEnd);taken<fragment.childCount;){var next=fragment.child(taken),matches=match.matchType(next.type);if(!matches)break;(++taken>1||0==openStart||next.content.size)&&(match=matches,add.push(closeNodeStart(next.mark(type.allowedMarks(next.marks)),1==taken?openStart:0,taken==fragment.childCount?openEndCount:-1)))}var toEnd=taken==fragment.childCount;toEnd||(openEndCount=-1),this.placed=addToFragment(this.placed,frontierDepth,Fragment.from(add)),this.frontier[frontierDepth].match=match,toEnd&&openEndCount<0&&parent&&parent.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(var i$2=0,cur=fragment;i$2<openEndCount;i$2++){var node=cur.lastChild;this.frontier.push({type:node.type,match:node.contentMatchAt(node.childCount)}),cur=node.content}this.unplaced=toEnd?0==sliceDepth?Slice.empty:new Slice(dropFromFragment(slice.content,sliceDepth-1,1),sliceDepth-1,openEndCount<0?slice.openEnd:sliceDepth-1):new Slice(dropFromFragment(slice.content,sliceDepth,taken),slice.openStart,slice.openEnd)},Fitter.prototype.mustMoveInline=function mustMoveInline(){if(!this.$to.parent.isTextblock||this.$to.end()==this.$to.pos)return-1;var top=this.frontier[this.depth],level;if(!top.type.isTextblock||!contentAfterFits(this.$to,this.$to.depth,top.type,top.match,!1)||this.$to.depth==this.depth&&(level=this.findCloseLevel(this.$to))&&level.depth==this.depth)return-1;for(var ref,depth=this.$to.depth,after=this.$to.after(depth);depth>1&&after==this.$to.end(--depth);)++after;return after},Fitter.prototype.findCloseLevel=function findCloseLevel($to){scan:for(var i=Math.min(this.depth,$to.depth);i>=0;i--){var ref=this.frontier[i],match=ref.match,type=ref.type,dropInner=i<$to.depth&&$to.end(i+1)==$to.pos+($to.depth-(i+1)),fit=contentAfterFits($to,i,type,match,dropInner);if(fit){for(var d=i-1;d>=0;d--){var ref$1=this.frontier[d],match$1=ref$1.match,type$1,matches=contentAfterFits($to,d,ref$1.type,match$1,!0);if(!matches||matches.childCount)continue scan}return{depth:i,fit:fit,move:dropInner?$to.doc.resolve($to.after(i+1)):$to}}}},Fitter.prototype.close=function close($to){var close=this.findCloseLevel($to);if(!close)return null;for(;this.depth>close.depth;)this.closeFrontierNode();close.fit.childCount&&(this.placed=addToFragment(this.placed,close.depth,close.fit)),$to=close.move;for(var d=close.depth+1;d<=$to.depth;d++){var node=$to.node(d),add=node.type.contentMatch.fillBefore(node.content,!0,$to.index(d));this.openFrontierNode(node.type,node.attrs,add)}return $to},Fitter.prototype.openFrontierNode=function openFrontierNode(type,attrs,content){var top=this.frontier[this.depth];top.match=top.match.matchType(type),this.placed=addToFragment(this.placed,this.depth,Fragment.from(type.create(attrs,content))),this.frontier.push({type:type,match:type.contentMatch})},Fitter.prototype.closeFrontierNode=function closeFrontierNode(){var open,add=this.frontier.pop().match.fillBefore(Fragment.empty,!0);add.childCount&&(this.placed=addToFragment(this.placed,this.frontier.length,add))},Object.defineProperties(Fitter.prototype,index_es_prototypeAccessors$1),Transform.prototype.replaceRange=function(from,to,slice){if(!slice.size)return this.deleteRange(from,to);var $from=this.doc.resolve(from),$to=this.doc.resolve(to);if(fitsTrivially($from,$to,slice))return this.step(new ReplaceStep(from,to,slice));var targetDepths=coveredDepths($from,this.doc.resolve(to));0==targetDepths[targetDepths.length-1]&&targetDepths.pop();var preferredTarget=-($from.depth+1);targetDepths.unshift(preferredTarget);for(var d=$from.depth,pos=$from.pos-1;d>0;d--,pos--){var spec=$from.node(d).type.spec;if(spec.defining||spec.isolating)break;targetDepths.indexOf(d)>-1?preferredTarget=d:$from.before(d)==pos&&targetDepths.splice(1,0,-d)}for(var preferredTargetIndex=targetDepths.indexOf(preferredTarget),leftNodes=[],preferredDepth=slice.openStart,content=slice.content,i=0;;i++){var node=content.firstChild;if(leftNodes.push(node),i==slice.openStart)break;content=node.content}preferredDepth>0&&leftNodes[preferredDepth-1].type.spec.defining&&$from.node(preferredTargetIndex).type!=leftNodes[preferredDepth-1].type?preferredDepth-=1:preferredDepth>=2&&leftNodes[preferredDepth-1].isTextblock&&leftNodes[preferredDepth-2].type.spec.defining&&$from.node(preferredTargetIndex).type!=leftNodes[preferredDepth-2].type&&(preferredDepth-=2);for(var j=slice.openStart;j>=0;j--){var openDepth=(j+preferredDepth+1)%(slice.openStart+1),insert=leftNodes[openDepth];if(insert)for(var i$1=0;i$1<targetDepths.length;i$1++){var targetDepth=targetDepths[(i$1+preferredTargetIndex)%targetDepths.length],expand=!0;targetDepth<0&&(expand=!1,targetDepth=-targetDepth);var parent=$from.node(targetDepth-1),index=$from.index(targetDepth-1);if(parent.canReplaceWith(index,index,insert.type,insert.marks))return this.replace($from.before(targetDepth),expand?$to.after(targetDepth):to,new Slice(closeFragment(slice.content,0,slice.openStart,openDepth),openDepth,slice.openEnd))}}for(var startSteps=this.steps.length,i$2=targetDepths.length-1;i$2>=0&&(this.replace(from,to,slice),!(this.steps.length>startSteps));i$2--){var depth=targetDepths[i$2];i$2<0||(from=$from.before(depth),to=$to.after(depth))}return this},Transform.prototype.replaceRangeWith=function(from,to,node){if(!node.isInline&&from==to&&this.doc.resolve(from).parent.content.size){var point=insertPoint(this.doc,from,node.type);null!=point&&(from=to=point)}return this.replaceRange(from,to,new Slice(Fragment.from(node),0,0))},Transform.prototype.deleteRange=function(from,to){for(var $from=this.doc.resolve(from),$to=this.doc.resolve(to),covered=coveredDepths($from,$to),i=0;i<covered.length;i++){var depth=covered[i],last=i==covered.length-1;if(last&&0==depth||$from.node(depth).type.contentMatch.validEnd)return this.delete($from.start(depth),$to.end(depth));if(depth>0&&(last||$from.node(depth-1).canReplace($from.index(depth-1),$to.indexAfter(depth-1))))return this.delete($from.before(depth),$to.after(depth))}for(var d=1;d<=$from.depth&&d<=$to.depth;d++)if(from-$from.start(d)==$from.depth-d&&to>$from.end(d)&&$to.end(d)-to!=$to.depth-d)return this.delete($from.before(d),to);return this.delete(from,to)};var classesById=Object.create(null),Selection=function Selection($anchor,$head,ranges){this.ranges=ranges||[new SelectionRange($anchor.min($head),$anchor.max($head))],this.$anchor=$anchor,this.$head=$head},dist_index_es_prototypeAccessors={anchor:{configurable:!0},head:{configurable:!0},from:{configurable:!0},to:{configurable:!0},$from:{configurable:!0},$to:{configurable:!0},empty:{configurable:!0}};dist_index_es_prototypeAccessors.anchor.get=function(){return this.$anchor.pos},dist_index_es_prototypeAccessors.head.get=function(){return this.$head.pos},dist_index_es_prototypeAccessors.from.get=function(){return this.$from.pos},dist_index_es_prototypeAccessors.to.get=function(){return this.$to.pos},dist_index_es_prototypeAccessors.$from.get=function(){return this.ranges[0].$from},dist_index_es_prototypeAccessors.$to.get=function(){return this.ranges[0].$to},dist_index_es_prototypeAccessors.empty.get=function(){for(var ranges=this.ranges,i=0;i<ranges.length;i++)if(ranges[i].$from.pos!=ranges[i].$to.pos)return!1;return!0},Selection.prototype.content=function content(){return this.$from.node(0).slice(this.from,this.to,!0)},Selection.prototype.replace=function replace(tr,content){void 0===content&&(content=Slice.empty);for(var lastNode=content.content.lastChild,lastParent=null,i=0;i<content.openEnd;i++)lastParent=lastNode,lastNode=lastNode.lastChild;for(var mapFrom=tr.steps.length,ranges=this.ranges,i$1=0;i$1<ranges.length;i$1++){var ref=ranges[i$1],$from=ref.$from,$to=ref.$to,mapping=tr.mapping.slice(mapFrom);tr.replaceRange(mapping.map($from.pos),mapping.map($to.pos),i$1?Slice.empty:content),0==i$1&&selectionToInsertionEnd(tr,mapFrom,(lastNode?lastNode.isInline:lastParent&&lastParent.isTextblock)?-1:1)}},Selection.prototype.replaceWith=function replaceWith(tr,node){for(var mapFrom=tr.steps.length,ranges=this.ranges,i=0;i<ranges.length;i++){var ref=ranges[i],$from=ref.$from,$to=ref.$to,mapping=tr.mapping.slice(mapFrom),from=mapping.map($from.pos),to=mapping.map($to.pos);i?tr.deleteRange(from,to):(tr.replaceRangeWith(from,to,node),selectionToInsertionEnd(tr,mapFrom,node.isInline?-1:1))}},Selection.findFrom=function findFrom($pos,dir,textOnly){var inner=$pos.parent.inlineContent?new TextSelection($pos):findSelectionIn($pos.node(0),$pos.parent,$pos.pos,$pos.index(),dir,textOnly);if(inner)return inner;for(var depth=$pos.depth-1;depth>=0;depth--){var found=dir<0?findSelectionIn($pos.node(0),$pos.node(depth),$pos.before(depth+1),$pos.index(depth),dir,textOnly):findSelectionIn($pos.node(0),$pos.node(depth),$pos.after(depth+1),$pos.index(depth)+1,dir,textOnly);if(found)return found}},Selection.near=function near($pos,bias){return void 0===bias&&(bias=1),this.findFrom($pos,bias)||this.findFrom($pos,-bias)||new AllSelection($pos.node(0))},Selection.atStart=function atStart(doc){return findSelectionIn(doc,doc,0,0,1)||new AllSelection(doc)},Selection.atEnd=function atEnd(doc){return findSelectionIn(doc,doc,doc.content.size,doc.childCount,-1)||new AllSelection(doc)},Selection.fromJSON=function fromJSON(doc,json){if(!json||!json.type)throw new RangeError("Invalid input for Selection.fromJSON");var cls=classesById[json.type];if(!cls)throw new RangeError("No selection type "+json.type+" defined");return cls.fromJSON(doc,json)},Selection.jsonID=function jsonID(id,selectionClass){if(id in classesById)throw new RangeError("Duplicate use of selection JSON ID "+id);return classesById[id]=selectionClass,selectionClass.prototype.jsonID=id,selectionClass},Selection.prototype.getBookmark=function getBookmark(){return TextSelection.between(this.$anchor,this.$head).getBookmark()},Object.defineProperties(Selection.prototype,dist_index_es_prototypeAccessors),Selection.prototype.visible=!0;var SelectionRange=function SelectionRange($from,$to){this.$from=$from,this.$to=$to},TextSelection=function(Selection){function TextSelection($anchor,$head){void 0===$head&&($head=$anchor),Selection.call(this,$anchor,$head)}Selection&&(TextSelection.__proto__=Selection),TextSelection.prototype=Object.create(Selection&&Selection.prototype),TextSelection.prototype.constructor=TextSelection;var prototypeAccessors$1={$cursor:{configurable:!0}};return prototypeAccessors$1.$cursor.get=function(){return this.$anchor.pos==this.$head.pos?this.$head:null},TextSelection.prototype.map=function map(doc,mapping){var $head=doc.resolve(mapping.map(this.head));if(!$head.parent.inlineContent)return Selection.near($head);var $anchor=doc.resolve(mapping.map(this.anchor));return new TextSelection($anchor.parent.inlineContent?$anchor:$head,$head)},TextSelection.prototype.replace=function replace(tr,content){if(void 0===content&&(content=Slice.empty),Selection.prototype.replace.call(this,tr,content),content==Slice.empty){var marks=this.$from.marksAcross(this.$to);marks&&tr.ensureMarks(marks)}},TextSelection.prototype.eq=function eq(other){return other instanceof TextSelection&&other.anchor==this.anchor&&other.head==this.head},TextSelection.prototype.getBookmark=function getBookmark(){return new TextBookmark(this.anchor,this.head)},TextSelection.prototype.toJSON=function toJSON(){return{type:"text",anchor:this.anchor,head:this.head}},TextSelection.fromJSON=function fromJSON(doc,json){if("number"!=typeof json.anchor||"number"!=typeof json.head)throw new RangeError("Invalid input for TextSelection.fromJSON");return new TextSelection(doc.resolve(json.anchor),doc.resolve(json.head))},TextSelection.create=function create(doc,anchor,head){void 0===head&&(head=anchor);var $anchor=doc.resolve(anchor);return new this($anchor,head==anchor?$anchor:doc.resolve(head))},TextSelection.between=function between($anchor,$head,bias){var dPos=$anchor.pos-$head.pos;if(bias&&!dPos||(bias=dPos>=0?1:-1),!$head.parent.inlineContent){var found=Selection.findFrom($head,bias,!0)||Selection.findFrom($head,-bias,!0);if(!found)return Selection.near($head,bias);$head=found.$head}return $anchor.parent.inlineContent||(0==dPos?$anchor=$head:($anchor=(Selection.findFrom($anchor,-bias,!0)||Selection.findFrom($anchor,bias,!0)).$anchor).pos<$head.pos!=dPos<0&&($anchor=$head)),new TextSelection($anchor,$head)},Object.defineProperties(TextSelection.prototype,prototypeAccessors$1),TextSelection}(Selection);Selection.jsonID("text",TextSelection);var TextBookmark=function TextBookmark(anchor,head){this.anchor=anchor,this.head=head};TextBookmark.prototype.map=function map(mapping){return new TextBookmark(mapping.map(this.anchor),mapping.map(this.head))},TextBookmark.prototype.resolve=function resolve(doc){return TextSelection.between(doc.resolve(this.anchor),doc.resolve(this.head))};var index_es_NodeSelection=function(Selection){function NodeSelection($pos){var node=$pos.nodeAfter,$end=$pos.node(0).resolve($pos.pos+node.nodeSize);Selection.call(this,$pos,$end),this.node=node}return Selection&&(NodeSelection.__proto__=Selection),NodeSelection.prototype=Object.create(Selection&&Selection.prototype),NodeSelection.prototype.constructor=NodeSelection,NodeSelection.prototype.map=function map(doc,mapping){var ref=mapping.mapResult(this.anchor),deleted=ref.deleted,pos=ref.pos,$pos=doc.resolve(pos);return deleted?Selection.near($pos):new NodeSelection($pos)},NodeSelection.prototype.content=function content(){return new Slice(Fragment.from(this.node),0,0)},NodeSelection.prototype.eq=function eq(other){return other instanceof NodeSelection&&other.anchor==this.anchor},NodeSelection.prototype.toJSON=function toJSON(){return{type:"node",anchor:this.anchor}},NodeSelection.prototype.getBookmark=function getBookmark(){return new NodeBookmark(this.anchor)},NodeSelection.fromJSON=function fromJSON(doc,json){if("number"!=typeof json.anchor)throw new RangeError("Invalid input for NodeSelection.fromJSON");return new NodeSelection(doc.resolve(json.anchor))},NodeSelection.create=function create(doc,from){return new this(doc.resolve(from))},NodeSelection.isSelectable=function isSelectable(node){return!node.isText&&!1!==node.type.spec.selectable},NodeSelection}(Selection);index_es_NodeSelection.prototype.visible=!1,Selection.jsonID("node",index_es_NodeSelection);var NodeBookmark=function NodeBookmark(anchor){this.anchor=anchor};NodeBookmark.prototype.map=function map(mapping){var ref=mapping.mapResult(this.anchor),deleted=ref.deleted,pos=ref.pos;return deleted?new TextBookmark(pos,pos):new NodeBookmark(pos)},NodeBookmark.prototype.resolve=function resolve(doc){var $pos=doc.resolve(this.anchor),node=$pos.nodeAfter;return node&&index_es_NodeSelection.isSelectable(node)?new index_es_NodeSelection($pos):Selection.near($pos)};var AllSelection=function(Selection){function AllSelection(doc){Selection.call(this,doc.resolve(0),doc.resolve(doc.content.size))}return Selection&&(AllSelection.__proto__=Selection),AllSelection.prototype=Object.create(Selection&&Selection.prototype),AllSelection.prototype.constructor=AllSelection,AllSelection.prototype.replace=function replace(tr,content){if(void 0===content&&(content=Slice.empty),content==Slice.empty){tr.delete(0,tr.doc.content.size);var sel=Selection.atStart(tr.doc);sel.eq(tr.selection)||tr.setSelection(sel)}else Selection.prototype.replace.call(this,tr,content)},AllSelection.prototype.toJSON=function toJSON(){return{type:"all"}},AllSelection.fromJSON=function fromJSON(doc){return new AllSelection(doc)},AllSelection.prototype.map=function map(doc){return new AllSelection(doc)},AllSelection.prototype.eq=function eq(other){return other instanceof AllSelection},AllSelection.prototype.getBookmark=function getBookmark(){return AllBookmark},AllSelection}(Selection);Selection.jsonID("all",AllSelection);var AllBookmark={map:function map(){return this},resolve:function resolve(doc){return new AllSelection(doc)}};function findSelectionIn(doc,node,pos,index,dir,text){if(node.inlineContent)return TextSelection.create(doc,pos);for(var i=index-(dir>0?0:1);dir>0?i<node.childCount:i>=0;i+=dir){var child=node.child(i);if(child.isAtom){if(!text&&index_es_NodeSelection.isSelectable(child))return index_es_NodeSelection.create(doc,pos-(dir<0?child.nodeSize:0))}else{var inner=findSelectionIn(doc,child,pos+dir,dir<0?child.childCount:0,dir,text);if(inner)return inner}pos+=child.nodeSize*dir}}function selectionToInsertionEnd(tr,startLen,bias){var last=tr.steps.length-1;if(!(last<startLen)){var step=tr.steps[last],map,end;if(step instanceof ReplaceStep||step instanceof ReplaceAroundStep)tr.mapping.maps[last].forEach((function(_from,_to,_newFrom,newTo){null==end&&(end=newTo)})),tr.setSelection(Selection.near(tr.doc.resolve(end),bias))}}var UPDATED_SEL=1,UPDATED_MARKS=2,UPDATED_SCROLL=4,Transaction=function(Transform){function Transaction(state){Transform.call(this,state.doc),this.time=Date.now(),this.curSelection=state.selection,this.curSelectionFor=0,this.storedMarks=state.storedMarks,this.updated=0,this.meta=Object.create(null)}Transform&&(Transaction.__proto__=Transform),Transaction.prototype=Object.create(Transform&&Transform.prototype),Transaction.prototype.constructor=Transaction;var prototypeAccessors={selection:{configurable:!0},selectionSet:{configurable:!0},storedMarksSet:{configurable:!0},isGeneric:{configurable:!0},scrolledIntoView:{configurable:!0}};return prototypeAccessors.selection.get=function(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection},Transaction.prototype.setSelection=function setSelection(selection){if(selection.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=selection,this.curSelectionFor=this.steps.length,this.updated=-3&(1|this.updated),this.storedMarks=null,this},prototypeAccessors.selectionSet.get=function(){return(1&this.updated)>0},Transaction.prototype.setStoredMarks=function setStoredMarks(marks){return this.storedMarks=marks,this.updated|=2,this},Transaction.prototype.ensureMarks=function ensureMarks(marks){return Mark.sameSet(this.storedMarks||this.selection.$from.marks(),marks)||this.setStoredMarks(marks),this},Transaction.prototype.addStoredMark=function addStoredMark(mark){return this.ensureMarks(mark.addToSet(this.storedMarks||this.selection.$head.marks()))},Transaction.prototype.removeStoredMark=function removeStoredMark(mark){return this.ensureMarks(mark.removeFromSet(this.storedMarks||this.selection.$head.marks()))},prototypeAccessors.storedMarksSet.get=function(){return(2&this.updated)>0},Transaction.prototype.addStep=function addStep(step,doc){Transform.prototype.addStep.call(this,step,doc),this.updated=-3&this.updated,this.storedMarks=null},Transaction.prototype.setTime=function setTime(time){return this.time=time,this},Transaction.prototype.replaceSelection=function replaceSelection(slice){return this.selection.replace(this,slice),this},Transaction.prototype.replaceSelectionWith=function replaceSelectionWith(node,inheritMarks){var selection=this.selection;return!1!==inheritMarks&&(node=node.mark(this.storedMarks||(selection.empty?selection.$from.marks():selection.$from.marksAcross(selection.$to)||Mark.none))),selection.replaceWith(this,node),this},Transaction.prototype.deleteSelection=function deleteSelection(){return this.selection.replace(this),this},Transaction.prototype.insertText=function insertText(text,from,to){void 0===to&&(to=from);var schema=this.doc.type.schema;if(null==from)return text?this.replaceSelectionWith(schema.text(text),!0):this.deleteSelection();if(!text)return this.deleteRange(from,to);var marks=this.storedMarks;if(!marks){var $from=this.doc.resolve(from);marks=to==from?$from.marks():$from.marksAcross(this.doc.resolve(to))}return this.replaceRangeWith(from,to,schema.text(text,marks)),this.selection.empty||this.setSelection(Selection.near(this.selection.$to)),this},Transaction.prototype.setMeta=function setMeta(key,value){return this.meta["string"==typeof key?key:key.key]=value,this},Transaction.prototype.getMeta=function getMeta(key){return this.meta["string"==typeof key?key:key.key]},prototypeAccessors.isGeneric.get=function(){for(var _ in this.meta)return!1;return!0},Transaction.prototype.scrollIntoView=function scrollIntoView(){return this.updated|=4,this},prototypeAccessors.scrolledIntoView.get=function(){return(4&this.updated)>0},Object.defineProperties(Transaction.prototype,prototypeAccessors),Transaction}(Transform);function bind(f,self){return self&&f?f.bind(self):f}var FieldDesc=function FieldDesc(name,desc,self){this.name=name,this.init=bind(desc.init,self),this.apply=bind(desc.apply,self)},baseFields=[new FieldDesc("doc",{init:function init(config){return config.doc||config.schema.topNodeType.createAndFill()},apply:function apply(tr){return tr.doc}}),new FieldDesc("selection",{init:function init(config,instance){return config.selection||Selection.atStart(instance.doc)},apply:function apply(tr){return tr.selection}}),new FieldDesc("storedMarks",{init:function init(config){return config.storedMarks||null},apply:function apply(tr,_marks,_old,state){return state.selection.$cursor?tr.storedMarks:null}}),new FieldDesc("scrollToSelection",{init:function init(){return 0},apply:function apply(tr,prev){return tr.scrolledIntoView?prev+1:prev}})],Configuration=function Configuration(schema,plugins){var this$1=this;this.schema=schema,this.fields=baseFields.concat(),this.plugins=[],this.pluginsByKey=Object.create(null),plugins&&plugins.forEach((function(plugin){if(this$1.pluginsByKey[plugin.key])throw new RangeError("Adding different instances of a keyed plugin ("+plugin.key+")");this$1.plugins.push(plugin),this$1.pluginsByKey[plugin.key]=plugin,plugin.spec.state&&this$1.fields.push(new FieldDesc(plugin.key,plugin.spec.state,plugin))}))},EditorState=function EditorState(config){this.config=config},dist_index_es_prototypeAccessors$1={schema:{configurable:!0},plugins:{configurable:!0},tr:{configurable:!0}};dist_index_es_prototypeAccessors$1.schema.get=function(){return this.config.schema},dist_index_es_prototypeAccessors$1.plugins.get=function(){return this.config.plugins},EditorState.prototype.apply=function apply(tr){return this.applyTransaction(tr).state},EditorState.prototype.filterTransaction=function filterTransaction(tr,ignore){void 0===ignore&&(ignore=-1);for(var i=0;i<this.config.plugins.length;i++)if(i!=ignore){var plugin=this.config.plugins[i];if(plugin.spec.filterTransaction&&!plugin.spec.filterTransaction.call(plugin,tr,this))return!1}return!0},EditorState.prototype.applyTransaction=function applyTransaction(rootTr){if(!this.filterTransaction(rootTr))return{state:this,transactions:[]};for(var trs=[rootTr],newState=this.applyInner(rootTr),seen=null;;){for(var haveNew=!1,i=0;i<this.config.plugins.length;i++){var plugin=this.config.plugins[i];if(plugin.spec.appendTransaction){var n=seen?seen[i].n:0,oldState=seen?seen[i].state:this,tr=n<trs.length&&plugin.spec.appendTransaction.call(plugin,n?trs.slice(n):trs,oldState,newState);if(tr&&newState.filterTransaction(tr,i)){if(tr.setMeta("appendedTransaction",rootTr),!seen){seen=[];for(var j=0;j<this.config.plugins.length;j++)seen.push(j<i?{state:newState,n:trs.length}:{state:this,n:0})}trs.push(tr),newState=newState.applyInner(tr),haveNew=!0}seen&&(seen[i]={state:newState,n:trs.length})}}if(!haveNew)return{state:newState,transactions:trs}}},EditorState.prototype.applyInner=function applyInner(tr){if(!tr.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");for(var newInstance=new EditorState(this.config),fields=this.config.fields,i=0;i<fields.length;i++){var field=fields[i];newInstance[field.name]=field.apply(tr,this[field.name],this,newInstance)}for(var i$1=0;i$1<applyListeners.length;i$1++)applyListeners[i$1](this,tr,newInstance);return newInstance},dist_index_es_prototypeAccessors$1.tr.get=function(){return new Transaction(this)},EditorState.create=function create(config){for(var $config=new Configuration(config.doc?config.doc.type.schema:config.schema,config.plugins),instance=new EditorState($config),i=0;i<$config.fields.length;i++)instance[$config.fields[i].name]=$config.fields[i].init(config,instance);return instance},EditorState.prototype.reconfigure=function reconfigure(config){for(var $config=new Configuration(this.schema,config.plugins),fields=$config.fields,instance=new EditorState($config),i=0;i<fields.length;i++){var name=fields[i].name;instance[name]=this.hasOwnProperty(name)?this[name]:fields[i].init(config,instance)}return instance},EditorState.prototype.toJSON=function toJSON(pluginFields){var result={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(result.storedMarks=this.storedMarks.map((function(m){return m.toJSON()}))),pluginFields&&"object"==typeof pluginFields)for(var prop in pluginFields){if("doc"==prop||"selection"==prop)throw new RangeError("The JSON fields `doc` and `selection` are reserved");var plugin=pluginFields[prop],state=plugin.spec.state;state&&state.toJSON&&(result[prop]=state.toJSON.call(plugin,this[plugin.key]))}return result},EditorState.fromJSON=function fromJSON(config,json,pluginFields){if(!json)throw new RangeError("Invalid input for EditorState.fromJSON");if(!config.schema)throw new RangeError("Required config field 'schema' missing");var $config=new Configuration(config.schema,config.plugins),instance=new EditorState($config);return $config.fields.forEach((function(field){if("doc"==field.name)instance.doc=index_es_Node.fromJSON(config.schema,json.doc);else if("selection"==field.name)instance.selection=Selection.fromJSON(instance.doc,json.selection);else if("storedMarks"==field.name)json.storedMarks&&(instance.storedMarks=json.storedMarks.map(config.schema.markFromJSON));else{if(pluginFields)for(var prop in pluginFields){var plugin=pluginFields[prop],state=plugin.spec.state;if(plugin.key==field.name&&state&&state.fromJSON&&Object.prototype.hasOwnProperty.call(json,prop))return void(instance[field.name]=state.fromJSON.call(plugin,config,json[prop],instance))}instance[field.name]=field.init(config,instance)}})),instance},EditorState.addApplyListener=function addApplyListener(f){applyListeners.push(f)},EditorState.removeApplyListener=function removeApplyListener(f){var found=applyListeners.indexOf(f);found>-1&&applyListeners.splice(found,1)},Object.defineProperties(EditorState.prototype,dist_index_es_prototypeAccessors$1);var applyListeners=[];function bindProps(obj,self,target){for(var prop in obj){var val=obj[prop];val instanceof Function?val=val.bind(self):"handleDOMEvents"==prop&&(val=bindProps(val,self,{})),target[prop]=val}return target}var Plugin=function Plugin(spec){this.props={},spec.props&&bindProps(spec.props,this,this.props),this.spec=spec,this.key=spec.key?spec.key.key:createKey("plugin")};Plugin.prototype.getState=function getState(state){return state[this.key]};var keys=Object.create(null);function createKey(name){return name in keys?name+"$"+ ++keys[name]:(keys[name]=0,name+"$")}var PluginKey=function PluginKey(name){void 0===name&&(name="key"),this.key=createKey(name)};PluginKey.prototype.get=function get(state){return state.config.pluginsByKey[this.key]},PluginKey.prototype.getState=function getState(state){return state[this.key]};var result={};if("undefined"!=typeof navigator&&"undefined"!=typeof document){var ie_edge=/Edge\/(\d+)/.exec(navigator.userAgent),ie_upto10=/MSIE \d/.test(navigator.userAgent),ie_11up=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);result.mac=/Mac/.test(navigator.platform);var ie=result.ie=!!(ie_upto10||ie_11up||ie_edge);result.ie_version=ie_upto10?document.documentMode||6:ie_11up?+ie_11up[1]:ie_edge?+ie_edge[1]:null,result.gecko=!ie&&/gecko\/(\d+)/i.test(navigator.userAgent),result.gecko_version=result.gecko&&+(/Firefox\/(\d+)/.exec(navigator.userAgent)||[0,0])[1];var chrome=!ie&&/Chrome\/(\d+)/.exec(navigator.userAgent);result.chrome=!!chrome,result.chrome_version=chrome&&+chrome[1],result.safari=!ie&&/Apple Computer/.test(navigator.vendor),result.ios=result.safari&&(/Mobile\/\w+/.test(navigator.userAgent)||navigator.maxTouchPoints>2),result.android=/Android \d/.test(navigator.userAgent),result.webkit="webkitFontSmoothing"in document.documentElement.style,result.webkit_version=result.webkit&&+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]}var domIndex=function(node){for(var index=0;;index++)if(!(node=node.previousSibling))return index},parentNode=function(node){var parent=node.assignedSlot||node.parentNode;return parent&&11==parent.nodeType?parent.host:parent},reusedRange=null,textRange=function(node,from,to){var range=reusedRange||(reusedRange=document.createRange());return range.setEnd(node,null==to?node.nodeValue.length:to),range.setStart(node,from||0),range},isEquivalentPosition=function(node,off,targetNode,targetOff){return targetNode&&(scanFor(node,off,targetNode,targetOff,-1)||scanFor(node,off,targetNode,targetOff,1))},atomElements=/^(img|br|input|textarea|hr)$/i;function scanFor(node,off,targetNode,targetOff,dir){for(;;){if(node==targetNode&&off==targetOff)return!0;if(off==(dir<0?0:nodeSize(node))){var parent=node.parentNode;if(1!=parent.nodeType||hasBlockDesc(node)||atomElements.test(node.nodeName)||"false"==node.contentEditable)return!1;off=domIndex(node)+(dir<0?0:1),node=parent}else{if(1!=node.nodeType)return!1;if("false"==(node=node.childNodes[off+(dir<0?-1:0)]).contentEditable)return!1;off=dir<0?nodeSize(node):0}}}function nodeSize(node){return 3==node.nodeType?node.nodeValue.length:node.childNodes.length}function isOnEdge(node,offset,parent){for(var atStart=0==offset,atEnd=offset==nodeSize(node);atStart||atEnd;){if(node==parent)return!0;var index=domIndex(node);if(!(node=node.parentNode))return!1;atStart=atStart&&0==index,atEnd=atEnd&&index==nodeSize(node)}}function hasBlockDesc(dom){for(var desc,cur=dom;cur&&!(desc=cur.pmViewDesc);cur=cur.parentNode);return desc&&desc.node&&desc.node.isBlock&&(desc.dom==dom||desc.contentDOM==dom)}var selectionCollapsed=function(domSel){var collapsed=domSel.isCollapsed;return collapsed&&result.chrome&&domSel.rangeCount&&!domSel.getRangeAt(0).collapsed&&(collapsed=!1),collapsed};function keyEvent(keyCode,key){var event=document.createEvent("Event");return event.initEvent("keydown",!0,!0),event.keyCode=keyCode,event.key=event.code=key,event}function windowRect(doc){return{left:0,right:doc.documentElement.clientWidth,top:0,bottom:doc.documentElement.clientHeight}}function getSide(value,side){return"number"==typeof value?value:value[side]}function clientRect(node){var rect=node.getBoundingClientRect(),scaleX=rect.width/node.offsetWidth||1,scaleY=rect.height/node.offsetHeight||1;return{left:rect.left,right:rect.left+node.clientWidth*scaleX,top:rect.top,bottom:rect.top+node.clientHeight*scaleY}}function scrollRectIntoView(view,rect,startDOM){for(var scrollThreshold=view.someProp("scrollThreshold")||0,scrollMargin=view.someProp("scrollMargin")||5,doc=view.dom.ownerDocument,parent=startDOM||view.dom;parent;parent=parentNode(parent))if(1==parent.nodeType){var atTop=parent==doc.body||1!=parent.nodeType,bounding=atTop?windowRect(doc):clientRect(parent),moveX=0,moveY=0;if(rect.top<bounding.top+getSide(scrollThreshold,"top")?moveY=-(bounding.top-rect.top+getSide(scrollMargin,"top")):rect.bottom>bounding.bottom-getSide(scrollThreshold,"bottom")&&(moveY=rect.bottom-bounding.bottom+getSide(scrollMargin,"bottom")),rect.left<bounding.left+getSide(scrollThreshold,"left")?moveX=-(bounding.left-rect.left+getSide(scrollMargin,"left")):rect.right>bounding.right-getSide(scrollThreshold,"right")&&(moveX=rect.right-bounding.right+getSide(scrollMargin,"right")),moveX||moveY)if(atTop)doc.defaultView.scrollBy(moveX,moveY);else{var startX=parent.scrollLeft,startY=parent.scrollTop;moveY&&(parent.scrollTop+=moveY),moveX&&(parent.scrollLeft+=moveX);var dX=parent.scrollLeft-startX,dY=parent.scrollTop-startY;rect={left:rect.left-dX,top:rect.top-dY,right:rect.right-dX,bottom:rect.bottom-dY}}if(atTop)break}}function storeScrollPos(view){for(var rect=view.dom.getBoundingClientRect(),startY=Math.max(0,rect.top),refDOM,refTop,x=(rect.left+rect.right)/2,y=startY+1;y<Math.min(innerHeight,rect.bottom);y+=5){var dom=view.root.elementFromPoint(x,y);if(dom!=view.dom&&view.dom.contains(dom)){var localRect=dom.getBoundingClientRect();if(localRect.top>=startY-20){refDOM=dom,refTop=localRect.top;break}}}return{refDOM:refDOM,refTop:refTop,stack:scrollStack(view.dom)}}function scrollStack(dom){for(var stack=[],doc=dom.ownerDocument;dom&&(stack.push({dom:dom,top:dom.scrollTop,left:dom.scrollLeft}),dom!=doc);dom=parentNode(dom));return stack}function resetScrollPos(ref){var refDOM=ref.refDOM,refTop=ref.refTop,stack=ref.stack,newRefTop=refDOM?refDOM.getBoundingClientRect().top:0;restoreScrollStack(stack,0==newRefTop?0:newRefTop-refTop)}function restoreScrollStack(stack,dTop){for(var i=0;i<stack.length;i++){var ref=stack[i],dom=ref.dom,top=ref.top,left=ref.left;dom.scrollTop!=top+dTop&&(dom.scrollTop=top+dTop),dom.scrollLeft!=left&&(dom.scrollLeft=left)}}var preventScrollSupported=null;function focusPreventScroll(dom){if(dom.setActive)return dom.setActive();if(preventScrollSupported)return dom.focus(preventScrollSupported);var stored=scrollStack(dom);dom.focus(null==preventScrollSupported?{get preventScroll(){return preventScrollSupported={preventScroll:!0},!0}}:void 0),preventScrollSupported||(preventScrollSupported=!1,restoreScrollStack(stored,0))}function findOffsetInNode(node,coords){for(var closest,dxClosest=2e8,coordsClosest,offset=0,rowBot=coords.top,rowTop=coords.top,child=node.firstChild,childIndex=0;child;child=child.nextSibling,childIndex++){var rects=void 0;if(1==child.nodeType)rects=child.getClientRects();else{if(3!=child.nodeType)continue;rects=textRange(child).getClientRects()}for(var i=0;i<rects.length;i++){var rect=rects[i];if(rect.top<=rowBot&&rect.bottom>=rowTop){rowBot=Math.max(rect.bottom,rowBot),rowTop=Math.min(rect.top,rowTop);var dx=rect.left>coords.left?rect.left-coords.left:rect.right<coords.left?coords.left-rect.right:0;if(dx<dxClosest){closest=child,dxClosest=dx,coordsClosest=dx&&3==closest.nodeType?{left:rect.right<coords.left?rect.right:rect.left,top:coords.top}:coords,1==child.nodeType&&dx&&(offset=childIndex+(coords.left>=(rect.left+rect.right)/2?1:0));continue}}!closest&&(coords.left>=rect.right&&coords.top>=rect.top||coords.left>=rect.left&&coords.top>=rect.bottom)&&(offset=childIndex+1)}}return closest&&3==closest.nodeType?findOffsetInText(closest,coordsClosest):!closest||dxClosest&&1==closest.nodeType?{node:node,offset:offset}:findOffsetInNode(closest,coordsClosest)}function findOffsetInText(node,coords){for(var len=node.nodeValue.length,range=document.createRange(),i=0;i<len;i++){range.setEnd(node,i+1),range.setStart(node,i);var rect=singleRect(range,1);if(rect.top!=rect.bottom&&inRect(coords,rect))return{node:node,offset:i+(coords.left>=(rect.left+rect.right)/2?1:0)}}return{node:node,offset:0}}function inRect(coords,rect){return coords.left>=rect.left-1&&coords.left<=rect.right+1&&coords.top>=rect.top-1&&coords.top<=rect.bottom+1}function targetKludge(dom,coords){var parent=dom.parentNode;return parent&&/^li$/i.test(parent.nodeName)&&coords.left<dom.getBoundingClientRect().left?parent:dom}function posFromElement(view,elt,coords){var ref=findOffsetInNode(elt,coords),node=ref.node,offset=ref.offset,bias=-1;if(1==node.nodeType&&!node.firstChild){var rect=node.getBoundingClientRect();bias=rect.left!=rect.right&&coords.left>(rect.left+rect.right)/2?1:-1}return view.docView.posFromDOM(node,offset,bias)}function posFromCaret(view,node,offset,coords){for(var outside=-1,cur=node;cur!=view.dom;){var desc=view.docView.nearestDesc(cur,!0);if(!desc)return null;if(desc.node.isBlock&&desc.parent){var rect=desc.dom.getBoundingClientRect();if(rect.left>coords.left||rect.top>coords.top)outside=desc.posBefore;else{if(!(rect.right<coords.left||rect.bottom<coords.top))break;outside=desc.posAfter}}cur=desc.dom.parentNode}return outside>-1?outside:view.docView.posFromDOM(node,offset)}function elementFromPoint(element,coords,box){var len=element.childNodes.length;if(len&&box.top<box.bottom)for(var startI=Math.max(0,Math.min(len-1,Math.floor(len*(coords.top-box.top)/(box.bottom-box.top))-2)),i=startI;;){var child=element.childNodes[i];if(1==child.nodeType)for(var rects=child.getClientRects(),j=0;j<rects.length;j++){var rect=rects[j];if(inRect(coords,rect))return elementFromPoint(child,coords,rect)}if((i=(i+1)%len)==startI)break}return element}function posAtCoords(view,coords){var assign,assign$1,root=view.root,node,offset;if(root.caretPositionFromPoint)try{var pos$1=root.caretPositionFromPoint(coords.left,coords.top);pos$1&&(node=(assign=pos$1).offsetNode,offset=assign.offset)}catch(_){}if(!node&&root.caretRangeFromPoint){var range=root.caretRangeFromPoint(coords.left,coords.top);range&&(node=(assign$1=range).startContainer,offset=assign$1.startOffset)}var elt=root.elementFromPoint(coords.left,coords.top+1),pos;if(!elt||!view.dom.contains(1!=elt.nodeType?elt.parentNode:elt)){var box=view.dom.getBoundingClientRect();if(!inRect(coords,box))return null;if(!(elt=elementFromPoint(view.dom,coords,box)))return null}if(result.safari)for(var p=elt;node&&p;p=parentNode(p))p.draggable&&(node=offset=null);if(elt=targetKludge(elt,coords),node){if(result.gecko&&1==node.nodeType&&(offset=Math.min(offset,node.childNodes.length))<node.childNodes.length){var next=node.childNodes[offset],box$1;"IMG"==next.nodeName&&(box$1=next.getBoundingClientRect()).right<=coords.left&&box$1.bottom>coords.top&&offset++}node==view.dom&&offset==node.childNodes.length-1&&1==node.lastChild.nodeType&&coords.top>node.lastChild.getBoundingClientRect().bottom?pos=view.state.doc.content.size:0!=offset&&1==node.nodeType&&"BR"==node.childNodes[offset-1].nodeName||(pos=posFromCaret(view,node,offset,coords))}null==pos&&(pos=posFromElement(view,elt,coords));var desc=view.docView.nearestDesc(elt,!0);return{pos:pos,inside:desc?desc.posAtStart-desc.border:-1}}function singleRect(object,bias){var rects=object.getClientRects();return rects.length?rects[bias<0?0:rects.length-1]:object.getBoundingClientRect()}var BIDI=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function coordsAtPos(view,pos,side){var ref=view.docView.domFromPos(pos,side<0?-1:1),node=ref.node,offset=ref.offset,supportEmptyRange=result.webkit||result.gecko;if(3==node.nodeType){if(!supportEmptyRange||!BIDI.test(node.nodeValue)&&(side<0?offset:offset!=node.nodeValue.length)){var from=offset,to=offset,takeSide=side<0?1:-1;return side<0&&!offset?(to++,takeSide=-1):side>=0&&offset==node.nodeValue.length?(from--,takeSide=1):side<0?from--:to++,flattenV(singleRect(textRange(node,from,to),takeSide),takeSide<0)}var rect=singleRect(textRange(node,offset,offset),side);if(result.gecko&&offset&&/\s/.test(node.nodeValue[offset-1])&&offset<node.nodeValue.length){var rectBefore=singleRect(textRange(node,offset-1,offset-1),-1);if(rectBefore.top==rect.top){var rectAfter=singleRect(textRange(node,offset,offset+1),-1);if(rectAfter.top!=rect.top)return flattenV(rectAfter,rectAfter.left<rectBefore.left)}}return rect}if(!view.state.doc.resolve(pos).parent.inlineContent){if(offset&&(side<0||offset==nodeSize(node))){var before=node.childNodes[offset-1];if(1==before.nodeType)return flattenH(before.getBoundingClientRect(),!1)}if(offset<nodeSize(node)){var after=node.childNodes[offset];if(1==after.nodeType)return flattenH(after.getBoundingClientRect(),!0)}return flattenH(node.getBoundingClientRect(),side>=0)}if(offset&&(side<0||offset==nodeSize(node))){var before$1=node.childNodes[offset-1],target=3==before$1.nodeType?textRange(before$1,nodeSize(before$1)-(supportEmptyRange?0:1)):1!=before$1.nodeType||"BR"==before$1.nodeName&&before$1.nextSibling?null:before$1;if(target)return flattenV(singleRect(target,1),!1)}if(offset<nodeSize(node)){var after$1=node.childNodes[offset],target$1=3==after$1.nodeType?textRange(after$1,0,supportEmptyRange?0:1):1==after$1.nodeType?after$1:null;if(target$1)return flattenV(singleRect(target$1,-1),!0)}return flattenV(singleRect(3==node.nodeType?textRange(node):node,-side),side>=0)}function flattenV(rect,left){if(0==rect.width)return rect;var x=left?rect.left:rect.right;return{top:rect.top,bottom:rect.bottom,left:x,right:x}}function flattenH(rect,top){if(0==rect.height)return rect;var y=top?rect.top:rect.bottom;return{top:y,bottom:y,left:rect.left,right:rect.right}}function withFlushedState(view,state,f){var viewState=view.state,active=view.root.activeElement;viewState!=state&&view.updateState(state),active!=view.dom&&view.focus();try{return f()}finally{viewState!=state&&view.updateState(viewState),active!=view.dom&&active&&active.focus()}}function endOfTextblockVertical(view,state,dir){var sel=state.selection,$pos="up"==dir?sel.$from:sel.$to;return withFlushedState(view,state,(function(){for(var ref,dom=view.docView.domFromPos($pos.pos,"up"==dir?-1:1).node;;){var nearest=view.docView.nearestDesc(dom,!0);if(!nearest)break;if(nearest.node.isBlock){dom=nearest.dom;break}dom=nearest.dom.parentNode}for(var coords=coordsAtPos(view,$pos.pos,1),child=dom.firstChild;child;child=child.nextSibling){var boxes=void 0;if(1==child.nodeType)boxes=child.getClientRects();else{if(3!=child.nodeType)continue;boxes=textRange(child,0,child.nodeValue.length).getClientRects()}for(var i=0;i<boxes.length;i++){var box=boxes[i];if(box.bottom>box.top&&("up"==dir?box.bottom<coords.top+1:box.top>coords.bottom-1))return!1}}return!0}))}var maybeRTL=/[\u0590-\u08ac]/;function endOfTextblockHorizontal(view,state,dir){var ref,$head=state.selection.$head;if(!$head.parent.isTextblock)return!1;var offset=$head.parentOffset,atStart=!offset,atEnd=offset==$head.parent.content.size,sel=getSelection();return maybeRTL.test($head.parent.textContent)&&sel.modify?withFlushedState(view,state,(function(){var oldRange=sel.getRangeAt(0),oldNode=sel.focusNode,oldOff=sel.focusOffset,oldBidiLevel=sel.caretBidiLevel;sel.modify("move",dir,"character");var parentDOM,result=!($head.depth?view.docView.domAfterPos($head.before()):view.dom).contains(1==sel.focusNode.nodeType?sel.focusNode:sel.focusNode.parentNode)||oldNode==sel.focusNode&&oldOff==sel.focusOffset;return sel.removeAllRanges(),sel.addRange(oldRange),null!=oldBidiLevel&&(sel.caretBidiLevel=oldBidiLevel),result})):"left"==dir||"backward"==dir?atStart:atEnd}var cachedState=null,cachedDir=null,cachedResult=!1;function endOfTextblock(view,state,dir){return cachedState==state&&cachedDir==dir?cachedResult:(cachedState=state,cachedDir=dir,cachedResult="up"==dir||"down"==dir?endOfTextblockVertical(view,state,dir):endOfTextblockHorizontal(view,state,dir))}var NOT_DIRTY=0,CHILD_DIRTY=1,CONTENT_DIRTY=2,NODE_DIRTY=3,ViewDesc=function ViewDesc(parent,children,dom,contentDOM){this.parent=parent,this.children=children,this.dom=dom,dom.pmViewDesc=this,this.contentDOM=contentDOM,this.dirty=0},prosemirror_view_dist_index_es_prototypeAccessors={beforePosition:{configurable:!0},size:{configurable:!0},border:{configurable:!0},posBefore:{configurable:!0},posAtStart:{configurable:!0},posAfter:{configurable:!0},posAtEnd:{configurable:!0},contentLost:{configurable:!0},domAtom:{configurable:!0}};ViewDesc.prototype.matchesWidget=function matchesWidget(){return!1},ViewDesc.prototype.matchesMark=function matchesMark(){return!1},ViewDesc.prototype.matchesNode=function matchesNode(){return!1},ViewDesc.prototype.matchesHack=function matchesHack(){return!1},prosemirror_view_dist_index_es_prototypeAccessors.beforePosition.get=function(){return!1},ViewDesc.prototype.parseRule=function parseRule(){return null},ViewDesc.prototype.stopEvent=function stopEvent(){return!1},prosemirror_view_dist_index_es_prototypeAccessors.size.get=function(){for(var size=0,i=0;i<this.children.length;i++)size+=this.children[i].size;return size},prosemirror_view_dist_index_es_prototypeAccessors.border.get=function(){return 0},ViewDesc.prototype.destroy=function destroy(){this.parent=null,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=null);for(var i=0;i<this.children.length;i++)this.children[i].destroy()},ViewDesc.prototype.posBeforeChild=function posBeforeChild(child){for(var i=0,pos=this.posAtStart;i<this.children.length;i++){var cur=this.children[i];if(cur==child)return pos;pos+=cur.size}},prosemirror_view_dist_index_es_prototypeAccessors.posBefore.get=function(){return this.parent.posBeforeChild(this)},prosemirror_view_dist_index_es_prototypeAccessors.posAtStart.get=function(){return this.parent?this.parent.posBeforeChild(this)+this.border:0},prosemirror_view_dist_index_es_prototypeAccessors.posAfter.get=function(){return this.posBefore+this.size},prosemirror_view_dist_index_es_prototypeAccessors.posAtEnd.get=function(){return this.posAtStart+this.size-2*this.border},ViewDesc.prototype.localPosFromDOM=function localPosFromDOM(dom,offset,bias){if(this.contentDOM&&this.contentDOM.contains(1==dom.nodeType?dom:dom.parentNode)){if(bias<0){var domBefore,desc;if(dom==this.contentDOM)domBefore=dom.childNodes[offset-1];else{for(;dom.parentNode!=this.contentDOM;)dom=dom.parentNode;domBefore=dom.previousSibling}for(;domBefore&&(!(desc=domBefore.pmViewDesc)||desc.parent!=this);)domBefore=domBefore.previousSibling;return domBefore?this.posBeforeChild(desc)+desc.size:this.posAtStart}var domAfter,desc$1;if(dom==this.contentDOM)domAfter=dom.childNodes[offset];else{for(;dom.parentNode!=this.contentDOM;)dom=dom.parentNode;domAfter=dom.nextSibling}for(;domAfter&&(!(desc$1=domAfter.pmViewDesc)||desc$1.parent!=this);)domAfter=domAfter.nextSibling;return domAfter?this.posBeforeChild(desc$1):this.posAtEnd}var atEnd;if(dom==this.dom&&this.contentDOM)atEnd=offset>domIndex(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))atEnd=2&dom.compareDocumentPosition(this.contentDOM);else if(this.dom.firstChild){if(0==offset)for(var search=dom;;search=search.parentNode){if(search==this.dom){atEnd=!1;break}if(search.parentNode.firstChild!=search)break}if(null==atEnd&&offset==dom.childNodes.length)for(var search$1=dom;;search$1=search$1.parentNode){if(search$1==this.dom){atEnd=!0;break}if(search$1.parentNode.lastChild!=search$1)break}}return(null==atEnd?bias>0:atEnd)?this.posAtEnd:this.posAtStart},ViewDesc.prototype.nearestDesc=function nearestDesc(dom,onlyNodes){for(var first=!0,cur=dom;cur;cur=cur.parentNode){var desc=this.getDesc(cur);if(desc&&(!onlyNodes||desc.node)){if(!first||!desc.nodeDOM||(1==desc.nodeDOM.nodeType?desc.nodeDOM.contains(1==dom.nodeType?dom:dom.parentNode):desc.nodeDOM==dom))return desc;first=!1}}},ViewDesc.prototype.getDesc=function getDesc(dom){for(var desc=dom.pmViewDesc,cur=desc;cur;cur=cur.parent)if(cur==this)return desc},ViewDesc.prototype.posFromDOM=function posFromDOM(dom,offset,bias){for(var scan=dom;scan;scan=scan.parentNode){var desc=this.getDesc(scan);if(desc)return desc.localPosFromDOM(dom,offset,bias)}return-1},ViewDesc.prototype.descAt=function descAt(pos){for(var i=0,offset=0;i<this.children.length;i++){var child=this.children[i],end=offset+child.size;if(offset==pos&&end!=offset){for(;!child.border&&child.children.length;)child=child.children[0];return child}if(pos<end)return child.descAt(pos-offset-child.border);offset=end}},ViewDesc.prototype.domFromPos=function domFromPos(pos,side){if(!this.contentDOM)return{node:this.dom,offset:0};for(var offset=0,i=0,first=!0;;i++,first=!1){for(;i<this.children.length&&(this.children[i].beforePosition||this.children[i].dom.parentNode!=this.contentDOM);)offset+=this.children[i++].size;var child=i==this.children.length?null:this.children[i];if(offset==pos&&(0==side||!child||!child.size||child.border||side<0&&first)||child&&child.domAtom&&pos<offset+child.size)return{node:this.contentDOM,offset:child?domIndex(child.dom):this.contentDOM.childNodes.length};if(!child)throw new Error("Invalid position "+pos);var end=offset+child.size;if(!child.domAtom&&(side<0&&!child.border?end>=pos:end>pos)&&(end>pos||i+1>=this.children.length||!this.children[i+1].beforePosition))return child.domFromPos(pos-offset-child.border,side);offset=end}},ViewDesc.prototype.parseRange=function parseRange(from,to,base){if(void 0===base&&(base=0),0==this.children.length)return{node:this.contentDOM,from:from,to:to,fromOffset:0,toOffset:this.contentDOM.childNodes.length};for(var fromOffset=-1,toOffset=-1,offset=base,i=0;;i++){var child=this.children[i],end=offset+child.size;if(-1==fromOffset&&from<=end){var childBase=offset+child.border;if(from>=childBase&&to<=end-child.border&&child.node&&child.contentDOM&&this.contentDOM.contains(child.contentDOM))return child.parseRange(from,to,childBase);from=offset;for(var j=i;j>0;j--){var prev=this.children[j-1];if(prev.size&&prev.dom.parentNode==this.contentDOM&&!prev.emptyChildAt(1)){fromOffset=domIndex(prev.dom)+1;break}from-=prev.size}-1==fromOffset&&(fromOffset=0)}if(fromOffset>-1&&(end>to||i==this.children.length-1)){to=end;for(var j$1=i+1;j$1<this.children.length;j$1++){var next=this.children[j$1];if(next.size&&next.dom.parentNode==this.contentDOM&&!next.emptyChildAt(-1)){toOffset=domIndex(next.dom);break}to+=next.size}-1==toOffset&&(toOffset=this.contentDOM.childNodes.length);break}offset=end}return{node:this.contentDOM,from:from,to:to,fromOffset:fromOffset,toOffset:toOffset}},ViewDesc.prototype.emptyChildAt=function emptyChildAt(side){if(this.border||!this.contentDOM||!this.children.length)return!1;var child=this.children[side<0?0:this.children.length-1];return 0==child.size||child.emptyChildAt(side)},ViewDesc.prototype.domAfterPos=function domAfterPos(pos){var ref=this.domFromPos(pos,0),node=ref.node,offset=ref.offset;if(1!=node.nodeType||offset==node.childNodes.length)throw new RangeError("No node after pos "+pos);return node.childNodes[offset]},ViewDesc.prototype.setSelection=function setSelection(anchor,head,root,force){for(var from=Math.min(anchor,head),to=Math.max(anchor,head),i=0,offset=0;i<this.children.length;i++){var child=this.children[i],end=offset+child.size;if(from>offset&&to<end)return child.setSelection(anchor-offset-child.border,head-offset-child.border,root,force);offset=end}var anchorDOM=this.domFromPos(anchor,anchor?-1:1),headDOM=head==anchor?anchorDOM:this.domFromPos(head,head?-1:1),domSel=root.getSelection(),brKludge=!1;if((result.gecko||result.safari)&&anchor==head){var node=anchorDOM.node,offset$1=anchorDOM.offset;if(3==node.nodeType)(brKludge=offset$1&&"\n"==node.nodeValue[offset$1-1])&&offset$1==node.nodeValue.length&&node.nextSibling&&"BR"==node.nextSibling.nodeName&&(anchorDOM=headDOM={node:node.parentNode,offset:domIndex(node)+1});else{var prev=node.childNodes[offset$1-1];brKludge=prev&&("BR"==prev.nodeName||"false"==prev.contentEditable)}}if(result.gecko&&domSel.focusNode&&domSel.focusNode!=headDOM.node&&1==domSel.focusNode.nodeType){var after=domSel.focusNode.childNodes[domSel.focusOffset];after&&"false"==after.contentEditable&&(force=!0)}if(force||brKludge&&result.safari||!isEquivalentPosition(anchorDOM.node,anchorDOM.offset,domSel.anchorNode,domSel.anchorOffset)||!isEquivalentPosition(headDOM.node,headDOM.offset,domSel.focusNode,domSel.focusOffset)){var domSelExtended=!1;if((domSel.extend||anchor==head)&&!brKludge){domSel.collapse(anchorDOM.node,anchorDOM.offset);try{anchor!=head&&domSel.extend(headDOM.node,headDOM.offset),domSelExtended=!0}catch(err){if(!(err instanceof DOMException))throw err}}if(!domSelExtended){if(anchor>head){var tmp=anchorDOM;anchorDOM=headDOM,headDOM=tmp}var range=document.createRange();range.setEnd(headDOM.node,headDOM.offset),range.setStart(anchorDOM.node,anchorDOM.offset),domSel.removeAllRanges(),domSel.addRange(range)}}},ViewDesc.prototype.ignoreMutation=function ignoreMutation(mutation){return!this.contentDOM&&"selection"!=mutation.type},prosemirror_view_dist_index_es_prototypeAccessors.contentLost.get=function(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)},ViewDesc.prototype.markDirty=function markDirty(from,to){for(var offset=0,i=0;i<this.children.length;i++){var child=this.children[i],end=offset+child.size;if(offset==end?from<=end&&to>=offset:from<end&&to>offset){var startInside=offset+child.border,endInside=end-child.border;if(from>=startInside&&to<=endInside)return this.dirty=from==offset||to==end?2:1,void(from!=startInside||to!=endInside||!child.contentLost&&child.dom.parentNode==this.contentDOM?child.markDirty(from-startInside,to-startInside):child.dirty=3);child.dirty=3}offset=end}this.dirty=2},ViewDesc.prototype.markParentsDirty=function markParentsDirty(){for(var level=1,node=this.parent;node;node=node.parent,level++){var dirty=1==level?2:1;node.dirty<dirty&&(node.dirty=dirty)}},prosemirror_view_dist_index_es_prototypeAccessors.domAtom.get=function(){return!1},Object.defineProperties(ViewDesc.prototype,prosemirror_view_dist_index_es_prototypeAccessors);var nothing=[],WidgetViewDesc=function(ViewDesc){function WidgetViewDesc(parent,widget,view,pos){var self,dom=widget.type.toDOM;if("function"==typeof dom&&(dom=dom(view,(function(){return self?self.parent?self.parent.posBeforeChild(self):void 0:pos}))),!widget.type.spec.raw){if(1!=dom.nodeType){var wrap=document.createElement("span");wrap.appendChild(dom),dom=wrap}dom.contentEditable=!1,dom.classList.add("ProseMirror-widget")}ViewDesc.call(this,parent,nothing,dom,null),this.widget=widget,self=this}ViewDesc&&(WidgetViewDesc.__proto__=ViewDesc),WidgetViewDesc.prototype=Object.create(ViewDesc&&ViewDesc.prototype),WidgetViewDesc.prototype.constructor=WidgetViewDesc;var prototypeAccessors$1={beforePosition:{configurable:!0},domAtom:{configurable:!0}};return prototypeAccessors$1.beforePosition.get=function(){return this.widget.type.side<0},WidgetViewDesc.prototype.matchesWidget=function matchesWidget(widget){return 0==this.dirty&&widget.type.eq(this.widget.type)},WidgetViewDesc.prototype.parseRule=function parseRule(){return{ignore:!0}},WidgetViewDesc.prototype.stopEvent=function stopEvent(event){var stop=this.widget.spec.stopEvent;return!!stop&&stop(event)},WidgetViewDesc.prototype.ignoreMutation=function ignoreMutation(mutation){return"selection"!=mutation.type||this.widget.spec.ignoreSelection},prototypeAccessors$1.domAtom.get=function(){return!0},Object.defineProperties(WidgetViewDesc.prototype,prototypeAccessors$1),WidgetViewDesc}(ViewDesc),CompositionViewDesc=function(ViewDesc){function CompositionViewDesc(parent,dom,textDOM,text){ViewDesc.call(this,parent,nothing,dom,null),this.textDOM=textDOM,this.text=text}ViewDesc&&(CompositionViewDesc.__proto__=ViewDesc),CompositionViewDesc.prototype=Object.create(ViewDesc&&ViewDesc.prototype),CompositionViewDesc.prototype.constructor=CompositionViewDesc;var prototypeAccessors$2={size:{configurable:!0}};return prototypeAccessors$2.size.get=function(){return this.text.length},CompositionViewDesc.prototype.localPosFromDOM=function localPosFromDOM(dom,offset){return dom!=this.textDOM?this.posAtStart+(offset?this.size:0):this.posAtStart+offset},CompositionViewDesc.prototype.domFromPos=function domFromPos(pos){return{node:this.textDOM,offset:pos}},CompositionViewDesc.prototype.ignoreMutation=function ignoreMutation(mut){return"characterData"===mut.type&&mut.target.nodeValue==mut.oldValue},Object.defineProperties(CompositionViewDesc.prototype,prototypeAccessors$2),CompositionViewDesc}(ViewDesc),MarkViewDesc=function(ViewDesc){function MarkViewDesc(parent,mark,dom,contentDOM){ViewDesc.call(this,parent,[],dom,contentDOM),this.mark=mark}return ViewDesc&&(MarkViewDesc.__proto__=ViewDesc),MarkViewDesc.prototype=Object.create(ViewDesc&&ViewDesc.prototype),MarkViewDesc.prototype.constructor=MarkViewDesc,MarkViewDesc.create=function create(parent,mark,inline,view){var custom=view.nodeViews[mark.type.name],spec=custom&&custom(mark,view,inline);return spec&&spec.dom||(spec=DOMSerializer.renderSpec(document,mark.type.spec.toDOM(mark,inline))),new MarkViewDesc(parent,mark,spec.dom,spec.contentDOM||spec.dom)},MarkViewDesc.prototype.parseRule=function parseRule(){return{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}},MarkViewDesc.prototype.matchesMark=function matchesMark(mark){return 3!=this.dirty&&this.mark.eq(mark)},MarkViewDesc.prototype.markDirty=function markDirty(from,to){if(ViewDesc.prototype.markDirty.call(this,from,to),0!=this.dirty){for(var parent=this.parent;!parent.node;)parent=parent.parent;parent.dirty<this.dirty&&(parent.dirty=this.dirty),this.dirty=0}},MarkViewDesc.prototype.slice=function slice(from,to,view){var copy=MarkViewDesc.create(this.parent,this.mark,!0,view),nodes=this.children,size=this.size;to<size&&(nodes=replaceNodes(nodes,to,size,view)),from>0&&(nodes=replaceNodes(nodes,0,from,view));for(var i=0;i<nodes.length;i++)nodes[i].parent=copy;return copy.children=nodes,copy},MarkViewDesc}(ViewDesc),NodeViewDesc=function(ViewDesc){function NodeViewDesc(parent,node,outerDeco,innerDeco,dom,contentDOM,nodeDOM,view,pos){ViewDesc.call(this,parent,node.isLeaf?nothing:[],dom,contentDOM),this.nodeDOM=nodeDOM,this.node=node,this.outerDeco=outerDeco,this.innerDeco=innerDeco,contentDOM&&this.updateChildren(view,pos)}ViewDesc&&(NodeViewDesc.__proto__=ViewDesc),NodeViewDesc.prototype=Object.create(ViewDesc&&ViewDesc.prototype),NodeViewDesc.prototype.constructor=NodeViewDesc;var prototypeAccessors$3={size:{configurable:!0},border:{configurable:!0},domAtom:{configurable:!0}};return NodeViewDesc.create=function create(parent,node,outerDeco,innerDeco,view,pos){var assign,custom=view.nodeViews[node.type.name],descObj,spec=custom&&custom(node,view,(function(){return descObj?descObj.parent?descObj.parent.posBeforeChild(descObj):void 0:pos}),outerDeco,innerDeco),dom=spec&&spec.dom,contentDOM=spec&&spec.contentDOM;if(node.isText)if(dom){if(3!=dom.nodeType)throw new RangeError("Text must be rendered as a DOM text node")}else dom=document.createTextNode(node.text);else dom||(dom=(assign=DOMSerializer.renderSpec(document,node.type.spec.toDOM(node))).dom,contentDOM=assign.contentDOM);contentDOM||node.isText||"BR"==dom.nodeName||(dom.hasAttribute("contenteditable")||(dom.contentEditable=!1),node.type.spec.draggable&&(dom.draggable=!0));var nodeDOM=dom;return dom=applyOuterDeco(dom,outerDeco,node),spec?descObj=new CustomNodeViewDesc(parent,node,outerDeco,innerDeco,dom,contentDOM,nodeDOM,spec,view,pos+1):node.isText?new TextViewDesc(parent,node,outerDeco,innerDeco,dom,nodeDOM,view):new NodeViewDesc(parent,node,outerDeco,innerDeco,dom,contentDOM,nodeDOM,view,pos+1)},NodeViewDesc.prototype.parseRule=function parseRule(){var this$1=this;if(this.node.type.spec.reparseInView)return null;var rule={node:this.node.type.name,attrs:this.node.attrs};return this.node.type.spec.code&&(rule.preserveWhitespace="full"),this.contentDOM&&!this.contentLost?rule.contentElement=this.contentDOM:rule.getContent=function(){return this$1.contentDOM?Fragment.empty:this$1.node.content},rule},NodeViewDesc.prototype.matchesNode=function matchesNode(node,outerDeco,innerDeco){return 0==this.dirty&&node.eq(this.node)&&sameOuterDeco(outerDeco,this.outerDeco)&&innerDeco.eq(this.innerDeco)},prototypeAccessors$3.size.get=function(){return this.node.nodeSize},prototypeAccessors$3.border.get=function(){return this.node.isLeaf?0:1},NodeViewDesc.prototype.updateChildren=function updateChildren(view,pos){var this$1=this,inline=this.node.inlineContent,off=pos,composition=inline&&view.composing&&this.localCompositionNode(view,pos),updater=new ViewTreeUpdater(this,composition&&composition.node);iterDeco(this.node,this.innerDeco,(function(widget,i,insideNode){widget.spec.marks?updater.syncToMarks(widget.spec.marks,inline,view):widget.type.side>=0&&!insideNode&&updater.syncToMarks(i==this$1.node.childCount?Mark.none:this$1.node.child(i).marks,inline,view),updater.placeWidget(widget,view,off)}),(function(child,outerDeco,innerDeco,i){updater.syncToMarks(child.marks,inline,view),updater.findNodeMatch(child,outerDeco,innerDeco,i)||updater.updateNextNode(child,outerDeco,innerDeco,view,i)||updater.addNode(child,outerDeco,innerDeco,view,off),off+=child.nodeSize})),updater.syncToMarks(nothing,inline,view),this.node.isTextblock&&updater.addTextblockHacks(),updater.destroyRest(),(updater.changed||2==this.dirty)&&(composition&&this.protectLocalComposition(view,composition),renderDescs(this.contentDOM,this.children,view),result.ios&&iosHacks(this.dom))},NodeViewDesc.prototype.localCompositionNode=function localCompositionNode(view,pos){var ref=view.state.selection,from=ref.from,to=ref.to;if(!(!(view.state.selection instanceof TextSelection)||from<pos||to>pos+this.node.content.size)){var sel=view.root.getSelection(),textNode=nearbyTextNode(sel.focusNode,sel.focusOffset);if(textNode&&this.dom.contains(textNode.parentNode)){var text=textNode.nodeValue,textPos=findTextInFragment(this.node.content,text,from-pos,to-pos);return textPos<0?null:{node:textNode,pos:textPos,text:text}}}},NodeViewDesc.prototype.protectLocalComposition=function protectLocalComposition(view,ref){var node=ref.node,pos=ref.pos,text=ref.text;if(!this.getDesc(node)){for(var topNode=node;topNode.parentNode!=this.contentDOM;topNode=topNode.parentNode){for(;topNode.previousSibling;)topNode.parentNode.removeChild(topNode.previousSibling);for(;topNode.nextSibling;)topNode.parentNode.removeChild(topNode.nextSibling);topNode.pmViewDesc&&(topNode.pmViewDesc=null)}var desc=new CompositionViewDesc(this,topNode,node,text);view.compositionNodes.push(desc),this.children=replaceNodes(this.children,pos,pos+text.length,view,desc)}},NodeViewDesc.prototype.update=function update(node,outerDeco,innerDeco,view){return!(3==this.dirty||!node.sameMarkup(this.node))&&(this.updateInner(node,outerDeco,innerDeco,view),!0)},NodeViewDesc.prototype.updateInner=function updateInner(node,outerDeco,innerDeco,view){this.updateOuterDeco(outerDeco),this.node=node,this.innerDeco=innerDeco,this.contentDOM&&this.updateChildren(view,this.posAtStart),this.dirty=0},NodeViewDesc.prototype.updateOuterDeco=function updateOuterDeco(outerDeco){if(!sameOuterDeco(outerDeco,this.outerDeco)){var needsWrap=1!=this.nodeDOM.nodeType,oldDOM=this.dom;this.dom=patchOuterDeco(this.dom,this.nodeDOM,computeOuterDeco(this.outerDeco,this.node,needsWrap),computeOuterDeco(outerDeco,this.node,needsWrap)),this.dom!=oldDOM&&(oldDOM.pmViewDesc=null,this.dom.pmViewDesc=this),this.outerDeco=outerDeco}},NodeViewDesc.prototype.selectNode=function selectNode(){this.nodeDOM.classList.add("ProseMirror-selectednode"),!this.contentDOM&&this.node.type.spec.draggable||(this.dom.draggable=!0)},NodeViewDesc.prototype.deselectNode=function deselectNode(){this.nodeDOM.classList.remove("ProseMirror-selectednode"),!this.contentDOM&&this.node.type.spec.draggable||this.dom.removeAttribute("draggable")},prototypeAccessors$3.domAtom.get=function(){return this.node.isAtom},Object.defineProperties(NodeViewDesc.prototype,prototypeAccessors$3),NodeViewDesc}(ViewDesc);function docViewDesc(doc,outerDeco,innerDeco,dom,view){return applyOuterDeco(dom,outerDeco,doc),new NodeViewDesc(null,doc,outerDeco,innerDeco,dom,dom,dom,view,0)}var TextViewDesc=function(NodeViewDesc){function TextViewDesc(parent,node,outerDeco,innerDeco,dom,nodeDOM,view){NodeViewDesc.call(this,parent,node,outerDeco,innerDeco,dom,null,nodeDOM,view)}NodeViewDesc&&(TextViewDesc.__proto__=NodeViewDesc),TextViewDesc.prototype=Object.create(NodeViewDesc&&NodeViewDesc.prototype),TextViewDesc.prototype.constructor=TextViewDesc;var prototypeAccessors$4={domAtom:{configurable:!0}};return TextViewDesc.prototype.parseRule=function parseRule(){for(var skip=this.nodeDOM.parentNode;skip&&skip!=this.dom&&!skip.pmIsDeco;)skip=skip.parentNode;return{skip:skip||!0}},TextViewDesc.prototype.update=function update(node,outerDeco,_,view){return!(3==this.dirty||0!=this.dirty&&!this.inParent()||!node.sameMarkup(this.node))&&(this.updateOuterDeco(outerDeco),0==this.dirty&&node.text==this.node.text||node.text==this.nodeDOM.nodeValue||(this.nodeDOM.nodeValue=node.text,view.trackWrites==this.nodeDOM&&(view.trackWrites=null)),this.node=node,this.dirty=0,!0)},TextViewDesc.prototype.inParent=function inParent(){for(var parentDOM=this.parent.contentDOM,n=this.nodeDOM;n;n=n.parentNode)if(n==parentDOM)return!0;return!1},TextViewDesc.prototype.domFromPos=function domFromPos(pos){return{node:this.nodeDOM,offset:pos}},TextViewDesc.prototype.localPosFromDOM=function localPosFromDOM(dom,offset,bias){return dom==this.nodeDOM?this.posAtStart+Math.min(offset,this.node.text.length):NodeViewDesc.prototype.localPosFromDOM.call(this,dom,offset,bias)},TextViewDesc.prototype.ignoreMutation=function ignoreMutation(mutation){return"characterData"!=mutation.type&&"selection"!=mutation.type},TextViewDesc.prototype.slice=function slice(from,to,view){var node=this.node.cut(from,to),dom=document.createTextNode(node.text);return new TextViewDesc(this.parent,node,this.outerDeco,this.innerDeco,dom,dom,view)},prototypeAccessors$4.domAtom.get=function(){return!1},Object.defineProperties(TextViewDesc.prototype,prototypeAccessors$4),TextViewDesc}(NodeViewDesc),TrailingHackViewDesc=function(ViewDesc){function TrailingHackViewDesc(){ViewDesc.apply(this,arguments)}ViewDesc&&(TrailingHackViewDesc.__proto__=ViewDesc),TrailingHackViewDesc.prototype=Object.create(ViewDesc&&ViewDesc.prototype),TrailingHackViewDesc.prototype.constructor=TrailingHackViewDesc;var prototypeAccessors$5={domAtom:{configurable:!0}};return TrailingHackViewDesc.prototype.parseRule=function parseRule(){return{ignore:!0}},TrailingHackViewDesc.prototype.matchesHack=function matchesHack(){return 0==this.dirty},prototypeAccessors$5.domAtom.get=function(){return!0},Object.defineProperties(TrailingHackViewDesc.prototype,prototypeAccessors$5),TrailingHackViewDesc}(ViewDesc),CustomNodeViewDesc=function(NodeViewDesc){function CustomNodeViewDesc(parent,node,outerDeco,innerDeco,dom,contentDOM,nodeDOM,spec,view,pos){NodeViewDesc.call(this,parent,node,outerDeco,innerDeco,dom,contentDOM,nodeDOM,view,pos),this.spec=spec}return NodeViewDesc&&(CustomNodeViewDesc.__proto__=NodeViewDesc),CustomNodeViewDesc.prototype=Object.create(NodeViewDesc&&NodeViewDesc.prototype),CustomNodeViewDesc.prototype.constructor=CustomNodeViewDesc,CustomNodeViewDesc.prototype.update=function update(node,outerDeco,innerDeco,view){if(3==this.dirty)return!1;if(this.spec.update){var result=this.spec.update(node,outerDeco,innerDeco);return result&&this.updateInner(node,outerDeco,innerDeco,view),result}return!(!this.contentDOM&&!node.isLeaf)&&NodeViewDesc.prototype.update.call(this,node,outerDeco,innerDeco,view)},CustomNodeViewDesc.prototype.selectNode=function selectNode(){this.spec.selectNode?this.spec.selectNode():NodeViewDesc.prototype.selectNode.call(this)},CustomNodeViewDesc.prototype.deselectNode=function deselectNode(){this.spec.deselectNode?this.spec.deselectNode():NodeViewDesc.prototype.deselectNode.call(this)},CustomNodeViewDesc.prototype.setSelection=function setSelection(anchor,head,root,force){this.spec.setSelection?this.spec.setSelection(anchor,head,root):NodeViewDesc.prototype.setSelection.call(this,anchor,head,root,force)},CustomNodeViewDesc.prototype.destroy=function destroy(){this.spec.destroy&&this.spec.destroy(),NodeViewDesc.prototype.destroy.call(this)},CustomNodeViewDesc.prototype.stopEvent=function stopEvent(event){return!!this.spec.stopEvent&&this.spec.stopEvent(event)},CustomNodeViewDesc.prototype.ignoreMutation=function ignoreMutation(mutation){return this.spec.ignoreMutation?this.spec.ignoreMutation(mutation):NodeViewDesc.prototype.ignoreMutation.call(this,mutation)},CustomNodeViewDesc}(NodeViewDesc);function renderDescs(parentDOM,descs,view){for(var dom=parentDOM.firstChild,written=!1,i=0;i<descs.length;i++){var desc=descs[i],childDOM=desc.dom;if(childDOM.parentNode==parentDOM){for(;childDOM!=dom;)dom=rm(dom),written=!0;dom=dom.nextSibling}else written=!0,parentDOM.insertBefore(childDOM,dom);if(desc instanceof MarkViewDesc){var pos=dom?dom.previousSibling:parentDOM.lastChild;renderDescs(desc.contentDOM,desc.children,view),dom=pos?pos.nextSibling:parentDOM.firstChild}}for(;dom;)dom=rm(dom),written=!0;written&&view.trackWrites==parentDOM&&(view.trackWrites=null)}function OuterDecoLevel(nodeName){nodeName&&(this.nodeName=nodeName)}OuterDecoLevel.prototype=Object.create(null);var noDeco=[new OuterDecoLevel];function computeOuterDeco(outerDeco,node,needsWrap){if(0==outerDeco.length)return noDeco;for(var top=needsWrap?noDeco[0]:new OuterDecoLevel,result=[top],i=0;i<outerDeco.length;i++){var attrs=outerDeco[i].type.attrs;if(attrs)for(var name in attrs.nodeName&&result.push(top=new OuterDecoLevel(attrs.nodeName)),attrs){var val=attrs[name];null!=val&&(needsWrap&&1==result.length&&result.push(top=new OuterDecoLevel(node.isInline?"span":"div")),"class"==name?top.class=(top.class?top.class+" ":"")+val:"style"==name?top.style=(top.style?top.style+";":"")+val:"nodeName"!=name&&(top[name]=val))}}return result}function patchOuterDeco(outerDOM,nodeDOM,prevComputed,curComputed){if(prevComputed==noDeco&&curComputed==noDeco)return nodeDOM;for(var curDOM=nodeDOM,i=0;i<curComputed.length;i++){var deco=curComputed[i],prev=prevComputed[i];if(i){var parent=void 0;prev&&prev.nodeName==deco.nodeName&&curDOM!=outerDOM&&(parent=curDOM.parentNode)&&parent.tagName.toLowerCase()==deco.nodeName?curDOM=parent:((parent=document.createElement(deco.nodeName)).pmIsDeco=!0,parent.appendChild(curDOM),prev=noDeco[0],curDOM=parent)}patchAttributes(curDOM,prev||noDeco[0],deco)}return curDOM}function patchAttributes(dom,prev,cur){for(var name in prev)"class"==name||"style"==name||"nodeName"==name||name in cur||dom.removeAttribute(name);for(var name$1 in cur)"class"!=name$1&&"style"!=name$1&&"nodeName"!=name$1&&cur[name$1]!=prev[name$1]&&dom.setAttribute(name$1,cur[name$1]);if(prev.class!=cur.class){for(var prevList=prev.class?prev.class.split(" ").filter(Boolean):nothing,curList=cur.class?cur.class.split(" ").filter(Boolean):nothing,i=0;i<prevList.length;i++)-1==curList.indexOf(prevList[i])&&dom.classList.remove(prevList[i]);for(var i$1=0;i$1<curList.length;i$1++)-1==prevList.indexOf(curList[i$1])&&dom.classList.add(curList[i$1])}if(prev.style!=cur.style){if(prev.style)for(var prop=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,m;m=prop.exec(prev.style);)dom.style.removeProperty(m[1]);cur.style&&(dom.style.cssText+=cur.style)}}function applyOuterDeco(dom,deco,node){return patchOuterDeco(dom,dom,noDeco,computeOuterDeco(deco,node,1!=dom.nodeType))}function sameOuterDeco(a,b){if(a.length!=b.length)return!1;for(var i=0;i<a.length;i++)if(!a[i].type.eq(b[i].type))return!1;return!0}function rm(dom){var next=dom.nextSibling;return dom.parentNode.removeChild(dom),next}var ViewTreeUpdater=function ViewTreeUpdater(top,lockedNode){this.top=top,this.lock=lockedNode,this.index=0,this.stack=[],this.changed=!1,this.preMatch=preMatch(top.node.content,top.children)};function preMatch(frag,descs){for(var fI=frag.childCount,dI=descs.length,matched=new Map;fI>0&&dI>0;dI--){var desc=descs[dI-1],node=desc.node;if(node){if(node!=frag.child(fI-1))break;--fI,matched.set(desc,fI)}}return{index:fI,matched:matched}}function compareSide(a,b){return a.type.side-b.type.side}function iterDeco(parent,deco,onWidget,onNode){var locals=deco.locals(parent),offset=0;if(0!=locals.length)for(var decoIndex=0,active=[],restNode=null,parentIndex=0;;){if(decoIndex<locals.length&&locals[decoIndex].to==offset){for(var widget=locals[decoIndex++],widgets=void 0;decoIndex<locals.length&&locals[decoIndex].to==offset;)(widgets||(widgets=[widget])).push(locals[decoIndex++]);if(widgets){widgets.sort(compareSide);for(var i$1=0;i$1<widgets.length;i$1++)onWidget(widgets[i$1],parentIndex,!!restNode)}else onWidget(widget,parentIndex,!!restNode)}var child$1=void 0,index=void 0;if(restNode)index=-1,child$1=restNode,restNode=null;else{if(!(parentIndex<parent.childCount))break;index=parentIndex,child$1=parent.child(parentIndex++)}for(var i$2=0;i$2<active.length;i$2++)active[i$2].to<=offset&&active.splice(i$2--,1);for(;decoIndex<locals.length&&locals[decoIndex].from<=offset&&locals[decoIndex].to>offset;)active.push(locals[decoIndex++]);var end=offset+child$1.nodeSize,outerDeco;if(child$1.isText){var cutAt=end;decoIndex<locals.length&&locals[decoIndex].from<cutAt&&(cutAt=locals[decoIndex].from);for(var i$3=0;i$3<active.length;i$3++)active[i$3].to<cutAt&&(cutAt=active[i$3].to);cutAt<end&&(restNode=child$1.cut(cutAt-offset),child$1=child$1.cut(0,cutAt-offset),end=cutAt,index=-1)}onNode(child$1,active.length?child$1.isInline&&!child$1.isLeaf?active.filter((function(d){return!d.inline})):active.slice():nothing,deco.forChild(offset,child$1),index),offset=end}else for(var i=0;i<parent.childCount;i++){var child=parent.child(i);onNode(child,locals,deco.forChild(offset,child),i),offset+=child.nodeSize}}function iosHacks(dom){if("UL"==dom.nodeName||"OL"==dom.nodeName){var oldCSS=dom.style.cssText;dom.style.cssText=oldCSS+"; list-style: square !important",window.getComputedStyle(dom).listStyle,dom.style.cssText=oldCSS}}function nearbyTextNode(node,offset){for(;;){if(3==node.nodeType)return node;if(1==node.nodeType&&offset>0){if(node.childNodes.length>offset&&3==node.childNodes[offset].nodeType)return node.childNodes[offset];offset=nodeSize(node=node.childNodes[offset-1])}else{if(!(1==node.nodeType&&offset<node.childNodes.length))return null;node=node.childNodes[offset],offset=0}}}function findTextInFragment(frag,text,from,to){for(var i=0,pos=0;i<frag.childCount&&pos<=to;){var child=frag.child(i++),childStart=pos;if(pos+=child.nodeSize,child.isText){for(var str=child.text;i<frag.childCount;){var next=frag.child(i++);if(pos+=next.nodeSize,!next.isText)break;str+=next.text}if(pos>=from){var found=str.lastIndexOf(text,to-childStart);if(found>=0&&found+text.length+childStart>=from)return childStart+found}}}return-1}function replaceNodes(nodes,from,to,view,replacement){for(var result=[],i=0,off=0;i<nodes.length;i++){var child=nodes[i],start=off,end=off+=child.size;start>=to||end<=from?result.push(child):(start<from&&result.push(child.slice(0,from-start,view)),replacement&&(result.push(replacement),replacement=null),end>to&&result.push(child.slice(to-start,child.size,view)))}return result}function selectionFromDOM(view,origin){var domSel=view.root.getSelection(),doc=view.state.doc;if(!domSel.focusNode)return null;var nearestDesc=view.docView.nearestDesc(domSel.focusNode),inWidget=nearestDesc&&0==nearestDesc.size,head=view.docView.posFromDOM(domSel.focusNode,domSel.focusOffset);if(head<0)return null;var $head=doc.resolve(head),$anchor,selection,bias;if(selectionCollapsed(domSel)){for($anchor=$head;nearestDesc&&!nearestDesc.node;)nearestDesc=nearestDesc.parent;if(nearestDesc&&nearestDesc.node.isAtom&&index_es_NodeSelection.isSelectable(nearestDesc.node)&&nearestDesc.parent&&(!nearestDesc.node.isInline||!isOnEdge(domSel.focusNode,domSel.focusOffset,nearestDesc.dom))){var pos=nearestDesc.posBefore;selection=new index_es_NodeSelection(head==pos?$head:doc.resolve(pos))}}else{var anchor=view.docView.posFromDOM(domSel.anchorNode,domSel.anchorOffset);if(anchor<0)return null;$anchor=doc.resolve(anchor)}selection||(selection=selectionBetween(view,$anchor,$head,"pointer"==origin||view.state.selection.head<$head.pos&&!inWidget?1:-1));return selection}function editorOwnsSelection(view){return view.editable?view.hasFocus():hasSelection(view)&&document.activeElement&&document.activeElement.contains(view.dom)}function selectionToDOM(view,force){var sel=view.state.selection;if(syncNodeSelection(view,sel),editorOwnsSelection(view)){if(view.domObserver.disconnectSelection(),view.cursorWrapper)selectCursorWrapper(view);else{var anchor=sel.anchor,head=sel.head,resetEditableFrom,resetEditableTo;!brokenSelectBetweenUneditable||sel instanceof TextSelection||(sel.$from.parent.inlineContent||(resetEditableFrom=temporarilyEditableNear(view,sel.from)),sel.empty||sel.$from.parent.inlineContent||(resetEditableTo=temporarilyEditableNear(view,sel.to))),view.docView.setSelection(anchor,head,view.root,force),brokenSelectBetweenUneditable&&(resetEditableFrom&&resetEditable(resetEditableFrom),resetEditableTo&&resetEditable(resetEditableTo)),sel.visible?view.dom.classList.remove("ProseMirror-hideselection"):(view.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&removeClassOnSelectionChange(view))}view.domObserver.setCurSelection(),view.domObserver.connectSelection()}}ViewTreeUpdater.prototype.destroyBetween=function destroyBetween(start,end){if(start!=end){for(var i=start;i<end;i++)this.top.children[i].destroy();this.top.children.splice(start,end-start),this.changed=!0}},ViewTreeUpdater.prototype.destroyRest=function destroyRest(){this.destroyBetween(this.index,this.top.children.length)},ViewTreeUpdater.prototype.syncToMarks=function syncToMarks(marks,inline,view){for(var keep=0,depth=this.stack.length>>1,maxKeep=Math.min(depth,marks.length);keep<maxKeep&&(keep==depth-1?this.top:this.stack[keep+1<<1]).matchesMark(marks[keep])&&!1!==marks[keep].type.spec.spanning;)keep++;for(;keep<depth;)this.destroyRest(),this.top.dirty=0,this.index=this.stack.pop(),this.top=this.stack.pop(),depth--;for(;depth<marks.length;){this.stack.push(this.top,this.index+1);for(var found=-1,i=this.index;i<Math.min(this.index+3,this.top.children.length);i++)if(this.top.children[i].matchesMark(marks[depth])){found=i;break}if(found>-1)found>this.index&&(this.changed=!0,this.destroyBetween(this.index,found)),this.top=this.top.children[this.index];else{var markDesc=MarkViewDesc.create(this.top,marks[depth],inline,view);this.top.children.splice(this.index,0,markDesc),this.top=markDesc,this.changed=!0}this.index=0,depth++}},ViewTreeUpdater.prototype.findNodeMatch=function findNodeMatch(node,outerDeco,innerDeco,index){var children=this.top.children,found=-1;if(index>=this.preMatch.index){for(var i=this.index;i<children.length;i++)if(children[i].matchesNode(node,outerDeco,innerDeco)){found=i;break}}else for(var i$1=this.index,e=Math.min(children.length,i$1+1);i$1<e;i$1++){var child=children[i$1];if(child.matchesNode(node,outerDeco,innerDeco)&&!this.preMatch.matched.has(child)){found=i$1;break}}return!(found<0)&&(this.destroyBetween(this.index,found),this.index++,!0)},ViewTreeUpdater.prototype.updateNextNode=function updateNextNode(node,outerDeco,innerDeco,view,index){for(var i=this.index;i<this.top.children.length;i++){var next=this.top.children[i];if(next instanceof NodeViewDesc){var preMatch=this.preMatch.matched.get(next);if(null!=preMatch&&preMatch!=index)return!1;var nextDOM=next.dom,locked;if(!(this.lock&&(nextDOM==this.lock||1==nextDOM.nodeType&&nextDOM.contains(this.lock.parentNode))&&!(node.isText&&next.node&&next.node.isText&&next.nodeDOM.nodeValue==node.text&&3!=next.dirty&&sameOuterDeco(outerDeco,next.outerDeco)))&&next.update(node,outerDeco,innerDeco,view))return this.destroyBetween(this.index,i),next.dom!=nextDOM&&(this.changed=!0),this.index++,!0;break}}return!1},ViewTreeUpdater.prototype.addNode=function addNode(node,outerDeco,innerDeco,view,pos){this.top.children.splice(this.index++,0,NodeViewDesc.create(this.top,node,outerDeco,innerDeco,view,pos)),this.changed=!0},ViewTreeUpdater.prototype.placeWidget=function placeWidget(widget,view,pos){var next=this.index<this.top.children.length?this.top.children[this.index]:null;if(!next||!next.matchesWidget(widget)||widget!=next.widget&&next.widget.type.toDOM.parentNode){var desc=new WidgetViewDesc(this.top,widget,view,pos);this.top.children.splice(this.index++,0,desc),this.changed=!0}else this.index++},ViewTreeUpdater.prototype.addTextblockHacks=function addTextblockHacks(){for(var lastChild=this.top.children[this.index-1];lastChild instanceof MarkViewDesc;)lastChild=lastChild.children[lastChild.children.length-1];if(!lastChild||!(lastChild instanceof TextViewDesc)||/\n$/.test(lastChild.node.text))if(this.index<this.top.children.length&&this.top.children[this.index].matchesHack())this.index++;else{var dom=document.createElement("br");this.top.children.splice(this.index++,0,new TrailingHackViewDesc(this.top,nothing,dom,null)),this.changed=!0}};var brokenSelectBetweenUneditable=result.safari||result.chrome&&result.chrome_version<63;function temporarilyEditableNear(view,pos){var ref=view.docView.domFromPos(pos,0),node=ref.node,offset=ref.offset,after=offset<node.childNodes.length?node.childNodes[offset]:null,before=offset?node.childNodes[offset-1]:null;if(result.safari&&after&&"false"==after.contentEditable)return setEditable(after);if(!(after&&"false"!=after.contentEditable||before&&"false"!=before.contentEditable)){if(after)return setEditable(after);if(before)return setEditable(before)}}function setEditable(element){return element.contentEditable="true",result.safari&&element.draggable&&(element.draggable=!1,element.wasDraggable=!0),element}function resetEditable(element){element.contentEditable="false",element.wasDraggable&&(element.draggable=!0,element.wasDraggable=null)}function removeClassOnSelectionChange(view){var doc=view.dom.ownerDocument;doc.removeEventListener("selectionchange",view.hideSelectionGuard);var domSel=view.root.getSelection(),node=domSel.anchorNode,offset=domSel.anchorOffset;doc.addEventListener("selectionchange",view.hideSelectionGuard=function(){domSel.anchorNode==node&&domSel.anchorOffset==offset||(doc.removeEventListener("selectionchange",view.hideSelectionGuard),setTimeout((function(){editorOwnsSelection(view)&&!view.state.selection.visible||view.dom.classList.remove("ProseMirror-hideselection")}),20))})}function selectCursorWrapper(view){var domSel=view.root.getSelection(),range=document.createRange(),node=view.cursorWrapper.dom,img="IMG"==node.nodeName;img?range.setEnd(node.parentNode,domIndex(node)+1):range.setEnd(node,0),range.collapse(!1),domSel.removeAllRanges(),domSel.addRange(range),!img&&!view.state.selection.visible&&result.ie&&result.ie_version<=11&&(node.disabled=!0,node.disabled=!1)}function syncNodeSelection(view,sel){if(sel instanceof index_es_NodeSelection){var desc=view.docView.descAt(sel.from);desc!=view.lastSelectedViewDesc&&(clearNodeSelection(view),desc&&desc.selectNode(),view.lastSelectedViewDesc=desc)}else clearNodeSelection(view)}function clearNodeSelection(view){view.lastSelectedViewDesc&&(view.lastSelectedViewDesc.parent&&view.lastSelectedViewDesc.deselectNode(),view.lastSelectedViewDesc=null)}function selectionBetween(view,$anchor,$head,bias){return view.someProp("createSelectionBetween",(function(f){return f(view,$anchor,$head)}))||TextSelection.between($anchor,$head,bias)}function hasFocusAndSelection(view){return(!view.editable||view.root.activeElement==view.dom)&&hasSelection(view)}function hasSelection(view){var sel=view.root.getSelection();if(!sel.anchorNode)return!1;try{return view.dom.contains(3==sel.anchorNode.nodeType?sel.anchorNode.parentNode:sel.anchorNode)&&(view.editable||view.dom.contains(3==sel.focusNode.nodeType?sel.focusNode.parentNode:sel.focusNode))}catch(_){return!1}}function anchorInRightPlace(view){var anchorDOM=view.docView.domFromPos(view.state.selection.anchor,0),domSel=view.root.getSelection();return isEquivalentPosition(anchorDOM.node,anchorDOM.offset,domSel.anchorNode,domSel.anchorOffset)}function moveSelectionBlock(state,dir){var ref=state.selection,$anchor=ref.$anchor,$head=ref.$head,$side=dir>0?$anchor.max($head):$anchor.min($head),$start=$side.parent.inlineContent?$side.depth?state.doc.resolve(dir>0?$side.after():$side.before()):null:$side;return $start&&Selection.findFrom($start,dir)}function apply(view,sel){return view.dispatch(view.state.tr.setSelection(sel).scrollIntoView()),!0}function selectHorizontally(view,dir,mods){var sel=view.state.selection;if(!(sel instanceof TextSelection)){if(sel instanceof index_es_NodeSelection&&sel.node.isInline)return apply(view,new TextSelection(dir>0?sel.$to:sel.$from));var next$1=moveSelectionBlock(view.state,dir);return!!next$1&&apply(view,next$1)}if(!sel.empty||mods.indexOf("s")>-1)return!1;if(view.endOfTextblock(dir>0?"right":"left")){var next=moveSelectionBlock(view.state,dir);return!!(next&&next instanceof index_es_NodeSelection)&&apply(view,next)}if(!(result.mac&&mods.indexOf("m")>-1)){var $head=sel.$head,node=$head.textOffset?null:dir<0?$head.nodeBefore:$head.nodeAfter,desc;if(!node||node.isText)return!1;var nodePos=dir<0?$head.pos-node.nodeSize:$head.pos;return!!(node.isAtom||(desc=view.docView.descAt(nodePos))&&!desc.contentDOM)&&(index_es_NodeSelection.isSelectable(node)?apply(view,new index_es_NodeSelection(dir<0?view.state.doc.resolve($head.pos-node.nodeSize):$head)):!!result.webkit&&apply(view,new TextSelection(view.state.doc.resolve(dir<0?nodePos:nodePos+node.nodeSize))))}}function nodeLen(node){return 3==node.nodeType?node.nodeValue.length:node.childNodes.length}function isIgnorable(dom){var desc=dom.pmViewDesc;return desc&&0==desc.size&&(dom.nextSibling||"BR"!=dom.nodeName)}function skipIgnoredNodesLeft(view){var sel=view.root.getSelection(),node=sel.focusNode,offset=sel.focusOffset;if(node){var moveNode,moveOffset,force=!1;for(result.gecko&&1==node.nodeType&&offset<nodeLen(node)&&isIgnorable(node.childNodes[offset])&&(force=!0);;)if(offset>0){if(1!=node.nodeType)break;var before=node.childNodes[offset-1];if(isIgnorable(before))moveNode=node,moveOffset=--offset;else{if(3!=before.nodeType)break;offset=(node=before).nodeValue.length}}else{if(isBlockNode(node))break;for(var prev=node.previousSibling;prev&&isIgnorable(prev);)moveNode=node.parentNode,moveOffset=domIndex(prev),prev=prev.previousSibling;if(prev)offset=nodeLen(node=prev);else{if((node=node.parentNode)==view.dom)break;offset=0}}force?setSelFocus(view,sel,node,offset):moveNode&&setSelFocus(view,sel,moveNode,moveOffset)}}function skipIgnoredNodesRight(view){var sel=view.root.getSelection(),node=sel.focusNode,offset=sel.focusOffset;if(node){for(var len=nodeLen(node),moveNode,moveOffset;;)if(offset<len){if(1!=node.nodeType)break;var after;if(!isIgnorable(node.childNodes[offset]))break;moveNode=node,moveOffset=++offset}else{if(isBlockNode(node))break;for(var next=node.nextSibling;next&&isIgnorable(next);)moveNode=next.parentNode,moveOffset=domIndex(next)+1,next=next.nextSibling;if(next)offset=0,len=nodeLen(node=next);else{if((node=node.parentNode)==view.dom)break;offset=len=0}}moveNode&&setSelFocus(view,sel,moveNode,moveOffset)}}function isBlockNode(dom){var desc=dom.pmViewDesc;return desc&&desc.node&&desc.node.isBlock}function setSelFocus(view,sel,node,offset){if(selectionCollapsed(sel)){var range=document.createRange();range.setEnd(node,offset),range.setStart(node,offset),sel.removeAllRanges(),sel.addRange(range)}else sel.extend&&sel.extend(node,offset);view.domObserver.setCurSelection();var state=view.state;setTimeout((function(){view.state==state&&selectionToDOM(view)}),50)}function selectVertically(view,dir,mods){var sel=view.state.selection;if(sel instanceof TextSelection&&!sel.empty||mods.indexOf("s")>-1)return!1;if(result.mac&&mods.indexOf("m")>-1)return!1;var $from=sel.$from,$to=sel.$to;if(!$from.parent.inlineContent||view.endOfTextblock(dir<0?"up":"down")){var next=moveSelectionBlock(view.state,dir);if(next&&next instanceof index_es_NodeSelection)return apply(view,next)}if(!$from.parent.inlineContent){var side=dir<0?$from:$to,beyond=sel instanceof AllSelection?Selection.near(side,dir):Selection.findFrom(side,dir);return!!beyond&&apply(view,beyond)}return!1}function stopNativeHorizontalDelete(view,dir){if(!(view.state.selection instanceof TextSelection))return!0;var ref=view.state.selection,$head=ref.$head,$anchor=ref.$anchor,empty=ref.empty;if(!$head.sameParent($anchor))return!0;if(!empty)return!1;if(view.endOfTextblock(dir>0?"forward":"backward"))return!0;var nextNode=!$head.textOffset&&(dir<0?$head.nodeBefore:$head.nodeAfter);if(nextNode&&!nextNode.isText){var tr=view.state.tr;return dir<0?tr.delete($head.pos-nextNode.nodeSize,$head.pos):tr.delete($head.pos,$head.pos+nextNode.nodeSize),view.dispatch(tr),!0}return!1}function switchEditable(view,node,state){view.domObserver.stop(),node.contentEditable=state,view.domObserver.start()}function safariDownArrowBug(view){if(result.safari&&!(view.state.selection.$head.parentOffset>0)){var ref=view.root.getSelection(),focusNode=ref.focusNode,focusOffset=ref.focusOffset;if(focusNode&&1==focusNode.nodeType&&0==focusOffset&&focusNode.firstChild&&"false"==focusNode.firstChild.contentEditable){var child=focusNode.firstChild;switchEditable(view,child,!0),setTimeout((function(){return switchEditable(view,child,!1)}),20)}}}function getMods(event){var result="";return event.ctrlKey&&(result+="c"),event.metaKey&&(result+="m"),event.altKey&&(result+="a"),event.shiftKey&&(result+="s"),result}function captureKeyDown(view,event){var code=event.keyCode,mods=getMods(event);return 8==code||result.mac&&72==code&&"c"==mods?stopNativeHorizontalDelete(view,-1)||skipIgnoredNodesLeft(view):46==code||result.mac&&68==code&&"c"==mods?stopNativeHorizontalDelete(view,1)||skipIgnoredNodesRight(view):13==code||27==code||(37==code?selectHorizontally(view,-1,mods)||skipIgnoredNodesLeft(view):39==code?selectHorizontally(view,1,mods)||skipIgnoredNodesRight(view):38==code?selectVertically(view,-1,mods)||skipIgnoredNodesLeft(view):40==code?safariDownArrowBug(view)||selectVertically(view,1,mods)||skipIgnoredNodesRight(view):mods==(result.mac?"m":"c")&&(66==code||73==code||89==code||90==code))}function parseBetween(view,from_,to_){var ref=view.docView.parseRange(from_,to_),parent=ref.node,fromOffset=ref.fromOffset,toOffset=ref.toOffset,from=ref.from,to=ref.to,domSel=view.root.getSelection(),find=null,anchor=domSel.anchorNode;if(anchor&&view.dom.contains(1==anchor.nodeType?anchor:anchor.parentNode)&&(find=[{node:anchor,offset:domSel.anchorOffset}],selectionCollapsed(domSel)||find.push({node:domSel.focusNode,offset:domSel.focusOffset})),result.chrome&&8===view.lastKeyCode)for(var off=toOffset;off>fromOffset;off--){var node=parent.childNodes[off-1],desc=node.pmViewDesc;if("BR"==node.nodeName&&!desc){toOffset=off;break}if(!desc||desc.size)break}var startDoc=view.state.doc,parser=view.someProp("domParser")||DOMParser.fromSchema(view.state.schema),$from=startDoc.resolve(from),sel=null,doc=parser.parse(parent,{topNode:$from.parent,topMatch:$from.parent.contentMatchAt($from.index()),topOpen:!0,from:fromOffset,to:toOffset,preserveWhitespace:!$from.parent.type.spec.code||"full",editableContent:!0,findPositions:find,ruleFromNode:ruleFromNode,context:$from});if(find&&null!=find[0].pos){var anchor$1=find[0].pos,head=find[1]&&find[1].pos;null==head&&(head=anchor$1),sel={anchor:anchor$1+from,head:head+from}}return{doc:doc,sel:sel,from:from,to:to}}function ruleFromNode(dom){var desc=dom.pmViewDesc;if(desc)return desc.parseRule();if("BR"==dom.nodeName&&dom.parentNode){if(result.safari&&/^(ul|ol)$/i.test(dom.parentNode.nodeName)){var skip=document.createElement("div");return skip.appendChild(document.createElement("li")),{skip:skip}}if(dom.parentNode.lastChild==dom||result.safari&&/^(tr|table)$/i.test(dom.parentNode.nodeName))return{ignore:!0}}else if("IMG"==dom.nodeName&&dom.getAttribute("mark-placeholder"))return{ignore:!0}}function readDOMChange(view,from,to,typeOver,addedNodes){if(from<0){var origin=view.lastSelectionTime>Date.now()-50?view.lastSelectionOrigin:null,newSel=selectionFromDOM(view,origin);if(newSel&&!view.state.selection.eq(newSel)){var tr$1=view.state.tr.setSelection(newSel);"pointer"==origin?tr$1.setMeta("pointer",!0):"key"==origin&&tr$1.scrollIntoView(),view.dispatch(tr$1)}}else{var $before=view.state.doc.resolve(from),shared=$before.sharedDepth(to);from=$before.before(shared+1),to=view.state.doc.resolve(to).after(shared+1);var sel=view.state.selection,parse=parseBetween(view,from,to);if(result.chrome&&view.cursorWrapper&&parse.sel&&parse.sel.anchor==view.cursorWrapper.deco.from){var text=view.cursorWrapper.deco.type.toDOM.nextSibling,size=text&&text.nodeValue?text.nodeValue.length:1;parse.sel={anchor:parse.sel.anchor+size,head:parse.sel.anchor+size}}var doc=view.state.doc,compare=doc.slice(parse.from,parse.to),preferredPos,preferredSide;8===view.lastKeyCode&&Date.now()-100<view.lastKeyCodeTime?(preferredPos=view.state.selection.to,preferredSide="end"):(preferredPos=view.state.selection.from,preferredSide="start"),view.lastKeyCode=null;var change=findDiff(compare.content,parse.doc.content,parse.from,preferredPos,preferredSide);if(!change){if(!(typeOver&&sel instanceof TextSelection&&!sel.empty&&sel.$head.sameParent(sel.$anchor))||view.composing||parse.sel&&parse.sel.anchor!=parse.sel.head){if((result.ios&&view.lastIOSEnter>Date.now()-225||result.android)&&addedNodes.some((function(n){return"DIV"==n.nodeName||"P"==n.nodeName}))&&view.someProp("handleKeyDown",(function(f){return f(view,keyEvent(13,"Enter"))})))return void(view.lastIOSEnter=0);if(parse.sel){var sel$1=resolveSelection(view,view.state.doc,parse.sel);sel$1&&!sel$1.eq(view.state.selection)&&view.dispatch(view.state.tr.setSelection(sel$1))}return}change={start:sel.from,endA:sel.to,endB:sel.to}}view.domChangeCount++,view.state.selection.from<view.state.selection.to&&change.start==change.endB&&view.state.selection instanceof TextSelection&&(change.start>view.state.selection.from&&change.start<=view.state.selection.from+2?change.start=view.state.selection.from:change.endA<view.state.selection.to&&change.endA>=view.state.selection.to-2&&(change.endB+=view.state.selection.to-change.endA,change.endA=view.state.selection.to)),result.ie&&result.ie_version<=11&&change.endB==change.start+1&&change.endA==change.start&&change.start>parse.from&&"  "==parse.doc.textBetween(change.start-parse.from-1,change.start-parse.from+1)&&(change.start--,change.endA--,change.endB--);var $from=parse.doc.resolveNoCache(change.start-parse.from),$to=parse.doc.resolveNoCache(change.endB-parse.from),inlineChange=$from.sameParent($to)&&$from.parent.inlineContent,nextSel;if((result.ios&&view.lastIOSEnter>Date.now()-225&&(!inlineChange||addedNodes.some((function(n){return"DIV"==n.nodeName||"P"==n.nodeName})))||!inlineChange&&$from.pos<parse.doc.content.size&&(nextSel=Selection.findFrom(parse.doc.resolve($from.pos+1),1,!0))&&nextSel.head==$to.pos)&&view.someProp("handleKeyDown",(function(f){return f(view,keyEvent(13,"Enter"))})))view.lastIOSEnter=0;else if(view.state.selection.anchor>change.start&&looksLikeJoin(doc,change.start,change.endA,$from,$to)&&view.someProp("handleKeyDown",(function(f){return f(view,keyEvent(8,"Backspace"))})))result.android&&result.chrome&&view.domObserver.suppressSelectionUpdates();else{result.chrome&&result.android&&change.toB==change.from&&(view.lastAndroidDelete=Date.now()),result.android&&!inlineChange&&$from.start()!=$to.start()&&0==$to.parentOffset&&$from.depth==$to.depth&&parse.sel&&parse.sel.anchor==parse.sel.head&&parse.sel.head==change.endA&&(change.endB-=2,$to=parse.doc.resolveNoCache(change.endB-parse.from),setTimeout((function(){view.someProp("handleKeyDown",(function(f){return f(view,keyEvent(13,"Enter"))}))}),20));var chFrom=change.start,chTo=change.endA,tr,storedMarks,markChange,$from1;if(inlineChange)if($from.pos==$to.pos)result.ie&&result.ie_version<=11&&0==$from.parentOffset&&(view.domObserver.suppressSelectionUpdates(),setTimeout((function(){return selectionToDOM(view)}),20)),tr=view.state.tr.delete(chFrom,chTo),storedMarks=doc.resolve(change.start).marksAcross(doc.resolve(change.endA));else if(change.endA==change.endB&&($from1=doc.resolve(change.start))&&(markChange=isMarkChange($from.parent.content.cut($from.parentOffset,$to.parentOffset),$from1.parent.content.cut($from1.parentOffset,change.endA-$from1.start()))))tr=view.state.tr,"add"==markChange.type?tr.addMark(chFrom,chTo,markChange.mark):tr.removeMark(chFrom,chTo,markChange.mark);else if($from.parent.child($from.index()).isText&&$from.index()==$to.index()-($to.textOffset?0:1)){var text$1=$from.parent.textBetween($from.parentOffset,$to.parentOffset);if(view.someProp("handleTextInput",(function(f){return f(view,chFrom,chTo,text$1)})))return;tr=view.state.tr.insertText(text$1,chFrom,chTo)}if(tr||(tr=view.state.tr.replace(chFrom,chTo,parse.doc.slice(change.start-parse.from,change.endB-parse.from))),parse.sel){var sel$2=resolveSelection(view,tr.doc,parse.sel);sel$2&&!(result.chrome&&result.android&&view.composing&&sel$2.empty&&(change.start!=change.endB||view.lastAndroidDelete<Date.now()-100)&&(sel$2.head==chFrom||sel$2.head==tr.mapping.map(chTo)-1)||result.ie&&sel$2.empty&&sel$2.head==chFrom)&&tr.setSelection(sel$2)}storedMarks&&tr.ensureMarks(storedMarks),view.dispatch(tr.scrollIntoView())}}}function resolveSelection(view,doc,parsedSel){return Math.max(parsedSel.anchor,parsedSel.head)>doc.content.size?null:selectionBetween(view,doc.resolve(parsedSel.anchor),doc.resolve(parsedSel.head))}function isMarkChange(cur,prev){for(var curMarks=cur.firstChild.marks,prevMarks=prev.firstChild.marks,added=curMarks,removed=prevMarks,type,mark,update,i=0;i<prevMarks.length;i++)added=prevMarks[i].removeFromSet(added);for(var i$1=0;i$1<curMarks.length;i$1++)removed=curMarks[i$1].removeFromSet(removed);if(1==added.length&&0==removed.length)mark=added[0],type="add",update=function(node){return node.mark(mark.addToSet(node.marks))};else{if(0!=added.length||1!=removed.length)return null;mark=removed[0],type="remove",update=function(node){return node.mark(mark.removeFromSet(node.marks))}}for(var updated=[],i$2=0;i$2<prev.childCount;i$2++)updated.push(update(prev.child(i$2)));if(Fragment.from(updated).eq(cur))return{mark:mark,type:type}}function looksLikeJoin(old,start,end,$newStart,$newEnd){if(!$newStart.parent.isTextblock||end-start<=$newEnd.pos-$newStart.pos||skipClosingAndOpening($newStart,!0,!1)<$newEnd.pos)return!1;var $start=old.resolve(start);if($start.parentOffset<$start.parent.content.size||!$start.parent.isTextblock)return!1;var $next=old.resolve(skipClosingAndOpening($start,!0,!0));return!(!$next.parent.isTextblock||$next.pos>end||skipClosingAndOpening($next,!0,!1)<end)&&$newStart.parent.content.cut($newStart.parentOffset).eq($next.parent.content)}function skipClosingAndOpening($pos,fromEnd,mayOpen){for(var depth=$pos.depth,end=fromEnd?$pos.end():$pos.pos;depth>0&&(fromEnd||$pos.indexAfter(depth)==$pos.node(depth).childCount);)depth--,end++,fromEnd=!1;if(mayOpen)for(var next=$pos.node(depth).maybeChild($pos.indexAfter(depth));next&&!next.isLeaf;)next=next.firstChild,end++;return end}function findDiff(a,b,pos,preferredPos,preferredSide){var start=a.findDiffStart(b,pos);if(null==start)return null;var ref=a.findDiffEnd(b,pos+a.size,pos+b.size),endA=ref.a,endB=ref.b,adjust,move;"end"==preferredSide&&(preferredPos-=endA+Math.max(0,start-Math.min(endA,endB))-start);if(endA<start&&a.size<b.size)endB=(start-=preferredPos<=start&&preferredPos>=endA?start-preferredPos:0)+(endB-endA),endA=start;else if(endB<start){var move$1;endA=(start-=preferredPos<=start&&preferredPos>=endB?start-preferredPos:0)+(endA-endB),endB=start}return{start:start,endA:endA,endB:endB}}function serializeForClipboard(view,slice){for(var context=[],content=slice.content,openStart=slice.openStart,openEnd=slice.openEnd;openStart>1&&openEnd>1&&1==content.childCount&&1==content.firstChild.childCount;){openStart--,openEnd--;var node=content.firstChild;context.push(node.type.name,node.attrs!=node.type.defaultAttrs?node.attrs:null),content=node.content}var serializer=view.someProp("clipboardSerializer")||DOMSerializer.fromSchema(view.state.schema),doc=detachedDoc(),wrap=doc.createElement("div"),text;wrap.appendChild(serializer.serializeFragment(content,{document:doc}));for(var firstChild=wrap.firstChild,needsWrap;firstChild&&1==firstChild.nodeType&&(needsWrap=wrapMap[firstChild.nodeName.toLowerCase()]);){for(var i=needsWrap.length-1;i>=0;i--){for(var wrapper=doc.createElement(needsWrap[i]);wrap.firstChild;)wrapper.appendChild(wrap.firstChild);wrap.appendChild(wrapper)}firstChild=wrap.firstChild}return firstChild&&1==firstChild.nodeType&&firstChild.setAttribute("data-pm-slice",openStart+" "+openEnd+" "+JSON.stringify(context)),{dom:wrap,text:view.someProp("clipboardTextSerializer",(function(f){return f(slice)}))||slice.content.textBetween(0,slice.content.size,"\n\n")}}function parseFromClipboard(view,text,html,plainText,$context){var dom,inCode=$context.parent.type.spec.code,slice;if(!html&&!text)return null;var asText=text&&(plainText||inCode||!html);if(asText){if(view.someProp("transformPastedText",(function(f){text=f(text,inCode||plainText)})),inCode)return new Slice(Fragment.from(view.state.schema.text(text.replace(/\r\n?/g,"\n"))),0,0);var parsed=view.someProp("clipboardTextParser",(function(f){return f(text,$context,plainText)}));parsed?slice=parsed:(dom=document.createElement("div"),text.trim().split(/(?:\r\n?|\n)+/).forEach((function(block){dom.appendChild(document.createElement("p")).textContent=block})))}else view.someProp("transformPastedHTML",(function(f){html=f(html)})),dom=readHTML(html);var contextNode=dom&&dom.querySelector("[data-pm-slice]"),sliceData=contextNode&&/^(\d+) (\d+) (.*)/.exec(contextNode.getAttribute("data-pm-slice"));if(!slice){var parser=view.someProp("clipboardParser")||view.someProp("domParser")||DOMParser.fromSchema(view.state.schema);slice=parser.parseSlice(dom,{preserveWhitespace:!(!asText&&!sliceData),context:$context})}return slice=sliceData?addContext(closeSlice(slice,+sliceData[1],+sliceData[2]),sliceData[3]):Slice.maxOpen(normalizeSiblings(slice.content,$context),!1),view.someProp("transformPasted",(function(f){slice=f(slice)})),slice}function normalizeSiblings(fragment,$context){if(fragment.childCount<2)return fragment;for(var loop=function(d){var parent,match=$context.node(d).contentMatchAt($context.index(d)),lastWrap=void 0,result=[];if(fragment.forEach((function(node){if(result){var wrap=match.findWrapping(node.type),inLast;if(!wrap)return result=null;if(inLast=result.length&&lastWrap.length&&addToSibling(wrap,lastWrap,node,result[result.length-1],0))result[result.length-1]=inLast;else{result.length&&(result[result.length-1]=closeRight(result[result.length-1],lastWrap.length));var wrapped=withWrappers(node,wrap);result.push(wrapped),match=match.matchType(wrapped.type,wrapped.attrs),lastWrap=wrap}}})),result)return{v:Fragment.from(result)}},d=$context.depth;d>=0;d--){var returned=loop(d);if(returned)return returned.v}return fragment}function withWrappers(node,wrap,from){void 0===from&&(from=0);for(var i=wrap.length-1;i>=from;i--)node=wrap[i].create(null,Fragment.from(node));return node}function addToSibling(wrap,lastWrap,node,sibling,depth){if(depth<wrap.length&&depth<lastWrap.length&&wrap[depth]==lastWrap[depth]){var inner=addToSibling(wrap,lastWrap,node,sibling.lastChild,depth+1),match;if(inner)return sibling.copy(sibling.content.replaceChild(sibling.childCount-1,inner));if(sibling.contentMatchAt(sibling.childCount).matchType(depth==wrap.length-1?node.type:wrap[depth+1]))return sibling.copy(sibling.content.append(Fragment.from(withWrappers(node,wrap,depth+1))))}}function closeRight(node,depth){if(0==depth)return node;var fragment=node.content.replaceChild(node.childCount-1,closeRight(node.lastChild,depth-1)),fill=node.contentMatchAt(node.childCount).fillBefore(Fragment.empty,!0);return node.copy(fragment.append(fill))}function closeRange(fragment,side,from,to,depth,openEnd){var node=side<0?fragment.firstChild:fragment.lastChild,inner=node.content;return depth<to-1&&(inner=closeRange(inner,side,from,to,depth+1,openEnd)),depth>=from&&(inner=side<0?node.contentMatchAt(0).fillBefore(inner,fragment.childCount>1||openEnd<=depth).append(inner):inner.append(node.contentMatchAt(node.childCount).fillBefore(Fragment.empty,!0))),fragment.replaceChild(side<0?0:fragment.childCount-1,node.copy(inner))}function closeSlice(slice,openStart,openEnd){return openStart<slice.openStart&&(slice=new Slice(closeRange(slice.content,-1,openStart,slice.openStart,0,slice.openEnd),openStart,slice.openEnd)),openEnd<slice.openEnd&&(slice=new Slice(closeRange(slice.content,1,openEnd,slice.openEnd,0,0),slice.openStart,openEnd)),slice}var wrapMap={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]},_detachedDoc=null;function detachedDoc(){return _detachedDoc||(_detachedDoc=document.implementation.createHTMLDocument("title"))}function readHTML(html){var metas=/^(\s*<meta [^>]*>)*/.exec(html);metas&&(html=html.slice(metas[0].length));var elt=detachedDoc().createElement("div"),firstTag=/<([a-z][^>\s]+)/i.exec(html),wrap;if((wrap=firstTag&&wrapMap[firstTag[1].toLowerCase()])&&(html=wrap.map((function(n){return"<"+n+">"})).join("")+html+wrap.map((function(n){return"</"+n+">"})).reverse().join("")),elt.innerHTML=html,wrap)for(var i=0;i<wrap.length;i++)elt=elt.querySelector(wrap[i])||elt;return elt}function addContext(slice,context){if(!slice.size)return slice;var schema=slice.content.firstChild.type.schema,array;try{array=JSON.parse(context)}catch(e){return slice}for(var content=slice.content,openStart=slice.openStart,openEnd=slice.openEnd,i=array.length-2;i>=0;i-=2){var type=schema.nodes[array[i]];if(!type||type.hasRequiredAttrs())break;content=Fragment.from(type.create(array[i+1],content)),openStart++,openEnd++}return new Slice(content,openStart,openEnd)}var observeOptions={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},useCharData=result.ie&&result.ie_version<=11,SelectionState=function SelectionState(){this.anchorNode=this.anchorOffset=this.focusNode=this.focusOffset=null};SelectionState.prototype.set=function set(sel){this.anchorNode=sel.anchorNode,this.anchorOffset=sel.anchorOffset,this.focusNode=sel.focusNode,this.focusOffset=sel.focusOffset},SelectionState.prototype.eq=function eq(sel){return sel.anchorNode==this.anchorNode&&sel.anchorOffset==this.anchorOffset&&sel.focusNode==this.focusNode&&sel.focusOffset==this.focusOffset};var DOMObserver=function DOMObserver(view,handleDOMChange){var this$1=this;this.view=view,this.handleDOMChange=handleDOMChange,this.queue=[],this.flushingSoon=-1,this.observer=window.MutationObserver&&new window.MutationObserver((function(mutations){for(var i=0;i<mutations.length;i++)this$1.queue.push(mutations[i]);result.ie&&result.ie_version<=11&&mutations.some((function(m){return"childList"==m.type&&m.removedNodes.length||"characterData"==m.type&&m.oldValue.length>m.target.nodeValue.length}))?this$1.flushSoon():this$1.flush()})),this.currentSelection=new SelectionState,useCharData&&(this.onCharData=function(e){this$1.queue.push({target:e.target,type:"characterData",oldValue:e.prevValue}),this$1.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),this.suppressingSelectionUpdates=!1};DOMObserver.prototype.flushSoon=function flushSoon(){var this$1=this;this.flushingSoon<0&&(this.flushingSoon=window.setTimeout((function(){this$1.flushingSoon=-1,this$1.flush()}),20))},DOMObserver.prototype.forceFlush=function forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())},DOMObserver.prototype.start=function start(){this.observer&&this.observer.observe(this.view.dom,observeOptions),useCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()},DOMObserver.prototype.stop=function stop(){var this$1=this;if(this.observer){var take=this.observer.takeRecords();if(take.length){for(var i=0;i<take.length;i++)this.queue.push(take[i]);window.setTimeout((function(){return this$1.flush()}),20)}this.observer.disconnect()}useCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()},DOMObserver.prototype.connectSelection=function connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)},DOMObserver.prototype.disconnectSelection=function disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)},DOMObserver.prototype.suppressSelectionUpdates=function suppressSelectionUpdates(){var this$1=this;this.suppressingSelectionUpdates=!0,setTimeout((function(){return this$1.suppressingSelectionUpdates=!1}),50)},DOMObserver.prototype.onSelectionChange=function onSelectionChange(){if(hasFocusAndSelection(this.view)){if(this.suppressingSelectionUpdates)return selectionToDOM(this.view);if(result.ie&&result.ie_version<=11&&!this.view.state.selection.empty){var sel=this.view.root.getSelection();if(sel.focusNode&&isEquivalentPosition(sel.focusNode,sel.focusOffset,sel.anchorNode,sel.anchorOffset))return this.flushSoon()}this.flush()}},DOMObserver.prototype.setCurSelection=function setCurSelection(){this.currentSelection.set(this.view.root.getSelection())},DOMObserver.prototype.ignoreSelectionChange=function ignoreSelectionChange(sel){if(0==sel.rangeCount)return!0;var container=sel.getRangeAt(0).commonAncestorContainer,desc=this.view.docView.nearestDesc(container);return desc&&desc.ignoreMutation({type:"selection",target:3==container.nodeType?container.parentNode:container})?(this.setCurSelection(),!0):void 0},DOMObserver.prototype.flush=function flush(){if(this.view.docView&&!(this.flushingSoon>-1)){var mutations=this.observer?this.observer.takeRecords():[];this.queue.length&&(mutations=this.queue.concat(mutations),this.queue.length=0);var sel=this.view.root.getSelection(),newSel=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(sel)&&hasSelection(this.view)&&!this.ignoreSelectionChange(sel),from=-1,to=-1,typeOver=!1,added=[];if(this.view.editable)for(var i=0;i<mutations.length;i++){var result$1=this.registerMutation(mutations[i],added);result$1&&(from=from<0?result$1.from:Math.min(result$1.from,from),to=to<0?result$1.to:Math.max(result$1.to,to),result$1.typeOver&&(typeOver=!0))}if(result.gecko&&added.length>1){var brs=added.filter((function(n){return"BR"==n.nodeName}));if(2==brs.length){var a=brs[0],b=brs[1];a.parentNode&&a.parentNode.parentNode==b.parentNode?b.remove():a.remove()}}(from>-1||newSel)&&(from>-1&&(this.view.docView.markDirty(from,to),checkCSS(this.view)),this.handleDOMChange(from,to,typeOver,added),this.view.docView.dirty?this.view.updateState(this.view.state):this.currentSelection.eq(sel)||selectionToDOM(this.view),this.currentSelection.set(sel))}},DOMObserver.prototype.registerMutation=function registerMutation(mut,added){if(added.indexOf(mut.target)>-1)return null;var desc=this.view.docView.nearestDesc(mut.target);if("attributes"==mut.type&&(desc==this.view.docView||"contenteditable"==mut.attributeName||"style"==mut.attributeName&&!mut.oldValue&&!mut.target.getAttribute("style")))return null;if(!desc||desc.ignoreMutation(mut))return null;if("childList"==mut.type){for(var i=0;i<mut.addedNodes.length;i++)added.push(mut.addedNodes[i]);if(desc.contentDOM&&desc.contentDOM!=desc.dom&&!desc.contentDOM.contains(mut.target))return{from:desc.posBefore,to:desc.posAfter};var prev=mut.previousSibling,next=mut.nextSibling;if(result.ie&&result.ie_version<=11&&mut.addedNodes.length)for(var i$1=0;i$1<mut.addedNodes.length;i$1++){var ref=mut.addedNodes[i$1],previousSibling=ref.previousSibling,nextSibling=ref.nextSibling;(!previousSibling||Array.prototype.indexOf.call(mut.addedNodes,previousSibling)<0)&&(prev=previousSibling),(!nextSibling||Array.prototype.indexOf.call(mut.addedNodes,nextSibling)<0)&&(next=nextSibling)}var fromOffset=prev&&prev.parentNode==mut.target?domIndex(prev)+1:0,from=desc.localPosFromDOM(mut.target,fromOffset,-1),toOffset=next&&next.parentNode==mut.target?domIndex(next):mut.target.childNodes.length,to;return{from:from,to:desc.localPosFromDOM(mut.target,toOffset,1)}}return"attributes"==mut.type?{from:desc.posAtStart-desc.border,to:desc.posAtEnd+desc.border}:{from:desc.posAtStart,to:desc.posAtEnd,typeOver:mut.target.nodeValue==mut.oldValue}};var cssChecked=!1;function checkCSS(view){cssChecked||(cssChecked=!0,"normal"==getComputedStyle(view.dom).whiteSpace&&console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."))}var handlers={},editHandlers={};function initInput(view){view.shiftKey=!1,view.mouseDown=null,view.lastKeyCode=null,view.lastKeyCodeTime=0,view.lastClick={time:0,x:0,y:0,type:""},view.lastSelectionOrigin=null,view.lastSelectionTime=0,view.lastIOSEnter=0,view.lastIOSEnterFallbackTimeout=null,view.lastAndroidDelete=0,view.composing=!1,view.composingTimeout=null,view.compositionNodes=[],view.compositionEndedAt=-2e8,view.domObserver=new DOMObserver(view,(function(from,to,typeOver,added){return readDOMChange(view,from,to,typeOver,added)})),view.domObserver.start(),view.domChangeCount=0,view.eventHandlers=Object.create(null);var loop=function(event){var handler=handlers[event];view.dom.addEventListener(event,view.eventHandlers[event]=function(event){!eventBelongsToView(view,event)||runCustomHandler(view,event)||!view.editable&&event.type in editHandlers||handler(view,event)})};for(var event in handlers)loop(event);result.safari&&view.dom.addEventListener("input",(function(){return null})),ensureListeners(view)}function setSelectionOrigin(view,origin){view.lastSelectionOrigin=origin,view.lastSelectionTime=Date.now()}function destroyInput(view){for(var type in view.domObserver.stop(),view.eventHandlers)view.dom.removeEventListener(type,view.eventHandlers[type]);clearTimeout(view.composingTimeout),clearTimeout(view.lastIOSEnterFallbackTimeout)}function ensureListeners(view){view.someProp("handleDOMEvents",(function(currentHandlers){for(var type in currentHandlers)view.eventHandlers[type]||view.dom.addEventListener(type,view.eventHandlers[type]=function(event){return runCustomHandler(view,event)})}))}function runCustomHandler(view,event){return view.someProp("handleDOMEvents",(function(handlers){var handler=handlers[event.type];return!!handler&&(handler(view,event)||event.defaultPrevented)}))}function eventBelongsToView(view,event){if(!event.bubbles)return!0;if(event.defaultPrevented)return!1;for(var node=event.target;node!=view.dom;node=node.parentNode)if(!node||11==node.nodeType||node.pmViewDesc&&node.pmViewDesc.stopEvent(event))return!1;return!0}function dispatchEvent(view,event){runCustomHandler(view,event)||!handlers[event.type]||!view.editable&&event.type in editHandlers||handlers[event.type](view,event)}function eventCoords(event){return{left:event.clientX,top:event.clientY}}function isNear(event,click){var dx=click.x-event.clientX,dy=click.y-event.clientY;return dx*dx+dy*dy<100}function runHandlerOnContext(view,propName,pos,inside,event){if(-1==inside)return!1;for(var $pos=view.state.doc.resolve(inside),loop=function(i){if(view.someProp(propName,(function(f){return i>$pos.depth?f(view,pos,$pos.nodeAfter,$pos.before(i),event,!0):f(view,pos,$pos.node(i),$pos.before(i),event,!1)})))return{v:!0}},i=$pos.depth+1;i>0;i--){var returned=loop(i);if(returned)return returned.v}return!1}function updateSelection(view,selection,origin){view.focused||view.focus();var tr=view.state.tr.setSelection(selection);"pointer"==origin&&tr.setMeta("pointer",!0),view.dispatch(tr)}function selectClickedLeaf(view,inside){if(-1==inside)return!1;var $pos=view.state.doc.resolve(inside),node=$pos.nodeAfter;return!!(node&&node.isAtom&&index_es_NodeSelection.isSelectable(node))&&(updateSelection(view,new index_es_NodeSelection($pos),"pointer"),!0)}function selectClickedNode(view,inside){if(-1==inside)return!1;var sel=view.state.selection,selectedNode,selectAt;sel instanceof index_es_NodeSelection&&(selectedNode=sel.node);for(var $pos=view.state.doc.resolve(inside),i=$pos.depth+1;i>0;i--){var node=i>$pos.depth?$pos.nodeAfter:$pos.node(i);if(index_es_NodeSelection.isSelectable(node)){selectAt=selectedNode&&sel.$from.depth>0&&i>=sel.$from.depth&&$pos.before(sel.$from.depth+1)==sel.$from.pos?$pos.before(sel.$from.depth):$pos.before(i);break}}return null!=selectAt&&(updateSelection(view,index_es_NodeSelection.create(view.state.doc,selectAt),"pointer"),!0)}function handleSingleClick(view,pos,inside,event,selectNode){return runHandlerOnContext(view,"handleClickOn",pos,inside,event)||view.someProp("handleClick",(function(f){return f(view,pos,event)}))||(selectNode?selectClickedNode(view,inside):selectClickedLeaf(view,inside))}function handleDoubleClick(view,pos,inside,event){return runHandlerOnContext(view,"handleDoubleClickOn",pos,inside,event)||view.someProp("handleDoubleClick",(function(f){return f(view,pos,event)}))}function handleTripleClick(view,pos,inside,event){return runHandlerOnContext(view,"handleTripleClickOn",pos,inside,event)||view.someProp("handleTripleClick",(function(f){return f(view,pos,event)}))||defaultTripleClick(view,inside)}function defaultTripleClick(view,inside){var doc=view.state.doc;if(-1==inside)return!!doc.inlineContent&&(updateSelection(view,TextSelection.create(doc,0,doc.content.size),"pointer"),!0);for(var $pos=doc.resolve(inside),i=$pos.depth+1;i>0;i--){var node=i>$pos.depth?$pos.nodeAfter:$pos.node(i),nodePos=$pos.before(i);if(node.inlineContent)updateSelection(view,TextSelection.create(doc,nodePos+1,nodePos+1+node.content.size),"pointer");else{if(!index_es_NodeSelection.isSelectable(node))continue;updateSelection(view,index_es_NodeSelection.create(doc,nodePos),"pointer")}return!0}}function forceDOMFlush(view){return endComposition(view)}editHandlers.keydown=function(view,event){if(view.shiftKey=16==event.keyCode||event.shiftKey,!inOrNearComposition(view,event))if(view.domObserver.forceFlush(),view.lastKeyCode=event.keyCode,view.lastKeyCodeTime=Date.now(),!result.ios||13!=event.keyCode||event.ctrlKey||event.altKey||event.metaKey)view.someProp("handleKeyDown",(function(f){return f(view,event)}))||captureKeyDown(view,event)?event.preventDefault():setSelectionOrigin(view,"key");else{var now=Date.now();view.lastIOSEnter=now,view.lastIOSEnterFallbackTimeout=setTimeout((function(){view.lastIOSEnter==now&&(view.someProp("handleKeyDown",(function(f){return f(view,keyEvent(13,"Enter"))})),view.lastIOSEnter=0)}),200)}},editHandlers.keyup=function(view,e){16==e.keyCode&&(view.shiftKey=!1)},editHandlers.keypress=function(view,event){if(!(inOrNearComposition(view,event)||!event.charCode||event.ctrlKey&&!event.altKey||result.mac&&event.metaKey))if(view.someProp("handleKeyPress",(function(f){return f(view,event)})))event.preventDefault();else{var sel=view.state.selection;if(!(sel instanceof TextSelection&&sel.$from.sameParent(sel.$to))){var text=String.fromCharCode(event.charCode);view.someProp("handleTextInput",(function(f){return f(view,sel.$from.pos,sel.$to.pos,text)}))||view.dispatch(view.state.tr.insertText(text).scrollIntoView()),event.preventDefault()}}};var selectNodeModifier=result.mac?"metaKey":"ctrlKey";handlers.mousedown=function(view,event){view.shiftKey=event.shiftKey;var flushed=forceDOMFlush(view),now=Date.now(),type="singleClick";now-view.lastClick.time<500&&isNear(event,view.lastClick)&&!event[selectNodeModifier]&&("singleClick"==view.lastClick.type?type="doubleClick":"doubleClick"==view.lastClick.type&&(type="tripleClick")),view.lastClick={time:now,x:event.clientX,y:event.clientY,type:type};var pos=view.posAtCoords(eventCoords(event));pos&&("singleClick"==type?(view.mouseDown&&view.mouseDown.done(),view.mouseDown=new MouseDown(view,pos,event,flushed)):("doubleClick"==type?handleDoubleClick:handleTripleClick)(view,pos.pos,pos.inside,event)?event.preventDefault():setSelectionOrigin(view,"pointer"))};var MouseDown=function MouseDown(view,pos,event,flushed){var this$1=this,targetNode,targetPos;if(this.view=view,this.startDoc=view.state.doc,this.pos=pos,this.event=event,this.flushed=flushed,this.selectNode=event[selectNodeModifier],this.allowDefault=event.shiftKey,pos.inside>-1)targetNode=view.state.doc.nodeAt(pos.inside),targetPos=pos.inside;else{var $pos=view.state.doc.resolve(pos.pos);targetNode=$pos.parent,targetPos=$pos.depth?$pos.before():0}this.mightDrag=null;var target=flushed?null:event.target,targetDesc=target?view.docView.nearestDesc(target,!0):null;this.target=targetDesc?targetDesc.dom:null;var ref,selection=view.state.selection;(targetNode.type.spec.draggable&&!1!==targetNode.type.spec.selectable||selection instanceof index_es_NodeSelection&&selection.from<=targetPos&&selection.to>targetPos)&&(this.mightDrag={node:targetNode,pos:targetPos,addAttr:this.target&&!this.target.draggable,setUneditable:this.target&&result.gecko&&!this.target.hasAttribute("contentEditable")}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout((function(){this$1.view.mouseDown==this$1&&this$1.target.setAttribute("contentEditable","false")}),20),this.view.domObserver.start()),view.root.addEventListener("mouseup",this.up=this.up.bind(this)),view.root.addEventListener("mousemove",this.move=this.move.bind(this)),setSelectionOrigin(view,"pointer")};function inOrNearComposition(view,event){return!!view.composing||!!(result.safari&&Math.abs(event.timeStamp-view.compositionEndedAt)<500)&&(view.compositionEndedAt=-2e8,!0)}MouseDown.prototype.done=function done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.view.mouseDown=null},MouseDown.prototype.up=function up(event){if(this.done(),this.view.dom.contains(3==event.target.nodeType?event.target.parentNode:event.target)){var pos=this.pos;this.view.state.doc!=this.startDoc&&(pos=this.view.posAtCoords(eventCoords(event))),this.allowDefault||!pos?setSelectionOrigin(this.view,"pointer"):handleSingleClick(this.view,pos.pos,pos.inside,event,this.selectNode)?event.preventDefault():this.flushed||result.safari&&this.mightDrag&&!this.mightDrag.node.isAtom||result.chrome&&!(this.view.state.selection instanceof TextSelection)&&Math.min(Math.abs(pos.pos-this.view.state.selection.from),Math.abs(pos.pos-this.view.state.selection.to))<=2?(updateSelection(this.view,Selection.near(this.view.state.doc.resolve(pos.pos)),"pointer"),event.preventDefault()):setSelectionOrigin(this.view,"pointer")}},MouseDown.prototype.move=function move(event){!this.allowDefault&&(Math.abs(this.event.x-event.clientX)>4||Math.abs(this.event.y-event.clientY)>4)&&(this.allowDefault=!0),setSelectionOrigin(this.view,"pointer"),0==event.buttons&&this.done()},handlers.touchdown=function(view){forceDOMFlush(view),setSelectionOrigin(view,"pointer")},handlers.contextmenu=function(view){return forceDOMFlush(view)};var timeoutComposition=result.android?5e3:-1;function scheduleComposeEnd(view,delay){clearTimeout(view.composingTimeout),delay>-1&&(view.composingTimeout=setTimeout((function(){return endComposition(view)}),delay))}function clearComposition(view){for(view.composing=!1;view.compositionNodes.length>0;)view.compositionNodes.pop().markParentsDirty()}function endComposition(view,forceUpdate){if(view.domObserver.forceFlush(),clearComposition(view),forceUpdate||view.docView.dirty){var sel=selectionFromDOM(view);return sel&&!sel.eq(view.state.selection)?view.dispatch(view.state.tr.setSelection(sel)):view.updateState(view.state),!0}return!1}function captureCopy(view,dom){if(view.dom.parentNode){var wrap=view.dom.parentNode.appendChild(document.createElement("div"));wrap.appendChild(dom),wrap.style.cssText="position: fixed; left: -10000px; top: 10px";var sel=getSelection(),range=document.createRange();range.selectNodeContents(dom),view.dom.blur(),sel.removeAllRanges(),sel.addRange(range),setTimeout((function(){wrap.parentNode&&wrap.parentNode.removeChild(wrap),view.focus()}),50)}}editHandlers.compositionstart=editHandlers.compositionupdate=function(view){if(!view.composing){view.domObserver.flush();var state=view.state,$pos=state.selection.$from;if(state.selection.empty&&(state.storedMarks||!$pos.textOffset&&$pos.parentOffset&&$pos.nodeBefore.marks.some((function(m){return!1===m.type.spec.inclusive}))))view.markCursor=view.state.storedMarks||$pos.marks(),endComposition(view,!0),view.markCursor=null;else if(endComposition(view),result.gecko&&state.selection.empty&&$pos.parentOffset&&!$pos.textOffset&&$pos.nodeBefore.marks.length)for(var sel=view.root.getSelection(),node=sel.focusNode,offset=sel.focusOffset;node&&1==node.nodeType&&0!=offset;){var before=offset<0?node.lastChild:node.childNodes[offset-1];if(!before)break;if(3==before.nodeType){sel.collapse(before,before.nodeValue.length);break}node=before,offset=-1}view.composing=!0}scheduleComposeEnd(view,timeoutComposition)},editHandlers.compositionend=function(view,event){view.composing&&(view.composing=!1,view.compositionEndedAt=event.timeStamp,scheduleComposeEnd(view,20))};var brokenClipboardAPI=result.ie&&result.ie_version<15||result.ios&&result.webkit_version<604;function sliceSingleNode(slice){return 0==slice.openStart&&0==slice.openEnd&&1==slice.content.childCount?slice.content.firstChild:null}function capturePaste(view,e){if(view.dom.parentNode){var plainText=view.shiftKey||view.state.selection.$from.parent.type.spec.code,target=view.dom.parentNode.appendChild(document.createElement(plainText?"textarea":"div"));plainText||(target.contentEditable="true"),target.style.cssText="position: fixed; left: -10000px; top: 10px",target.focus(),setTimeout((function(){view.focus(),target.parentNode&&target.parentNode.removeChild(target),plainText?doPaste(view,target.value,null,e):doPaste(view,target.textContent,target.innerHTML,e)}),50)}}function doPaste(view,text,html,e){var slice=parseFromClipboard(view,text,html,view.shiftKey,view.state.selection.$from);if(view.someProp("handlePaste",(function(f){return f(view,e,slice||Slice.empty)})))return!0;if(!slice)return!1;var singleNode=sliceSingleNode(slice),tr=singleNode?view.state.tr.replaceSelectionWith(singleNode,view.shiftKey):view.state.tr.replaceSelection(slice);return view.dispatch(tr.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}handlers.copy=editHandlers.cut=function(view,e){var sel=view.state.selection,cut="cut"==e.type;if(!sel.empty){var data=brokenClipboardAPI?null:e.clipboardData,slice,ref=serializeForClipboard(view,sel.content()),dom=ref.dom,text=ref.text;data?(e.preventDefault(),data.clearData(),data.setData("text/html",dom.innerHTML),data.setData("text/plain",text)):captureCopy(view,dom),cut&&view.dispatch(view.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))}},editHandlers.paste=function(view,e){var data=brokenClipboardAPI?null:e.clipboardData;data&&doPaste(view,data.getData("text/plain"),data.getData("text/html"),e)?e.preventDefault():capturePaste(view,e)};var Dragging=function Dragging(slice,move){this.slice=slice,this.move=move},dragCopyModifier=result.mac?"altKey":"ctrlKey";for(var prop in handlers.dragstart=function(view,e){var mouseDown=view.mouseDown;if(mouseDown&&mouseDown.done(),e.dataTransfer){var sel=view.state.selection,pos=sel.empty?null:view.posAtCoords(eventCoords(e));if(pos&&pos.pos>=sel.from&&pos.pos<=(sel instanceof index_es_NodeSelection?sel.to-1:sel.to));else if(mouseDown&&mouseDown.mightDrag)view.dispatch(view.state.tr.setSelection(index_es_NodeSelection.create(view.state.doc,mouseDown.mightDrag.pos)));else if(e.target&&1==e.target.nodeType){var desc=view.docView.nearestDesc(e.target,!0);if(!desc||!desc.node.type.spec.draggable||desc==view.docView)return;view.dispatch(view.state.tr.setSelection(index_es_NodeSelection.create(view.state.doc,desc.posBefore)))}var slice=view.state.selection.content(),ref=serializeForClipboard(view,slice),dom=ref.dom,text=ref.text;e.dataTransfer.clearData(),e.dataTransfer.setData(brokenClipboardAPI?"Text":"text/html",dom.innerHTML),e.dataTransfer.effectAllowed="copyMove",brokenClipboardAPI||e.dataTransfer.setData("text/plain",text),view.dragging=new Dragging(slice,!e[dragCopyModifier])}},handlers.dragend=function(view){var dragging=view.dragging;window.setTimeout((function(){view.dragging==dragging&&(view.dragging=null)}),50)},editHandlers.dragover=editHandlers.dragenter=function(_,e){return e.preventDefault()},editHandlers.drop=function(view,e){var dragging=view.dragging;if(view.dragging=null,e.dataTransfer){var eventPos=view.posAtCoords(eventCoords(e));if(eventPos){var $mouse=view.state.doc.resolve(eventPos.pos);if($mouse){var slice=dragging&&dragging.slice;slice?view.someProp("transformPasted",(function(f){slice=f(slice)})):slice=parseFromClipboard(view,e.dataTransfer.getData(brokenClipboardAPI?"Text":"text/plain"),brokenClipboardAPI?null:e.dataTransfer.getData("text/html"),!1,$mouse);var move=dragging&&!e[dragCopyModifier];if(view.someProp("handleDrop",(function(f){return f(view,e,slice||Slice.empty,move)})))e.preventDefault();else if(slice){e.preventDefault();var insertPos=slice?dropPoint(view.state.doc,$mouse.pos,slice):$mouse.pos;null==insertPos&&(insertPos=$mouse.pos);var tr=view.state.tr;move&&tr.deleteSelection();var pos=tr.mapping.map(insertPos),isNode=0==slice.openStart&&0==slice.openEnd&&1==slice.content.childCount,beforeInsert=tr.doc;if(isNode?tr.replaceRangeWith(pos,pos,slice.content.firstChild):tr.replaceRange(pos,pos,slice),!tr.doc.eq(beforeInsert)){var $pos=tr.doc.resolve(pos);if(isNode&&index_es_NodeSelection.isSelectable(slice.content.firstChild)&&$pos.nodeAfter&&$pos.nodeAfter.sameMarkup(slice.content.firstChild))tr.setSelection(new index_es_NodeSelection($pos));else{var end=tr.mapping.map(insertPos);tr.mapping.maps[tr.mapping.maps.length-1].forEach((function(_from,_to,_newFrom,newTo){return end=newTo})),tr.setSelection(selectionBetween(view,$pos,tr.doc.resolve(end)))}view.focus(),view.dispatch(tr.setMeta("uiEvent","drop"))}}}}}},handlers.focus=function(view){view.focused||(view.domObserver.stop(),view.dom.classList.add("ProseMirror-focused"),view.domObserver.start(),view.focused=!0,setTimeout((function(){view.docView&&view.hasFocus()&&!view.domObserver.currentSelection.eq(view.root.getSelection())&&selectionToDOM(view)}),20))},handlers.blur=function(view){view.focused&&(view.domObserver.stop(),view.dom.classList.remove("ProseMirror-focused"),view.domObserver.start(),view.domObserver.currentSelection.set({}),view.focused=!1)},handlers.beforeinput=function(view,event){if(result.chrome&&result.android&&"deleteContentBackward"==event.inputType){var domChangeCount=view.domChangeCount;setTimeout((function(){if(view.domChangeCount==domChangeCount&&(view.dom.blur(),view.focus(),!view.someProp("handleKeyDown",(function(f){return f(view,keyEvent(8,"Backspace"))})))){var ref,$cursor=view.state.selection.$cursor;$cursor&&$cursor.pos>0&&view.dispatch(view.state.tr.delete($cursor.pos-1,$cursor.pos).scrollIntoView())}}),50)}},editHandlers)handlers[prop]=editHandlers[prop];function compareObjs(a,b){if(a==b)return!0;for(var p in a)if(a[p]!==b[p])return!1;for(var p$1 in b)if(!(p$1 in a))return!1;return!0}var WidgetType=function WidgetType(toDOM,spec){this.spec=spec||noSpec,this.side=this.spec.side||0,this.toDOM=toDOM};WidgetType.prototype.map=function map(mapping,span,offset,oldOffset){var ref=mapping.mapResult(span.from+oldOffset,this.side<0?-1:1),pos=ref.pos,deleted;return ref.deleted?null:new Decoration(pos-offset,pos-offset,this)},WidgetType.prototype.valid=function valid(){return!0},WidgetType.prototype.eq=function eq(other){return this==other||other instanceof WidgetType&&(this.spec.key&&this.spec.key==other.spec.key||this.toDOM==other.toDOM&&compareObjs(this.spec,other.spec))};var InlineType=function InlineType(attrs,spec){this.spec=spec||noSpec,this.attrs=attrs};InlineType.prototype.map=function map(mapping,span,offset,oldOffset){var from=mapping.map(span.from+oldOffset,this.spec.inclusiveStart?-1:1)-offset,to=mapping.map(span.to+oldOffset,this.spec.inclusiveEnd?1:-1)-offset;return from>=to?null:new Decoration(from,to,this)},InlineType.prototype.valid=function valid(_,span){return span.from<span.to},InlineType.prototype.eq=function eq(other){return this==other||other instanceof InlineType&&compareObjs(this.attrs,other.attrs)&&compareObjs(this.spec,other.spec)},InlineType.is=function is(span){return span.type instanceof InlineType};var index_es_NodeType=function NodeType(attrs,spec){this.spec=spec||noSpec,this.attrs=attrs};index_es_NodeType.prototype.map=function map(mapping,span,offset,oldOffset){var from=mapping.mapResult(span.from+oldOffset,1);if(from.deleted)return null;var to=mapping.mapResult(span.to+oldOffset,-1);return to.deleted||to.pos<=from.pos?null:new Decoration(from.pos-offset,to.pos-offset,this)},index_es_NodeType.prototype.valid=function valid(node,span){var ref=node.content.findIndex(span.from),index=ref.index,offset=ref.offset;return offset==span.from&&offset+node.child(index).nodeSize==span.to},index_es_NodeType.prototype.eq=function eq(other){return this==other||other instanceof index_es_NodeType&&compareObjs(this.attrs,other.attrs)&&compareObjs(this.spec,other.spec)};var Decoration=function Decoration(from,to,type){this.from=from,this.to=to,this.type=type},prosemirror_view_dist_index_es_prototypeAccessors$1={spec:{configurable:!0},inline:{configurable:!0}};Decoration.prototype.copy=function copy(from,to){return new Decoration(from,to,this.type)},Decoration.prototype.eq=function eq(other,offset){return void 0===offset&&(offset=0),this.type.eq(other.type)&&this.from+offset==other.from&&this.to+offset==other.to},Decoration.prototype.map=function map(mapping,offset,oldOffset){return this.type.map(mapping,this,offset,oldOffset)},Decoration.widget=function widget(pos,toDOM,spec){return new Decoration(pos,pos,new WidgetType(toDOM,spec))},Decoration.inline=function inline(from,to,attrs,spec){return new Decoration(from,to,new InlineType(attrs,spec))},Decoration.node=function node(from,to,attrs,spec){return new Decoration(from,to,new index_es_NodeType(attrs,spec))},prosemirror_view_dist_index_es_prototypeAccessors$1.spec.get=function(){return this.type.spec},prosemirror_view_dist_index_es_prototypeAccessors$1.inline.get=function(){return this.type instanceof InlineType},Object.defineProperties(Decoration.prototype,prosemirror_view_dist_index_es_prototypeAccessors$1);var none=[],noSpec={},DecorationSet=function DecorationSet(local,children){this.local=local&&local.length?local:none,this.children=children&&children.length?children:none};DecorationSet.create=function create(doc,decorations){return decorations.length?buildTree(decorations,doc,0,noSpec):empty},DecorationSet.prototype.find=function find(start,end,predicate){var result=[];return this.findInner(null==start?0:start,null==end?1e9:end,result,0,predicate),result},DecorationSet.prototype.findInner=function findInner(start,end,result,offset,predicate){for(var i=0;i<this.local.length;i++){var span=this.local[i];span.from<=end&&span.to>=start&&(!predicate||predicate(span.spec))&&result.push(span.copy(span.from+offset,span.to+offset))}for(var i$1=0;i$1<this.children.length;i$1+=3)if(this.children[i$1]<end&&this.children[i$1+1]>start){var childOff=this.children[i$1]+1;this.children[i$1+2].findInner(start-childOff,end-childOff,result,offset+childOff,predicate)}},DecorationSet.prototype.map=function map(mapping,doc,options){return this==empty||0==mapping.maps.length?this:this.mapInner(mapping,doc,0,0,options||noSpec)},DecorationSet.prototype.mapInner=function mapInner(mapping,node,offset,oldOffset,options){for(var newLocal,i=0;i<this.local.length;i++){var mapped=this.local[i].map(mapping,offset,oldOffset);mapped&&mapped.type.valid(node,mapped)?(newLocal||(newLocal=[])).push(mapped):options.onRemove&&options.onRemove(this.local[i].spec)}return this.children.length?mapChildren(this.children,newLocal,mapping,node,offset,oldOffset,options):newLocal?new DecorationSet(newLocal.sort(byPos)):empty},DecorationSet.prototype.add=function add(doc,decorations){return decorations.length?this==empty?DecorationSet.create(doc,decorations):this.addInner(doc,decorations,0):this},DecorationSet.prototype.addInner=function addInner(doc,decorations,offset){var this$1=this,children,childIndex=0;doc.forEach((function(childNode,childOffset){var baseOffset=childOffset+offset,found;if(found=takeSpansForNode(decorations,childNode,baseOffset)){for(children||(children=this$1.children.slice());childIndex<children.length&&children[childIndex]<childOffset;)childIndex+=3;children[childIndex]==childOffset?children[childIndex+2]=children[childIndex+2].addInner(childNode,found,baseOffset+1):children.splice(childIndex,0,childOffset,childOffset+childNode.nodeSize,buildTree(found,childNode,baseOffset+1,noSpec)),childIndex+=3}}));for(var local=moveSpans(childIndex?withoutNulls(decorations):decorations,-offset),i=0;i<local.length;i++)local[i].type.valid(doc,local[i])||local.splice(i--,1);return new DecorationSet(local.length?this.local.concat(local).sort(byPos):this.local,children||this.children)},DecorationSet.prototype.remove=function remove(decorations){return 0==decorations.length||this==empty?this:this.removeInner(decorations,0)},DecorationSet.prototype.removeInner=function removeInner(decorations,offset){for(var children=this.children,local=this.local,i=0;i<children.length;i+=3){for(var found=void 0,from=children[i]+offset,to=children[i+1]+offset,j=0,span=void 0;j<decorations.length;j++)(span=decorations[j])&&span.from>from&&span.to<to&&(decorations[j]=null,(found||(found=[])).push(span));if(found){children==this.children&&(children=this.children.slice());var removed=children[i+2].removeInner(found,from+1);removed!=empty?children[i+2]=removed:(children.splice(i,3),i-=3)}}if(local.length)for(var i$1=0,span$1=void 0;i$1<decorations.length;i$1++)if(span$1=decorations[i$1])for(var j$1=0;j$1<local.length;j$1++)local[j$1].eq(span$1,offset)&&(local==this.local&&(local=this.local.slice()),local.splice(j$1--,1));return children==this.children&&local==this.local?this:local.length||children.length?new DecorationSet(local,children):empty},DecorationSet.prototype.forChild=function forChild(offset,node){if(this==empty)return this;if(node.isLeaf)return DecorationSet.empty;for(var child,local,i=0;i<this.children.length;i+=3)if(this.children[i]>=offset){this.children[i]==offset&&(child=this.children[i+2]);break}for(var start=offset+1,end=start+node.content.size,i$1=0;i$1<this.local.length;i$1++){var dec=this.local[i$1];if(dec.from<end&&dec.to>start&&dec.type instanceof InlineType){var from=Math.max(start,dec.from)-start,to=Math.min(end,dec.to)-start;from<to&&(local||(local=[])).push(dec.copy(from,to))}}if(local){var localSet=new DecorationSet(local.sort(byPos));return child?new DecorationGroup([localSet,child]):localSet}return child||empty},DecorationSet.prototype.eq=function eq(other){if(this==other)return!0;if(!(other instanceof DecorationSet)||this.local.length!=other.local.length||this.children.length!=other.children.length)return!1;for(var i=0;i<this.local.length;i++)if(!this.local[i].eq(other.local[i]))return!1;for(var i$1=0;i$1<this.children.length;i$1+=3)if(this.children[i$1]!=other.children[i$1]||this.children[i$1+1]!=other.children[i$1+1]||!this.children[i$1+2].eq(other.children[i$1+2]))return!1;return!0},DecorationSet.prototype.locals=function locals(node){return removeOverlap(this.localsInner(node))},DecorationSet.prototype.localsInner=function localsInner(node){if(this==empty)return none;if(node.inlineContent||!this.local.some(InlineType.is))return this.local;for(var result=[],i=0;i<this.local.length;i++)this.local[i].type instanceof InlineType||result.push(this.local[i]);return result};var empty=new DecorationSet;DecorationSet.empty=empty,DecorationSet.removeOverlap=removeOverlap;var DecorationGroup=function DecorationGroup(members){this.members=members};function mapChildren(oldChildren,newLocal,mapping,node,offset,oldOffset,options){for(var children=oldChildren.slice(),shift=function(oldStart,oldEnd,newStart,newEnd){for(var i=0;i<children.length;i+=3){var end=children[i+1],dSize=void 0;-1==end||oldStart>end+oldOffset||(oldEnd>=children[i]+oldOffset?children[i+1]=-1:newStart>=offset&&(dSize=newEnd-newStart-(oldEnd-oldStart))&&(children[i]+=dSize,children[i+1]+=dSize))}},i=0;i<mapping.maps.length;i++)mapping.maps[i].forEach(shift);for(var mustRebuild=!1,i$1=0;i$1<children.length;i$1+=3)if(-1==children[i$1+1]){var from=mapping.map(oldChildren[i$1]+oldOffset),fromLocal=from-offset;if(fromLocal<0||fromLocal>=node.content.size){mustRebuild=!0;continue}var to,toLocal=mapping.map(oldChildren[i$1+1]+oldOffset,-1)-offset,ref=node.content.findIndex(fromLocal),index=ref.index,childOffset=ref.offset,childNode=node.maybeChild(index);if(childNode&&childOffset==fromLocal&&childOffset+childNode.nodeSize==toLocal){var mapped=children[i$1+2].mapInner(mapping,childNode,from+1,oldChildren[i$1]+oldOffset+1,options);mapped!=empty?(children[i$1]=fromLocal,children[i$1+1]=toLocal,children[i$1+2]=mapped):(children[i$1+1]=-2,mustRebuild=!0)}else mustRebuild=!0}if(mustRebuild){var decorations,built=buildTree(mapAndGatherRemainingDecorations(children,oldChildren,newLocal||[],mapping,offset,oldOffset,options),node,0,options);newLocal=built.local;for(var i$2=0;i$2<children.length;i$2+=3)children[i$2+1]<0&&(children.splice(i$2,3),i$2-=3);for(var i$3=0,j=0;i$3<built.children.length;i$3+=3){for(var from$1=built.children[i$3];j<children.length&&children[j]<from$1;)j+=3;children.splice(j,0,built.children[i$3],built.children[i$3+1],built.children[i$3+2])}}return new DecorationSet(newLocal&&newLocal.sort(byPos),children)}function moveSpans(spans,offset){if(!offset||!spans.length)return spans;for(var result=[],i=0;i<spans.length;i++){var span=spans[i];result.push(new Decoration(span.from+offset,span.to+offset,span.type))}return result}function mapAndGatherRemainingDecorations(children,oldChildren,decorations,mapping,offset,oldOffset,options){function gather(set,oldOffset){for(var i=0;i<set.local.length;i++){var mapped=set.local[i].map(mapping,offset,oldOffset);mapped?decorations.push(mapped):options.onRemove&&options.onRemove(set.local[i].spec)}for(var i$1=0;i$1<set.children.length;i$1+=3)gather(set.children[i$1+2],set.children[i$1]+oldOffset+1)}for(var i=0;i<children.length;i+=3)-1==children[i+1]&&gather(children[i+2],oldChildren[i]+oldOffset+1);return decorations}function takeSpansForNode(spans,node,offset){if(node.isLeaf)return null;for(var end=offset+node.nodeSize,found=null,i=0,span=void 0;i<spans.length;i++)(span=spans[i])&&span.from>offset&&span.to<end&&((found||(found=[])).push(span),spans[i]=null);return found}function withoutNulls(array){for(var result=[],i=0;i<array.length;i++)null!=array[i]&&result.push(array[i]);return result}function buildTree(spans,node,offset,options){var children=[],hasNulls=!1;node.forEach((function(childNode,localStart){var found=takeSpansForNode(spans,childNode,localStart+offset);if(found){hasNulls=!0;var subtree=buildTree(found,childNode,offset+localStart+1,options);subtree!=empty&&children.push(localStart,localStart+childNode.nodeSize,subtree)}}));for(var locals=moveSpans(hasNulls?withoutNulls(spans):spans,-offset).sort(byPos),i=0;i<locals.length;i++)locals[i].type.valid(node,locals[i])||(options.onRemove&&options.onRemove(locals[i].spec),locals.splice(i--,1));return locals.length||children.length?new DecorationSet(locals,children):empty}function byPos(a,b){return a.from-b.from||a.to-b.to}function removeOverlap(spans){for(var working=spans,i=0;i<working.length-1;i++){var span=working[i];if(span.from!=span.to)for(var j=i+1;j<working.length;j++){var next=working[j];if(next.from!=span.from){next.from<span.to&&(working==spans&&(working=spans.slice()),working[i]=span.copy(span.from,next.from),insertAhead(working,j,span.copy(next.from,span.to)));break}next.to!=span.to&&(working==spans&&(working=spans.slice()),working[j]=next.copy(next.from,span.to),insertAhead(working,j+1,next.copy(span.to,next.to)))}}return working}function insertAhead(array,i,deco){for(;i<array.length&&byPos(deco,array[i])>0;)i++;array.splice(i,0,deco)}function viewDecorations(view){var found=[];return view.someProp("decorations",(function(f){var result=f(view.state);result&&result!=empty&&found.push(result)})),view.cursorWrapper&&found.push(DecorationSet.create(view.state.doc,[view.cursorWrapper.deco])),DecorationGroup.from(found)}DecorationGroup.prototype.forChild=function forChild(offset,child){if(child.isLeaf)return DecorationSet.empty;for(var found=[],i=0;i<this.members.length;i++){var result=this.members[i].forChild(offset,child);result!=empty&&(result instanceof DecorationGroup?found=found.concat(result.members):found.push(result))}return DecorationGroup.from(found)},DecorationGroup.prototype.eq=function eq(other){if(!(other instanceof DecorationGroup)||other.members.length!=this.members.length)return!1;for(var i=0;i<this.members.length;i++)if(!this.members[i].eq(other.members[i]))return!1;return!0},DecorationGroup.prototype.locals=function locals(node){for(var result,sorted=!0,i=0;i<this.members.length;i++){var locals=this.members[i].localsInner(node);if(locals.length)if(result){sorted&&(result=result.slice(),sorted=!1);for(var j=0;j<locals.length;j++)result.push(locals[j])}else result=locals}return result?removeOverlap(sorted?result:result.sort(byPos)):none},DecorationGroup.from=function from(members){switch(members.length){case 0:return empty;case 1:return members[0];default:return new DecorationGroup(members)}};var EditorView=function EditorView(place,props){this._props=props,this.state=props.state,this.dispatch=this.dispatch.bind(this),this._root=null,this.focused=!1,this.trackWrites=null,this.dom=place&&place.mount||document.createElement("div"),place&&(place.appendChild?place.appendChild(this.dom):place.apply?place(this.dom):place.mount&&(this.mounted=!0)),this.editable=getEditable(this),this.markCursor=null,this.cursorWrapper=null,updateCursorWrapper(this),this.nodeViews=buildNodeViews(this),this.docView=docViewDesc(this.state.doc,computeDocDeco(this),viewDecorations(this),this.dom,this),this.lastSelectedViewDesc=null,this.dragging=null,initInput(this),this.pluginViews=[],this.updatePluginViews()},index_es_prototypeAccessors$2={props:{configurable:!0},root:{configurable:!0}};function computeDocDeco(view){var attrs=Object.create(null);return attrs.class="ProseMirror",attrs.contenteditable=String(view.editable),view.someProp("attributes",(function(value){if("function"==typeof value&&(value=value(view.state)),value)for(var attr in value)"class"==attr?attrs.class+=" "+value[attr]:attrs[attr]||"contenteditable"==attr||"nodeName"==attr||(attrs[attr]=String(value[attr]))})),[Decoration.node(0,view.state.doc.content.size,attrs)]}function updateCursorWrapper(view){if(view.markCursor){var dom=document.createElement("img");dom.setAttribute("mark-placeholder","true"),view.cursorWrapper={dom:dom,deco:Decoration.widget(view.state.selection.head,dom,{raw:!0,marks:view.markCursor})}}else view.cursorWrapper=null}function getEditable(view){return!view.someProp("editable",(function(value){return!1===value(view.state)}))}function selectionContextChanged(sel1,sel2){var depth=Math.min(sel1.$anchor.sharedDepth(sel1.head),sel2.$anchor.sharedDepth(sel2.head));return sel1.$anchor.start(depth)!=sel2.$anchor.start(depth)}function buildNodeViews(view){var result={};return view.someProp("nodeViews",(function(obj){for(var prop in obj)Object.prototype.hasOwnProperty.call(result,prop)||(result[prop]=obj[prop])})),result}function changedNodeViews(a,b){var nA=0,nB=0;for(var prop in a){if(a[prop]!=b[prop])return!0;nA++}for(var _ in b)nB++;return nA!=nB}index_es_prototypeAccessors$2.props.get=function(){if(this._props.state!=this.state){var prev=this._props;for(var name in this._props={},prev)this._props[name]=prev[name];this._props.state=this.state}return this._props},EditorView.prototype.update=function update(props){props.handleDOMEvents!=this._props.handleDOMEvents&&ensureListeners(this),this._props=props,this.updateStateInner(props.state,!0)},EditorView.prototype.setProps=function setProps(props){var updated={};for(var name in this._props)updated[name]=this._props[name];for(var name$1 in updated.state=this.state,props)updated[name$1]=props[name$1];this.update(updated)},EditorView.prototype.updateState=function updateState(state){this.updateStateInner(state,this.state.plugins!=state.plugins)},EditorView.prototype.updateStateInner=function updateStateInner(state,reconfigured){var this$1=this,prev=this.state,redraw=!1,updateSel=!1;if(state.storedMarks&&this.composing&&(clearComposition(this),updateSel=!0),this.state=state,reconfigured){var nodeViews=buildNodeViews(this);changedNodeViews(nodeViews,this.nodeViews)&&(this.nodeViews=nodeViews,redraw=!0),ensureListeners(this)}this.editable=getEditable(this),updateCursorWrapper(this);var innerDeco=viewDecorations(this),outerDeco=computeDocDeco(this),scroll=reconfigured?"reset":state.scrollToSelection>prev.scrollToSelection?"to selection":"preserve",updateDoc=redraw||!this.docView.matchesNode(state.doc,outerDeco,innerDeco);!updateDoc&&state.selection.eq(prev.selection)||(updateSel=!0);var oldScrollPos="preserve"==scroll&&updateSel&&null==this.dom.style.overflowAnchor&&storeScrollPos(this);if(updateSel){this.domObserver.stop();var forceSelUpdate=updateDoc&&(result.ie||result.chrome)&&!this.composing&&!prev.selection.empty&&!state.selection.empty&&selectionContextChanged(prev.selection,state.selection);if(updateDoc){var chromeKludge=result.chrome?this.trackWrites=this.root.getSelection().focusNode:null;!redraw&&this.docView.update(state.doc,outerDeco,innerDeco,this)||(this.docView.updateOuterDeco([]),this.docView.destroy(),this.docView=docViewDesc(state.doc,outerDeco,innerDeco,this.dom,this)),chromeKludge&&!this.trackWrites&&(forceSelUpdate=!0)}forceSelUpdate||!(this.mouseDown&&this.domObserver.currentSelection.eq(this.root.getSelection())&&anchorInRightPlace(this))?selectionToDOM(this,forceSelUpdate):(syncNodeSelection(this,state.selection),this.domObserver.setCurSelection()),this.domObserver.start()}if(this.updatePluginViews(prev),"reset"==scroll)this.dom.scrollTop=0;else if("to selection"==scroll){var startDOM=this.root.getSelection().focusNode;this.someProp("handleScrollToSelection",(function(f){return f(this$1)}))||(state.selection instanceof index_es_NodeSelection?scrollRectIntoView(this,this.docView.domAfterPos(state.selection.from).getBoundingClientRect(),startDOM):scrollRectIntoView(this,this.coordsAtPos(state.selection.head,1),startDOM))}else oldScrollPos&&resetScrollPos(oldScrollPos)},EditorView.prototype.destroyPluginViews=function destroyPluginViews(){for(var view;view=this.pluginViews.pop();)view.destroy&&view.destroy()},EditorView.prototype.updatePluginViews=function updatePluginViews(prevState){if(prevState&&prevState.plugins==this.state.plugins)for(var i$1=0;i$1<this.pluginViews.length;i$1++){var pluginView=this.pluginViews[i$1];pluginView.update&&pluginView.update(this,prevState)}else{this.destroyPluginViews();for(var i=0;i<this.state.plugins.length;i++){var plugin=this.state.plugins[i];plugin.spec.view&&this.pluginViews.push(plugin.spec.view(this))}}},EditorView.prototype.someProp=function someProp(propName,f){var prop=this._props&&this._props[propName],value;if(null!=prop&&(value=f?f(prop):prop))return value;var plugins=this.state.plugins;if(plugins)for(var i=0;i<plugins.length;i++){var prop$1=plugins[i].props[propName];if(null!=prop$1&&(value=f?f(prop$1):prop$1))return value}},EditorView.prototype.hasFocus=function hasFocus(){return this.root.activeElement==this.dom},EditorView.prototype.focus=function focus(){this.domObserver.stop(),this.editable&&focusPreventScroll(this.dom),selectionToDOM(this),this.domObserver.start()},index_es_prototypeAccessors$2.root.get=function(){var cached=this._root;if(null==cached)for(var search=this.dom.parentNode;search;search=search.parentNode)if(9==search.nodeType||11==search.nodeType&&search.host)return search.getSelection||(Object.getPrototypeOf(search).getSelection=function(){return document.getSelection()}),this._root=search;return cached||document},EditorView.prototype.posAtCoords=function posAtCoords$1(coords){return posAtCoords(this,coords)},EditorView.prototype.coordsAtPos=function coordsAtPos$1(pos,side){return void 0===side&&(side=1),coordsAtPos(this,pos,side)},EditorView.prototype.domAtPos=function domAtPos(pos,side){return void 0===side&&(side=0),this.docView.domFromPos(pos,side)},EditorView.prototype.nodeDOM=function nodeDOM(pos){var desc=this.docView.descAt(pos);return desc?desc.nodeDOM:null},EditorView.prototype.posAtDOM=function posAtDOM(node,offset,bias){void 0===bias&&(bias=-1);var pos=this.docView.posFromDOM(node,offset,bias);if(null==pos)throw new RangeError("DOM position not inside the editor");return pos},EditorView.prototype.endOfTextblock=function endOfTextblock$1(dir,state){return endOfTextblock(this,state||this.state,dir)},EditorView.prototype.destroy=function destroy(){this.docView&&(destroyInput(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],viewDecorations(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null)},EditorView.prototype.dispatchEvent=function dispatchEvent$1(event){return dispatchEvent(this,event)},EditorView.prototype.dispatch=function dispatch(tr){var dispatchTransaction=this._props.dispatchTransaction;dispatchTransaction?dispatchTransaction.call(this,tr):this.updateState(this.state.apply(tr))},Object.defineProperties(EditorView.prototype,index_es_prototypeAccessors$2);for(var base={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",229:"q"},shift={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"',229:"Q"},index_es_chrome="undefined"!=typeof navigator&&/Chrome\/(\d+)/.exec(navigator.userAgent),safari="undefined"!=typeof navigator&&/Apple Computer/.test(navigator.vendor),gecko="undefined"!=typeof navigator&&/Gecko\/\d+/.test(navigator.userAgent),mac="undefined"!=typeof navigator&&/Mac/.test(navigator.platform),index_es_ie="undefined"!=typeof navigator&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),brokenModifierNames=index_es_chrome&&(mac||+index_es_chrome[1]<57)||gecko&&mac,i=0;i<10;i++)base[48+i]=base[96+i]=String(i);for(var i=1;i<=24;i++)base[i+111]="F"+i;for(var i=65;i<=90;i++)base[i]=String.fromCharCode(i+32),shift[i]=String.fromCharCode(i);for(var code in base)shift.hasOwnProperty(code)||(shift[code]=base[code]);function keyName(event){var ignoreKey,name=!(brokenModifierNames&&(event.ctrlKey||event.altKey||event.metaKey)||(safari||index_es_ie)&&event.shiftKey&&event.key&&1==event.key.length)&&event.key||(event.shiftKey?shift:base)[event.keyCode]||event.key||"Unidentified";return"Esc"==name&&(name="Escape"),"Del"==name&&(name="Delete"),"Left"==name&&(name="ArrowLeft"),"Up"==name&&(name="ArrowUp"),"Right"==name&&(name="ArrowRight"),"Down"==name&&(name="ArrowDown"),name}var index_es_mac="undefined"!=typeof navigator&&/Mac/.test(navigator.platform);function normalizeKeyName(name){var parts=name.split(/-(?!$)/),result=parts[parts.length-1],alt,ctrl,shift,meta;"Space"==result&&(result=" ");for(var i=0;i<parts.length-1;i++){var mod=parts[i];if(/^(cmd|meta|m)$/i.test(mod))meta=!0;else if(/^a(lt)?$/i.test(mod))alt=!0;else if(/^(c|ctrl|control)$/i.test(mod))ctrl=!0;else if(/^s(hift)?$/i.test(mod))shift=!0;else{if(!/^mod$/i.test(mod))throw new Error("Unrecognized modifier name: "+mod);index_es_mac?meta=!0:ctrl=!0}}return alt&&(result="Alt-"+result),ctrl&&(result="Ctrl-"+result),meta&&(result="Meta-"+result),shift&&(result="Shift-"+result),result}function normalize(map){var copy=Object.create(null);for(var prop in map)copy[normalizeKeyName(prop)]=map[prop];return copy}function modifiers(name,event,shift){return event.altKey&&(name="Alt-"+name),event.ctrlKey&&(name="Ctrl-"+name),event.metaKey&&(name="Meta-"+name),!1!==shift&&event.shiftKey&&(name="Shift-"+name),name}function keymap(bindings){return new Plugin({props:{handleKeyDown:keydownHandler(bindings)}})}function keydownHandler(bindings){var map=normalize(bindings);return function(view,event){var name=keyName(event),isChar=1==name.length&&" "!=name,baseName,direct=map[modifiers(name,event,!isChar)];if(direct&&direct(view.state,view.dispatch,view))return!0;if(isChar&&(event.shiftKey||event.altKey||event.metaKey||name.charCodeAt(0)>127)&&(baseName=base[event.keyCode])&&baseName!=name){var fromCode=map[modifiers(baseName,event,!0)];if(fromCode&&fromCode(view.state,view.dispatch,view))return!0}else if(isChar&&event.shiftKey){var withShift=map[modifiers(name,event,!0)];if(withShift&&withShift(view.state,view.dispatch,view))return!0}return!1}}function deleteSelection(state,dispatch){return!state.selection.empty&&(dispatch&&dispatch(state.tr.deleteSelection().scrollIntoView()),!0)}function joinBackward(state,dispatch,view){var ref,$cursor=state.selection.$cursor;if(!$cursor||(view?!view.endOfTextblock("backward",state):$cursor.parentOffset>0))return!1;var $cut=findCutBefore($cursor);if(!$cut){var range=$cursor.blockRange(),target=range&&index_es_liftTarget(range);return null!=target&&(dispatch&&dispatch(state.tr.lift(range,target).scrollIntoView()),!0)}var before=$cut.nodeBefore;if(!before.type.spec.isolating&&deleteBarrier(state,$cut,dispatch))return!0;if(0==$cursor.parent.content.size&&(textblockAt(before,"end")||index_es_NodeSelection.isSelectable(before))){if(dispatch){var tr=state.tr.deleteRange($cursor.before(),$cursor.after());tr.setSelection(textblockAt(before,"end")?Selection.findFrom(tr.doc.resolve(tr.mapping.map($cut.pos,-1)),-1):index_es_NodeSelection.create(tr.doc,$cut.pos-before.nodeSize)),dispatch(tr.scrollIntoView())}return!0}return!(!before.isAtom||$cut.depth!=$cursor.depth-1)&&(dispatch&&dispatch(state.tr.delete($cut.pos-before.nodeSize,$cut.pos).scrollIntoView()),!0)}function textblockAt(node,side){for(;node;node="start"==side?node.firstChild:node.lastChild)if(node.isTextblock)return!0;return!1}function selectNodeBackward(state,dispatch,view){var ref=state.selection,$head=ref.$head,empty,$cut=$head;if(!ref.empty)return!1;if($head.parent.isTextblock){if(view?!view.endOfTextblock("backward",state):$head.parentOffset>0)return!1;$cut=findCutBefore($head)}var node=$cut&&$cut.nodeBefore;return!(!node||!index_es_NodeSelection.isSelectable(node))&&(dispatch&&dispatch(state.tr.setSelection(index_es_NodeSelection.create(state.doc,$cut.pos-node.nodeSize)).scrollIntoView()),!0)}function findCutBefore($pos){if(!$pos.parent.type.spec.isolating)for(var i=$pos.depth-1;i>=0;i--){if($pos.index(i)>0)return $pos.doc.resolve($pos.before(i+1));if($pos.node(i).type.spec.isolating)break}return null}function joinForward(state,dispatch,view){var ref,$cursor=state.selection.$cursor;if(!$cursor||(view?!view.endOfTextblock("forward",state):$cursor.parentOffset<$cursor.parent.content.size))return!1;var $cut=findCutAfter($cursor);if(!$cut)return!1;var after=$cut.nodeAfter;if(deleteBarrier(state,$cut,dispatch))return!0;if(0==$cursor.parent.content.size&&(textblockAt(after,"start")||index_es_NodeSelection.isSelectable(after))){if(dispatch){var tr=state.tr.deleteRange($cursor.before(),$cursor.after());tr.setSelection(textblockAt(after,"start")?Selection.findFrom(tr.doc.resolve(tr.mapping.map($cut.pos)),1):index_es_NodeSelection.create(tr.doc,tr.mapping.map($cut.pos))),dispatch(tr.scrollIntoView())}return!0}return!(!after.isAtom||$cut.depth!=$cursor.depth-1)&&(dispatch&&dispatch(state.tr.delete($cut.pos,$cut.pos+after.nodeSize).scrollIntoView()),!0)}function selectNodeForward(state,dispatch,view){var ref=state.selection,$head=ref.$head,empty,$cut=$head;if(!ref.empty)return!1;if($head.parent.isTextblock){if(view?!view.endOfTextblock("forward",state):$head.parentOffset<$head.parent.content.size)return!1;$cut=findCutAfter($head)}var node=$cut&&$cut.nodeAfter;return!(!node||!index_es_NodeSelection.isSelectable(node))&&(dispatch&&dispatch(state.tr.setSelection(index_es_NodeSelection.create(state.doc,$cut.pos)).scrollIntoView()),!0)}function findCutAfter($pos){if(!$pos.parent.type.spec.isolating)for(var i=$pos.depth-1;i>=0;i--){var parent=$pos.node(i);if($pos.index(i)+1<parent.childCount)return $pos.doc.resolve($pos.after(i+1));if(parent.type.spec.isolating)break}return null}function joinUp(state,dispatch){var sel=state.selection,nodeSel=sel instanceof NodeSelection,point;if(nodeSel){if(sel.node.isTextblock||!canJoin(state.doc,sel.from))return!1;point=sel.from}else if(null==(point=joinPoint(state.doc,sel.from,-1)))return!1;if(dispatch){var tr=state.tr.join(point);nodeSel&&tr.setSelection(NodeSelection.create(tr.doc,point-state.doc.resolve(point).nodeBefore.nodeSize)),dispatch(tr.scrollIntoView())}return!0}function joinDown(state,dispatch){var sel=state.selection,point;if(sel instanceof NodeSelection){if(sel.node.isTextblock||!canJoin(state.doc,sel.to))return!1;point=sel.to}else if(null==(point=joinPoint(state.doc,sel.to,1)))return!1;return dispatch&&dispatch(state.tr.join(point).scrollIntoView()),!0}function lift(state,dispatch){var ref=state.selection,$from=ref.$from,$to=ref.$to,range=$from.blockRange($to),target=range&&liftTarget(range);return null!=target&&(dispatch&&dispatch(state.tr.lift(range,target).scrollIntoView()),!0)}function newlineInCode(state,dispatch){var ref=state.selection,$head=ref.$head,$anchor=ref.$anchor;return!(!$head.parent.type.spec.code||!$head.sameParent($anchor))&&(dispatch&&dispatch(state.tr.insertText("\n").scrollIntoView()),!0)}function defaultBlockAt(match){for(var i=0;i<match.edgeCount;i++){var ref,type=match.edge(i).type;if(type.isTextblock&&!type.hasRequiredAttrs())return type}return null}function exitCode(state,dispatch){var ref=state.selection,$head=ref.$head,$anchor=ref.$anchor;if(!$head.parent.type.spec.code||!$head.sameParent($anchor))return!1;var above=$head.node(-1),after=$head.indexAfter(-1),type=defaultBlockAt(above.contentMatchAt(after));if(!above.canReplaceWith(after,after,type))return!1;if(dispatch){var pos=$head.after(),tr=state.tr.replaceWith(pos,pos,type.createAndFill());tr.setSelection(Selection.near(tr.doc.resolve(pos),1)),dispatch(tr.scrollIntoView())}return!0}function createParagraphNear(state,dispatch){var sel=state.selection,$from=sel.$from,$to=sel.$to;if(sel instanceof AllSelection||$from.parent.inlineContent||$to.parent.inlineContent)return!1;var type=defaultBlockAt($to.parent.contentMatchAt($to.indexAfter()));if(!type||!type.isTextblock)return!1;if(dispatch){var side=(!$from.parentOffset&&$to.index()<$to.parent.childCount?$from:$to).pos,tr=state.tr.insert(side,type.createAndFill());tr.setSelection(TextSelection.create(tr.doc,side+1)),dispatch(tr.scrollIntoView())}return!0}function liftEmptyBlock(state,dispatch){var ref,$cursor=state.selection.$cursor;if(!$cursor||$cursor.parent.content.size)return!1;if($cursor.depth>1&&$cursor.after()!=$cursor.end(-1)){var before=$cursor.before();if(canSplit(state.doc,before))return dispatch&&dispatch(state.tr.split(before).scrollIntoView()),!0}var range=$cursor.blockRange(),target=range&&index_es_liftTarget(range);return null!=target&&(dispatch&&dispatch(state.tr.lift(range,target).scrollIntoView()),!0)}function splitBlock(state,dispatch){var ref=state.selection,$from=ref.$from,$to=ref.$to;if(state.selection instanceof index_es_NodeSelection&&state.selection.node.isBlock)return!(!$from.parentOffset||!canSplit(state.doc,$from.pos))&&(dispatch&&dispatch(state.tr.split($from.pos).scrollIntoView()),!0);if(!$from.parent.isBlock)return!1;if(dispatch){var atEnd=$to.parentOffset==$to.parent.content.size,tr=state.tr;(state.selection instanceof TextSelection||state.selection instanceof AllSelection)&&tr.deleteSelection();var deflt=0==$from.depth?null:defaultBlockAt($from.node(-1).contentMatchAt($from.indexAfter(-1))),types=atEnd&&deflt?[{type:deflt}]:null,can=canSplit(tr.doc,tr.mapping.map($from.pos),1,types);if(types||can||!canSplit(tr.doc,tr.mapping.map($from.pos),1,deflt&&[{type:deflt}])||(types=[{type:deflt}],can=!0),can&&(tr.split(tr.mapping.map($from.pos),1,types),!atEnd&&!$from.parentOffset&&$from.parent.type!=deflt)){var first=tr.mapping.map($from.before()),$first=tr.doc.resolve(first);$from.node(-1).canReplaceWith($first.index(),$first.index()+1,deflt)&&tr.setNodeMarkup(tr.mapping.map($from.before()),deflt)}dispatch(tr.scrollIntoView())}return!0}function splitBlockKeepMarks(state,dispatch){return splitBlock(state,dispatch&&function(tr){var marks=state.storedMarks||state.selection.$to.parentOffset&&state.selection.$from.marks();marks&&tr.ensureMarks(marks),dispatch(tr)})}function selectParentNode(state,dispatch){var ref=state.selection,$from=ref.$from,to=ref.to,pos,same=$from.sharedDepth(to);return 0!=same&&(pos=$from.before(same),dispatch&&dispatch(state.tr.setSelection(NodeSelection.create(state.doc,pos))),!0)}function selectAll(state,dispatch){return dispatch&&dispatch(state.tr.setSelection(new AllSelection(state.doc))),!0}function joinMaybeClear(state,$pos,dispatch){var before=$pos.nodeBefore,after=$pos.nodeAfter,index=$pos.index();return!!(before&&after&&before.type.compatibleContent(after.type))&&(!before.content.size&&$pos.parent.canReplace(index-1,index)?(dispatch&&dispatch(state.tr.delete($pos.pos-before.nodeSize,$pos.pos).scrollIntoView()),!0):!(!$pos.parent.canReplace(index,index+1)||!after.isTextblock&&!index_es_canJoin(state.doc,$pos.pos))&&(dispatch&&dispatch(state.tr.clearIncompatible($pos.pos,before.type,before.contentMatchAt(before.childCount)).join($pos.pos).scrollIntoView()),!0))}function deleteBarrier(state,$cut,dispatch){var before=$cut.nodeBefore,after=$cut.nodeAfter,conn,match;if(before.type.spec.isolating||after.type.spec.isolating)return!1;if(joinMaybeClear(state,$cut,dispatch))return!0;var canDelAfter=$cut.parent.canReplace($cut.index(),$cut.index()+1);if(canDelAfter&&(conn=(match=before.contentMatchAt(before.childCount)).findWrapping(after.type))&&match.matchType(conn[0]||after.type).validEnd){if(dispatch){for(var end=$cut.pos+after.nodeSize,wrap=Fragment.empty,i=conn.length-1;i>=0;i--)wrap=Fragment.from(conn[i].create(null,wrap));wrap=Fragment.from(before.copy(wrap));var tr=state.tr.step(new ReplaceAroundStep($cut.pos-1,end,$cut.pos,end,new Slice(wrap,1,0),conn.length,!0)),joinAt=end+2*conn.length;index_es_canJoin(tr.doc,joinAt)&&tr.join(joinAt),dispatch(tr.scrollIntoView())}return!0}var selAfter=Selection.findFrom($cut,1),range=selAfter&&selAfter.$from.blockRange(selAfter.$to),target=range&&index_es_liftTarget(range);if(null!=target&&target>=$cut.depth)return dispatch&&dispatch(state.tr.lift(range,target).scrollIntoView()),!0;if(canDelAfter&&after.isTextblock&&textblockAt(before,"end")){for(var at=before,wrap$1=[];wrap$1.push(at),!at.isTextblock;)at=at.lastChild;if(at.canReplace(at.childCount,at.childCount,after.content)){if(dispatch){for(var end$1=Fragment.empty,i$1=wrap$1.length-1;i$1>=0;i$1--)end$1=Fragment.from(wrap$1[i$1].copy(end$1));var tr$1;dispatch(state.tr.step(new ReplaceAroundStep($cut.pos-wrap$1.length,$cut.pos+after.nodeSize,$cut.pos+1,$cut.pos+after.nodeSize-1,new Slice(end$1,wrap$1.length,0),0,!0)).scrollIntoView())}return!0}}return!1}function wrapIn(nodeType,attrs){return function(state,dispatch){var ref=state.selection,$from=ref.$from,$to=ref.$to,range=$from.blockRange($to),wrapping=range&&index_es_findWrapping(range,nodeType,attrs);return!!wrapping&&(dispatch&&dispatch(state.tr.wrap(range,wrapping).scrollIntoView()),!0)}}function setBlockType(nodeType,attrs){return function(state,dispatch){var ref=state.selection,from=ref.from,to=ref.to,applicable=!1;return state.doc.nodesBetween(from,to,(function(node,pos){if(applicable)return!1;if(node.isTextblock&&!node.hasMarkup(nodeType,attrs))if(node.type==nodeType)applicable=!0;else{var $pos=state.doc.resolve(pos),index=$pos.index();applicable=$pos.parent.canReplaceWith(index,index+1,nodeType)}})),!!applicable&&(dispatch&&dispatch(state.tr.setBlockType(from,to,nodeType,attrs).scrollIntoView()),!0)}}function markApplies(doc,ranges,type){for(var loop=function(i){var ref=ranges[i],$from=ref.$from,$to=ref.$to,can=0==$from.depth&&doc.type.allowsMarkType(type);if(doc.nodesBetween($from.pos,$to.pos,(function(node){if(can)return!1;can=node.inlineContent&&node.type.allowsMarkType(type)})),can)return{v:!0}},i=0;i<ranges.length;i++){var returned=loop(i);if(returned)return returned.v}return!1}function toggleMark(markType,attrs){return function(state,dispatch){var ref=state.selection,empty=ref.empty,$cursor=ref.$cursor,ranges=ref.ranges;if(empty&&!$cursor||!markApplies(state.doc,ranges,markType))return!1;if(dispatch)if($cursor)markType.isInSet(state.storedMarks||$cursor.marks())?dispatch(state.tr.removeStoredMark(markType)):dispatch(state.tr.addStoredMark(markType.create(attrs)));else{for(var has=!1,tr=state.tr,i=0;!has&&i<ranges.length;i++){var ref$1=ranges[i],$from=ref$1.$from,$to=ref$1.$to;has=state.doc.rangeHasMark($from.pos,$to.pos,markType)}for(var i$1=0;i$1<ranges.length;i$1++){var ref$2=ranges[i$1],$from$1=ref$2.$from,$to$1=ref$2.$to;if(has)tr.removeMark($from$1.pos,$to$1.pos,markType);else{var from=$from$1.pos,to=$to$1.pos,start=$from$1.nodeAfter,end=$to$1.nodeBefore,spaceStart=start&&start.isText?/^\s*/.exec(start.text)[0].length:0,spaceEnd=end&&end.isText?/\s*$/.exec(end.text)[0].length:0;from+spaceStart<to&&(from+=spaceStart,to-=spaceEnd),tr.addMark(from,to,markType.create(attrs))}}dispatch(tr.scrollIntoView())}return!0}}function wrapDispatchForJoin(dispatch,isJoinable){return function(tr){if(!tr.isGeneric)return dispatch(tr);for(var ranges=[],i=0;i<tr.mapping.maps.length;i++){for(var map=tr.mapping.maps[i],j=0;j<ranges.length;j++)ranges[j]=map.map(ranges[j]);map.forEach((function(_s,_e,from,to){return ranges.push(from,to)}))}for(var joinable=[],i$1=0;i$1<ranges.length;i$1+=2)for(var from=ranges[i$1],to=ranges[i$1+1],$from=tr.doc.resolve(from),depth=$from.sharedDepth(to),parent=$from.node(depth),index=$from.indexAfter(depth),pos=$from.after(depth+1);pos<=to;++index){var after=parent.maybeChild(index);if(!after)break;if(index&&-1==joinable.indexOf(pos)){var before=parent.child(index-1);before.type==after.type&&isJoinable(before,after)&&joinable.push(pos)}pos+=after.nodeSize}joinable.sort((function(a,b){return a-b}));for(var i$2=joinable.length-1;i$2>=0;i$2--)canJoin(tr.doc,joinable[i$2])&&tr.join(joinable[i$2]);dispatch(tr)}}function autoJoin(command,isJoinable){if(Array.isArray(isJoinable)){var types=isJoinable;isJoinable=function(node){return types.indexOf(node.type.name)>-1}}return function(state,dispatch){return command(state,dispatch&&wrapDispatchForJoin(dispatch,isJoinable))}}function chainCommands(){for(var commands=[],len=arguments.length;len--;)commands[len]=arguments[len];return function(state,dispatch,view){for(var i=0;i<commands.length;i++)if(commands[i](state,dispatch,view))return!0;return!1}}var backspace=chainCommands(deleteSelection,joinBackward,selectNodeBackward),del=chainCommands(deleteSelection,joinForward,selectNodeForward),pcBaseKeymap={Enter:chainCommands(newlineInCode,createParagraphNear,liftEmptyBlock,splitBlock),"Mod-Enter":exitCode,Backspace:backspace,"Mod-Backspace":backspace,Delete:del,"Mod-Delete":del,"Mod-a":selectAll},macBaseKeymap={"Ctrl-h":pcBaseKeymap.Backspace,"Alt-Backspace":pcBaseKeymap["Mod-Backspace"],"Ctrl-d":pcBaseKeymap.Delete,"Ctrl-Alt-Backspace":pcBaseKeymap["Mod-Delete"],"Alt-Delete":pcBaseKeymap["Mod-Delete"],"Alt-d":pcBaseKeymap["Mod-Delete"]};for(var key in pcBaseKeymap)macBaseKeymap[key]=pcBaseKeymap[key];var dist_index_es_mac,baseKeymap=("undefined"!=typeof navigator?/Mac/.test(navigator.platform):"undefined"!=typeof os&&"darwin"==os.platform())?macBaseKeymap:pcBaseKeymap,InputRule=function InputRule(match,handler){this.match=match,this.handler="string"==typeof handler?stringHandler(handler):handler};function stringHandler(string){return function(state,match,start,end){var insert=string;if(match[1]){var offset=match[0].lastIndexOf(match[1]);insert+=match[0].slice(offset+match[1].length);var cutOff=(start+=offset)-end;cutOff>0&&(insert=match[0].slice(offset-cutOff,offset)+insert,start=end)}return state.tr.insertText(insert,start,end)}}var MAX_MATCH=500;function inputRules(ref){var rules=ref.rules,plugin=new Plugin({state:{init:function init(){return null},apply:function apply(tr,prev){var stored=tr.getMeta(this);return stored||(tr.selectionSet||tr.docChanged?null:prev)}},props:{handleTextInput:function handleTextInput(view,from,to,text){return run(view,from,to,text,rules,plugin)},handleDOMEvents:{compositionend:function(view){setTimeout((function(){var ref,$cursor=view.state.selection.$cursor;$cursor&&run(view,$cursor.pos,$cursor.pos,"",rules,plugin)}))}}},isInputRules:!0});return plugin}function run(view,from,to,text,rules,plugin){if(view.composing)return!1;var state=view.state,$from=state.doc.resolve(from);if($from.parent.type.spec.code)return!1;for(var textBefore=$from.parent.textBetween(Math.max(0,$from.parentOffset-500),$from.parentOffset,null,"￼")+text,i=0;i<rules.length;i++){var match=rules[i].match.exec(textBefore),tr=match&&rules[i].handler(state,match,from-(match[0].length-text.length),to);if(tr)return view.dispatch(tr.setMeta(plugin,{transform:tr,from:from,to:to,text:text})),!0}return!1}function undoInputRule(state,dispatch){for(var plugins=state.plugins,i=0;i<plugins.length;i++){var plugin=plugins[i],undoable=void 0;if(plugin.spec.isInputRules&&(undoable=plugin.getState(state))){if(dispatch){for(var tr=state.tr,toUndo=undoable.transform,j=toUndo.steps.length-1;j>=0;j--)tr.step(toUndo.steps[j].invert(toUndo.docs[j]));if(undoable.text){var marks=tr.doc.resolve(undoable.from).marks();tr.replaceWith(undoable.from,undoable.to,state.schema.text(undoable.text,marks))}else tr.delete(undoable.from,undoable.to);dispatch(tr)}return!0}}return!1}var emDash=new InputRule(/--$/,"—"),ellipsis=new InputRule(/\.\.\.$/,"…"),openDoubleQuote,closeDoubleQuote,openSingleQuote,closeSingleQuote,smartQuotes=[new InputRule(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(")$/,"“"),new InputRule(/"$/,"”"),new InputRule(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(')$/,"‘"),new InputRule(/'$/,"’")];function wrappingInputRule(regexp,nodeType,getAttrs,joinPredicate){return new InputRule(regexp,(function(state,match,start,end){var attrs=getAttrs instanceof Function?getAttrs(match):getAttrs,tr=state.tr.delete(start,end),$start,range=tr.doc.resolve(start).blockRange(),wrapping=range&&findWrapping(range,nodeType,attrs);if(!wrapping)return null;tr.wrap(range,wrapping);var before=tr.doc.resolve(start-1).nodeBefore;return before&&before.type==nodeType&&canJoin(tr.doc,start-1)&&(!joinPredicate||joinPredicate(match,before))&&tr.join(start-1),tr}))}function textblockTypeInputRule(regexp,nodeType,getAttrs){return new InputRule(regexp,(function(state,match,start,end){var $start=state.doc.resolve(start),attrs=getAttrs instanceof Function?getAttrs(match):getAttrs;return $start.node(-1).canReplaceWith($start.index(-1),$start.indexAfter(-1),nodeType)?state.tr.delete(start,end).setBlockType(start,start,nodeType,attrs):null}))}var GOOD_LEAF_SIZE=200,RopeSequence=function RopeSequence(){};RopeSequence.prototype.append=function append(other){return other.length?(other=RopeSequence.from(other),!this.length&&other||other.length<200&&this.leafAppend(other)||this.length<200&&other.leafPrepend(this)||this.appendInner(other)):this},RopeSequence.prototype.prepend=function prepend(other){return other.length?RopeSequence.from(other).append(this):this},RopeSequence.prototype.appendInner=function appendInner(other){return new Append(this,other)},RopeSequence.prototype.slice=function slice(from,to){return void 0===from&&(from=0),void 0===to&&(to=this.length),from>=to?RopeSequence.empty:this.sliceInner(Math.max(0,from),Math.min(this.length,to))},RopeSequence.prototype.get=function get(i){if(!(i<0||i>=this.length))return this.getInner(i)},RopeSequence.prototype.forEach=function forEach(f,from,to){void 0===from&&(from=0),void 0===to&&(to=this.length),from<=to?this.forEachInner(f,from,to,0):this.forEachInvertedInner(f,from,to,0)},RopeSequence.prototype.map=function map(f,from,to){void 0===from&&(from=0),void 0===to&&(to=this.length);var result=[];return this.forEach((function(elt,i){return result.push(f(elt,i))}),from,to),result},RopeSequence.from=function from(values){return values instanceof RopeSequence?values:values&&values.length?new Leaf(values):RopeSequence.empty};var Leaf=function(RopeSequence){function Leaf(values){RopeSequence.call(this),this.values=values}RopeSequence&&(Leaf.__proto__=RopeSequence),Leaf.prototype=Object.create(RopeSequence&&RopeSequence.prototype),Leaf.prototype.constructor=Leaf;var prototypeAccessors={length:{configurable:!0},depth:{configurable:!0}};return Leaf.prototype.flatten=function flatten(){return this.values},Leaf.prototype.sliceInner=function sliceInner(from,to){return 0==from&&to==this.length?this:new Leaf(this.values.slice(from,to))},Leaf.prototype.getInner=function getInner(i){return this.values[i]},Leaf.prototype.forEachInner=function forEachInner(f,from,to,start){for(var i=from;i<to;i++)if(!1===f(this.values[i],start+i))return!1},Leaf.prototype.forEachInvertedInner=function forEachInvertedInner(f,from,to,start){for(var i=from-1;i>=to;i--)if(!1===f(this.values[i],start+i))return!1},Leaf.prototype.leafAppend=function leafAppend(other){if(this.length+other.length<=200)return new Leaf(this.values.concat(other.flatten()))},Leaf.prototype.leafPrepend=function leafPrepend(other){if(this.length+other.length<=200)return new Leaf(other.flatten().concat(this.values))},prototypeAccessors.length.get=function(){return this.values.length},prototypeAccessors.depth.get=function(){return 0},Object.defineProperties(Leaf.prototype,prototypeAccessors),Leaf}(RopeSequence);RopeSequence.empty=new Leaf([]);var Append=function(RopeSequence){function Append(left,right){RopeSequence.call(this),this.left=left,this.right=right,this.length=left.length+right.length,this.depth=Math.max(left.depth,right.depth)+1}return RopeSequence&&(Append.__proto__=RopeSequence),Append.prototype=Object.create(RopeSequence&&RopeSequence.prototype),Append.prototype.constructor=Append,Append.prototype.flatten=function flatten(){return this.left.flatten().concat(this.right.flatten())},Append.prototype.getInner=function getInner(i){return i<this.left.length?this.left.get(i):this.right.get(i-this.left.length)},Append.prototype.forEachInner=function forEachInner(f,from,to,start){var leftLen=this.left.length;return!(from<leftLen&&!1===this.left.forEachInner(f,from,Math.min(to,leftLen),start))&&(!(to>leftLen&&!1===this.right.forEachInner(f,Math.max(from-leftLen,0),Math.min(this.length,to)-leftLen,start+leftLen))&&void 0)},Append.prototype.forEachInvertedInner=function forEachInvertedInner(f,from,to,start){var leftLen=this.left.length;return!(from>leftLen&&!1===this.right.forEachInvertedInner(f,from-leftLen,Math.max(to,leftLen)-leftLen,start+leftLen))&&(!(to<leftLen&&!1===this.left.forEachInvertedInner(f,Math.min(from,leftLen),to,start))&&void 0)},Append.prototype.sliceInner=function sliceInner(from,to){if(0==from&&to==this.length)return this;var leftLen=this.left.length;return to<=leftLen?this.left.slice(from,to):from>=leftLen?this.right.slice(from-leftLen,to-leftLen):this.left.slice(from,leftLen).append(this.right.slice(0,to-leftLen))},Append.prototype.leafAppend=function leafAppend(other){var inner=this.right.leafAppend(other);if(inner)return new Append(this.left,inner)},Append.prototype.leafPrepend=function leafPrepend(other){var inner=this.left.leafPrepend(other);if(inner)return new Append(inner,this.right)},Append.prototype.appendInner=function appendInner(other){return this.left.depth>=Math.max(this.right.depth,other.depth)+1?new Append(this.left,new Append(this.right,other)):new Append(this,other)},Append}(RopeSequence),ropeSequence,dist_index_es=RopeSequence,max_empty_items=500,Branch=function Branch(items,eventCount){this.items=items,this.eventCount=eventCount};function cutOffEvents(items,n){var cutPoint;return items.forEach((function(item,i){if(item.selection&&0==n--)return cutPoint=i,!1})),items.slice(cutPoint)}Branch.prototype.popEvent=function popEvent(state,preserveItems){var this$1=this;if(0==this.eventCount)return null;for(var end=this.items.length,remap,mapFrom;;end--){var next;if(this.items.get(end-1).selection){--end;break}}preserveItems&&(remap=this.remapping(end,this.items.length),mapFrom=remap.maps.length);var transform=state.tr,selection,remaining,addAfter=[],addBefore=[];return this.items.forEach((function(item,i){if(!item.step)return remap||(remap=this$1.remapping(end,i+1),mapFrom=remap.maps.length),mapFrom--,void addBefore.push(item);if(remap){addBefore.push(new Item(item.map));var step=item.step.map(remap.slice(mapFrom)),map;step&&transform.maybeStep(step).doc&&(map=transform.mapping.maps[transform.mapping.maps.length-1],addAfter.push(new Item(map,null,null,addAfter.length+addBefore.length))),mapFrom--,map&&remap.appendMap(map,mapFrom)}else transform.maybeStep(item.step);return item.selection?(selection=remap?item.selection.map(remap.slice(mapFrom)):item.selection,remaining=new Branch(this$1.items.slice(0,end).append(addBefore.reverse().concat(addAfter)),this$1.eventCount-1),!1):void 0}),this.items.length,0),{remaining:remaining,transform:transform,selection:selection}},Branch.prototype.addTransform=function addTransform(transform,selection,histOptions,preserveItems){for(var newItems=[],eventCount=this.eventCount,oldItems=this.items,lastItem=!preserveItems&&oldItems.length?oldItems.get(oldItems.length-1):null,i=0;i<transform.steps.length;i++){var step=transform.steps[i].invert(transform.docs[i]),item=new Item(transform.mapping.maps[i],step,selection),merged=void 0;(merged=lastItem&&lastItem.merge(item))&&(item=merged,i?newItems.pop():oldItems=oldItems.slice(0,oldItems.length-1)),newItems.push(item),selection&&(eventCount++,selection=null),preserveItems||(lastItem=item)}var overflow=eventCount-histOptions.depth;return overflow>DEPTH_OVERFLOW&&(oldItems=cutOffEvents(oldItems,overflow),eventCount-=overflow),new Branch(oldItems.append(newItems),eventCount)},Branch.prototype.remapping=function remapping(from,to){var maps=new Mapping;return this.items.forEach((function(item,i){var mirrorPos=null!=item.mirrorOffset&&i-item.mirrorOffset>=from?maps.maps.length-item.mirrorOffset:null;maps.appendMap(item.map,mirrorPos)}),from,to),maps},Branch.prototype.addMaps=function addMaps(array){return 0==this.eventCount?this:new Branch(this.items.append(array.map((function(map){return new Item(map)}))),this.eventCount)},Branch.prototype.rebased=function rebased(rebasedTransform,rebasedCount){if(!this.eventCount)return this;var rebasedItems=[],start=Math.max(0,this.items.length-rebasedCount),mapping=rebasedTransform.mapping,newUntil=rebasedTransform.steps.length,eventCount=this.eventCount;this.items.forEach((function(item){item.selection&&eventCount--}),start);var iRebased=rebasedCount;this.items.forEach((function(item){var pos=mapping.getMirror(--iRebased);if(null!=pos){newUntil=Math.min(newUntil,pos);var map=mapping.maps[pos];if(item.step){var step=rebasedTransform.steps[pos].invert(rebasedTransform.docs[pos]),selection=item.selection&&item.selection.map(mapping.slice(iRebased+1,pos));selection&&eventCount++,rebasedItems.push(new Item(map,step,selection))}else rebasedItems.push(new Item(map))}}),start);for(var newMaps=[],i=rebasedCount;i<newUntil;i++)newMaps.push(new Item(mapping.maps[i]));var items=this.items.slice(0,start).append(newMaps).append(rebasedItems),branch=new Branch(items,eventCount);return branch.emptyItemCount()>500&&(branch=branch.compress(this.items.length-rebasedItems.length)),branch},Branch.prototype.emptyItemCount=function emptyItemCount(){var count=0;return this.items.forEach((function(item){item.step||count++})),count},Branch.prototype.compress=function compress(upto){void 0===upto&&(upto=this.items.length);var remap=this.remapping(0,upto),mapFrom=remap.maps.length,items=[],events=0;return this.items.forEach((function(item,i){if(i>=upto)items.push(item),item.selection&&events++;else if(item.step){var step=item.step.map(remap.slice(mapFrom)),map=step&&step.getMap();if(mapFrom--,map&&remap.appendMap(map,mapFrom),step){var selection=item.selection&&item.selection.map(remap.slice(mapFrom));selection&&events++;var newItem=new Item(map.invert(),step,selection),merged,last=items.length-1;(merged=items.length&&items[last].merge(newItem))?items[last]=merged:items.push(newItem)}}else item.map&&mapFrom--}),this.items.length,0),new Branch(dist_index_es.from(items.reverse()),events)},Branch.empty=new Branch(dist_index_es.empty,0);var Item=function Item(map,step,selection,mirrorOffset){this.map=map,this.step=step,this.selection=selection,this.mirrorOffset=mirrorOffset};Item.prototype.merge=function merge(other){if(this.step&&other.step&&!other.selection){var step=other.step.merge(this.step);if(step)return new Item(step.getMap().invert(),step,this.selection)}};var HistoryState=function HistoryState(done,undone,prevRanges,prevTime){this.done=done,this.undone=undone,this.prevRanges=prevRanges,this.prevTime=prevTime},DEPTH_OVERFLOW=20;function applyTransaction(history,state,tr,options){var historyTr=tr.getMeta(historyKey),rebased;if(historyTr)return historyTr.historyState;tr.getMeta(closeHistoryKey)&&(history=new HistoryState(history.done,history.undone,null,0));var appended=tr.getMeta("appendedTransaction");if(0==tr.steps.length)return history;if(appended&&appended.getMeta(historyKey))return appended.getMeta(historyKey).redo?new HistoryState(history.done.addTransform(tr,null,options,mustPreserveItems(state)),history.undone,rangesFor(tr.mapping.maps[tr.steps.length-1]),history.prevTime):new HistoryState(history.done,history.undone.addTransform(tr,null,options,mustPreserveItems(state)),null,history.prevTime);if(!1===tr.getMeta("addToHistory")||appended&&!1===appended.getMeta("addToHistory"))return(rebased=tr.getMeta("rebased"))?new HistoryState(history.done.rebased(tr,rebased),history.undone.rebased(tr,rebased),mapRanges(history.prevRanges,tr.mapping),history.prevTime):new HistoryState(history.done.addMaps(tr.mapping.maps),history.undone.addMaps(tr.mapping.maps),mapRanges(history.prevRanges,tr.mapping),history.prevTime);var newGroup=0==history.prevTime||!appended&&(history.prevTime<(tr.time||0)-options.newGroupDelay||!isAdjacentTo(tr,history.prevRanges)),prevRanges=appended?mapRanges(history.prevRanges,tr.mapping):rangesFor(tr.mapping.maps[tr.steps.length-1]);return new HistoryState(history.done.addTransform(tr,newGroup?state.selection.getBookmark():null,options,mustPreserveItems(state)),Branch.empty,prevRanges,tr.time)}function isAdjacentTo(transform,prevRanges){if(!prevRanges)return!1;if(!transform.docChanged)return!0;var adjacent=!1;return transform.mapping.maps[0].forEach((function(start,end){for(var i=0;i<prevRanges.length;i+=2)start<=prevRanges[i+1]&&end>=prevRanges[i]&&(adjacent=!0)})),adjacent}function rangesFor(map){var result=[];return map.forEach((function(_from,_to,from,to){return result.push(from,to)})),result}function mapRanges(ranges,mapping){if(!ranges)return null;for(var result=[],i=0;i<ranges.length;i+=2){var from=mapping.map(ranges[i],1),to=mapping.map(ranges[i+1],-1);from<=to&&result.push(from,to)}return result}function histTransaction(history,state,dispatch,redo){var preserveItems=mustPreserveItems(state),histOptions=historyKey.get(state).spec.config,pop=(redo?history.undone:history.done).popEvent(state,preserveItems);if(pop){var selection=pop.selection.resolve(pop.transform.doc),added=(redo?history.done:history.undone).addTransform(pop.transform,state.selection.getBookmark(),histOptions,preserveItems),newHist=new HistoryState(redo?added:pop.remaining,redo?pop.remaining:added,null,0);dispatch(pop.transform.setSelection(selection).setMeta(historyKey,{redo:redo,historyState:newHist}).scrollIntoView())}}var cachedPreserveItems=!1,cachedPreserveItemsPlugins=null;function mustPreserveItems(state){var plugins=state.plugins;if(cachedPreserveItemsPlugins!=plugins){cachedPreserveItems=!1,cachedPreserveItemsPlugins=plugins;for(var i=0;i<plugins.length;i++)if(plugins[i].spec.historyPreserveItems){cachedPreserveItems=!0;break}}return cachedPreserveItems}function closeHistory(tr){return tr.setMeta(closeHistoryKey,!0)}var historyKey=new PluginKey("history"),closeHistoryKey=new PluginKey("closeHistory");function index_es_history(config){return config={depth:config&&config.depth||100,newGroupDelay:config&&config.newGroupDelay||500},new Plugin({key:historyKey,state:{init:function init(){return new HistoryState(Branch.empty,Branch.empty,null,0)},apply:function apply(tr,hist,state){return applyTransaction(hist,state,tr,config)}},config:config})}function undo(state,dispatch){var hist=historyKey.getState(state);return!(!hist||0==hist.done.eventCount)&&(dispatch&&histTransaction(hist,state,dispatch,!1),!0)}function redo(state,dispatch){var hist=historyKey.getState(state);return!(!hist||0==hist.undone.eventCount)&&(dispatch&&histTransaction(hist,state,dispatch,!0),!0)}function undoDepth(state){var hist=historyKey.getState(state);return hist?hist.done.eventCount:0}function redoDepth(state){var hist=historyKey.getState(state);return hist?hist.undone.eventCount:0}function createParagraph(schema,content){var paragraph=schema.nodes.paragraph;return content?paragraph.create(null,isString_default()(content)?schema.text(content):content):paragraph.createAndFill()}function createTextNode(schema,text,marks){return schema.text(text,marks)}function createTextSelection(tr,from,to){void 0===to&&(to=from);var contentSize=tr.doc.content.size,size=contentSize>0?contentSize-1:1;return TextSelection.create(tr.doc,Math.min(from,size),Math.min(to,size))}function addParagraph(tr,_a,schema){var pos=_a.pos;return tr.replaceWith(pos,pos,createParagraph(schema)),tr.setSelection(createTextSelection(tr,pos+1))}function replaceTextNode(_a){for(var state=_a.state,from=_a.from,startIndex=_a.startIndex,endIndex=_a.endIndex,createText=_a.createText,tr=state.tr,doc=state.doc,schema=state.schema,i=startIndex;i<=endIndex;i+=1){var _b=doc.child(i),nodeSize=_b.nodeSize,textContent=_b.textContent,content=_b.content,text=createText(textContent),node=text?createTextNode(schema,text):Fragment.empty,mappedFrom=tr.mapping.map(from),mappedTo=mappedFrom+content.size;tr.replaceWith(mappedFrom,mappedTo,node),from+=nodeSize}return tr}function splitAndExtendBlock(tr,pos,text,node){var textLen=text.length;tr.split(pos).delete(pos-textLen,pos).insert(tr.mapping.map(pos),node).setSelection(createTextSelection(tr,tr.mapping.map(pos)-textLen))}function hasSpecificTypeAncestor(mdNode){for(var types=[],_i=1;_i<arguments.length;_i++)types[_i-1]=arguments[_i];for(;mdNode&&mdNode.parent&&"document"!==mdNode.parent.type;){if(includes(types,mdNode.parent.type))return!0;mdNode=mdNode.parent}return!1}function getMdStartLine(mdNode){return mdNode.sourcepos[0][0]}function getMdEndLine(mdNode){return mdNode.sourcepos[1][0]}function getMdStartCh(mdNode){return mdNode.sourcepos[0][1]}function getMdEndCh(mdNode){return mdNode.sourcepos[1][1]}function isMultiLineNode(mdNode){var type=mdNode.type;return"codeBlock"===type||"paragraph"===type}function isHTMLNode(mdNode){var type=mdNode.type;return"htmlBlock"===type||"htmlInline"===type}function isStyledInlineNode(mdNode){var type=mdNode.type;return"strike"===type||"strong"===type||"emph"===type||"code"===type||"link"===type||"image"===type}function isCodeBlockNode(mdNode){return mdNode&&"codeBlock"===mdNode.type}function isCustomBlockNode(mdNode){return mdNode&&"customBlock"===mdNode.type}function isListNode(mdNode){return mdNode&&("item"===mdNode.type||"list"===mdNode.type)}function isOrderedListNode(mdNode){return isListNode(mdNode)&&"ordered"===mdNode.listData.type}function isBulletListNode(mdNode){return isListNode(mdNode)&&"ordered"!==mdNode.listData.type}function isTableCellNode(mdNode){return mdNode&&("tableCell"===mdNode.type||"tableDelimCell"===mdNode.type)}function isInlineNode(mdNode){switch(mdNode.type){case"code":case"text":case"emph":case"strong":case"strike":case"link":case"image":case"htmlInline":case"linebreak":case"softbreak":case"customInline":return!0;default:return!1}}function findClosestNode(mdNode,condition,includeSelf){for(void 0===includeSelf&&(includeSelf=!0),mdNode=includeSelf?mdNode:mdNode.parent;mdNode&&"document"!==mdNode.type;){if(condition(mdNode))return mdNode;mdNode=mdNode.parent}return null}function traverseParentNodes(mdNode,iteratee,includeSelf){for(void 0===includeSelf&&(includeSelf=!0),mdNode=includeSelf?mdNode:mdNode.parent;mdNode&&"document"!==mdNode.type;)iteratee(mdNode),mdNode=mdNode.parent}function addOffsetPos(originPos,offset){return[originPos[0],originPos[1]+offset]}function setOffsetPos(originPos,newOffset){return[originPos[0],newOffset]}function getInlineMarkdownText(mdNode){var text=mdNode.firstChild.literal;switch(mdNode.type){case"emph":return"*"+text+"*";case"strong":return"**"+text+"**";case"strike":return"~~"+text+"~~";case"code":return"`"+text+"`";case"link":case"image":var _a=mdNode,destination=_a.destination,title=_a.title,delim;return("link"===mdNode.type?"":"!")+"["+text+"]("+destination+(title?' "'+title+'"':"")+")";default:return null}}function isContainer(node){switch(node.type){case"document":case"blockQuote":case"list":case"item":case"paragraph":case"heading":case"emph":case"strong":case"strike":case"link":case"image":case"table":case"tableHead":case"tableBody":case"tableRow":case"tableCell":case"tableDelimRow":case"customInline":return!0;default:return!1}}function getChildrenText(node){for(var buffer=[],walker=node.walker(),event=null;event=walker.next();){var childNode=event.node;"text"===childNode.type&&buffer.push(childNode.literal)}return buffer.join("")}var widgetRules=[],widgetRuleMap={},reWidgetPrefix=/\$\$widget\d+\s/;function unwrapWidgetSyntax(text){var index=text.search(reWidgetPrefix);if(-1!==index){var rest,replaced=text.substring(index).replace(reWidgetPrefix,"").replace("$$","");text=text.substring(0,index),text+=unwrapWidgetSyntax(replaced)}return text}function createWidgetContent(info,text){return"$$"+info+" "+text+"$$"}function widgetToDOM(info,text){var _a=widgetRuleMap[info],rule=_a.rule,toDOM;return(0,_a.toDOM)(text=unwrapWidgetSyntax(text).match(rule)[0])}function getWidgetRules(){return widgetRules}function setWidgetRules(rules){(widgetRules=rules).forEach((function(rule,index){widgetRuleMap["widget"+index]=rule}))}function mergeNodes(nodes,text,schema,ruleIndex){return nodes.concat(createNodesWithWidget(text,schema,ruleIndex))}function createNodesWithWidget(text,schema,ruleIndex){void 0===ruleIndex&&(ruleIndex=0);var nodes=[],rule=(widgetRules[ruleIndex]||{}).rule,nextRuleIndex=ruleIndex+1;if(text=unwrapWidgetSyntax(text),rule&&rule.test(text)){for(var index=void 0;-1!==(index=text.search(rule));){var prev=text.substring(0,index);prev&&(nodes=mergeNodes(nodes,prev,schema,nextRuleIndex));var literal=(text=text.substring(index)).match(rule)[0],info="widget"+ruleIndex;nodes.push(schema.nodes.widget.create({info:info},schema.text(createWidgetContent(info,literal)))),text=text.substring(literal.length)}text&&(nodes=mergeNodes(nodes,text,schema,nextRuleIndex))}else text&&(nodes=ruleIndex<widgetRules.length-1?mergeNodes(nodes,text,schema,nextRuleIndex):[schema.text(text)]);return nodes}function getWidgetContent(widgetNode){for(var event,text="",walker=widgetNode.walker();event=walker.next();){var node=event.node,entering;event.entering&&(node!==widgetNode&&"text"!==node.type?(text+=getInlineMarkdownText(node),walker.resumeAt(widgetNode,!1),walker.next()):"text"===node.type&&(text+=node.literal))}return text}function getDefaultCommands(){return{deleteSelection:function(){return deleteSelection},selectAll:function(){return selectAll},undo:function(){return undo},redo:function(){return redo}}}function placeholder(options){return new Plugin({props:{decorations:function(state){var doc=state.doc;if(options.text&&1===doc.childCount&&doc.firstChild.isTextblock&&0===doc.firstChild.content.size){var placeHolder=document.createElement("span");return addClass_default()(placeHolder,"placeholder"),options.className&&addClass_default()(placeHolder,options.className),placeHolder.textContent=options.text,DecorationSet.create(doc,[Decoration.widget(1,placeHolder)])}return null}}})}var pluginKey=new PluginKey("widget"),PopupWidget=function(){function PopupWidget(eventEmitter){var _this=this;this.popup=null,this.removeWidget=function(){_this.popup&&(document.body.removeChild(_this.popup),_this.popup=null)},this.eventEmitter=eventEmitter,this.eventEmitter.listen("blur",this.removeWidget),this.eventEmitter.listen("removePopupWidget",this.removeWidget)}return PopupWidget.prototype.update=function(view){var widget=pluginKey.getState(view.state);if(this.removeWidget(),widget){var node=widget.node,style=widget.style,_a=view.coordsAtPos(widget.pos),top=_a.top,left=_a.left,bottom,height=_a.bottom-top;css_default()(node,{position:"absolute",left:left+"px",opacity:"0"}),document.body.appendChild(node),css_default()(node,{top:("bottom"===style?top+height:top-node.clientHeight-height)+"px",opacity:"1"}),this.popup=node,view.focus()}},PopupWidget.prototype.destroy=function(){this.eventEmitter.removeEventHandler("blur",this.removeWidget)},PopupWidget}();function addWidget(eventEmitter){return new Plugin({key:pluginKey,state:{init:function(){return null},apply:function(tr){return tr.getMeta("widget")}},view:function(){return new PopupWidget(eventEmitter)}})}var forEachArray=__webpack_require__(893),forEachArray_default=__webpack_require__.n(forEachArray),collection_toArray=__webpack_require__(990),toArray_default=__webpack_require__.n(collection_toArray);function addDefaultImageBlobHook(eventEmitter){eventEmitter.listen("addImageBlobHook",(function(blob,callback){var reader=new FileReader;reader.onload=function(_a){var target=_a.target;return callback(target.result)},reader.readAsDataURL(blob)}))}function emitImageBlobHook(eventEmitter,blob,type){var hook=function(imageUrl,altText){eventEmitter.emit("command","addImage",{imageUrl:imageUrl,altText:altText||blob.name||"image"})};eventEmitter.emit("addImageBlobHook",blob,hook,type)}function pasteImageOnly(items){var images=toArray_default()(items).filter((function(_a){var type;return-1!==_a.type.indexOf("image")}));if(1===images.length){var item=images[0];if(item)return item.getAsFile()}return null}function dropImage(_a){var eventEmitter=_a.eventEmitter;return new Plugin({props:{handleDOMEvents:{drop:function(_,ev){var _a,items=null===(_a=ev.dataTransfer)||void 0===_a?void 0:_a.files;return items&&forEachArray_default()(items,(function(item){return-1===item.type.indexOf("image")||(ev.preventDefault(),ev.stopPropagation(),emitImageBlobHook(eventEmitter,item,ev.type),!1)})),!0}}}})}var node_Node,node=function(){function Node(){}return Object.defineProperty(Node.prototype,"type",{get:function(){return"node"},enumerable:!1,configurable:!0}),Node.prototype.setContext=function(context){this.context=context},Node}();function widgetNodeView(pmNode){var dom=document.createElement("span"),node=widgetToDOM(pmNode.attrs.info,pmNode.textContent);return dom.className="tui-widget",dom.appendChild(node),{dom:dom}}function isWidgetNode(pmNode){return"widget"===pmNode.type.name}var Widget=function(_super){function Widget(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(Widget,_super),Object.defineProperty(Widget.prototype,"name",{get:function(){return"widget"},enumerable:!1,configurable:!0}),Object.defineProperty(Widget.prototype,"schema",{get:function(){return{attrs:{info:{default:null}},group:"inline",inline:!0,content:"text*",selectable:!1,atom:!0,toDOM:function(){return["span",{class:"tui-widget"},0]},parseDOM:[{tag:"span.tui-widget",getAttrs:function(dom){var text,_a,info;return{info:dom.textContent.match(/\$\$(widget\d+)/)[1]}}}]}},enumerable:!1,configurable:!0}),Widget}(node),EditorBase,src_base=function(){function EditorBase(eventEmitter){this.el=document.createElement("div"),this.el.className="toastui-editor",this.eventEmitter=eventEmitter,this.placeholder={text:""}}return EditorBase.prototype.createState=function(){return EditorState.create({schema:this.schema,plugins:this.createPlugins()})},EditorBase.prototype.initEvent=function(){var _a=this,eventEmitter=_a.eventEmitter,view=_a.view,editorType=_a.editorType;view.dom.addEventListener("focus",(function(){return eventEmitter.emit("focus",editorType)})),view.dom.addEventListener("blur",(function(){return eventEmitter.emit("blur",editorType)}))},EditorBase.prototype.emitChangeEvent=function(tr){this.eventEmitter.emit("caretChange",this.editorType),tr.docChanged&&this.eventEmitter.emit("change",this.editorType)},Object.defineProperty(EditorBase.prototype,"defaultPlugins",{get:function(){var _a=getDefaultCommands(),undo=_a.undo,redo=_a.redo,rules=this.createInputRules(),plugins=__spreadArray(__spreadArray([],this.keymaps),[keymap(__assign({"Mod-z":undo(),"Shift-Mod-z":redo()},baseKeymap)),index_es_history(),placeholder(this.placeholder),addWidget(this.eventEmitter),dropImage(this.context)]);return rules?plugins.concat(rules):plugins},enumerable:!1,configurable:!0}),EditorBase.prototype.createInputRules=function(){var widgetRules,rules=getWidgetRules().map((function(_a){var rule=_a.rule;return new InputRule(rule,(function(state,match,start,end){var schema=state.schema,tr=state.tr,doc=state.doc,allMatched=match.input.match(new RegExp(rule,"g")),pos=doc.resolve(start),parent=pos.parent,count=0;if(isWidgetNode(parent)&&(parent=pos.node(pos.depth-1)),parent.forEach((function(child){return isWidgetNode(child)&&(count+=1)})),allMatched.length>count){var content=last(allMatched),nodes=createNodesWithWidget(content,schema);return tr.replaceWith(end-content.length+1,end,nodes)}return null}))}));return rules.length?inputRules({rules:rules}):null},EditorBase.prototype.createSchema=function(){return new Schema({nodes:this.specs.nodes,marks:this.specs.marks})},EditorBase.prototype.createKeymaps=function(useCommandShortcut){return useCommandShortcut?this.specs.keymaps():[]},EditorBase.prototype.createCommands=function(){return this.specs.commands(this.view)},EditorBase.prototype.createPluginProps=function(){var _this=this;return this.extraPlugins.map((function(plugin){return plugin(_this.eventEmitter)}))},EditorBase.prototype.focus=function(){var _this=this;setTimeout((function(){_this.view.focus(),_this.view.dispatch(_this.view.state.tr.scrollIntoView())}))},EditorBase.prototype.blur=function(){this.view.dom.blur()},EditorBase.prototype.destroy=function(){var _this=this;this.view.destroy(),Object.keys(this).forEach((function(prop){delete _this[prop]}))},EditorBase.prototype.moveCursorToStart=function(){var tr=this.view.state.tr;this.view.dispatch(tr.setSelection(createTextSelection(tr,1)).scrollIntoView()),this.focus()},EditorBase.prototype.moveCursorToEnd=function(){var tr=this.view.state.tr;this.view.dispatch(tr.setSelection(createTextSelection(tr,tr.doc.content.size-1)).scrollIntoView()),this.focus()},EditorBase.prototype.setScrollTop=function(top){this.view.dom.scrollTop=top},EditorBase.prototype.getScrollTop=function(){return this.view.dom.scrollTop},EditorBase.prototype.setPlaceholder=function(text){this.placeholder.text=text,this.view.dispatch(this.view.state.tr.scrollIntoView())},EditorBase.prototype.setHeight=function(height){css_default()(this.el,{height:height+"px"})},EditorBase.prototype.setMinHeight=function(minHeight){css_default()(this.el,{minHeight:minHeight+"px"})},EditorBase.prototype.getElement=function(){return this.el},EditorBase}(),isFunction=__webpack_require__(294),isFunction_default=__webpack_require__.n(isFunction);function execCommand(view,command,payload){return view.focus(),command(payload)(view.state,view.dispatch,view)}var SpecManager,specManager=function(){function SpecManager(specs){this.specs=specs}return Object.defineProperty(SpecManager.prototype,"nodes",{get:function(){return this.specs.filter((function(spec){return"node"===spec.type})).reduce((function(nodes,_a){var _b,name=_a.name,schema=_a.schema;return __assign(__assign({},nodes),((_b={})[name]=schema,_b))}),{})},enumerable:!1,configurable:!0}),Object.defineProperty(SpecManager.prototype,"marks",{get:function(){return this.specs.filter((function(spec){return"mark"===spec.type})).reduce((function(marks,_a){var _b,name=_a.name,schema=_a.schema;return __assign(__assign({},marks),((_b={})[name]=schema,_b))}),{})},enumerable:!1,configurable:!0}),SpecManager.prototype.commands=function(view,addedCommands){var specCommands=this.specs.filter((function(_a){var commands;return _a.commands})).reduce((function(allCommands,spec){var commands={},specCommand=spec.commands();return isFunction_default()(specCommand)?commands[spec.name]=function(payload){return execCommand(view,specCommand,payload)}:Object.keys(specCommand).forEach((function(name){commands[name]=function(payload){return execCommand(view,specCommand[name],payload)}})),__assign(__assign({},allCommands),commands)}),{}),defaultCommands=getDefaultCommands();return Object.keys(defaultCommands).forEach((function(name){specCommands[name]=function(payload){return execCommand(view,defaultCommands[name],payload)}})),addedCommands&&Object.keys(addedCommands).forEach((function(name){specCommands[name]=function(payload){return execCommand(view,addedCommands[name],payload)}})),specCommands},SpecManager.prototype.keymaps=function(){var specKeymaps;return this.specs.filter((function(spec){return spec.keymaps})).map((function(spec){return spec.keymaps()})).map((function(keys){return keymap(keys)}))},SpecManager.prototype.setContext=function(context){this.specs.forEach((function(spec){spec.setContext(context)}))},SpecManager}(),isArray=__webpack_require__(322),isArray_default=__webpack_require__.n(isArray),hasClass=__webpack_require__(714),hasClass_default=__webpack_require__.n(hasClass),domUtil_matches=__webpack_require__(471),matches_default=__webpack_require__.n(domUtil_matches),TAG_NAME="[A-Za-z][A-Za-z0-9-]*",ATTRIBUTE_NAME,UNQUOTED_VALUE,SINGLE_QUOTED_VALUE="'[^']*'",DOUBLE_QUOTED_VALUE='"[^"]*"',ATTRIBUTE_VALUE,ATTRIBUTE_VALUE_SPEC,ATTRIBUTE="(?:\\s+"+"[a-zA-Z_:][a-zA-Z0-9:._-]*"+("(?:\\s*=\\s*"+("(?:"+"[^\"'=<>`\\x00-\\x20]+"+"|'[^']*'|\"[^\"]*\")")+")")+"?)",OPEN_TAG="<("+TAG_NAME+")("+ATTRIBUTE+")*\\s*/?>",CLOSE_TAG,HTML_TAG="(?:"+OPEN_TAG+"|"+("</("+TAG_NAME+")\\s*[>]")+")",reHTMLTag=new RegExp("^"+HTML_TAG,"i");function isPositionInBox(style,offsetX,offsetY){var left=parseInt(style.left,10),top=parseInt(style.top,10),width=parseInt(style.width,10)+parseInt(style.paddingLeft,10)+parseInt(style.paddingRight,10),height=parseInt(style.height,10)+parseInt(style.paddingTop,10)+parseInt(style.paddingBottom,10);return offsetX>=left&&offsetX<=left+width&&offsetY>=top&&offsetY<=top+height}var CLS_PREFIX="toastui-editor-";function cls(){for(var names=[],_i=0;_i<arguments.length;_i++)names[_i]=arguments[_i];for(var result=[],_a=0,names_1=names;_a<names_1.length;_a++){var name=names_1[_a],className=void 0;(className=Array.isArray(name)?name[0]?name[1]:null:name)&&result.push(""+CLS_PREFIX+className)}return result.join(" ")}function clsWithMdPrefix(){for(var names=[],_i=0;_i<arguments.length;_i++)names[_i]=arguments[_i];return names.map((function(className){return CLS_PREFIX+"md-"+className})).join(" ")}function isTextNode(node){return(null==node?void 0:node.nodeType)===Node.TEXT_NODE}function isElemNode(node){return node&&node.nodeType===Node.ELEMENT_NODE}function findNodes(element,selector){var nodeList=toArray_default()(element.querySelectorAll(selector));return nodeList.length?nodeList:[]}function appendNodes(node,nodesToAppend){(nodesToAppend=isArray_default()(nodesToAppend)?toArray_default()(nodesToAppend):[nodesToAppend]).forEach((function(nodeToAppend){node.appendChild(nodeToAppend)}))}function insertBeforeNode(insertedNode,node){node.parentNode&&node.parentNode.insertBefore(insertedNode,node)}function removeNode(node){node.parentNode&&node.parentNode.removeChild(node)}function unwrapNode(node){for(var result=[];node.firstChild;)result.push(node.firstChild),node.parentNode&&node.parentNode.insertBefore(node.firstChild,node);return removeNode(node),result}function toggleClass(element,className,state){var toggleFn;isUndefined_default()(state)&&(state=!hasClass_default()(element,className)),(state?addClass_default():removeClass_default())(element,className)}function createElementWith(contents,target){var container=document.createElement("div");isString_default()(contents)?container.innerHTML=contents:container.appendChild(contents);var firstChild=container.firstChild;return target&&target.appendChild(firstChild),firstChild}function getOuterWidth(el){var computed=window.getComputedStyle(el);return["margin-left","margin-right"].reduce((function(acc,type){return acc+parseInt(computed.getPropertyValue(type),10)}),0)+el.offsetWidth}function closest(node,found){var condition;for(condition=isString_default()(found)?function(target){return matches_default()(target,found)}:function(target){return target===found};node&&node!==document;){if(isElemNode(node)&&condition(node))return node;node=node.parentNode}return null}function getTotalOffset(el,root){for(var offsetTop=0,offsetLeft=0;el&&el!==root;){var top,left,offsetParent;if(offsetTop+=el.offsetTop,offsetLeft+=el.offsetLeft,el.offsetParent===root.offsetParent)break;el=el.offsetParent}return{offsetTop:offsetTop,offsetLeft:offsetLeft}}function finalizeHtml(html,needHtmlText){var result;if(needHtmlText)result=html.innerHTML;else{for(var frag=document.createDocumentFragment(),childNodes=toArray_default()(html.childNodes),length=childNodes.length,i=0;i<length;i+=1)frag.appendChild(childNodes[i]);result=frag}return result}function dom_empty(node){for(;node.firstChild;)node.removeChild(node.firstChild)}function appendNode(node,appended){if(isString(appended))node.insertAdjacentHTML("beforeend",appended);else for(var nodes=appended.length?toArray(appended):[appended],i=0,len=nodes.length;i<len;i+=1)node.appendChild(nodes[i])}function prependNode(node,appended){if(isString(appended))node.insertAdjacentHTML("afterbegin",appended);else for(var nodes=appended.length?toArray(appended):[appended],i=nodes.length-1,len=0;i>=0;i-=1)node.insertBefore(nodes[i],node.firstChild)}function setAttributes(attributes,element){Object.keys(attributes).forEach((function(attrName){attributes[attrName]?element.setAttribute(attrName,attributes[attrName]):element.removeAttribute(attrName)}))}function replaceBRWithEmptyBlock(html){var reBr=/<br\s*\/*>/i,reHTMLTag=new RegExp(HTML_TAG,"ig"),htmlTagMatched=html.match(reHTMLTag);return null==htmlTagMatched||htmlTagMatched.forEach((function(htmlTag,index){if(reBr.test(htmlTag)){var alternativeTag="";if(index){var prevTag,openTagMatched=htmlTagMatched[index-1].match(OPEN_TAG);if(openTagMatched){var tagName=openTagMatched[1];alternativeTag="</"+tagName+"><"+tagName+">"}}html=html.replace(reBr,alternativeTag)}})),html}function resolveSelectionPos(selection){var from=selection.from,to=selection.to;return selection instanceof AllSelection?[from+1,to-1]:[from,to]}function getEditorToMdLine(from,to,doc){var fragment=doc.content,childCount=fragment.childCount,startLine=Math.min(fragment.findIndex(from).index+1,childCount),endLine;return[startLine,from===to?startLine:Math.min(fragment.findIndex(to).index+1,childCount)]}function getWidgetNodePos(node,chPos,direction){void 0===direction&&(direction=1);var additionalPos=0;return node.forEach((function(child,pos){isWidgetNode(child)&&pos+2<chPos&&(additionalPos+=2*direction)})),additionalPos}function getEditorToMdPos(doc,from,to){void 0===to&&(to=from);var collapsed=from===to,startResolvedPos=doc.resolve(from),lineRange=getEditorToMdLine(from,to,doc),startOffset=startResolvedPos.start(1),endOffset=startOffset;if(!collapsed){var endResolvedPos=doc.resolve(to===doc.content.size?to-1:to);endOffset=endResolvedPos.start(),endResolvedPos.pos===doc.content.size&&(to=doc.content.size-2)}var startCh=Math.max(from-startOffset+1,1),endCh=Math.max(to-endOffset+1,1);return[[lineRange[0],startCh+getWidgetNodePos(doc.child(lineRange[0]-1),startCh,-1)],[lineRange[1],endCh+getWidgetNodePos(doc.child(lineRange[1]-1),endCh,-1)]]}function getStartPosListPerLine(doc,endIndex){for(var startPosListPerLine=[],i=0,pos=0;i<endIndex;i+=1){var child=doc.child(i);startPosListPerLine[i]=pos,pos+=child.nodeSize}return startPosListPerLine}function getMdToEditorPos(doc,startPos,endPos){var startPosListPerLine=getStartPosListPerLine(doc,endPos[0]),startIndex=startPos[0]-1,endIndex=endPos[0]-1,startNode=doc.child(startIndex),endNode=doc.child(endIndex),from=startPosListPerLine[startIndex],to=startPosListPerLine[endIndex];return from+=startPos[1]+getWidgetNodePos(startNode,startPos[1]-1),to+=endPos[1]+getWidgetNodePos(endNode,endPos[1]-1),[from,Math.min(to,doc.content.size)]}function getRangeInfo(selection){var $from=selection.$from,$to=selection.$to,from=selection.from,to=selection.to,doc=$from.doc;return selection instanceof AllSelection&&($from=doc.resolve(from+1),$to=doc.resolve(to-1)),0===$from.depth&&($to=$from=doc.resolve(from-1)),{startFromOffset:$from.start(1),endFromOffset:$to.start(1),startToOffset:$from.end(1),endToOffset:$to.end(1),startIndex:$from.index(0),endIndex:$to.index(0),from:$from.pos,to:$to.pos}}function getNodeContentOffsetRange(doc,targetIndex){for(var startOffset=1,endOffset=1,i=0,offset=0;i<doc.childCount;i+=1){var nodeSize=doc.child(i).nodeSize;if(startOffset=offset+1,endOffset=offset+nodeSize-1,i===targetIndex)break;offset+=nodeSize}return{startOffset:startOffset,endOffset:endOffset}}var HEADING="heading",BLOCK_QUOTE="blockQuote",LIST_ITEM="listItem",TABLE,TABLE_CELL,CODE_BLOCK="codeBlock",THEMATIC_BREAK,LINK="link",CODE="code",META="meta",DELIM="delimiter",TASK_DELIM="taskDelimiter",TEXT="markedText",HTML,CUSTOM_BLOCK="customBlock",delimSize={strong:2,emph:1,strike:2};function markInfo(start,end,type,attrs){return{start:start,end:end,spec:{type:type,attrs:attrs}}}function heading(_a,start,end){var level=_a.level,headingType=_a.headingType,marks=[markInfo(start,end,HEADING,{level:level})];return"atx"===headingType?marks.push(markInfo(start,addOffsetPos(start,level),DELIM)):marks.push(markInfo(setOffsetPos(end,0),end,HEADING,{seText:!0})),marks}function emphasisAndStrikethrough(_a,start,end){var type=_a.type,startDelimPos=addOffsetPos(start,delimSize[type]),endDelimPos=addOffsetPos(end,-delimSize[type]);return[markInfo(startDelimPos,endDelimPos,type),markInfo(start,startDelimPos,DELIM),markInfo(endDelimPos,end,DELIM)]}function markLink(start,end,linkTextStart,lastChildCh){return[markInfo(start,end,LINK),markInfo(setOffsetPos(start,linkTextStart[1]+1),setOffsetPos(end,lastChildCh),LINK,{desc:!0}),markInfo(setOffsetPos(end,lastChildCh+2),addOffsetPos(end,-1),LINK,{url:!0})]}function markInfo_image(_a,start,end){var lastChild=_a.lastChild,lastChildCh=lastChild?getMdEndCh(lastChild)+1:3,linkTextEnd=addOffsetPos(start,1);return __spreadArray([markInfo(start,linkTextEnd,META)],markLink(start,end,linkTextEnd,lastChildCh))}function markInfo_link(_a,start,end){var lastChild=_a.lastChild,extendedAutolink=_a.extendedAutolink,lastChildCh=lastChild?getMdEndCh(lastChild)+1:2;return extendedAutolink?[markInfo(start,end,LINK,{desc:!0})]:markLink(start,end,start,lastChildCh)}function markInfo_code(_a,start,end){var tickCount=_a.tickCount,openDelimEnd=addOffsetPos(start,tickCount),closeDelimStart=addOffsetPos(end,-tickCount);return[markInfo(start,end,CODE),markInfo(start,openDelimEnd,CODE,{start:!0}),markInfo(openDelimEnd,closeDelimStart,CODE,{marked:!0}),markInfo(closeDelimStart,end,CODE,{end:!0})]}function lineBackground(parent,start,end,prefix){var defaultBackground={start:start,end:end,spec:{attrs:{className:prefix+"-line-background",codeStart:start[0],codeEnd:end[0]}},lineBackground:!0};return"item"!==parent.type&&"blockQuote"!==parent.type?[__assign(__assign({},defaultBackground),{end:start,spec:{attrs:{className:prefix+"-line-background start"}}}),__assign(__assign({},defaultBackground),{start:[Math.min(start[0]+1,end[0]),start[1]]})]:null}function codeBlock(node,start,end,endLine){var fenceOffset=node.fenceOffset,fenceLength=node.fenceLength,fenceChar=node.fenceChar,info=node.info,infoPadding=node.infoPadding,parent=node.parent,fenceEnd=fenceOffset+fenceLength,marks=[markInfo(setOffsetPos(start,1),end,CODE_BLOCK)],codeBlockEnd,reCodeBlockEnd;fenceChar&&marks.push(markInfo(start,addOffsetPos(start,fenceEnd),DELIM)),info&&marks.push(markInfo(addOffsetPos(start,fenceLength),addOffsetPos(start,fenceLength+infoPadding+info.length),META)),new RegExp("^(\\s{0,4})("+fenceChar+"{"+fenceLength+",})").test(endLine)&&marks.push(markInfo(setOffsetPos(end,1),end,DELIM));var lineBackgroundMarkInfo=lineBackground(parent,start,end,"code-block");return lineBackgroundMarkInfo?marks.concat(lineBackgroundMarkInfo):marks}function customBlock(node,start,end){var _a=node,offset=_a.offset,syntaxLength=_a.syntaxLength,info=_a.info,parent=_a.parent,syntaxEnd=offset+syntaxLength,marks=[markInfo(setOffsetPos(start,1),end,CUSTOM_BLOCK)];marks.push(markInfo(start,addOffsetPos(start,syntaxEnd),DELIM)),info&&marks.push(markInfo(addOffsetPos(start,2),addOffsetPos(start,syntaxLength+info.length),META)),marks.push(markInfo(setOffsetPos(end,1),end,DELIM));var lineBackgroundMarkInfo=lineBackground(parent,start,end,"custom-block");return lineBackgroundMarkInfo?marks.concat(lineBackgroundMarkInfo):marks}function markListItemChildren(node,markType){for(var marks=[];node;){var type=node.type;"paragraph"!==type&&"codeBlock"!==type||marks.push(markInfo([getMdStartLine(node),getMdStartCh(node)-1],[getMdEndLine(node),getMdEndCh(node)+1],markType)),node=node.next}return marks}function markParagraphInBlockQuote(node){for(var marks=[];node;)marks.push(markInfo([getMdStartLine(node),getMdStartCh(node)],[getMdEndLine(node),getMdEndCh(node)+1],TEXT)),node=node.next;return marks}function blockQuote(node,start,end){var marks=node.parent&&"blockQuote"!==node.parent.type?[markInfo(start,end,BLOCK_QUOTE)]:[];if(node.firstChild){var childMarks=[];"paragraph"===node.firstChild.type?childMarks=markParagraphInBlockQuote(node.firstChild.firstChild):"list"===node.firstChild.type&&(childMarks=markListItemChildren(node.firstChild,TEXT)),marks=__spreadArray(__spreadArray([],marks),childMarks)}return marks}function getSpecOfListItemStyle(node){for(var depth=0;node.parent.parent&&"item"===node.parent.parent.type;)node=node.parent.parent,depth+=1;var attrs;return[LIST_ITEM,__assign(__assign({},[{odd:!0},{even:!0}][depth%2]),{listStyle:!0})]}function item(node,start){var _a=node.listData,padding=_a.padding,task=_a.task,spec=getSpecOfListItemStyle(node),marks=[markInfo.apply(void 0,__spreadArray([start,addOffsetPos(start,padding)],spec))];return task&&(marks.push(markInfo(addOffsetPos(start,padding),addOffsetPos(start,padding+3),TASK_DELIM)),marks.push(markInfo(addOffsetPos(start,padding+1),addOffsetPos(start,padding+2),META))),marks.concat(markListItemChildren(node.firstChild,TEXT))}var markNodeFuncMap={heading:heading,strong:emphasisAndStrikethrough,emph:emphasisAndStrikethrough,strike:emphasisAndStrikethrough,link:markInfo_link,image:markInfo_image,code:markInfo_code,codeBlock:codeBlock,blockQuote:blockQuote,item:item,customBlock:customBlock},simpleMarkClassNameMap={thematicBreak:"thematicBreak",table:"table",tableCell:"tableCell",htmlInline:"html"};function getMarkInfo(node,start,end,endLine){var type=node.type;return isFunction_default()(markNodeFuncMap[type])?markNodeFuncMap[type](node,start,end,endLine):simpleMarkClassNameMap[type]?[markInfo(start,end,simpleMarkClassNameMap[type])]:null}var removingBackgroundIndexMap={};function syntaxHighlight(_a){var schema=_a.schema,toastMark=_a.toastMark;return new Plugin({appendTransaction:function(transactions,_,newState){var tr=transactions[0],newTr=newState.tr;if(tr.docChanged){var markInfo_1=[],editResult;tr.getMeta("editResult").forEach((function(result){var nodes=result.nodes,removedNodeRange=result.removedNodeRange;if(nodes.length){markInfo_1=markInfo_1.concat(getMarkForRemoving(newTr,nodes));for(var _i=0,nodes_1=nodes;_i<nodes_1.length;_i++)for(var parent,walker=nodes_1[_i].walker(),event=walker.next();event;){var node=event.node,entering;event.entering&&(markInfo_1=markInfo_1.concat(getMarkForAdding(node,toastMark))),event=walker.next()}}else if(removedNodeRange)for(var maxIndex=newTr.doc.childCount-1,_a=removedNodeRange.line,startLine=_a[0],endLine=_a[1],startIndex=Math.min(startLine,maxIndex),endIndex=Math.min(endLine,maxIndex),i=startIndex;i<=endIndex;i+=1)removingBackgroundIndexMap[i]=!0})),appendMarkTr(newTr,schema,markInfo_1)}return newTr.setMeta("widget",tr.getMeta("widget"))}})}function isDifferentBlock(doc,index,attrs){return Object.keys(attrs).some((function(name){return attrs[name]!==doc.child(index).attrs[name]}))}function addLineBackground(tr,doc,paragraph,blockPosInfo,attrs){void 0===attrs&&(attrs={});for(var startIndex=blockPosInfo.startIndex,endIndex=blockPosInfo.endIndex,from=blockPosInfo.from,to=blockPosInfo.to,shouldChangeBlockType=!1,i=startIndex;i<=endIndex;i+=1)delete removingBackgroundIndexMap[i],shouldChangeBlockType=isDifferentBlock(doc,i,attrs);shouldChangeBlockType&&tr.setBlockType(from,to,paragraph,attrs)}function appendMarkTr(tr,schema,marks){var doc=tr.doc,paragraph=schema.nodes.paragraph,startPosListPerLine=getStartPosListPerLine(doc,doc.childCount);marks.forEach((function(_a){var start=_a.start,end=_a.end,spec=_a.spec,lineBackground=_a.lineBackground,startIndex=Math.min(start[0],doc.childCount)-1,endIndex=Math.min(end[0],doc.childCount)-1,startNode=doc.child(startIndex),endNode=doc.child(endIndex),from=startPosListPerLine[startIndex],to=startPosListPerLine[endIndex],posInfo;(from+=start[1]+getWidgetNodePos(startNode,start[1]-1),to+=end[1]+getWidgetNodePos(endNode,end[1]-1),spec)?lineBackground?addLineBackground(tr,doc,paragraph,{from:from,to:to,startIndex:startIndex,endIndex:endIndex},spec.attrs):tr.addMark(from,to,schema.mark(spec.type,spec.attrs)):tr.removeMark(from,to)})),removeBlockBackground(tr,startPosListPerLine,paragraph)}function removeBlockBackground(tr,startPosListPerLine,paragraph){Object.keys(removingBackgroundIndexMap).forEach((function(index){var startIndex=Number(index),endIndex=Math.min(Number(index)+1,tr.doc.childCount-1),from=startPosListPerLine[startIndex],to=startPosListPerLine[endIndex]-1;startIndex===endIndex&&(to+=2),tr.setBlockType(from,to,paragraph)}))}function cacheIndexToRemoveBackground(doc,start,end){var skipLines=[];removingBackgroundIndexMap={};for(var i=start[0]-1;i<end[0];i+=1){var node=doc.child(i),codeEnd=node.attrs.codeEnd,codeStart=node.attrs.codeStart;if(codeStart&&codeEnd&&!common_includes(skipLines,codeStart)){skipLines.push(codeStart),codeEnd=Math.min(codeEnd,doc.childCount);for(var startIndex=codeStart-1,endIndex=end[0],index=startIndex;index<endIndex;index+=1)removingBackgroundIndexMap[index]=!0}}}function getMarkForRemoving(_a,nodes){var doc=_a.doc,start=nodes[0].sourcepos[0],_b,end=last(nodes).sourcepos[1],startPos=[start[0],start[1]],endPos=[end[0],end[1]+1],marks=[];return cacheIndexToRemoveBackground(doc,start,end),marks.push({start:startPos,end:endPos}),marks}function getMarkForAdding(node,toastMark){var lineTexts=toastMark.getLineTexts(),startPos=[getMdStartLine(node),getMdStartCh(node)],endPos=[getMdEndLine(node),getMdEndCh(node)+1],markInfo=getMarkInfo(node,startPos,endPos,lineTexts[endPos[0]-1]);return null!=markInfo?markInfo:[]}function getToolbarStateType(mdNode){return isListNode(mdNode)?mdNode.listData.task?"taskList":"ordered"===mdNode.listData.type?"orderedList":"bulletList":-1!==mdNode.type.indexOf("table")?"table":mdNode.type}function getToolbarState(targetNode){var toolbarState={},listEnabled=!0;return traverseParentNodes(targetNode,(function(mdNode){var type=getToolbarStateType(mdNode);"customBlock"!==type&&"image"!==type&&"link"!==type&&("bulletList"===type||"orderedList"===type?listEnabled&&(toolbarState[type]=!0,listEnabled=!1):toolbarState[type]=!0)})),toolbarState}function previewHighlight(_a){var toastMark=_a.toastMark,eventEmitter=_a.eventEmitter;return new Plugin({view:function(){return{update:function(view,prevState){var state=view.state,doc=state.doc,selection=state.selection;if(!(prevState&&prevState.doc.eq(doc)&&prevState.selection.eq(selection))){var from=selection.from,startChOffset=state.doc.resolve(from).start(),line,ch=from-startChOffset;from===startChOffset&&(ch+=1);var cursorPos=[state.doc.content.findIndex(from).index+1,ch],mdNode=toastMark.findNodeAtPosition(cursorPos),toolbarState=getToolbarState(mdNode);eventEmitter.emit("changeToolbarState",{cursorPos:cursorPos,mdNode:mdNode,toolbarState:toolbarState}),eventEmitter.emit("setFocusedNode",mdNode)}}}}})}var Doc=function(_super){function Doc(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(Doc,_super),Object.defineProperty(Doc.prototype,"name",{get:function(){return"doc"},enumerable:!1,configurable:!0}),Object.defineProperty(Doc.prototype,"schema",{get:function(){return{content:"block+"}},enumerable:!1,configurable:!0}),Doc}(node),mark_Mark,mark=function(){function Mark(){}return Object.defineProperty(Mark.prototype,"type",{get:function(){return"mark"},enumerable:!1,configurable:!0}),Mark.prototype.setContext=function(context){this.context=context},Mark}();function getTextByMdLine(doc,mdLine){return getTextContent(doc,mdLine-1)}function getTextContent(doc,index){return doc.child(index).textContent}var reBlockQuote=/^\s*> ?/,BlockQuote=function(_super){function BlockQuote(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(BlockQuote,_super),Object.defineProperty(BlockQuote.prototype,"name",{get:function(){return"blockQuote"},enumerable:!1,configurable:!0}),Object.defineProperty(BlockQuote.prototype,"schema",{get:function(){return{toDOM:function(){return["span",{class:clsWithMdPrefix("block-quote")},0]}}},enumerable:!1,configurable:!0}),BlockQuote.prototype.createBlockQuoteText=function(text,isBlockQuote){return isBlockQuote?text.replace(reBlockQuote,"").trim():"> "+text.trim()},BlockQuote.prototype.extendBlockQuote=function(){var _this=this;return function(_a,dispatch){var selection=_a.selection,doc=_a.doc,tr=_a.tr,schema=_a.schema,_b=getRangeInfo(selection),endFromOffset=_b.endFromOffset,endToOffset=_b.endToOffset,endIndex=_b.endIndex,to=_b.to,textContent=getTextContent(doc,endIndex),isBlockQuote;if(reBlockQuote.test(textContent)&&to>endFromOffset&&selection.empty){var isEmpty;if(!textContent.replace(reBlockQuote,"").trim())tr.deleteRange(endFromOffset,endToOffset).split(tr.mapping.map(endToOffset));else{var slicedText=textContent.slice(to-endFromOffset).trim(),node;splitAndExtendBlock(tr,endToOffset,slicedText,createTextNode(schema,_this.createBlockQuoteText(slicedText)))}return dispatch(tr),!0}return!1}},BlockQuote.prototype.commands=function(){var _this=this;return function(){return function(state,dispatch){var selection=state.selection,doc=state.doc,_a=getRangeInfo(selection),startFromOffset=_a.startFromOffset,endToOffset=_a.endToOffset,startIndex=_a.startIndex,endIndex=_a.endIndex,isBlockQuote=reBlockQuote.test(getTextContent(doc,startIndex)),tr=replaceTextNode({state:state,startIndex:startIndex,endIndex:endIndex,from:startFromOffset,createText:function(textContent){return _this.createBlockQuoteText(textContent,isBlockQuote)}});return dispatch(tr.setSelection(createTextSelection(tr,tr.mapping.map(endToOffset)))),!0}}},BlockQuote.prototype.keymaps=function(){var blockQuoteCommand=this.commands()();return{"alt-q":blockQuoteCommand,"alt-Q":blockQuoteCommand,Enter:this.extendBlockQuote()}},BlockQuote}(mark),reList=/(^\s*)([-*+] |[\d]+\. )/,reOrderedList=/(^\s*)([\d])+\.( \[[ xX]])? /,reOrderedListGroup=/^(\s*)((\d+)([.)]\s(?:\[(?:x|\s)\]\s)?))(.*)/,reCanBeTaskList=/(^\s*)([-*+]|[\d]+\.)( \[[ xX]])? /,reBulletListGroup=/^(\s*)([-*+]+(\s(?:\[(?:x|\s)\]\s)?))(.*)/,reTaskList=/(^\s*)([-*+] |[\d]+\. )(\[[ xX]] )/,reBulletTaskList=/(^\s*)([-*+])( \[[ xX]]) /;function getListType(text){return reOrderedList.test(text)?"ordered":"bullet"}function getListDepth(mdNode){for(var depth=0;mdNode&&"document"!==mdNode.type;)"list"===mdNode.type&&(depth+=1),mdNode=mdNode.parent;return depth}function findSameDepthList(toastMark,currentLine,depth,backward){for(var lineTexts,lineLen=toastMark.getLineTexts().length,result=[],line=currentLine;backward?line<lineLen:line>1;){line=backward?line+1:line-1;var mdNode=toastMark.findFirstNodeAtLine(line),currentListDepth=getListDepth(mdNode);if(currentListDepth===depth)result.push({line:line,depth:depth,mdNode:mdNode});else if(currentListDepth<depth)break}return result}function getSameDepthItems(_a){var toastMark=_a.toastMark,mdNode=_a.mdNode,line=_a.line,depth=getListDepth(mdNode),forwardList=findSameDepthList(toastMark,line,depth,!1).reverse(),backwardList=findSameDepthList(toastMark,line,depth,!0);return forwardList.concat([{line:line,depth:depth,mdNode:mdNode}]).concat(backwardList)}function textToBullet(text){if(!reList.test(text))return"* "+text;var type=getListType(text);return"bullet"===type&&reCanBeTaskList.test(text)?text=text.replace(reBulletTaskList,"$1$2 "):"ordered"===type&&(text=text.replace(reOrderedList,"$1* ")),text}function textToOrdered(text,ordinalNum){if(!reList.test(text))return ordinalNum+". "+text;var type=getListType(text);if("bullet"===type||"ordered"===type&&reCanBeTaskList.test(text))text=text.replace(reCanBeTaskList,"$1"+ordinalNum+". ");else if("ordered"===type){var start=reOrderedListGroup.exec(text)[3];Number(start)!==ordinalNum&&(text=text.replace(reOrderedList,"$1"+ordinalNum+". "))}return text}function getChangedInfo(doc,sameDepthItems,type,start){void 0===start&&(start=0);var firstIndex=Number.MAX_VALUE,lastIndex=0,changedResults;return{changedResults:sameDepthItems.map((function(_a,index){var line=_a.line;firstIndex=Math.min(line-1,firstIndex),lastIndex=Math.max(line-1,lastIndex);var text=getTextByMdLine(doc,line);return{text:text="bullet"===type?textToBullet(text):textToOrdered(text,index+1+start),line:line}})),firstIndex:firstIndex,lastIndex:lastIndex}}function getBulletOrOrdered(type,context){var sameDepthListInfo=getSameDepthItems(context);return getChangedInfo(context.doc,sameDepthListInfo,type)}var otherListToList={bullet:function(context){return getBulletOrOrdered("bullet",context)},ordered:function(context){return getBulletOrOrdered("ordered",context)},task:function(_a){var mdNode=_a.mdNode,doc=_a.doc,line=_a.line,text=getTextByMdLine(doc,line);return mdNode.listData.task?text=text.replace(reTaskList,"$1$2"):isListNode(mdNode)&&(text=text.replace(reList,"$1$2[ ] ")),{changedResults:[{text:text,line:line}]}}},otherNodeToList={bullet:function(_a){var doc=_a.doc,line=_a.line,lineText,changedResults;return{changedResults:[{text:"* "+getTextByMdLine(doc,line),line:line}]}},ordered:function(_a){for(var toastMark=_a.toastMark,doc=_a.doc,line=_a.line,startLine=_a.startLine,lineText=getTextByMdLine(doc,line),firstOrderedListNum=1,firstOrderedListLine=startLine,skipped=0,i=startLine-1;i>0;i-=1){var mdNode=toastMark.findFirstNodeAtLine(i),text,canBeListNode=getTextByMdLine(doc,i)&&!!findClosestNode(mdNode,(function(targetNode){return isListNode(targetNode)})),searchResult=reOrderedListGroup.exec(getTextByMdLine(doc,i));if(!searchResult&&!canBeListNode)break;if(searchResult||!canBeListNode){var _b=searchResult,indent=_b[1],start=_b[3];if(!indent){firstOrderedListNum=Number(start),firstOrderedListLine=i;break}}else skipped+=1}var ordinalNum,changedResults;return{changedResults:[{text:firstOrderedListNum+line-firstOrderedListLine-skipped+". "+lineText,line:line}]}},task:function(_a){var doc=_a.doc,line=_a.line,lineText,changedResults;return{changedResults:[{text:"* [ ] "+getTextByMdLine(doc,line),line:line}]}}},extendList={bullet:function(_a){var line=_a.line,doc,lineText=getTextByMdLine(_a.doc,line),_b=reBulletListGroup.exec(lineText),indent,delimiter;return{listSyntax:""+_b[1]+_b[2]}},ordered:function(_a){var toastMark=_a.toastMark,line=_a.line,mdNode=_a.mdNode,doc=_a.doc,depth=getListDepth(mdNode),lineText=getTextByMdLine(doc,line),_b=reOrderedListGroup.exec(lineText),indent=_b[1],start=_b[3],delimiter=_b[4],ordinalNum=Number(start)+1,listSyntax=""+indent+ordinalNum+delimiter,backwardList,filteredList=findSameDepthList(toastMark,line,depth,!0).filter((function(info){var searchResult=reOrderedListGroup.exec(getTextByMdLine(doc,info.line));return searchResult&&searchResult[1].length===indent.length&&!!findClosestNode(info.mdNode,(function(targetNode){return isOrderedListNode(targetNode)}))}));return __assign({listSyntax:listSyntax},getChangedInfo(doc,filteredList,"ordered",ordinalNum))}};function getReorderedListInfo(doc,schema,line,ordinalNum,prevIndentLength){for(var nodes=[],lineText=getTextByMdLine(doc,line),searchResult=reOrderedListGroup.exec(lineText);searchResult;){var indent=searchResult[1],delimiter=searchResult[4],text=searchResult[5],indentLength=indent.length;if(indentLength===prevIndentLength)nodes.push(createTextNode(schema,""+indent+ordinalNum+delimiter+text)),ordinalNum+=1,line+=1;else if(indentLength>prevIndentLength){var nestedListInfo=getReorderedListInfo(doc,schema,line,1,indentLength);line=nestedListInfo.line,nodes=nodes.concat(nestedListInfo.nodes)}if(indentLength<prevIndentLength||line>doc.childCount)break;lineText=getTextByMdLine(doc,line),searchResult=reOrderedListGroup.exec(lineText)}return{nodes:nodes,line:line}}var reStartSpace=/(^\s{1,4})(.*)/;function isBlockUnit(from,to,text){return from<to||reList.test(text)||reBlockQuote.test(text)}function isInTableCellNode(doc,schema,selection){var $pos=selection.$from;0===$pos.depth&&($pos=doc.resolve($pos.pos-1));var node=$pos.node(1),startOffset=$pos.start(1),contentSize=node.content.size;return node.rangeHasMark(0,contentSize,schema.marks.table)&&$pos.pos-startOffset!==contentSize&&$pos.pos!==startOffset}function createSelection(tr,posInfo){var from=posInfo.from,to=posInfo.to;if("indent"===posInfo.type){var softTabLen=4;from+=4,to+=4*(posInfo.lineLen+1)}else{var spaceLenList=posInfo.spaceLenList;from-=spaceLenList[0];for(var i=0;i<spaceLenList.length;i+=1)to-=spaceLenList[i]}return createTextSelection(tr,from,to)}var Paragraph=function(_super){function Paragraph(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(Paragraph,_super),Object.defineProperty(Paragraph.prototype,"name",{get:function(){return"paragraph"},enumerable:!1,configurable:!0}),Object.defineProperty(Paragraph.prototype,"schema",{get:function(){return{content:"inline*",attrs:{className:{default:null},codeStart:{default:null},codeEnd:{default:null}},selectable:!1,group:"block",parseDOM:[{tag:"div"}],toDOM:function(_a){var attrs=_a.attrs;return attrs.className?["div",{class:clsWithMdPrefix(attrs.className)},0]:["div",0]}}},enumerable:!1,configurable:!0}),Paragraph.prototype.reorderList=function(startLine,endLine){for(var _a=this.context,view=_a.view,toastMark=_a.toastMark,schema=_a.schema,_b=view.state,tr=_b.tr,selection=_b.selection,doc=_b.doc,mdNode=toastMark.findFirstNodeAtLine(startLine),topListNode=mdNode;mdNode&&!isBulletListNode(mdNode)&&"document"!==mdNode.parent.type;)if(isOrderedListNode(mdNode=mdNode.parent)){topListNode=mdNode;break}topListNode&&(startLine=topListNode.sourcepos[0][0]);var _c=reOrderedListGroup.exec(getTextByMdLine(doc,startLine)),indent=_c[1],start=_c[3],indentLen=indent.length,_d=getReorderedListInfo(doc,schema,startLine,Number(start),indentLen),line=_d.line,nodes=_d.nodes;endLine=Math.max(endLine,line-1);for(var startOffset=getNodeContentOffsetRange(doc,startLine-1).startOffset,i=startLine-1;i<=endLine-1;i+=1){var _e=doc.child(i),nodeSize=_e.nodeSize,content=_e.content,mappedFrom=tr.mapping.map(startOffset),mappedTo=mappedFrom+content.size;tr.replaceWith(mappedFrom,mappedTo,nodes[i-startLine+1]),startOffset+=nodeSize}var newSelection=createTextSelection(tr,selection.from,selection.to);view.dispatch(tr.setSelection(newSelection))},Paragraph.prototype.indent=function(tabKey){var _this=this;return void 0===tabKey&&(tabKey=!1),function(){return function(state,dispatch){var schema=state.schema,selection=state.selection,doc=state.doc,_a=getRangeInfo(selection),from=_a.from,to=_a.to,startFromOffset=_a.startFromOffset,startIndex=_a.startIndex,endIndex=_a.endIndex;if(tabKey&&isInTableCellNode(doc,schema,selection))return!1;var startLineText=getTextContent(doc,startIndex);if(tabKey&&isBlockUnit(from,to,startLineText)||!tabKey&&reList.test(startLineText)){var tr=replaceTextNode({state:state,from:startFromOffset,startIndex:startIndex,endIndex:endIndex,createText:function(textContent){return"    "+textContent}}),posInfo={type:"indent",from:from,to:to,lineLen:endIndex-startIndex};dispatch(tr.setSelection(createSelection(tr,posInfo))),reOrderedListGroup.test(startLineText)&&_this.reorderList(startIndex+1,endIndex+1)}else tabKey&&dispatch(state.tr.insert(to,createTextNode(schema,"    ")));return!0}}},Paragraph.prototype.outdent=function(tabKey){var _this=this;return void 0===tabKey&&(tabKey=!1),function(){return function(state,dispatch){var selection=state.selection,doc=state.doc,schema=state.schema,_a=getRangeInfo(selection),from=_a.from,to=_a.to,startFromOffset=_a.startFromOffset,startIndex=_a.startIndex,endIndex=_a.endIndex;if(tabKey&&isInTableCellNode(doc,schema,selection))return!1;var startLineText=getTextContent(doc,startIndex);if(tabKey&&isBlockUnit(from,to,startLineText)||!tabKey&&reList.test(startLineText)){var spaceLenList_1=[],tr=replaceTextNode({state:state,from:startFromOffset,startIndex:startIndex,endIndex:endIndex,createText:function(textContent){var searchResult=reStartSpace.exec(textContent);return spaceLenList_1.push(searchResult?searchResult[1].length:0),textContent.replace(reStartSpace,"$2")}}),posInfo={type:"outdent",from:from,to:to,spaceLenList:spaceLenList_1};dispatch(tr.setSelection(createSelection(tr,posInfo))),reOrderedListGroup.test(startLineText)&&_this.reorderList(startIndex+1,endIndex+1)}else if(tabKey){var startText=startLineText.slice(0,to-startFromOffset),startTextWithoutSpace=startText.replace(/\s{1,4}$/,""),deletStart=to-(startText.length-startTextWithoutSpace.length);dispatch(state.tr.delete(deletStart,to))}return!0}}},Paragraph.prototype.deleteLines=function(){var _this=this;return function(state,dispatch){var view=_this.context.view,_a=getRangeInfo(state.selection),startFromOffset=_a.startFromOffset,endToOffset=_a.endToOffset,deleteRange;return chainCommands((function(){return dispatch(state.tr.deleteRange(startFromOffset,endToOffset)),!0}),joinForward)(state,dispatch,view)}},Paragraph.prototype.moveDown=function(){return function(state,dispatch){var doc=state.doc,tr=state.tr,selection=state.selection,schema=state.schema,_a=getRangeInfo(selection),startFromOffset=_a.startFromOffset,endToOffset=_a.endToOffset,endIndex=_a.endIndex;if(endIndex<doc.content.childCount-1){var _b=doc.child(endIndex+1),nodeSize=_b.nodeSize,textContent=_b.textContent;return tr.delete(endToOffset,endToOffset+nodeSize).split(startFromOffset).insert(tr.mapping.map(startFromOffset)-2,createTextNode(schema,textContent)),dispatch(tr),!0}return!1}},Paragraph.prototype.moveUp=function(){return function(state,dispatch){var tr=state.tr,doc=state.doc,selection=state.selection,schema=state.schema,_a=getRangeInfo(selection),startFromOffset=_a.startFromOffset,endToOffset=_a.endToOffset,startIndex=_a.startIndex;if(startIndex>0){var _b=doc.child(startIndex-1),nodeSize=_b.nodeSize,textContent=_b.textContent;return tr.delete(startFromOffset-nodeSize,startFromOffset).split(tr.mapping.map(endToOffset)).insert(tr.mapping.map(endToOffset),createTextNode(schema,textContent)),dispatch(tr),!0}return!1}},Paragraph.prototype.commands=function(){return{indent:this.indent(),outdent:this.outdent()}},Paragraph.prototype.keymaps=function(){return{Tab:this.indent(!0)(),"Shift-Tab":this.outdent(!0)(),"Mod-d":this.deleteLines(),"Mod-D":this.deleteLines(),"Alt-ArrowUp":this.moveUp(),"Alt-ArrowDown":this.moveDown()}},Paragraph}(node),Text=function(_super){function Text(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(Text,_super),Object.defineProperty(Text.prototype,"name",{get:function(){return"text"},enumerable:!1,configurable:!0}),Object.defineProperty(Text.prototype,"schema",{get:function(){return{group:"inline"}},enumerable:!1,configurable:!0}),Text}(node),reHeading=/^#{1,6}\s/,Heading=function(_super){function Heading(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(Heading,_super),Object.defineProperty(Heading.prototype,"name",{get:function(){return"heading"},enumerable:!1,configurable:!0}),Object.defineProperty(Heading.prototype,"schema",{get:function(){return{attrs:{level:{default:1},seText:{default:!1}},toDOM:function(_a){var attrs=_a.attrs,level,seText,classNames="heading|heading"+attrs.level;return attrs.seText&&(classNames+="|delimiter|setext"),["span",{class:clsWithMdPrefix.apply(void 0,classNames.split("|"))},0]}}},enumerable:!1,configurable:!0}),Heading.prototype.createHeadingText=function(level,text,curHeadingSyntax){for(var textContent=text.replace(curHeadingSyntax,"").trim(),headingText="";level>0;)headingText+="#",level-=1;return headingText+" "+textContent},Heading.prototype.commands=function(){var _this=this;return function(payload){return function(state,dispatch){var level=payload.level,_a=getRangeInfo(state.selection),startFromOffset=_a.startFromOffset,endToOffset=_a.endToOffset,startIndex,endIndex,tr=replaceTextNode({state:state,from:startFromOffset,startIndex:_a.startIndex,endIndex:_a.endIndex,createText:function(textContent){var matchedHeading=textContent.match(reHeading),curHeadingSyntax=matchedHeading?matchedHeading[0]:"";return _this.createHeadingText(level,textContent,curHeadingSyntax)}});return dispatch(tr.setSelection(createTextSelection(tr,tr.mapping.map(endToOffset)))),!0}}},Heading}(mark),fencedCodeBlockSyntax="```",CodeBlock=function(_super){function CodeBlock(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(CodeBlock,_super),Object.defineProperty(CodeBlock.prototype,"name",{get:function(){return"codeBlock"},enumerable:!1,configurable:!0}),Object.defineProperty(CodeBlock.prototype,"schema",{get:function(){return{toDOM:function(){return["span",{class:clsWithMdPrefix("code-block")},0]}}},enumerable:!1,configurable:!0}),CodeBlock.prototype.commands=function(){return function(){return function(state,dispatch){var selection=state.selection,schema=state.schema,tr=state.tr,_a=getRangeInfo(selection),startFromOffset=_a.startFromOffset,endToOffset=_a.endToOffset,fencedNode=createTextNode(schema,"```");return tr.insert(startFromOffset,fencedNode).split(startFromOffset+"```".length),tr.split(tr.mapping.map(endToOffset)).insert(tr.mapping.map(endToOffset),fencedNode),dispatch(tr.setSelection(createTextSelection(tr,tr.mapping.map(endToOffset)-("```".length+2)))),!0}}},CodeBlock.prototype.keepIndentation=function(){var _this=this;return function(_a,dispatch){var selection=_a.selection,tr=_a.tr,doc=_a.doc,schema=_a.schema,toastMark=_this.context.toastMark,_b=getRangeInfo(selection),startFromOffset=_b.startFromOffset,endToOffset=_b.endToOffset,endIndex=_b.endIndex,from=_b.from,to=_b.to,textContent=getTextContent(doc,endIndex);if(from===to&&textContent.trim()){var matched=textContent.match(/^\s+/),mdNode;if(isCodeBlockNode(toastMark.findFirstNodeAtLine(endIndex+1))&&matched){var spaces=matched[0],slicedText=textContent.slice(to-startFromOffset),node;return splitAndExtendBlock(tr,endToOffset,slicedText,createTextNode(schema,spaces+slicedText)),dispatch(tr),!0}}return!1}},CodeBlock.prototype.keymaps=function(){var codeBlockCommand=this.commands()();return{"Shift-Mod-p":codeBlockCommand,"Shift-Mod-P":codeBlockCommand,Enter:this.keepIndentation()}},CodeBlock}(mark),reEmptyTable=/\||\s/g;function createTableHeader(columnCount){return[createTableRow(columnCount),createTableRow(columnCount,!0)]}function createTableBody(columnCount,rowCount){for(var bodyRows=[],i=0;i<rowCount;i+=1)bodyRows.push(createTableRow(columnCount));return bodyRows}function createTableRow(columnCount,delim){for(var row="|",i=0;i<columnCount;i+=1)row+=delim?" --- |":"  |";return row}function createTargetTypes(moveNext){return moveNext?{type:"next",parentType:"tableHead",childType:"firstChild"}:{type:"prev",parentType:"tableBody",childType:"lastChild"}}var Table=function(_super){function Table(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(Table,_super),Object.defineProperty(Table.prototype,"name",{get:function(){return"table"},enumerable:!1,configurable:!0}),Object.defineProperty(Table.prototype,"schema",{get:function(){return{toDOM:function(){return["span",{class:clsWithMdPrefix("table")},0]}}},enumerable:!1,configurable:!0}),Table.prototype.extendTable=function(){var _this=this;return function(_a,dispatch){var selection=_a.selection,doc=_a.doc,tr=_a.tr,schema=_a.schema;if(!selection.empty)return!1;var _b=getRangeInfo(selection),endFromOffset=_b.endFromOffset,endToOffset=_b.endToOffset,endIndex=_b.endIndex,to=_b.to,textContent=getTextContent(doc,endIndex),mdPos=[endIndex+1,to-endFromOffset+1],mdNode,cellNode=findClosestNode(_this.context.toastMark.findNodeAtPosition(mdPos),(function(node){return isTableCellNode(node)&&("tableDelimRow"===node.parent.type||"tableBody"===node.parent.parent.type)}));if(cellNode){var isEmpty=!textContent.replace(reEmptyTable,"").trim(),parent,columnCount,row=createTableRow(cellNode.parent.parent.parent.columns.length);return isEmpty?tr.deleteRange(endFromOffset,endToOffset).split(tr.mapping.map(endToOffset)):tr.split(endToOffset).insert(tr.mapping.map(endToOffset),createTextNode(schema,row)).setSelection(createTextSelection(tr,tr.mapping.map(endToOffset)-2)),dispatch(tr),!0}return!1}},Table.prototype.moveTableCell=function(moveNext){var _this=this;return function(_a,dispatch){var selection=_a.selection,tr=_a.tr,_b=getRangeInfo(selection),endFromOffset=_b.endFromOffset,endIndex,to,mdPos=[_b.endIndex+1,_b.to-endFromOffset],mdNode,cellNode=findClosestNode(_this.context.toastMark.findNodeAtPosition(mdPos),(function(node){return isTableCellNode(node)}));if(cellNode){var parent=cellNode.parent,_c=createTargetTypes(moveNext),type=_c.type,parentType=_c.parentType,childType=_c.childType,chOffset=getMdEndCh(cellNode);if(cellNode[type])chOffset=getMdEndCh(cellNode[type])-1;else{var row=parent[type]||parent.parent.type!==parentType?parent[type]:parent.parent[type][childType],baseOffset;if("next"===type)chOffset+=(row?getMdEndCh(row[childType]):0)+2;else"prev"===type&&(chOffset=row?-4:0)}return dispatch(tr.setSelection(createTextSelection(tr,endFromOffset+chOffset))),!0}return!1}},Table.prototype.addTable=function(){return function(payload){return function(_a,dispatch){var selection=_a.selection,tr=_a.tr,schema=_a.schema,_b=payload,columnCount=_b.columnCount,rowCount=_b.rowCount,endToOffset=getRangeInfo(selection).endToOffset,headerRows=createTableHeader(columnCount),bodyRows=createTableBody(columnCount,rowCount-1),rows;return __spreadArray(__spreadArray([],headerRows),bodyRows).forEach((function(row){tr.split(tr.mapping.map(endToOffset)).insert(tr.mapping.map(endToOffset),createTextNode(schema,row))})),dispatch(tr.setSelection(createTextSelection(tr,endToOffset+4))),!0}}},Table.prototype.commands=function(){return{addTable:this.addTable()}},Table.prototype.keymaps=function(){return{Enter:this.extendTable(),Tab:this.moveTableCell(!0),"Shift-Tab":this.moveTableCell(!1)}},Table}(mark),thematicBreakSyntax="***",ThematicBreak=function(_super){function ThematicBreak(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(ThematicBreak,_super),Object.defineProperty(ThematicBreak.prototype,"name",{get:function(){return"thematicBreak"},enumerable:!1,configurable:!0}),Object.defineProperty(ThematicBreak.prototype,"schema",{get:function(){return{toDOM:function(){return["span",{class:clsWithMdPrefix("thematic-break")},0]}}},enumerable:!1,configurable:!0}),ThematicBreak.prototype.hr=function(){return function(){return function(state,dispatch){var selection=state.selection,schema=state.schema,tr=state.tr,_a=getRangeInfo(selection),from=_a.from,to=_a.to,endToOffset=_a.endToOffset,node=createTextNode(schema,"***");return tr.split(from).replaceWith(tr.mapping.map(from),tr.mapping.map(to),node).split(tr.mapping.map(to)).setSelection(createTextSelection(tr,tr.mapping.map(endToOffset))),dispatch(tr),!0}}},ThematicBreak.prototype.commands=function(){return{hr:this.hr()}},ThematicBreak.prototype.keymaps=function(){var lineCommand=this.hr()();return{"Mod-l":lineCommand,"Mod-L":lineCommand}},ThematicBreak}(mark);function cannotBeListNode(_a){var type=_a.type;return"codeBlock"===type||"heading"===type||-1!==type.indexOf("table")}var ListItem=function(_super){function ListItem(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(ListItem,_super),Object.defineProperty(ListItem.prototype,"name",{get:function(){return"listItem"},enumerable:!1,configurable:!0}),Object.defineProperty(ListItem.prototype,"schema",{get:function(){return{attrs:{odd:{default:!1},even:{default:!1},listStyle:{default:!1}},toDOM:function(_a){var attrs=_a.attrs,odd=attrs.odd,even=attrs.even,listStyle,classNames="list-item";return attrs.listStyle&&(classNames+="|list-item-style"),odd&&(classNames+="|list-item-odd"),even&&(classNames+="|list-item-even"),["span",{class:clsWithMdPrefix.apply(void 0,classNames.split("|"))},0]}}},enumerable:!1,configurable:!0}),ListItem.prototype.extendList=function(){var _this=this;return function(_a,dispatch){var selection=_a.selection,doc=_a.doc,schema=_a.schema,tr=_a.tr,toastMark=_this.context.toastMark,_b=getRangeInfo(selection),to=_b.to,startFromOffset=_b.startFromOffset,endFromOffset=_b.endFromOffset,endIndex=_b.endIndex,endToOffset=_b.endToOffset,textContent=getTextContent(doc,endIndex),isList,isEmpty;if(!reList.test(textContent)||selection.from===startFromOffset||!selection.empty)return!1;if(!textContent.replace(reCanBeTaskList,"").trim())tr.deleteRange(endFromOffset,endToOffset).split(tr.mapping.map(endToOffset));else{var commandType=getListType(textContent),mdNode=toastMark.findFirstNodeAtLine(endIndex+1),slicedText=textContent.slice(to-endFromOffset),context={toastMark:toastMark,mdNode:mdNode,doc:doc,line:endIndex+1},_c=extendList[commandType](context),listSyntax=_c.listSyntax,changedResults=_c.changedResults;if(null==changedResults?void 0:changedResults.length){tr.split(to),changedResults.unshift({text:listSyntax+slicedText,line:endIndex+1}),_this.changeToListPerLine(tr,changedResults,{from:to,startLine:changedResults[0].line,endLine:last(changedResults).line});var pos=tr.mapping.map(endToOffset)-slicedText.length;tr.setSelection(createTextSelection(tr,pos))}else{var node;splitAndExtendBlock(tr,endToOffset,slicedText,createTextNode(schema,listSyntax+slicedText))}}return dispatch(tr),!0}},ListItem.prototype.toList=function(commandType){var _this=this;return function(){return function(_a,dispatch){for(var doc=_a.doc,tr=_a.tr,selection=_a.selection,toastMark=_this.context.toastMark,rangeInfo=getRangeInfo(selection),startLine=rangeInfo.startIndex+1,endLine=rangeInfo.endIndex+1,endToOffset=rangeInfo.endToOffset,skipLines=[],line=startLine;line<=endLine;line+=1){var mdNode=toastMark.findFirstNodeAtLine(line);if(mdNode&&cannotBeListNode(mdNode))break;if(-1===skipLines.indexOf(line)){var context={toastMark:toastMark,mdNode:mdNode,doc:doc,line:line,startLine:startLine},changedResults=(isListNode(mdNode)?otherListToList[commandType](context):otherNodeToList[commandType](context)).changedResults,endOffset=_this.changeToListPerLine(tr,changedResults,{from:getNodeContentOffsetRange(doc,changedResults[0].line-1).startOffset,startLine:changedResults[0].line,endLine:last(changedResults).line,indexDiff:1});endToOffset=Math.max(endOffset,endToOffset),changedResults&&(skipLines=skipLines.concat(changedResults.map((function(info){return info.line}))))}}return dispatch(tr.setSelection(createTextSelection(tr,tr.mapping.map(endToOffset)))),!0}}},ListItem.prototype.changeToListPerLine=function(tr,changedResults,_a){for(var from=_a.from,startLine=_a.startLine,endLine=_a.endLine,_b=_a.indexDiff,indexDiff=void 0===_b?0:_b,maxEndOffset=0,_loop_1=function(i){var _c=tr.doc.child(i),nodeSize=_c.nodeSize,content=_c.content,mappedFrom=tr.mapping.map(from),mappedTo=mappedFrom+content.size,changedResult=changedResults.filter((function(result){return result.line-indexDiff===i}))[0];changedResult&&(tr.replaceWith(mappedFrom,mappedTo,createTextNode(this_1.context.schema,changedResult.text)),maxEndOffset=Math.max(maxEndOffset,from+content.size)),from+=nodeSize},this_1=this,i=startLine-indexDiff;i<=endLine-indexDiff;i+=1)_loop_1(i);return maxEndOffset},ListItem.prototype.toggleTask=function(){var _this=this;return function(_a,dispatch){for(var selection=_a.selection,tr=_a.tr,doc=_a.doc,schema=_a.schema,toastMark=_this.context.toastMark,_b=getRangeInfo(selection),startIndex=_b.startIndex,endIndex=_b.endIndex,newTr=null,i=startIndex;i<=endIndex;i+=1){var mdNode=toastMark.findFirstNodeAtLine(i+1);if(isListNode(mdNode)&&mdNode.listData.task){var _c=mdNode.listData,checked=_c.checked,padding=_c.padding,stateChar=checked?" ":"x",mdPos=mdNode.sourcepos[0],startOffset=getNodeContentOffsetRange(doc,mdPos[0]-1).startOffset;startOffset+=mdPos[1]+padding,newTr=tr.replaceWith(startOffset,startOffset+1,schema.text(stateChar))}}return!!newTr&&(dispatch(newTr),!0)}},ListItem.prototype.commands=function(){return{bulletList:this.toList("bullet"),orderedList:this.toList("ordered"),taskList:this.toList("task")}},ListItem.prototype.keymaps=function(){var bulletCommand=this.toList("bullet")(),orderedCommand=this.toList("ordered")(),taskCommand=this.toList("task")(),togleTaskCommand=this.toggleTask();return{"Mod-u":bulletCommand,"Mod-U":bulletCommand,"Mod-o":orderedCommand,"Mod-O":orderedCommand,"alt-t":taskCommand,"alt-T":taskCommand,"Shift-Ctrl-x":togleTaskCommand,"Shift-Ctrl-X":togleTaskCommand,Enter:this.extendList()}},ListItem}(mark);function mdCommand_toggleMark(condition,syntax){return function(){return function(_a,dispatch){var tr=_a.tr,selection=_a.selection,conditionFn=isFunction_default()(condition)?condition:function(text){return condition.test(text)},syntaxLen=syntax.length,doc=tr.doc,_b=resolveSelectionPos(selection),from=_b[0],to=_b[1],prevPos=Math.max(from-syntaxLen,1),nextPos=Math.min(to+syntaxLen,doc.content.size-1),slice=selection.content(),textContent=slice.content.textBetween(0,slice.content.size,"\n"),prevText=doc.textBetween(prevPos,from,"\n"),nextText=doc.textBetween(to,nextPos,"\n");if(textContent=""+prevText+textContent+nextText,prevText&&nextText&&conditionFn(textContent))tr.delete(nextPos-syntaxLen,nextPos).delete(prevPos,prevPos+syntaxLen);else{tr.insertText(syntax,to).insertText(syntax,from);var newSelection=selection.empty?createTextSelection(tr,from+syntaxLen):createTextSelection(tr,from+syntaxLen,to+syntaxLen);tr.setSelection(newSelection)}return dispatch(tr),!0}}}var reStrong=/^(\*{2}|_{2}).*([\s\S]*)\1$/m,strongSyntax="**",Strong=function(_super){function Strong(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(Strong,_super),Object.defineProperty(Strong.prototype,"name",{get:function(){return"strong"},enumerable:!1,configurable:!0}),Object.defineProperty(Strong.prototype,"schema",{get:function(){return{toDOM:function(){return["span",{class:clsWithMdPrefix("strong")},0]}}},enumerable:!1,configurable:!0}),Strong.prototype.bold=function(){return mdCommand_toggleMark(reStrong,"**")},Strong.prototype.commands=function(){return{bold:this.bold()}},Strong.prototype.keymaps=function(){var boldCommand=this.bold()();return{"Mod-b":boldCommand,"Mod-B":boldCommand}},Strong}(mark),reStrike=/^(~{2}).*([\s\S]*)\1$/m,strikeSyntax="~~",Strike=function(_super){function Strike(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(Strike,_super),Object.defineProperty(Strike.prototype,"name",{get:function(){return"strike"},enumerable:!1,configurable:!0}),Object.defineProperty(Strike.prototype,"schema",{get:function(){return{toDOM:function(){return["span",{class:clsWithMdPrefix("strike")},0]}}},enumerable:!1,configurable:!0}),Strike.prototype.commands=function(){return mdCommand_toggleMark(reStrike,"~~")},Strike.prototype.keymaps=function(){var strikeCommand=this.commands()();return{"Mod-s":strikeCommand,"Mod-S":strikeCommand}},Strike}(mark),reEmph=/^(\*|_).*([\s\S]*)\1$/m,emphSyntax="*",Emph=function(_super){function Emph(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(Emph,_super),Object.defineProperty(Emph.prototype,"name",{get:function(){return"emph"},enumerable:!1,configurable:!0}),Object.defineProperty(Emph.prototype,"schema",{get:function(){return{toDOM:function(){return["span",{class:clsWithMdPrefix("emph")},0]}}},enumerable:!1,configurable:!0}),Emph.prototype.italic=function(){return mdCommand_toggleMark(reEmph,"*")},Emph.prototype.commands=function(){return{italic:this.italic()}},Emph.prototype.keymaps=function(){var italicCommand=this.italic()();return{"Mod-i":italicCommand,"Mod-I":italicCommand}},Emph}(mark),reCode=/^(`).*([\s\S]*)\1$/m,codeSyntax="`",Code=function(_super){function Code(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(Code,_super),Object.defineProperty(Code.prototype,"name",{get:function(){return"code"},enumerable:!1,configurable:!0}),Object.defineProperty(Code.prototype,"schema",{get:function(){return{attrs:{start:{default:!1},end:{default:!1},marked:{default:!1}},toDOM:function(mark){var _a=mark.attrs,start,end,marked,classNames="code";return _a.start&&(classNames+="|delimiter|start"),_a.end&&(classNames+="|delimiter|end"),_a.marked&&(classNames+="|marked-text"),["span",{class:clsWithMdPrefix.apply(void 0,classNames.split("|"))},0]}}},enumerable:!1,configurable:!0}),Code.prototype.commands=function(){return mdCommand_toggleMark(reCode,"`")},Code.prototype.keymaps=function(){var codeCommand=this.commands()();return{"Shift-Mod-c":codeCommand,"Shift-Mod-C":codeCommand}},Code}(mark),encoderList=[{regExp:/\(/g,encoded:"%28",escaped:"\\("},{regExp:/\)/g,encoded:"%29",escaped:"\\)"},{regExp:/\[/g,encoded:"%5B",escaped:"\\["},{regExp:/\]/g,encoded:"%5D",escaped:"\\]"},{regExp:/</g,encoded:"%3C",escaped:"\\<"},{regExp:/>/g,encoded:"%3E",escaped:"\\>"},{regExp:/ /g,encoded:"%20",escaped:" "}];function escapeMarkdownText(text){return encoderList.reduce((function(result,_a){var regExp=_a.regExp,escaped=_a.escaped;return result.replace(regExp,escaped)}),text)}function encodeMarkdownText(text){return encoderList.reduce((function(result,_a){var regExp=_a.regExp,encoded=_a.encoded;return result.replace(regExp,encoded)}),text)}var Link=function(_super){function Link(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(Link,_super),Object.defineProperty(Link.prototype,"name",{get:function(){return"link"},enumerable:!1,configurable:!0}),Object.defineProperty(Link.prototype,"schema",{get:function(){return{attrs:{url:{default:!1},desc:{default:!1}},toDOM:function(_a){var attrs=_a.attrs,url,desc,classNames="link";return attrs.url&&(classNames+="|link-url|marked-text"),attrs.desc&&(classNames+="|link-desc|marked-text"),["span",{class:clsWithMdPrefix.apply(void 0,classNames.split("|"))},0]}}},enumerable:!1,configurable:!0}),Link.prototype.addLinkOrImage=function(commandType){return function(payload){return function(_a,dispatch){var selection=_a.selection,tr=_a.tr,schema=_a.schema,_b=resolveSelectionPos(selection),from=_b[0],to=_b[1],_c=payload,linkText=_c.linkText,altText=_c.altText,linkUrl=_c.linkUrl,imageUrl=_c.imageUrl,text=linkText,url=linkUrl,syntax="";return"image"===commandType&&(text=altText,url=imageUrl,syntax="!"),syntax+="["+(text=escapeMarkdownText(text))+"]("+(url=encodeMarkdownText(url))+")",dispatch(tr.replaceWith(from,to,createTextNode(schema,syntax))),!0}}},Link.prototype.commands=function(){return{addImage:this.addLinkOrImage("image"),addLink:this.addLinkOrImage("link")}},Link}(mark),TaskDelimiter=function(_super){function TaskDelimiter(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(TaskDelimiter,_super),Object.defineProperty(TaskDelimiter.prototype,"name",{get:function(){return"taskDelimiter"},enumerable:!1,configurable:!0}),Object.defineProperty(TaskDelimiter.prototype,"schema",{get:function(){return{toDOM:function(){return["span",{class:clsWithMdPrefix("delimiter","list-item")},0]}}},enumerable:!1,configurable:!0}),TaskDelimiter}(mark),Delimiter=function(_super){function Delimiter(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(Delimiter,_super),Object.defineProperty(Delimiter.prototype,"name",{get:function(){return"delimiter"},enumerable:!1,configurable:!0}),Object.defineProperty(Delimiter.prototype,"schema",{get:function(){return{toDOM:function(){return["span",{class:clsWithMdPrefix("delimiter")},0]}}},enumerable:!1,configurable:!0}),Delimiter}(mark),Meta=function(_super){function Meta(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(Meta,_super),Object.defineProperty(Meta.prototype,"name",{get:function(){return"meta"},enumerable:!1,configurable:!0}),Object.defineProperty(Meta.prototype,"schema",{get:function(){return{toDOM:function(){return["span",{class:clsWithMdPrefix("meta")},0]}}},enumerable:!1,configurable:!0}),Meta}(mark),MarkedText=function(_super){function MarkedText(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(MarkedText,_super),Object.defineProperty(MarkedText.prototype,"name",{get:function(){return"markedText"},enumerable:!1,configurable:!0}),Object.defineProperty(MarkedText.prototype,"schema",{get:function(){return{toDOM:function(){return["span",{class:clsWithMdPrefix("marked-text")},0]}}},enumerable:!1,configurable:!0}),MarkedText}(mark),TableCell=function(_super){function TableCell(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(TableCell,_super),Object.defineProperty(TableCell.prototype,"name",{get:function(){return"tableCell"},enumerable:!1,configurable:!0}),Object.defineProperty(TableCell.prototype,"schema",{get:function(){return{toDOM:function(){return["span",{class:clsWithMdPrefix("table-cell")},0]}}},enumerable:!1,configurable:!0}),TableCell}(mark),Html=function(_super){function Html(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(Html,_super),Object.defineProperty(Html.prototype,"name",{get:function(){return"html"},enumerable:!1,configurable:!0}),Object.defineProperty(Html.prototype,"schema",{get:function(){return{toDOM:function(){return["span",{class:clsWithMdPrefix("html")},0]}}},enumerable:!1,configurable:!0}),Html}(mark),CustomBlock=function(_super){function CustomBlock(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(CustomBlock,_super),Object.defineProperty(CustomBlock.prototype,"name",{get:function(){return"customBlock"},enumerable:!1,configurable:!0}),Object.defineProperty(CustomBlock.prototype,"schema",{get:function(){return{toDOM:function(){return["span",{class:clsWithMdPrefix("custom-block")},0]}}},enumerable:!1,configurable:!0}),CustomBlock}(mark),reTaskMarkerKey=/x|backspace/i,reTaskMarker=/^\[(\s*)(x?)(\s*)\](?:\s+)/i;function smartTask(_a){var schema=_a.schema,toastMark=_a.toastMark;return new Plugin({props:{handleDOMEvents:{keyup:function(view,ev){var _a=view.state,doc=_a.doc,tr=_a.tr,selection=_a.selection;if(selection.empty&&reTaskMarkerKey.test(ev.key)){var _b=getRangeInfo(selection),startIndex=_b.startIndex,startFromOffset=_b.startFromOffset,from,mdPos=[startIndex+1,_b.from-startFromOffset+1],mdNode,paraNode=findClosestNode(toastMark.findNodeAtPosition(mdPos),(function(node){var _a;return"paragraph"===node.type&&"item"===(null===(_a=node.parent)||void 0===_a?void 0:_a.type)}));if(paraNode&&paraNode.firstChild){var firstChild=paraNode.firstChild,matched=firstChild.literal.match(reTaskMarker);if(matched){var startMdPos=firstChild.sourcepos[0],startSpaces=matched[1],stateChar=matched[2],lastSpaces=matched[3],spaces=startSpaces.length+lastSpaces.length,startOffset=getNodeContentOffsetRange(doc,startMdPos[0]-1).startOffset,startPos=startMdPos[1]+startOffset;if(stateChar){var addedPos=spaces?spaces+1:0;tr.replaceWith(startPos,addedPos+startPos,schema.text(stateChar)),view.dispatch(tr)}else spaces||(tr.insertText(" ",startPos),view.dispatch(tr))}}}return!1}}}})}var EVENT_TYPE="cut",MdEditor,mdEditor=function(_super){function MdEditor(eventEmitter,options){var _this=_super.call(this,eventEmitter)||this,toastMark=options.toastMark,_a=options.useCommandShortcut,useCommandShortcut=void 0===_a||_a,_b=options.mdPlugins,mdPlugins=void 0===_b?[]:_b;return _this.editorType="markdown",_this.el.classList.add("md-mode"),_this.toastMark=toastMark,_this.extraPlugins=mdPlugins,_this.specs=_this.createSpecs(),_this.schema=_this.createSchema(),_this.context=_this.createContext(),_this.keymaps=_this.createKeymaps(useCommandShortcut),_this.view=_this.createView(),_this.commands=_this.createCommands(),_this.specs.setContext(__assign(__assign({},_this.context),{view:_this.view})),_this.createClipboard(),_this.eventEmitter.listen("changePreviewTabWrite",(function(){return _this.toggleActive(!0)})),_this.eventEmitter.listen("changePreviewTabPreview",(function(){return _this.toggleActive(!1)})),_this.initEvent(),_this}return __extends(MdEditor,_super),MdEditor.prototype.toggleActive=function(active){toggleClass(this.el,"active",active),active?this.focus():this.blur()},MdEditor.prototype.createClipboard=function(){var _this=this;this.clipboard=document.createElement("textarea"),this.clipboard.className=cls("pseudo-clipboard"),this.clipboard.addEventListener("paste",(function(ev){var clipboardData=ev.clipboardData||window.clipboardData,items=clipboardData&&clipboardData.items;if(items){var imageBlob=pasteImageOnly(items);imageBlob&&(ev.preventDefault(),emitImageBlobHook(_this.eventEmitter,imageBlob,ev.type))}})),this.clipboard.addEventListener("input",(function(ev){var text=ev.target.value;_this.replaceSelection(text),ev.preventDefault(),ev.target.value=""})),this.el.insertBefore(this.clipboard,this.view.dom)},MdEditor.prototype.createContext=function(){return{toastMark:this.toastMark,schema:this.schema,eventEmitter:this.eventEmitter}},MdEditor.prototype.createSpecs=function(){return new specManager([new Doc,new Paragraph,new Widget,new Text,new Heading,new BlockQuote,new CodeBlock,new CustomBlock,new Table,new TableCell,new ThematicBreak,new ListItem,new Strong,new Strike,new Emph,new Code,new Link,new Delimiter,new TaskDelimiter,new MarkedText,new Meta,new Html])},MdEditor.prototype.createPlugins=function(){return this.defaultPlugins.concat(__spreadArray([syntaxHighlight(this.context),previewHighlight(this.context),smartTask(this.context)],this.createPluginProps()))},MdEditor.prototype.createView=function(){var _this=this;return new EditorView(this.el,{state:this.createState(),dispatchTransaction:function(tr){_this.updateMarkdown(tr);var state=_this.view.state.applyTransaction(tr).state;_this.view.updateState(state),_this.emitChangeEvent(tr)},handleKeyDown:function(_,ev){return(ev.metaKey||ev.ctrlKey)&&"V"===ev.key.toUpperCase()&&_this.clipboard.focus(),_this.eventEmitter.emit("keydown",_this.editorType,ev),!1},handleDOMEvents:{copy:function(_,ev){return _this.captureCopy(ev)},cut:function(_,ev){return _this.captureCopy(ev,"cut")},scroll:function(){return _this.eventEmitter.emit("scroll","editor"),!0},keyup:function(_,ev){return _this.eventEmitter.emit("keyup",_this.editorType,ev),!1}},nodeViews:{widget:widgetNodeView}})},MdEditor.prototype.createCommands=function(){return this.specs.commands(this.view)},MdEditor.prototype.captureCopy=function(ev,type){ev.preventDefault();var _a=this.view.state,selection=_a.selection,tr=_a.tr;if(selection.empty)return!0;var text=this.getChanged(selection.content());return ev.clipboardData?ev.clipboardData.setData("text/plain",text):window.clipboardData.setData("Text",text),"cut"===type&&this.view.dispatch(tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut")),!0},MdEditor.prototype.updateMarkdown=function(tr){var _this=this;tr.docChanged&&tr.steps.forEach((function(step,index){if(step.slice&&!(step instanceof ReplaceAroundStep)){var doc=tr.docs[index],_a=[step.from,step.to],from,to,_b=getEditorToMdPos(doc,_a[0],_a[1]),startPos=_b[0],endPos=_b[1],changed=_this.getChanged(step.slice);startPos[0]===endPos[0]&&startPos[1]===endPos[1]&&""===changed&&(changed="\n");var editResult=_this.toastMark.editMarkdown(startPos,endPos,changed);_this.eventEmitter.emit("updatePreview",editResult),tr.setMeta("editResult",editResult).scrollIntoView()}}))},MdEditor.prototype.getChanged=function(slice){var changed="",from=0,to=slice.content.size;return slice.content.nodesBetween(0,to,(function(node,pos){node.isText?changed+=node.text.slice(Math.max(0,pos)-pos,to-pos):node.isBlock&&pos>0&&(changed+="\n")})),changed},MdEditor.prototype.setSelection=function(start,end){void 0===end&&(end=start);var tr=this.view.state.tr,_a=getMdToEditorPos(tr.doc,start,end),from=_a[0],to=_a[1];this.view.dispatch(tr.setSelection(createTextSelection(tr,from,to)).scrollIntoView())},MdEditor.prototype.replaceSelection=function(text,start,end){var newTr,_a=this.view.state,tr=_a.tr,schema=_a.schema,doc=_a.doc,lineTexts,nodes=text.split("\n").map((function(lineText){return createParagraph(schema,createNodesWithWidget(lineText,schema))})),slice=new Slice(Fragment.from(nodes),1,1);if(this.focus(),start&&end){var _b=getMdToEditorPos(doc,start,end),from=_b[0],to=_b[1];newTr=tr.replaceRange(from,to,slice)}else newTr=tr.replaceSelection(slice);this.view.dispatch(newTr.scrollIntoView())},MdEditor.prototype.deleteSelection=function(start,end){var newTr,_a=this.view.state,tr=_a.tr,doc=_a.doc;if(start&&end){var _b=getMdToEditorPos(doc,start,end),from=_b[0],to=_b[1];newTr=tr.deleteRange(from,to)}else newTr=tr.deleteSelection();this.view.dispatch(newTr.scrollIntoView())},MdEditor.prototype.getSelectedText=function(start,end){var _a=this.view.state,doc=_a.doc,selection=_a.selection,from=selection.from,to=selection.to;if(start&&end){var pos=getMdToEditorPos(doc,start,end);from=pos[0],to=pos[1]}return doc.textBetween(from,to,"\n")},MdEditor.prototype.getSelection=function(){var _a=this.view.state.selection,from=_a.from,to=_a.to;return getEditorToMdPos(this.view.state.tr.doc,from,to)},MdEditor.prototype.setMarkdown=function(markdown,cursorToEnd){void 0===cursorToEnd&&(cursorToEnd=!0);var lineTexts=markdown.split("\n"),_a=this.view.state,tr=_a.tr,doc=_a.doc,schema=_a.schema,nodes=lineTexts.map((function(lineText){return createParagraph(schema,createNodesWithWidget(lineText,schema))}));this.view.dispatch(tr.replaceWith(0,doc.content.size,nodes)),cursorToEnd&&this.moveCursorToEnd()},MdEditor.prototype.addWidget=function(node,style,mdPos){var _a=this.view.state,tr=_a.tr,doc=_a.doc,selection=_a.selection,pos=mdPos?getMdToEditorPos(doc,mdPos,mdPos)[0]:selection.to;this.view.dispatch(tr.setMeta("widget",{pos:pos,node:node,style:style}))},MdEditor.prototype.replaceWithWidget=function(start,end,text){var _a=this.view.state,tr=_a.tr,schema=_a.schema,doc,pos=getMdToEditorPos(_a.doc,start,end),nodes=createNodesWithWidget(text,schema);this.view.dispatch(tr.replaceWith(pos[0],pos[1],nodes))},MdEditor.prototype.getRangeInfoOfNode=function(pos){var _a=this.view.state,doc=_a.doc,selection=_a.selection,mdPos=pos||getEditorToMdPos(doc,selection.from)[0],mdNode=this.toastMark.findNodeAtPosition(mdPos);return"text"===mdNode.type&&"paragraph"!==mdNode.parent.type&&(mdNode=mdNode.parent),mdNode.sourcepos[1][1]+=1,{range:mdNode.sourcepos,type:mdNode.type}},MdEditor.prototype.getMarkdown=function(){return this.toastMark.getLineTexts().map((function(lineText){return unwrapWidgetSyntax(lineText)})).join("\n")},MdEditor.prototype.getToastMark=function(){return this.toastMark},MdEditor}(src_base),off=__webpack_require__(349),off_default=__webpack_require__.n(off),on=__webpack_require__(348),on_default=__webpack_require__.n(on),esm_extendStatics=function(d,b){return(esm_extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(d[p]=b[p])})(d,b)};function esm_extends(d,b){if("function"!=typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function __(){this.constructor=d}esm_extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}var esm_assign=function(){return(esm_assign=Object.assign||function __assign(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)};function esm_spreadArray(to,from){for(var i=0,il=from.length,j=to.length;i<il;i++,j++)to[j]=from[i];return to}var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==__webpack_require__.g?__webpack_require__.g:"undefined"!=typeof self?self:{},encodeCache={};function getEncodeCache(exclude){var i,ch,cache=encodeCache[exclude];if(cache)return cache;for(cache=encodeCache[exclude]=[],i=0;i<128;i++)ch=String.fromCharCode(i),/^[0-9a-z]$/i.test(ch)?cache.push(ch):cache.push("%"+("0"+i.toString(16).toUpperCase()).slice(-2));for(i=0;i<exclude.length;i++)cache[exclude.charCodeAt(i)]=exclude[i];return cache}function encode$1(string,exclude,keepEscaped){var i,l,code,nextCode,cache,result="";for("string"!=typeof exclude&&(keepEscaped=exclude,exclude=encode$1.defaultChars),void 0===keepEscaped&&(keepEscaped=!0),cache=getEncodeCache(exclude),i=0,l=string.length;i<l;i++)if(code=string.charCodeAt(i),keepEscaped&&37===code&&i+2<l&&/^[0-9a-f]{2}$/i.test(string.slice(i+1,i+3)))result+=string.slice(i,i+3),i+=2;else if(code<128)result+=cache[code];else if(code>=55296&&code<=57343){if(code>=55296&&code<=56319&&i+1<l&&(nextCode=string.charCodeAt(i+1))>=56320&&nextCode<=57343){result+=encodeURIComponent(string[i]+string[i+1]),i++;continue}result+="%EF%BF%BD"}else result+=encodeURIComponent(string[i]);return result}encode$1.defaultChars=";/?:@&=+$,-_.!~*'()#",encode$1.componentChars="-_.!~*'()";var encode_1=encode$1,lib={},decode={},Aacute$1="Á",aacute$1="á",Abreve="Ă",abreve="ă",ac="∾",acd="∿",acE="∾̳",Acirc$1="Â",acirc$1="â",acute$1="´",Acy="А",acy="а",AElig$1="Æ",aelig$1="æ",af="⁡",Afr="𝔄",afr="𝔞",Agrave$1="À",agrave$1="à",alefsym="ℵ",aleph="ℵ",Alpha="Α",alpha="α",Amacr="Ā",amacr="ā",amalg="⨿",amp$2="&",AMP$1="&",andand="⩕",And="⩓",and="∧",andd="⩜",andslope="⩘",andv="⩚",ang="∠",ange="⦤",angle="∠",angmsdaa="⦨",angmsdab="⦩",angmsdac="⦪",angmsdad="⦫",angmsdae="⦬",angmsdaf="⦭",angmsdag="⦮",angmsdah="⦯",angmsd="∡",angrt="∟",angrtvb="⊾",angrtvbd="⦝",angsph="∢",angst="Å",angzarr="⍼",Aogon="Ą",aogon="ą",Aopf="𝔸",aopf="𝕒",apacir="⩯",ap="≈",apE="⩰",ape="≊",apid="≋",apos$1="'",ApplyFunction="⁡",approx="≈",approxeq="≊",Aring$1="Å",aring$1="å",Ascr="𝒜",ascr="𝒶",Assign="≔",ast="*",asymp="≈",asympeq="≍",Atilde$1="Ã",atilde$1="ã",Auml$1="Ä",auml$1="ä",awconint="∳",awint="⨑",backcong="≌",backepsilon="϶",backprime="‵",backsim="∽",backsimeq="⋍",Backslash="∖",Barv="⫧",barvee="⊽",barwed="⌅",Barwed="⌆",barwedge="⌅",bbrk="⎵",bbrktbrk="⎶",bcong="≌",Bcy="Б",bcy="б",bdquo="„",becaus="∵",because="∵",Because="∵",bemptyv="⦰",bepsi="϶",bernou="ℬ",Bernoullis="ℬ",Beta="Β",beta="β",beth="ℶ",esm_between="≬",Bfr="𝔅",bfr="𝔟",bigcap="⋂",bigcirc="◯",bigcup="⋃",bigodot="⨀",bigoplus="⨁",bigotimes="⨂",bigsqcup="⨆",bigstar="★",bigtriangledown="▽",bigtriangleup="△",biguplus="⨄",bigvee="⋁",bigwedge="⋀",bkarow="⤍",blacklozenge="⧫",blacksquare="▪",blacktriangle="▴",blacktriangledown="▾",blacktriangleleft="◂",blacktriangleright="▸",blank="␣",blk12="▒",blk14="░",blk34="▓",block="█",bne="=⃥",bnequiv="≡⃥",bNot="⫭",bnot="⌐",Bopf="𝔹",bopf="𝕓",bot="⊥",bottom="⊥",bowtie="⋈",boxbox="⧉",boxdl="┐",boxdL="╕",boxDl="╖",boxDL="╗",boxdr="┌",boxdR="╒",boxDr="╓",boxDR="╔",boxh="─",boxH="═",boxhd="┬",boxHd="╤",boxhD="╥",boxHD="╦",boxhu="┴",boxHu="╧",boxhU="╨",boxHU="╩",boxminus="⊟",boxplus="⊞",boxtimes="⊠",boxul="┘",boxuL="╛",boxUl="╜",boxUL="╝",boxur="└",boxuR="╘",boxUr="╙",boxUR="╚",boxv="│",boxV="║",boxvh="┼",boxvH="╪",boxVh="╫",boxVH="╬",boxvl="┤",boxvL="╡",boxVl="╢",boxVL="╣",boxvr="├",boxvR="╞",boxVr="╟",boxVR="╠",bprime="‵",breve="˘",Breve="˘",brvbar$1="¦",bscr="𝒷",Bscr="ℬ",bsemi="⁏",bsim="∽",bsime="⋍",bsolb="⧅",bsol="\\",bsolhsub="⟈",bull="•",bullet="•",bump="≎",bumpE="⪮",bumpe="≏",Bumpeq="≎",bumpeq="≏",Cacute="Ć",cacute="ć",capand="⩄",capbrcup="⩉",capcap="⩋",cap="∩",Cap="⋒",capcup="⩇",capdot="⩀",CapitalDifferentialD="ⅅ",caps="∩︀",caret="⁁",caron="ˇ",Cayleys="ℭ",ccaps="⩍",Ccaron="Č",ccaron="č",Ccedil$1="Ç",ccedil$1="ç",Ccirc="Ĉ",ccirc="ĉ",Cconint="∰",ccups="⩌",ccupssm="⩐",Cdot="Ċ",cdot="ċ",cedil$1="¸",Cedilla="¸",cemptyv="⦲",cent$1="¢",centerdot="·",CenterDot="·",cfr="𝔠",Cfr="ℭ",CHcy="Ч",chcy="ч",check="✓",checkmark="✓",Chi="Χ",chi="χ",circ="ˆ",circeq="≗",circlearrowleft="↺",circlearrowright="↻",circledast="⊛",circledcirc="⊚",circleddash="⊝",CircleDot="⊙",circledR="®",circledS="Ⓢ",CircleMinus="⊖",CirclePlus="⊕",CircleTimes="⊗",cir="○",cirE="⧃",cire="≗",cirfnint="⨐",cirmid="⫯",cirscir="⧂",ClockwiseContourIntegral="∲",CloseCurlyDoubleQuote="”",CloseCurlyQuote="’",clubs="♣",clubsuit="♣",colon=":",Colon="∷",Colone="⩴",colone="≔",coloneq="≔",comma=",",commat="@",comp="∁",compfn="∘",complement="∁",complexes="ℂ",cong="≅",congdot="⩭",Congruent="≡",conint="∮",Conint="∯",ContourIntegral="∮",copf="𝕔",Copf="ℂ",coprod="∐",Coproduct="∐",copy$1="©",COPY$1="©",copysr="℗",CounterClockwiseContourIntegral="∳",crarr="↵",cross="✗",Cross="⨯",Cscr="𝒞",cscr="𝒸",csub="⫏",csube="⫑",csup="⫐",csupe="⫒",ctdot="⋯",cudarrl="⤸",cudarrr="⤵",cuepr="⋞",cuesc="⋟",cularr="↶",cularrp="⤽",cupbrcap="⩈",cupcap="⩆",CupCap="≍",cup="∪",Cup="⋓",cupcup="⩊",cupdot="⊍",cupor="⩅",cups="∪︀",curarr="↷",curarrm="⤼",curlyeqprec="⋞",curlyeqsucc="⋟",curlyvee="⋎",curlywedge="⋏",curren$1="¤",curvearrowleft="↶",curvearrowright="↷",cuvee="⋎",cuwed="⋏",cwconint="∲",cwint="∱",cylcty="⌭",dagger="†",Dagger="‡",daleth="ℸ",darr="↓",Darr="↡",dArr="⇓",dash="‐",Dashv="⫤",dashv="⊣",dbkarow="⤏",dblac="˝",Dcaron="Ď",dcaron="ď",Dcy="Д",dcy="д",ddagger="‡",ddarr="⇊",DD="ⅅ",dd="ⅆ",DDotrahd="⤑",ddotseq="⩷",deg$1="°",Del="∇",Delta="Δ",delta="δ",demptyv="⦱",dfisht="⥿",Dfr="𝔇",dfr="𝔡",dHar="⥥",dharl="⇃",dharr="⇂",DiacriticalAcute="´",DiacriticalDot="˙",DiacriticalDoubleAcute="˝",DiacriticalGrave="`",DiacriticalTilde="˜",diam="⋄",diamond="⋄",Diamond="⋄",diamondsuit="♦",diams="♦",die="¨",DifferentialD="ⅆ",digamma="ϝ",disin="⋲",div="÷",divide$1="÷",divideontimes="⋇",divonx="⋇",DJcy="Ђ",djcy="ђ",dlcorn="⌞",dlcrop="⌍",dollar="$",Dopf="𝔻",dopf="𝕕",Dot="¨",dot="˙",DotDot="⃜",doteq="≐",doteqdot="≑",DotEqual="≐",dotminus="∸",dotplus="∔",dotsquare="⊡",doublebarwedge="⌆",DoubleContourIntegral="∯",DoubleDot="¨",DoubleDownArrow="⇓",DoubleLeftArrow="⇐",DoubleLeftRightArrow="⇔",DoubleLeftTee="⫤",DoubleLongLeftArrow="⟸",DoubleLongLeftRightArrow="⟺",DoubleLongRightArrow="⟹",DoubleRightArrow="⇒",DoubleRightTee="⊨",DoubleUpArrow="⇑",DoubleUpDownArrow="⇕",DoubleVerticalBar="∥",DownArrowBar="⤓",downarrow="↓",DownArrow="↓",Downarrow="⇓",DownArrowUpArrow="⇵",DownBreve="̑",downdownarrows="⇊",downharpoonleft="⇃",downharpoonright="⇂",DownLeftRightVector="⥐",DownLeftTeeVector="⥞",DownLeftVectorBar="⥖",DownLeftVector="↽",DownRightTeeVector="⥟",DownRightVectorBar="⥗",DownRightVector="⇁",DownTeeArrow="↧",DownTee="⊤",drbkarow="⤐",drcorn="⌟",drcrop="⌌",Dscr="𝒟",dscr="𝒹",DScy="Ѕ",dscy="ѕ",dsol="⧶",Dstrok="Đ",dstrok="đ",dtdot="⋱",dtri="▿",dtrif="▾",duarr="⇵",duhar="⥯",dwangle="⦦",DZcy="Џ",dzcy="џ",dzigrarr="⟿",Eacute$1="É",eacute$1="é",easter="⩮",Ecaron="Ě",ecaron="ě",Ecirc$1="Ê",ecirc$1="ê",ecir="≖",ecolon="≕",Ecy="Э",ecy="э",eDDot="⩷",Edot="Ė",edot="ė",eDot="≑",ee="ⅇ",efDot="≒",Efr="𝔈",efr="𝔢",eg="⪚",Egrave$1="È",egrave$1="è",egs="⪖",egsdot="⪘",el="⪙",Element="∈",elinters="⏧",ell="ℓ",els="⪕",elsdot="⪗",Emacr="Ē",emacr="ē",esm_empty="∅",emptyset="∅",EmptySmallSquare="◻",emptyv="∅",EmptyVerySmallSquare="▫",emsp13=" ",emsp14=" ",emsp=" ",ENG="Ŋ",eng="ŋ",ensp=" ",Eogon="Ę",eogon="ę",Eopf="𝔼",eopf="𝕖",epar="⋕",eparsl="⧣",eplus="⩱",epsi="ε",Epsilon="Ε",epsilon="ε",epsiv="ϵ",eqcirc="≖",eqcolon="≕",eqsim="≂",eqslantgtr="⪖",eqslantless="⪕",Equal="⩵",equals="=",EqualTilde="≂",equest="≟",Equilibrium="⇌",equiv="≡",equivDD="⩸",eqvparsl="⧥",erarr="⥱",erDot="≓",escr="ℯ",Escr="ℰ",esdot="≐",Esim="⩳",esim="≂",Eta="Η",eta="η",ETH$1="Ð",eth$1="ð",Euml$1="Ë",euml$1="ë",euro="€",excl="!",exist="∃",Exists="∃",expectation="ℰ",exponentiale="ⅇ",ExponentialE="ⅇ",fallingdotseq="≒",Fcy="Ф",fcy="ф",female="♀",ffilig="ﬃ",fflig="ﬀ",ffllig="ﬄ",Ffr="𝔉",ffr="𝔣",filig="ﬁ",FilledSmallSquare="◼",FilledVerySmallSquare="▪",fjlig="fj",flat="♭",fllig="ﬂ",fltns="▱",fnof="ƒ",Fopf="𝔽",fopf="𝕗",forall="∀",ForAll="∀",fork="⋔",forkv="⫙",Fouriertrf="ℱ",fpartint="⨍",frac12$1="½",frac13="⅓",frac14$1="¼",frac15="⅕",frac16="⅙",frac18="⅛",frac23="⅔",frac25="⅖",frac34$1="¾",frac35="⅗",frac38="⅜",frac45="⅘",frac56="⅚",frac58="⅝",frac78="⅞",frasl="⁄",frown="⌢",fscr="𝒻",Fscr="ℱ",gacute="ǵ",Gamma="Γ",gamma="γ",Gammad="Ϝ",gammad="ϝ",gap="⪆",Gbreve="Ğ",gbreve="ğ",Gcedil="Ģ",Gcirc="Ĝ",gcirc="ĝ",Gcy="Г",gcy="г",Gdot="Ġ",gdot="ġ",ge="≥",gE="≧",gEl="⪌",gel="⋛",geq="≥",geqq="≧",geqslant="⩾",gescc="⪩",ges="⩾",gesdot="⪀",gesdoto="⪂",gesdotol="⪄",gesl="⋛︀",gesles="⪔",Gfr="𝔊",gfr="𝔤",gg="≫",Gg="⋙",ggg="⋙",gimel="ℷ",GJcy="Ѓ",gjcy="ѓ",gla="⪥",gl="≷",glE="⪒",glj="⪤",gnap="⪊",gnapprox="⪊",gne="⪈",gnE="≩",gneq="⪈",gneqq="≩",gnsim="⋧",Gopf="𝔾",gopf="𝕘",grave="`",GreaterEqual="≥",GreaterEqualLess="⋛",GreaterFullEqual="≧",GreaterGreater="⪢",GreaterLess="≷",GreaterSlantEqual="⩾",GreaterTilde="≳",Gscr="𝒢",gscr="ℊ",gsim="≳",gsime="⪎",gsiml="⪐",gtcc="⪧",gtcir="⩺",gt$2=">",GT$1=">",Gt="≫",gtdot="⋗",gtlPar="⦕",gtquest="⩼",gtrapprox="⪆",gtrarr="⥸",gtrdot="⋗",gtreqless="⋛",gtreqqless="⪌",gtrless="≷",gtrsim="≳",gvertneqq="≩︀",gvnE="≩︀",Hacek="ˇ",hairsp=" ",half="½",hamilt="ℋ",HARDcy="Ъ",hardcy="ъ",harrcir="⥈",harr="↔",hArr="⇔",harrw="↭",Hat="^",hbar="ℏ",Hcirc="Ĥ",hcirc="ĥ",hearts="♥",heartsuit="♥",hellip="…",hercon="⊹",hfr="𝔥",Hfr="ℌ",HilbertSpace="ℋ",hksearow="⤥",hkswarow="⤦",hoarr="⇿",homtht="∻",hookleftarrow="↩",hookrightarrow="↪",hopf="𝕙",Hopf="ℍ",horbar="―",HorizontalLine="─",hscr="𝒽",Hscr="ℋ",hslash="ℏ",Hstrok="Ħ",hstrok="ħ",HumpDownHump="≎",HumpEqual="≏",hybull="⁃",hyphen="‐",Iacute$1="Í",iacute$1="í",ic="⁣",Icirc$1="Î",icirc$1="î",Icy="И",icy="и",Idot="İ",IEcy="Е",iecy="е",iexcl$1="¡",iff="⇔",ifr="𝔦",Ifr="ℑ",Igrave$1="Ì",igrave$1="ì",ii="ⅈ",iiiint="⨌",iiint="∭",iinfin="⧜",iiota="℩",IJlig="Ĳ",ijlig="ĳ",Imacr="Ī",imacr="ī",esm_image="ℑ",ImaginaryI="ⅈ",imagline="ℐ",imagpart="ℑ",imath="ı",Im="ℑ",imof="⊷",imped="Ƶ",Implies="⇒",incare="℅",infin="∞",infintie="⧝",inodot="ı",intcal="⊺",esm_int="∫",Int="∬",integers="ℤ",Integral="∫",intercal="⊺",Intersection="⋂",intlarhk="⨗",intprod="⨼",InvisibleComma="⁣",InvisibleTimes="⁢",IOcy="Ё",iocy="ё",Iogon="Į",iogon="į",Iopf="𝕀",iopf="𝕚",Iota="Ι",iota="ι",iprod="⨼",iquest$1="¿",iscr="𝒾",Iscr="ℐ",isin="∈",isindot="⋵",isinE="⋹",isins="⋴",isinsv="⋳",isinv="∈",it="⁢",Itilde="Ĩ",itilde="ĩ",Iukcy="І",iukcy="і",Iuml$1="Ï",iuml$1="ï",Jcirc="Ĵ",jcirc="ĵ",Jcy="Й",jcy="й",Jfr="𝔍",jfr="𝔧",jmath="ȷ",Jopf="𝕁",jopf="𝕛",Jscr="𝒥",jscr="𝒿",Jsercy="Ј",jsercy="ј",Jukcy="Є",jukcy="є",Kappa="Κ",kappa="κ",kappav="ϰ",Kcedil="Ķ",kcedil="ķ",Kcy="К",kcy="к",Kfr="𝔎",kfr="𝔨",kgreen="ĸ",KHcy="Х",khcy="х",KJcy="Ќ",kjcy="ќ",Kopf="𝕂",kopf="𝕜",Kscr="𝒦",kscr="𝓀",lAarr="⇚",Lacute="Ĺ",lacute="ĺ",laemptyv="⦴",lagran="ℒ",Lambda="Λ",lambda="λ",lang="⟨",Lang="⟪",langd="⦑",langle="⟨",lap="⪅",Laplacetrf="ℒ",laquo$1="«",larrb="⇤",larrbfs="⤟",larr="←",Larr="↞",lArr="⇐",larrfs="⤝",larrhk="↩",larrlp="↫",larrpl="⤹",larrsim="⥳",larrtl="↢",latail="⤙",lAtail="⤛",lat="⪫",late="⪭",lates="⪭︀",lbarr="⤌",lBarr="⤎",lbbrk="❲",lbrace="{",lbrack="[",lbrke="⦋",lbrksld="⦏",lbrkslu="⦍",Lcaron="Ľ",lcaron="ľ",Lcedil="Ļ",lcedil="ļ",lceil="⌈",lcub="{",Lcy="Л",lcy="л",ldca="⤶",ldquo="“",ldquor="„",ldrdhar="⥧",ldrushar="⥋",ldsh="↲",le="≤",lE="≦",LeftAngleBracket="⟨",LeftArrowBar="⇤",leftarrow="←",LeftArrow="←",Leftarrow="⇐",LeftArrowRightArrow="⇆",leftarrowtail="↢",LeftCeiling="⌈",LeftDoubleBracket="⟦",LeftDownTeeVector="⥡",LeftDownVectorBar="⥙",LeftDownVector="⇃",LeftFloor="⌊",leftharpoondown="↽",leftharpoonup="↼",leftleftarrows="⇇",leftrightarrow="↔",LeftRightArrow="↔",Leftrightarrow="⇔",leftrightarrows="⇆",leftrightharpoons="⇋",leftrightsquigarrow="↭",LeftRightVector="⥎",LeftTeeArrow="↤",LeftTee="⊣",LeftTeeVector="⥚",leftthreetimes="⋋",LeftTriangleBar="⧏",LeftTriangle="⊲",LeftTriangleEqual="⊴",LeftUpDownVector="⥑",LeftUpTeeVector="⥠",LeftUpVectorBar="⥘",LeftUpVector="↿",LeftVectorBar="⥒",LeftVector="↼",lEg="⪋",leg="⋚",leq="≤",leqq="≦",leqslant="⩽",lescc="⪨",les="⩽",lesdot="⩿",lesdoto="⪁",lesdotor="⪃",lesg="⋚︀",lesges="⪓",lessapprox="⪅",lessdot="⋖",lesseqgtr="⋚",lesseqqgtr="⪋",LessEqualGreater="⋚",LessFullEqual="≦",LessGreater="≶",lessgtr="≶",LessLess="⪡",lesssim="≲",LessSlantEqual="⩽",LessTilde="≲",lfisht="⥼",lfloor="⌊",Lfr="𝔏",lfr="𝔩",lg="≶",lgE="⪑",lHar="⥢",lhard="↽",lharu="↼",lharul="⥪",lhblk="▄",LJcy="Љ",ljcy="љ",llarr="⇇",ll="≪",Ll="⋘",llcorner="⌞",Lleftarrow="⇚",llhard="⥫",lltri="◺",Lmidot="Ŀ",lmidot="ŀ",lmoustache="⎰",lmoust="⎰",lnap="⪉",lnapprox="⪉",lne="⪇",lnE="≨",lneq="⪇",lneqq="≨",lnsim="⋦",loang="⟬",loarr="⇽",lobrk="⟦",longleftarrow="⟵",LongLeftArrow="⟵",Longleftarrow="⟸",longleftrightarrow="⟷",LongLeftRightArrow="⟷",Longleftrightarrow="⟺",longmapsto="⟼",longrightarrow="⟶",LongRightArrow="⟶",Longrightarrow="⟹",looparrowleft="↫",looparrowright="↬",lopar="⦅",Lopf="𝕃",lopf="𝕝",loplus="⨭",lotimes="⨴",lowast="∗",lowbar="_",LowerLeftArrow="↙",LowerRightArrow="↘",loz="◊",lozenge="◊",lozf="⧫",lpar="(",lparlt="⦓",lrarr="⇆",lrcorner="⌟",lrhar="⇋",lrhard="⥭",lrm="‎",lrtri="⊿",lsaquo="‹",lscr="𝓁",Lscr="ℒ",lsh="↰",Lsh="↰",lsim="≲",lsime="⪍",lsimg="⪏",lsqb="[",lsquo="‘",lsquor="‚",Lstrok="Ł",lstrok="ł",ltcc="⪦",ltcir="⩹",lt$2="<",LT$1="<",Lt="≪",ltdot="⋖",lthree="⋋",ltimes="⋉",ltlarr="⥶",ltquest="⩻",ltri="◃",ltrie="⊴",ltrif="◂",ltrPar="⦖",lurdshar="⥊",luruhar="⥦",lvertneqq="≨︀",lvnE="≨︀",macr$1="¯",male="♂",malt="✠",maltese="✠",map="↦",mapsto="↦",mapstodown="↧",mapstoleft="↤",mapstoup="↥",marker="▮",mcomma="⨩",Mcy="М",mcy="м",mdash="—",mDDot="∺",measuredangle="∡",MediumSpace=" ",Mellintrf="ℳ",Mfr="𝔐",mfr="𝔪",mho="℧",micro$1="µ",midast="*",midcir="⫰",mid="∣",middot$1="·",minusb="⊟",minus="−",minusd="∸",minusdu="⨪",MinusPlus="∓",mlcp="⫛",mldr="…",mnplus="∓",models="⊧",Mopf="𝕄",mopf="𝕞",mp="∓",mscr="𝓂",Mscr="ℳ",mstpos="∾",Mu="Μ",mu="μ",multimap="⊸",mumap="⊸",nabla="∇",Nacute="Ń",nacute="ń",nang="∠⃒",nap="≉",napE="⩰̸",napid="≋̸",napos="ŉ",napprox="≉",natural="♮",naturals="ℕ",natur="♮",nbsp$1=" ",nbump="≎̸",nbumpe="≏̸",ncap="⩃",Ncaron="Ň",ncaron="ň",Ncedil="Ņ",ncedil="ņ",ncong="≇",ncongdot="⩭̸",ncup="⩂",Ncy="Н",ncy="н",ndash="–",nearhk="⤤",nearr="↗",neArr="⇗",nearrow="↗",ne="≠",nedot="≐̸",NegativeMediumSpace="​",NegativeThickSpace="​",NegativeThinSpace="​",NegativeVeryThinSpace="​",nequiv="≢",nesear="⤨",nesim="≂̸",NestedGreaterGreater="≫",NestedLessLess="≪",NewLine="\n",nexist="∄",nexists="∄",Nfr="𝔑",nfr="𝔫",ngE="≧̸",nge="≱",ngeq="≱",ngeqq="≧̸",ngeqslant="⩾̸",nges="⩾̸",nGg="⋙̸",ngsim="≵",nGt="≫⃒",ngt="≯",ngtr="≯",nGtv="≫̸",nharr="↮",nhArr="⇎",nhpar="⫲",ni="∋",nis="⋼",nisd="⋺",niv="∋",NJcy="Њ",njcy="њ",nlarr="↚",nlArr="⇍",nldr="‥",nlE="≦̸",nle="≰",nleftarrow="↚",nLeftarrow="⇍",nleftrightarrow="↮",nLeftrightarrow="⇎",nleq="≰",nleqq="≦̸",nleqslant="⩽̸",nles="⩽̸",nless="≮",nLl="⋘̸",nlsim="≴",nLt="≪⃒",nlt="≮",nltri="⋪",nltrie="⋬",nLtv="≪̸",nmid="∤",NoBreak="⁠",NonBreakingSpace=" ",nopf="𝕟",Nopf="ℕ",Not="⫬",not$1="¬",NotCongruent="≢",NotCupCap="≭",NotDoubleVerticalBar="∦",NotElement="∉",NotEqual="≠",NotEqualTilde="≂̸",NotExists="∄",NotGreater="≯",NotGreaterEqual="≱",NotGreaterFullEqual="≧̸",NotGreaterGreater="≫̸",NotGreaterLess="≹",NotGreaterSlantEqual="⩾̸",NotGreaterTilde="≵",NotHumpDownHump="≎̸",NotHumpEqual="≏̸",notin="∉",notindot="⋵̸",notinE="⋹̸",notinva="∉",notinvb="⋷",notinvc="⋶",NotLeftTriangleBar="⧏̸",NotLeftTriangle="⋪",NotLeftTriangleEqual="⋬",NotLess="≮",NotLessEqual="≰",NotLessGreater="≸",NotLessLess="≪̸",NotLessSlantEqual="⩽̸",NotLessTilde="≴",NotNestedGreaterGreater="⪢̸",NotNestedLessLess="⪡̸",notni="∌",notniva="∌",notnivb="⋾",notnivc="⋽",NotPrecedes="⊀",NotPrecedesEqual="⪯̸",NotPrecedesSlantEqual="⋠",NotReverseElement="∌",NotRightTriangleBar="⧐̸",NotRightTriangle="⋫",NotRightTriangleEqual="⋭",NotSquareSubset="⊏̸",NotSquareSubsetEqual="⋢",NotSquareSuperset="⊐̸",NotSquareSupersetEqual="⋣",NotSubset="⊂⃒",NotSubsetEqual="⊈",NotSucceeds="⊁",NotSucceedsEqual="⪰̸",NotSucceedsSlantEqual="⋡",NotSucceedsTilde="≿̸",NotSuperset="⊃⃒",NotSupersetEqual="⊉",NotTilde="≁",NotTildeEqual="≄",NotTildeFullEqual="≇",NotTildeTilde="≉",NotVerticalBar="∤",nparallel="∦",npar="∦",nparsl="⫽⃥",npart="∂̸",npolint="⨔",npr="⊀",nprcue="⋠",nprec="⊀",npreceq="⪯̸",npre="⪯̸",nrarrc="⤳̸",nrarr="↛",nrArr="⇏",nrarrw="↝̸",nrightarrow="↛",nRightarrow="⇏",nrtri="⋫",nrtrie="⋭",nsc="⊁",nsccue="⋡",nsce="⪰̸",Nscr="𝒩",nscr="𝓃",nshortmid="∤",nshortparallel="∦",nsim="≁",nsime="≄",nsimeq="≄",nsmid="∤",nspar="∦",nsqsube="⋢",nsqsupe="⋣",nsub="⊄",nsubE="⫅̸",nsube="⊈",nsubset="⊂⃒",nsubseteq="⊈",nsubseteqq="⫅̸",nsucc="⊁",nsucceq="⪰̸",nsup="⊅",nsupE="⫆̸",nsupe="⊉",nsupset="⊃⃒",nsupseteq="⊉",nsupseteqq="⫆̸",ntgl="≹",Ntilde$1="Ñ",ntilde$1="ñ",ntlg="≸",ntriangleleft="⋪",ntrianglelefteq="⋬",ntriangleright="⋫",ntrianglerighteq="⋭",Nu="Ν",nu="ν",num="#",numero="№",numsp=" ",nvap="≍⃒",nvdash="⊬",nvDash="⊭",nVdash="⊮",nVDash="⊯",nvge="≥⃒",nvgt=">⃒",nvHarr="⤄",nvinfin="⧞",nvlArr="⤂",nvle="≤⃒",nvlt="<⃒",nvltrie="⊴⃒",nvrArr="⤃",nvrtrie="⊵⃒",nvsim="∼⃒",nwarhk="⤣",nwarr="↖",nwArr="⇖",nwarrow="↖",nwnear="⤧",Oacute$1="Ó",oacute$1="ó",oast="⊛",Ocirc$1="Ô",ocirc$1="ô",ocir="⊚",Ocy="О",ocy="о",odash="⊝",Odblac="Ő",odblac="ő",odiv="⨸",odot="⊙",odsold="⦼",OElig="Œ",oelig="œ",ofcir="⦿",Ofr="𝔒",ofr="𝔬",ogon="˛",Ograve$1="Ò",ograve$1="ò",ogt="⧁",ohbar="⦵",ohm="Ω",oint="∮",olarr="↺",olcir="⦾",olcross="⦻",oline="‾",olt="⧀",Omacr="Ō",omacr="ō",Omega="Ω",omega="ω",Omicron="Ο",omicron="ο",omid="⦶",ominus="⊖",Oopf="𝕆",oopf="𝕠",opar="⦷",OpenCurlyDoubleQuote="“",OpenCurlyQuote="‘",operp="⦹",oplus="⊕",orarr="↻",Or="⩔",or="∨",ord="⩝",order="ℴ",orderof="ℴ",ordf$1="ª",ordm$1="º",origof="⊶",oror="⩖",orslope="⩗",orv="⩛",oS="Ⓢ",Oscr="𝒪",oscr="ℴ",Oslash$1="Ø",oslash$1="ø",osol="⊘",Otilde$1="Õ",otilde$1="õ",otimesas="⨶",Otimes="⨷",otimes="⊗",Ouml$1="Ö",ouml$1="ö",ovbar="⌽",OverBar="‾",OverBrace="⏞",OverBracket="⎴",OverParenthesis="⏜",para$1="¶",parallel="∥",par="∥",parsim="⫳",parsl="⫽",part="∂",PartialD="∂",Pcy="П",pcy="п",percnt="%",period=".",permil="‰",perp="⊥",pertenk="‱",Pfr="𝔓",pfr="𝔭",Phi="Φ",phi="φ",phiv="ϕ",phmmat="ℳ",phone="☎",Pi="Π",pi="π",pitchfork="⋔",piv="ϖ",planck="ℏ",planckh="ℎ",plankv="ℏ",plusacir="⨣",plusb="⊞",pluscir="⨢",plus="+",plusdo="∔",plusdu="⨥",pluse="⩲",PlusMinus="±",plusmn$1="±",plussim="⨦",plustwo="⨧",pm="±",Poincareplane="ℌ",pointint="⨕",popf="𝕡",Popf="ℙ",pound$1="£",prap="⪷",Pr="⪻",pr="≺",prcue="≼",precapprox="⪷",prec="≺",preccurlyeq="≼",Precedes="≺",PrecedesEqual="⪯",PrecedesSlantEqual="≼",PrecedesTilde="≾",preceq="⪯",precnapprox="⪹",precneqq="⪵",precnsim="⋨",pre="⪯",prE="⪳",precsim="≾",prime="′",Prime="″",primes="ℙ",prnap="⪹",prnE="⪵",prnsim="⋨",prod="∏",Product="∏",profalar="⌮",profline="⌒",profsurf="⌓",esm_prop="∝",Proportional="∝",Proportion="∷",propto="∝",prsim="≾",prurel="⊰",Pscr="𝒫",pscr="𝓅",Psi="Ψ",psi="ψ",puncsp=" ",Qfr="𝔔",qfr="𝔮",qint="⨌",qopf="𝕢",Qopf="ℚ",qprime="⁗",Qscr="𝒬",qscr="𝓆",quaternions="ℍ",quatint="⨖",quest="?",questeq="≟",quot$2='"',QUOT$1='"',rAarr="⇛",race="∽̱",Racute="Ŕ",racute="ŕ",radic="√",raemptyv="⦳",rang="⟩",Rang="⟫",rangd="⦒",range="⦥",rangle="⟩",raquo$1="»",rarrap="⥵",rarrb="⇥",rarrbfs="⤠",rarrc="⤳",rarr="→",Rarr="↠",rArr="⇒",rarrfs="⤞",rarrhk="↪",rarrlp="↬",rarrpl="⥅",rarrsim="⥴",Rarrtl="⤖",rarrtl="↣",rarrw="↝",ratail="⤚",rAtail="⤜",ratio="∶",rationals="ℚ",rbarr="⤍",rBarr="⤏",RBarr="⤐",rbbrk="❳",rbrace="}",rbrack="]",rbrke="⦌",rbrksld="⦎",rbrkslu="⦐",Rcaron="Ř",rcaron="ř",Rcedil="Ŗ",rcedil="ŗ",rceil="⌉",rcub="}",Rcy="Р",rcy="р",rdca="⤷",rdldhar="⥩",rdquo="”",rdquor="”",rdsh="↳",real="ℜ",realine="ℛ",realpart="ℜ",reals="ℝ",Re="ℜ",rect="▭",reg$1="®",REG$1="®",ReverseElement="∋",ReverseEquilibrium="⇋",ReverseUpEquilibrium="⥯",rfisht="⥽",rfloor="⌋",rfr="𝔯",Rfr="ℜ",rHar="⥤",rhard="⇁",rharu="⇀",rharul="⥬",Rho="Ρ",rho="ρ",rhov="ϱ",RightAngleBracket="⟩",RightArrowBar="⇥",rightarrow="→",RightArrow="→",Rightarrow="⇒",RightArrowLeftArrow="⇄",rightarrowtail="↣",RightCeiling="⌉",RightDoubleBracket="⟧",RightDownTeeVector="⥝",RightDownVectorBar="⥕",RightDownVector="⇂",RightFloor="⌋",rightharpoondown="⇁",rightharpoonup="⇀",rightleftarrows="⇄",rightleftharpoons="⇌",rightrightarrows="⇉",rightsquigarrow="↝",RightTeeArrow="↦",RightTee="⊢",RightTeeVector="⥛",rightthreetimes="⋌",RightTriangleBar="⧐",RightTriangle="⊳",RightTriangleEqual="⊵",RightUpDownVector="⥏",RightUpTeeVector="⥜",RightUpVectorBar="⥔",RightUpVector="↾",RightVectorBar="⥓",RightVector="⇀",ring="˚",risingdotseq="≓",rlarr="⇄",rlhar="⇌",rlm="‏",rmoustache="⎱",rmoust="⎱",rnmid="⫮",roang="⟭",roarr="⇾",robrk="⟧",ropar="⦆",ropf="𝕣",Ropf="ℝ",roplus="⨮",rotimes="⨵",RoundImplies="⥰",rpar=")",rpargt="⦔",rppolint="⨒",rrarr="⇉",Rrightarrow="⇛",rsaquo="›",rscr="𝓇",Rscr="ℛ",rsh="↱",Rsh="↱",rsqb="]",rsquo="’",rsquor="’",rthree="⋌",rtimes="⋊",rtri="▹",rtrie="⊵",rtrif="▸",rtriltri="⧎",RuleDelayed="⧴",ruluhar="⥨",rx="℞",Sacute="Ś",sacute="ś",sbquo="‚",scap="⪸",Scaron="Š",scaron="š",Sc="⪼",sc="≻",sccue="≽",sce="⪰",scE="⪴",Scedil="Ş",scedil="ş",Scirc="Ŝ",scirc="ŝ",scnap="⪺",scnE="⪶",scnsim="⋩",scpolint="⨓",scsim="≿",Scy="С",scy="с",sdotb="⊡",sdot="⋅",sdote="⩦",searhk="⤥",searr="↘",seArr="⇘",searrow="↘",sect$1="§",semi=";",seswar="⤩",setminus="∖",setmn="∖",sext="✶",Sfr="𝔖",sfr="𝔰",sfrown="⌢",sharp="♯",SHCHcy="Щ",shchcy="щ",SHcy="Ш",shcy="ш",ShortDownArrow="↓",ShortLeftArrow="←",shortmid="∣",shortparallel="∥",ShortRightArrow="→",ShortUpArrow="↑",shy$1="­",Sigma="Σ",sigma="σ",sigmaf="ς",sigmav="ς",sim="∼",simdot="⩪",sime="≃",simeq="≃",simg="⪞",simgE="⪠",siml="⪝",simlE="⪟",simne="≆",simplus="⨤",simrarr="⥲",slarr="←",SmallCircle="∘",smallsetminus="∖",smashp="⨳",smeparsl="⧤",smid="∣",smile="⌣",smt="⪪",smte="⪬",smtes="⪬︀",SOFTcy="Ь",softcy="ь",solbar="⌿",solb="⧄",sol="/",Sopf="𝕊",sopf="𝕤",spades="♠",spadesuit="♠",spar="∥",sqcap="⊓",sqcaps="⊓︀",sqcup="⊔",sqcups="⊔︀",Sqrt="√",sqsub="⊏",sqsube="⊑",sqsubset="⊏",sqsubseteq="⊑",sqsup="⊐",sqsupe="⊒",sqsupset="⊐",sqsupseteq="⊒",square="□",Square="□",SquareIntersection="⊓",SquareSubset="⊏",SquareSubsetEqual="⊑",SquareSuperset="⊐",SquareSupersetEqual="⊒",SquareUnion="⊔",squarf="▪",squ="□",squf="▪",srarr="→",Sscr="𝒮",sscr="𝓈",ssetmn="∖",ssmile="⌣",sstarf="⋆",Star="⋆",star="☆",starf="★",straightepsilon="ϵ",straightphi="ϕ",strns="¯",sub="⊂",Sub="⋐",subdot="⪽",subE="⫅",sube="⊆",subedot="⫃",submult="⫁",subnE="⫋",subne="⊊",subplus="⪿",subrarr="⥹",subset="⊂",Subset="⋐",subseteq="⊆",subseteqq="⫅",SubsetEqual="⊆",subsetneq="⊊",subsetneqq="⫋",subsim="⫇",subsub="⫕",subsup="⫓",succapprox="⪸",succ="≻",succcurlyeq="≽",Succeeds="≻",SucceedsEqual="⪰",SucceedsSlantEqual="≽",SucceedsTilde="≿",succeq="⪰",succnapprox="⪺",succneqq="⪶",succnsim="⋩",succsim="≿",SuchThat="∋",sum="∑",Sum="∑",sung="♪",sup1$1="¹",sup2$1="²",sup3$1="³",sup="⊃",Sup="⋑",supdot="⪾",supdsub="⫘",supE="⫆",supe="⊇",supedot="⫄",Superset="⊃",SupersetEqual="⊇",suphsol="⟉",suphsub="⫗",suplarr="⥻",supmult="⫂",supnE="⫌",supne="⊋",supplus="⫀",supset="⊃",Supset="⋑",supseteq="⊇",supseteqq="⫆",supsetneq="⊋",supsetneqq="⫌",supsim="⫈",supsub="⫔",supsup="⫖",swarhk="⤦",swarr="↙",swArr="⇙",swarrow="↙",swnwar="⤪",szlig$1="ß",Tab="\t",target="⌖",Tau="Τ",tau="τ",tbrk="⎴",Tcaron="Ť",tcaron="ť",Tcedil="Ţ",tcedil="ţ",Tcy="Т",tcy="т",tdot="⃛",telrec="⌕",Tfr="𝔗",tfr="𝔱",there4="∴",therefore="∴",Therefore="∴",Theta="Θ",theta="θ",thetasym="ϑ",thetav="ϑ",thickapprox="≈",thicksim="∼",ThickSpace="  ",ThinSpace=" ",thinsp=" ",thkap="≈",thksim="∼",THORN$1="Þ",thorn$1="þ",tilde="˜",Tilde="∼",TildeEqual="≃",TildeFullEqual="≅",TildeTilde="≈",timesbar="⨱",timesb="⊠",times$1="×",timesd="⨰",tint="∭",toea="⤨",topbot="⌶",topcir="⫱",esm_top="⊤",Topf="𝕋",topf="𝕥",topfork="⫚",tosa="⤩",tprime="‴",trade="™",TRADE="™",triangle="▵",triangledown="▿",triangleleft="◃",trianglelefteq="⊴",triangleq="≜",triangleright="▹",trianglerighteq="⊵",tridot="◬",trie="≜",triminus="⨺",TripleDot="⃛",triplus="⨹",trisb="⧍",tritime="⨻",trpezium="⏢",Tscr="𝒯",tscr="𝓉",TScy="Ц",tscy="ц",TSHcy="Ћ",tshcy="ћ",Tstrok="Ŧ",tstrok="ŧ",twixt="≬",twoheadleftarrow="↞",twoheadrightarrow="↠",Uacute$1="Ú",uacute$1="ú",uarr="↑",Uarr="↟",uArr="⇑",Uarrocir="⥉",Ubrcy="Ў",ubrcy="ў",Ubreve="Ŭ",ubreve="ŭ",Ucirc$1="Û",ucirc$1="û",Ucy="У",ucy="у",udarr="⇅",Udblac="Ű",udblac="ű",udhar="⥮",ufisht="⥾",Ufr="𝔘",ufr="𝔲",Ugrave$1="Ù",ugrave$1="ù",uHar="⥣",uharl="↿",uharr="↾",uhblk="▀",ulcorn="⌜",ulcorner="⌜",ulcrop="⌏",ultri="◸",Umacr="Ū",umacr="ū",uml$1="¨",UnderBar="_",UnderBrace="⏟",UnderBracket="⎵",UnderParenthesis="⏝",Union="⋃",UnionPlus="⊎",Uogon="Ų",uogon="ų",Uopf="𝕌",uopf="𝕦",UpArrowBar="⤒",uparrow="↑",UpArrow="↑",Uparrow="⇑",UpArrowDownArrow="⇅",updownarrow="↕",UpDownArrow="↕",Updownarrow="⇕",UpEquilibrium="⥮",upharpoonleft="↿",upharpoonright="↾",uplus="⊎",UpperLeftArrow="↖",UpperRightArrow="↗",upsi="υ",Upsi="ϒ",upsih="ϒ",Upsilon="Υ",upsilon="υ",UpTeeArrow="↥",UpTee="⊥",upuparrows="⇈",urcorn="⌝",urcorner="⌝",urcrop="⌎",Uring="Ů",uring="ů",urtri="◹",Uscr="𝒰",uscr="𝓊",utdot="⋰",Utilde="Ũ",utilde="ũ",utri="▵",utrif="▴",uuarr="⇈",Uuml$1="Ü",uuml$1="ü",uwangle="⦧",vangrt="⦜",varepsilon="ϵ",varkappa="ϰ",varnothing="∅",varphi="ϕ",varpi="ϖ",varpropto="∝",varr="↕",vArr="⇕",varrho="ϱ",varsigma="ς",varsubsetneq="⊊︀",varsubsetneqq="⫋︀",varsupsetneq="⊋︀",varsupsetneqq="⫌︀",vartheta="ϑ",vartriangleleft="⊲",vartriangleright="⊳",vBar="⫨",Vbar="⫫",vBarv="⫩",Vcy="В",vcy="в",vdash="⊢",vDash="⊨",Vdash="⊩",VDash="⊫",Vdashl="⫦",veebar="⊻",vee="∨",Vee="⋁",veeeq="≚",vellip="⋮",verbar="|",Verbar="‖",vert="|",Vert="‖",VerticalBar="∣",VerticalLine="|",VerticalSeparator="❘",VerticalTilde="≀",VeryThinSpace=" ",Vfr="𝔙",vfr="𝔳",vltri="⊲",vnsub="⊂⃒",vnsup="⊃⃒",Vopf="𝕍",vopf="𝕧",vprop="∝",vrtri="⊳",Vscr="𝒱",vscr="𝓋",vsubnE="⫋︀",vsubne="⊊︀",vsupnE="⫌︀",vsupne="⊋︀",Vvdash="⊪",vzigzag="⦚",Wcirc="Ŵ",wcirc="ŵ",wedbar="⩟",wedge="∧",Wedge="⋀",wedgeq="≙",weierp="℘",Wfr,wfr,Wopf="𝕎",wopf="𝕨",wp,wr,wreath="≀",Wscr="𝒲",wscr="𝓌",xcap="⋂",xcirc="◯",xcup="⋃",xdtri="▽",Xfr,xfr,xharr="⟷",xhArr="⟺",Xi,xi,xlarr="⟵",xlArr="⟸",xmap="⟼",xnis="⋻",xodot="⨀",Xopf="𝕏",xopf="𝕩",xoplus="⨁",xotime="⨂",xrarr="⟶",xrArr="⟹",Xscr="𝒳",xscr="𝓍",xsqcup="⨆",xuplus="⨄",xutri="△",xvee="⋁",xwedge="⋀",Yacute$1="Ý",yacute$1="ý",YAcy="Я",yacy="я",Ycirc="Ŷ",ycirc="ŷ",Ycy="Ы",ycy="ы",yen$1="¥",Yfr,yfr,YIcy="Ї",yicy="ї",Yopf="𝕐",yopf="𝕪",Yscr="𝒴",yscr="𝓎",YUcy="Ю",yucy="ю",yuml$1="ÿ",Yuml="Ÿ",Zacute="Ź",zacute="ź",Zcaron="Ž",zcaron="ž",Zcy="З",zcy="з",Zdot="Ż",zdot="ż",zeetrf="ℨ",ZeroWidthSpace="​",Zeta="Ζ",zeta="ζ",zfr,Zfr="ℨ",ZHcy="Ж",zhcy="ж",zigrarr="⇝",zopf="𝕫",Zopf="ℤ",Zscr="𝒵",zscr="𝓏",zwj="‍",zwnj="‌",require$$1$1={Aacute:"Á",aacute:"á",Abreve:"Ă",abreve:"ă",ac:ac,acd:"∿",acE:acE,Acirc:"Â",acirc:"â",acute:"´",Acy:"А",acy:"а",AElig:"Æ",aelig:"æ",af:af,Afr:Afr,afr:afr,Agrave:"À",agrave:"à",alefsym:"ℵ",aleph:"ℵ",Alpha:"Α",alpha:"α",Amacr:"Ā",amacr:"ā",amalg:"⨿",amp:"&",AMP:"&",andand:"⩕",And:"⩓",and:"∧",andd:"⩜",andslope:"⩘",andv:"⩚",ang:"∠",ange:"⦤",angle:"∠",angmsdaa:"⦨",angmsdab:"⦩",angmsdac:"⦪",angmsdad:"⦫",angmsdae:"⦬",angmsdaf:"⦭",angmsdag:"⦮",angmsdah:"⦯",angmsd:"∡",angrt:"∟",angrtvb:"⊾",angrtvbd:"⦝",angsph:"∢",angst:"Å",angzarr:"⍼",Aogon:"Ą",aogon:"ą",Aopf:"𝔸",aopf:"𝕒",apacir:"⩯",ap:ap,apE:"⩰",ape:"≊",apid:"≋",apos:"'",ApplyFunction:"⁡",approx:"≈",approxeq:"≊",Aring:"Å",aring:"å",Ascr:"𝒜",ascr:"𝒶",Assign:"≔",ast:"*",asymp:"≈",asympeq:"≍",Atilde:"Ã",atilde:"ã",Auml:"Ä",auml:"ä",awconint:"∳",awint:"⨑",backcong:"≌",backepsilon:"϶",backprime:"‵",backsim:"∽",backsimeq:"⋍",Backslash:"∖",Barv:"⫧",barvee:"⊽",barwed:"⌅",Barwed:"⌆",barwedge:"⌅",bbrk:"⎵",bbrktbrk:"⎶",bcong:"≌",Bcy:"Б",bcy:"б",bdquo:"„",becaus:"∵",because:"∵",Because:"∵",bemptyv:"⦰",bepsi:"϶",bernou:"ℬ",Bernoullis:"ℬ",Beta:"Β",beta:"β",beth:"ℶ",between:"≬",Bfr:Bfr,bfr:bfr,bigcap:"⋂",bigcirc:"◯",bigcup:"⋃",bigodot:"⨀",bigoplus:"⨁",bigotimes:"⨂",bigsqcup:"⨆",bigstar:"★",bigtriangledown:"▽",bigtriangleup:"△",biguplus:"⨄",bigvee:"⋁",bigwedge:"⋀",bkarow:"⤍",blacklozenge:"⧫",blacksquare:"▪",blacktriangle:"▴",blacktriangledown:"▾",blacktriangleleft:"◂",blacktriangleright:"▸",blank:"␣",blk12:"▒",blk14:"░",blk34:"▓",block:"█",bne:bne,bnequiv:"≡⃥",bNot:"⫭",bnot:"⌐",Bopf:"𝔹",bopf:"𝕓",bot:"⊥",bottom:"⊥",bowtie:"⋈",boxbox:"⧉",boxdl:"┐",boxdL:"╕",boxDl:"╖",boxDL:"╗",boxdr:"┌",boxdR:"╒",boxDr:"╓",boxDR:"╔",boxh:"─",boxH:"═",boxhd:"┬",boxHd:"╤",boxhD:"╥",boxHD:"╦",boxhu:"┴",boxHu:"╧",boxhU:"╨",boxHU:"╩",boxminus:"⊟",boxplus:"⊞",boxtimes:"⊠",boxul:"┘",boxuL:"╛",boxUl:"╜",boxUL:"╝",boxur:"└",boxuR:"╘",boxUr:"╙",boxUR:"╚",boxv:"│",boxV:"║",boxvh:"┼",boxvH:"╪",boxVh:"╫",boxVH:"╬",boxvl:"┤",boxvL:"╡",boxVl:"╢",boxVL:"╣",boxvr:"├",boxvR:"╞",boxVr:"╟",boxVR:"╠",bprime:"‵",breve:"˘",Breve:"˘",brvbar:"¦",bscr:"𝒷",Bscr:"ℬ",bsemi:"⁏",bsim:"∽",bsime:"⋍",bsolb:"⧅",bsol:"\\",bsolhsub:"⟈",bull:"•",bullet:"•",bump:"≎",bumpE:"⪮",bumpe:"≏",Bumpeq:"≎",bumpeq:"≏",Cacute:"Ć",cacute:"ć",capand:"⩄",capbrcup:"⩉",capcap:"⩋",cap:"∩",Cap:"⋒",capcup:"⩇",capdot:"⩀",CapitalDifferentialD:"ⅅ",caps:"∩︀",caret:"⁁",caron:"ˇ",Cayleys:"ℭ",ccaps:"⩍",Ccaron:"Č",ccaron:"č",Ccedil:"Ç",ccedil:"ç",Ccirc:"Ĉ",ccirc:"ĉ",Cconint:"∰",ccups:"⩌",ccupssm:"⩐",Cdot:"Ċ",cdot:"ċ",cedil:"¸",Cedilla:"¸",cemptyv:"⦲",cent:"¢",centerdot:"·",CenterDot:"·",cfr:cfr,Cfr:"ℭ",CHcy:"Ч",chcy:"ч",check:"✓",checkmark:"✓",Chi:"Χ",chi:"χ",circ:"ˆ",circeq:"≗",circlearrowleft:"↺",circlearrowright:"↻",circledast:"⊛",circledcirc:"⊚",circleddash:"⊝",CircleDot:"⊙",circledR:"®",circledS:"Ⓢ",CircleMinus:"⊖",CirclePlus:"⊕",CircleTimes:"⊗",cir:"○",cirE:"⧃",cire:"≗",cirfnint:"⨐",cirmid:"⫯",cirscir:"⧂",ClockwiseContourIntegral:"∲",CloseCurlyDoubleQuote:"”",CloseCurlyQuote:"’",clubs:"♣",clubsuit:"♣",colon:":",Colon:"∷",Colone:"⩴",colone:"≔",coloneq:"≔",comma:",",commat:"@",comp:"∁",compfn:"∘",complement:"∁",complexes:"ℂ",cong:"≅",congdot:"⩭",Congruent:"≡",conint:"∮",Conint:"∯",ContourIntegral:"∮",copf:"𝕔",Copf:"ℂ",coprod:"∐",Coproduct:"∐",copy:"©",COPY:"©",copysr:"℗",CounterClockwiseContourIntegral:"∳",crarr:"↵",cross:"✗",Cross:"⨯",Cscr:"𝒞",cscr:"𝒸",csub:"⫏",csube:"⫑",csup:"⫐",csupe:"⫒",ctdot:"⋯",cudarrl:"⤸",cudarrr:"⤵",cuepr:"⋞",cuesc:"⋟",cularr:"↶",cularrp:"⤽",cupbrcap:"⩈",cupcap:"⩆",CupCap:"≍",cup:"∪",Cup:"⋓",cupcup:"⩊",cupdot:"⊍",cupor:"⩅",cups:"∪︀",curarr:"↷",curarrm:"⤼",curlyeqprec:"⋞",curlyeqsucc:"⋟",curlyvee:"⋎",curlywedge:"⋏",curren:"¤",curvearrowleft:"↶",curvearrowright:"↷",cuvee:"⋎",cuwed:"⋏",cwconint:"∲",cwint:"∱",cylcty:"⌭",dagger:"†",Dagger:"‡",daleth:"ℸ",darr:"↓",Darr:"↡",dArr:"⇓",dash:"‐",Dashv:"⫤",dashv:"⊣",dbkarow:"⤏",dblac:"˝",Dcaron:"Ď",dcaron:"ď",Dcy:"Д",dcy:"д",ddagger:"‡",ddarr:"⇊",DD:DD,dd:dd,DDotrahd:"⤑",ddotseq:"⩷",deg:"°",Del:"∇",Delta:"Δ",delta:"δ",demptyv:"⦱",dfisht:"⥿",Dfr:Dfr,dfr:dfr,dHar:"⥥",dharl:"⇃",dharr:"⇂",DiacriticalAcute:"´",DiacriticalDot:"˙",DiacriticalDoubleAcute:"˝",DiacriticalGrave:"`",DiacriticalTilde:"˜",diam:"⋄",diamond:"⋄",Diamond:"⋄",diamondsuit:"♦",diams:"♦",die:"¨",DifferentialD:"ⅆ",digamma:"ϝ",disin:"⋲",div:"÷",divide:"÷",divideontimes:"⋇",divonx:"⋇",DJcy:"Ђ",djcy:"ђ",dlcorn:"⌞",dlcrop:"⌍",dollar:"$",Dopf:"𝔻",dopf:"𝕕",Dot:"¨",dot:"˙",DotDot:"⃜",doteq:"≐",doteqdot:"≑",DotEqual:"≐",dotminus:"∸",dotplus:"∔",dotsquare:"⊡",doublebarwedge:"⌆",DoubleContourIntegral:"∯",DoubleDot:"¨",DoubleDownArrow:"⇓",DoubleLeftArrow:"⇐",DoubleLeftRightArrow:"⇔",DoubleLeftTee:"⫤",DoubleLongLeftArrow:"⟸",DoubleLongLeftRightArrow:"⟺",DoubleLongRightArrow:"⟹",DoubleRightArrow:"⇒",DoubleRightTee:"⊨",DoubleUpArrow:"⇑",DoubleUpDownArrow:"⇕",DoubleVerticalBar:"∥",DownArrowBar:"⤓",downarrow:"↓",DownArrow:"↓",Downarrow:"⇓",DownArrowUpArrow:"⇵",DownBreve:"̑",downdownarrows:"⇊",downharpoonleft:"⇃",downharpoonright:"⇂",DownLeftRightVector:"⥐",DownLeftTeeVector:"⥞",DownLeftVectorBar:"⥖",DownLeftVector:"↽",DownRightTeeVector:"⥟",DownRightVectorBar:"⥗",DownRightVector:"⇁",DownTeeArrow:"↧",DownTee:"⊤",drbkarow:"⤐",drcorn:"⌟",drcrop:"⌌",Dscr:"𝒟",dscr:"𝒹",DScy:"Ѕ",dscy:"ѕ",dsol:"⧶",Dstrok:"Đ",dstrok:"đ",dtdot:"⋱",dtri:"▿",dtrif:"▾",duarr:"⇵",duhar:"⥯",dwangle:"⦦",DZcy:"Џ",dzcy:"џ",dzigrarr:"⟿",Eacute:"É",eacute:"é",easter:"⩮",Ecaron:"Ě",ecaron:"ě",Ecirc:"Ê",ecirc:"ê",ecir:"≖",ecolon:"≕",Ecy:"Э",ecy:"э",eDDot:"⩷",Edot:"Ė",edot:"ė",eDot:"≑",ee:ee,efDot:"≒",Efr:Efr,efr:efr,eg:eg,Egrave:"È",egrave:"è",egs:"⪖",egsdot:"⪘",el:el,Element:"∈",elinters:"⏧",ell:"ℓ",els:"⪕",elsdot:"⪗",Emacr:"Ē",emacr:"ē",empty:"∅",emptyset:"∅",EmptySmallSquare:"◻",emptyv:"∅",EmptyVerySmallSquare:"▫",emsp13:" ",emsp14:" ",emsp:" ",ENG:"Ŋ",eng:"ŋ",ensp:" ",Eogon:"Ę",eogon:"ę",Eopf:"𝔼",eopf:"𝕖",epar:"⋕",eparsl:"⧣",eplus:"⩱",epsi:"ε",Epsilon:"Ε",epsilon:"ε",epsiv:"ϵ",eqcirc:"≖",eqcolon:"≕",eqsim:"≂",eqslantgtr:"⪖",eqslantless:"⪕",Equal:"⩵",equals:"=",EqualTilde:"≂",equest:"≟",Equilibrium:"⇌",equiv:"≡",equivDD:"⩸",eqvparsl:"⧥",erarr:"⥱",erDot:"≓",escr:"ℯ",Escr:"ℰ",esdot:"≐",Esim:"⩳",esim:"≂",Eta:"Η",eta:"η",ETH:"Ð",eth:"ð",Euml:"Ë",euml:"ë",euro:"€",excl:"!",exist:"∃",Exists:"∃",expectation:"ℰ",exponentiale:"ⅇ",ExponentialE:"ⅇ",fallingdotseq:"≒",Fcy:"Ф",fcy:"ф",female:"♀",ffilig:"ﬃ",fflig:"ﬀ",ffllig:"ﬄ",Ffr:Ffr,ffr:ffr,filig:"ﬁ",FilledSmallSquare:"◼",FilledVerySmallSquare:"▪",fjlig:"fj",flat:"♭",fllig:"ﬂ",fltns:"▱",fnof:"ƒ",Fopf:"𝔽",fopf:"𝕗",forall:"∀",ForAll:"∀",fork:"⋔",forkv:"⫙",Fouriertrf:"ℱ",fpartint:"⨍",frac12:"½",frac13:"⅓",frac14:"¼",frac15:"⅕",frac16:"⅙",frac18:"⅛",frac23:"⅔",frac25:"⅖",frac34:"¾",frac35:"⅗",frac38:"⅜",frac45:"⅘",frac56:"⅚",frac58:"⅝",frac78:"⅞",frasl:"⁄",frown:"⌢",fscr:"𝒻",Fscr:"ℱ",gacute:"ǵ",Gamma:"Γ",gamma:"γ",Gammad:"Ϝ",gammad:"ϝ",gap:"⪆",Gbreve:"Ğ",gbreve:"ğ",Gcedil:"Ģ",Gcirc:"Ĝ",gcirc:"ĝ",Gcy:"Г",gcy:"г",Gdot:"Ġ",gdot:"ġ",ge:ge,gE:gE,gEl:"⪌",gel:"⋛",geq:"≥",geqq:"≧",geqslant:"⩾",gescc:"⪩",ges:"⩾",gesdot:"⪀",gesdoto:"⪂",gesdotol:"⪄",gesl:"⋛︀",gesles:"⪔",Gfr:Gfr,gfr:gfr,gg:gg,Gg:Gg,ggg:"⋙",gimel:"ℷ",GJcy:"Ѓ",gjcy:"ѓ",gla:"⪥",gl:gl,glE:"⪒",glj:"⪤",gnap:"⪊",gnapprox:"⪊",gne:"⪈",gnE:"≩",gneq:"⪈",gneqq:"≩",gnsim:"⋧",Gopf:"𝔾",gopf:"𝕘",grave:"`",GreaterEqual:"≥",GreaterEqualLess:"⋛",GreaterFullEqual:"≧",GreaterGreater:"⪢",GreaterLess:"≷",GreaterSlantEqual:"⩾",GreaterTilde:"≳",Gscr:"𝒢",gscr:"ℊ",gsim:"≳",gsime:"⪎",gsiml:"⪐",gtcc:"⪧",gtcir:"⩺",gt:">",GT:">",Gt:Gt,gtdot:"⋗",gtlPar:"⦕",gtquest:"⩼",gtrapprox:"⪆",gtrarr:"⥸",gtrdot:"⋗",gtreqless:"⋛",gtreqqless:"⪌",gtrless:"≷",gtrsim:"≳",gvertneqq:"≩︀",gvnE:"≩︀",Hacek:"ˇ",hairsp:" ",half:"½",hamilt:"ℋ",HARDcy:"Ъ",hardcy:"ъ",harrcir:"⥈",harr:"↔",hArr:"⇔",harrw:"↭",Hat:"^",hbar:"ℏ",Hcirc:"Ĥ",hcirc:"ĥ",hearts:"♥",heartsuit:"♥",hellip:"…",hercon:"⊹",hfr:hfr,Hfr:"ℌ",HilbertSpace:"ℋ",hksearow:"⤥",hkswarow:"⤦",hoarr:"⇿",homtht:"∻",hookleftarrow:"↩",hookrightarrow:"↪",hopf:"𝕙",Hopf:"ℍ",horbar:"―",HorizontalLine:"─",hscr:"𝒽",Hscr:"ℋ",hslash:"ℏ",Hstrok:"Ħ",hstrok:"ħ",HumpDownHump:"≎",HumpEqual:"≏",hybull:"⁃",hyphen:"‐",Iacute:"Í",iacute:"í",ic:ic,Icirc:"Î",icirc:"î",Icy:"И",icy:"и",Idot:"İ",IEcy:"Е",iecy:"е",iexcl:"¡",iff:"⇔",ifr:ifr,Ifr:"ℑ",Igrave:"Ì",igrave:"ì",ii:ii,iiiint:"⨌",iiint:"∭",iinfin:"⧜",iiota:"℩",IJlig:"Ĳ",ijlig:"ĳ",Imacr:"Ī",imacr:"ī",image:"ℑ",ImaginaryI:"ⅈ",imagline:"ℐ",imagpart:"ℑ",imath:"ı",Im:Im,imof:"⊷",imped:"Ƶ",Implies:"⇒",incare:"℅",in:"∈",infin:"∞",infintie:"⧝",inodot:"ı",intcal:"⊺",int:"∫",Int:"∬",integers:"ℤ",Integral:"∫",intercal:"⊺",Intersection:"⋂",intlarhk:"⨗",intprod:"⨼",InvisibleComma:"⁣",InvisibleTimes:"⁢",IOcy:"Ё",iocy:"ё",Iogon:"Į",iogon:"į",Iopf:"𝕀",iopf:"𝕚",Iota:"Ι",iota:"ι",iprod:"⨼",iquest:"¿",iscr:"𝒾",Iscr:"ℐ",isin:"∈",isindot:"⋵",isinE:"⋹",isins:"⋴",isinsv:"⋳",isinv:"∈",it:it,Itilde:"Ĩ",itilde:"ĩ",Iukcy:"І",iukcy:"і",Iuml:"Ï",iuml:"ï",Jcirc:"Ĵ",jcirc:"ĵ",Jcy:"Й",jcy:"й",Jfr:Jfr,jfr:jfr,jmath:"ȷ",Jopf:"𝕁",jopf:"𝕛",Jscr:"𝒥",jscr:"𝒿",Jsercy:"Ј",jsercy:"ј",Jukcy:"Є",jukcy:"є",Kappa:"Κ",kappa:"κ",kappav:"ϰ",Kcedil:"Ķ",kcedil:"ķ",Kcy:"К",kcy:"к",Kfr:Kfr,kfr:kfr,kgreen:"ĸ",KHcy:"Х",khcy:"х",KJcy:"Ќ",kjcy:"ќ",Kopf:"𝕂",kopf:"𝕜",Kscr:"𝒦",kscr:"𝓀",lAarr:"⇚",Lacute:"Ĺ",lacute:"ĺ",laemptyv:"⦴",lagran:"ℒ",Lambda:"Λ",lambda:"λ",lang:"⟨",Lang:"⟪",langd:"⦑",langle:"⟨",lap:"⪅",Laplacetrf:"ℒ",laquo:"«",larrb:"⇤",larrbfs:"⤟",larr:"←",Larr:"↞",lArr:"⇐",larrfs:"⤝",larrhk:"↩",larrlp:"↫",larrpl:"⤹",larrsim:"⥳",larrtl:"↢",latail:"⤙",lAtail:"⤛",lat:"⪫",late:"⪭",lates:"⪭︀",lbarr:"⤌",lBarr:"⤎",lbbrk:"❲",lbrace:"{",lbrack:"[",lbrke:"⦋",lbrksld:"⦏",lbrkslu:"⦍",Lcaron:"Ľ",lcaron:"ľ",Lcedil:"Ļ",lcedil:"ļ",lceil:"⌈",lcub:"{",Lcy:"Л",lcy:"л",ldca:"⤶",ldquo:"“",ldquor:"„",ldrdhar:"⥧",ldrushar:"⥋",ldsh:"↲",le:le,lE:lE,LeftAngleBracket:"⟨",LeftArrowBar:"⇤",leftarrow:"←",LeftArrow:"←",Leftarrow:"⇐",LeftArrowRightArrow:"⇆",leftarrowtail:"↢",LeftCeiling:"⌈",LeftDoubleBracket:"⟦",LeftDownTeeVector:"⥡",LeftDownVectorBar:"⥙",LeftDownVector:"⇃",LeftFloor:"⌊",leftharpoondown:"↽",leftharpoonup:"↼",leftleftarrows:"⇇",leftrightarrow:"↔",LeftRightArrow:"↔",Leftrightarrow:"⇔",leftrightarrows:"⇆",leftrightharpoons:"⇋",leftrightsquigarrow:"↭",LeftRightVector:"⥎",LeftTeeArrow:"↤",LeftTee:"⊣",LeftTeeVector:"⥚",leftthreetimes:"⋋",LeftTriangleBar:"⧏",LeftTriangle:"⊲",LeftTriangleEqual:"⊴",LeftUpDownVector:"⥑",LeftUpTeeVector:"⥠",LeftUpVectorBar:"⥘",LeftUpVector:"↿",LeftVectorBar:"⥒",LeftVector:"↼",lEg:"⪋",leg:"⋚",leq:"≤",leqq:"≦",leqslant:"⩽",lescc:"⪨",les:"⩽",lesdot:"⩿",lesdoto:"⪁",lesdotor:"⪃",lesg:"⋚︀",lesges:"⪓",lessapprox:"⪅",lessdot:"⋖",lesseqgtr:"⋚",lesseqqgtr:"⪋",LessEqualGreater:"⋚",LessFullEqual:"≦",LessGreater:"≶",lessgtr:"≶",LessLess:"⪡",lesssim:"≲",LessSlantEqual:"⩽",LessTilde:"≲",lfisht:"⥼",lfloor:"⌊",Lfr:Lfr,lfr:lfr,lg:lg,lgE:"⪑",lHar:"⥢",lhard:"↽",lharu:"↼",lharul:"⥪",lhblk:"▄",LJcy:"Љ",ljcy:"љ",llarr:"⇇",ll:ll,Ll:Ll,llcorner:"⌞",Lleftarrow:"⇚",llhard:"⥫",lltri:"◺",Lmidot:"Ŀ",lmidot:"ŀ",lmoustache:"⎰",lmoust:"⎰",lnap:"⪉",lnapprox:"⪉",lne:"⪇",lnE:"≨",lneq:"⪇",lneqq:"≨",lnsim:"⋦",loang:"⟬",loarr:"⇽",lobrk:"⟦",longleftarrow:"⟵",LongLeftArrow:"⟵",Longleftarrow:"⟸",longleftrightarrow:"⟷",LongLeftRightArrow:"⟷",Longleftrightarrow:"⟺",longmapsto:"⟼",longrightarrow:"⟶",LongRightArrow:"⟶",Longrightarrow:"⟹",looparrowleft:"↫",looparrowright:"↬",lopar:"⦅",Lopf:"𝕃",lopf:"𝕝",loplus:"⨭",lotimes:"⨴",lowast:"∗",lowbar:"_",LowerLeftArrow:"↙",LowerRightArrow:"↘",loz:"◊",lozenge:"◊",lozf:"⧫",lpar:"(",lparlt:"⦓",lrarr:"⇆",lrcorner:"⌟",lrhar:"⇋",lrhard:"⥭",lrm:"‎",lrtri:"⊿",lsaquo:"‹",lscr:"𝓁",Lscr:"ℒ",lsh:"↰",Lsh:"↰",lsim:"≲",lsime:"⪍",lsimg:"⪏",lsqb:"[",lsquo:"‘",lsquor:"‚",Lstrok:"Ł",lstrok:"ł",ltcc:"⪦",ltcir:"⩹",lt:"<",LT:"<",Lt:Lt,ltdot:"⋖",lthree:"⋋",ltimes:"⋉",ltlarr:"⥶",ltquest:"⩻",ltri:"◃",ltrie:"⊴",ltrif:"◂",ltrPar:"⦖",lurdshar:"⥊",luruhar:"⥦",lvertneqq:"≨︀",lvnE:"≨︀",macr:"¯",male:"♂",malt:"✠",maltese:"✠",Map:"⤅",map:"↦",mapsto:"↦",mapstodown:"↧",mapstoleft:"↤",mapstoup:"↥",marker:"▮",mcomma:"⨩",Mcy:"М",mcy:"м",mdash:"—",mDDot:"∺",measuredangle:"∡",MediumSpace:" ",Mellintrf:"ℳ",Mfr:Mfr,mfr:mfr,mho:"℧",micro:"µ",midast:"*",midcir:"⫰",mid:"∣",middot:"·",minusb:"⊟",minus:"−",minusd:"∸",minusdu:"⨪",MinusPlus:"∓",mlcp:"⫛",mldr:"…",mnplus:"∓",models:"⊧",Mopf:"𝕄",mopf:"𝕞",mp:mp,mscr:"𝓂",Mscr:"ℳ",mstpos:"∾",Mu:Mu,mu:mu,multimap:"⊸",mumap:"⊸",nabla:"∇",Nacute:"Ń",nacute:"ń",nang:"∠⃒",nap:"≉",napE:"⩰̸",napid:"≋̸",napos:"ŉ",napprox:"≉",natural:"♮",naturals:"ℕ",natur:"♮",nbsp:" ",nbump:"≎̸",nbumpe:"≏̸",ncap:"⩃",Ncaron:"Ň",ncaron:"ň",Ncedil:"Ņ",ncedil:"ņ",ncong:"≇",ncongdot:"⩭̸",ncup:"⩂",Ncy:"Н",ncy:"н",ndash:"–",nearhk:"⤤",nearr:"↗",neArr:"⇗",nearrow:"↗",ne:ne,nedot:"≐̸",NegativeMediumSpace:"​",NegativeThickSpace:"​",NegativeThinSpace:"​",NegativeVeryThinSpace:"​",nequiv:"≢",nesear:"⤨",nesim:"≂̸",NestedGreaterGreater:"≫",NestedLessLess:"≪",NewLine:"\n",nexist:"∄",nexists:"∄",Nfr:Nfr,nfr:nfr,ngE:ngE,nge:"≱",ngeq:"≱",ngeqq:"≧̸",ngeqslant:"⩾̸",nges:"⩾̸",nGg:nGg,ngsim:"≵",nGt:nGt,ngt:"≯",ngtr:"≯",nGtv:"≫̸",nharr:"↮",nhArr:"⇎",nhpar:"⫲",ni:ni,nis:"⋼",nisd:"⋺",niv:"∋",NJcy:"Њ",njcy:"њ",nlarr:"↚",nlArr:"⇍",nldr:"‥",nlE:nlE,nle:"≰",nleftarrow:"↚",nLeftarrow:"⇍",nleftrightarrow:"↮",nLeftrightarrow:"⇎",nleq:"≰",nleqq:"≦̸",nleqslant:"⩽̸",nles:"⩽̸",nless:"≮",nLl:nLl,nlsim:"≴",nLt:nLt,nlt:"≮",nltri:"⋪",nltrie:"⋬",nLtv:"≪̸",nmid:"∤",NoBreak:"⁠",NonBreakingSpace:" ",nopf:"𝕟",Nopf:"ℕ",Not:"⫬",not:"¬",NotCongruent:"≢",NotCupCap:"≭",NotDoubleVerticalBar:"∦",NotElement:"∉",NotEqual:"≠",NotEqualTilde:"≂̸",NotExists:"∄",NotGreater:"≯",NotGreaterEqual:"≱",NotGreaterFullEqual:"≧̸",NotGreaterGreater:"≫̸",NotGreaterLess:"≹",NotGreaterSlantEqual:"⩾̸",NotGreaterTilde:"≵",NotHumpDownHump:"≎̸",NotHumpEqual:"≏̸",notin:"∉",notindot:"⋵̸",notinE:"⋹̸",notinva:"∉",notinvb:"⋷",notinvc:"⋶",NotLeftTriangleBar:"⧏̸",NotLeftTriangle:"⋪",NotLeftTriangleEqual:"⋬",NotLess:"≮",NotLessEqual:"≰",NotLessGreater:"≸",NotLessLess:"≪̸",NotLessSlantEqual:"⩽̸",NotLessTilde:"≴",NotNestedGreaterGreater:"⪢̸",NotNestedLessLess:"⪡̸",notni:"∌",notniva:"∌",notnivb:"⋾",notnivc:"⋽",NotPrecedes:"⊀",NotPrecedesEqual:"⪯̸",NotPrecedesSlantEqual:"⋠",NotReverseElement:"∌",NotRightTriangleBar:"⧐̸",NotRightTriangle:"⋫",NotRightTriangleEqual:"⋭",NotSquareSubset:"⊏̸",NotSquareSubsetEqual:"⋢",NotSquareSuperset:"⊐̸",NotSquareSupersetEqual:"⋣",NotSubset:"⊂⃒",NotSubsetEqual:"⊈",NotSucceeds:"⊁",NotSucceedsEqual:"⪰̸",NotSucceedsSlantEqual:"⋡",NotSucceedsTilde:"≿̸",NotSuperset:"⊃⃒",NotSupersetEqual:"⊉",NotTilde:"≁",NotTildeEqual:"≄",NotTildeFullEqual:"≇",NotTildeTilde:"≉",NotVerticalBar:"∤",nparallel:"∦",npar:"∦",nparsl:"⫽⃥",npart:"∂̸",npolint:"⨔",npr:"⊀",nprcue:"⋠",nprec:"⊀",npreceq:"⪯̸",npre:"⪯̸",nrarrc:"⤳̸",nrarr:"↛",nrArr:"⇏",nrarrw:"↝̸",nrightarrow:"↛",nRightarrow:"⇏",nrtri:"⋫",nrtrie:"⋭",nsc:"⊁",nsccue:"⋡",nsce:"⪰̸",Nscr:"𝒩",nscr:"𝓃",nshortmid:"∤",nshortparallel:"∦",nsim:"≁",nsime:"≄",nsimeq:"≄",nsmid:"∤",nspar:"∦",nsqsube:"⋢",nsqsupe:"⋣",nsub:"⊄",nsubE:"⫅̸",nsube:"⊈",nsubset:"⊂⃒",nsubseteq:"⊈",nsubseteqq:"⫅̸",nsucc:"⊁",nsucceq:"⪰̸",nsup:"⊅",nsupE:"⫆̸",nsupe:"⊉",nsupset:"⊃⃒",nsupseteq:"⊉",nsupseteqq:"⫆̸",ntgl:"≹",Ntilde:"Ñ",ntilde:"ñ",ntlg:"≸",ntriangleleft:"⋪",ntrianglelefteq:"⋬",ntriangleright:"⋫",ntrianglerighteq:"⋭",Nu:Nu,nu:nu,num:"#",numero:"№",numsp:" ",nvap:"≍⃒",nvdash:"⊬",nvDash:"⊭",nVdash:"⊮",nVDash:"⊯",nvge:"≥⃒",nvgt:">⃒",nvHarr:"⤄",nvinfin:"⧞",nvlArr:"⤂",nvle:"≤⃒",nvlt:"<⃒",nvltrie:"⊴⃒",nvrArr:"⤃",nvrtrie:"⊵⃒",nvsim:"∼⃒",nwarhk:"⤣",nwarr:"↖",nwArr:"⇖",nwarrow:"↖",nwnear:"⤧",Oacute:"Ó",oacute:"ó",oast:"⊛",Ocirc:"Ô",ocirc:"ô",ocir:"⊚",Ocy:"О",ocy:"о",odash:"⊝",Odblac:"Ő",odblac:"ő",odiv:"⨸",odot:"⊙",odsold:"⦼",OElig:"Œ",oelig:"œ",ofcir:"⦿",Ofr:Ofr,ofr:ofr,ogon:"˛",Ograve:"Ò",ograve:"ò",ogt:"⧁",ohbar:"⦵",ohm:"Ω",oint:"∮",olarr:"↺",olcir:"⦾",olcross:"⦻",oline:"‾",olt:"⧀",Omacr:"Ō",omacr:"ō",Omega:"Ω",omega:"ω",Omicron:"Ο",omicron:"ο",omid:"⦶",ominus:"⊖",Oopf:"𝕆",oopf:"𝕠",opar:"⦷",OpenCurlyDoubleQuote:"“",OpenCurlyQuote:"‘",operp:"⦹",oplus:"⊕",orarr:"↻",Or:Or,or:or,ord:"⩝",order:"ℴ",orderof:"ℴ",ordf:"ª",ordm:"º",origof:"⊶",oror:"⩖",orslope:"⩗",orv:"⩛",oS:oS,Oscr:"𝒪",oscr:"ℴ",Oslash:"Ø",oslash:"ø",osol:"⊘",Otilde:"Õ",otilde:"õ",otimesas:"⨶",Otimes:"⨷",otimes:"⊗",Ouml:"Ö",ouml:"ö",ovbar:"⌽",OverBar:"‾",OverBrace:"⏞",OverBracket:"⎴",OverParenthesis:"⏜",para:"¶",parallel:"∥",par:"∥",parsim:"⫳",parsl:"⫽",part:"∂",PartialD:"∂",Pcy:"П",pcy:"п",percnt:"%",period:".",permil:"‰",perp:"⊥",pertenk:"‱",Pfr:Pfr,pfr:pfr,Phi:"Φ",phi:"φ",phiv:"ϕ",phmmat:"ℳ",phone:"☎",Pi:Pi,pi:pi,pitchfork:"⋔",piv:"ϖ",planck:"ℏ",planckh:"ℎ",plankv:"ℏ",plusacir:"⨣",plusb:"⊞",pluscir:"⨢",plus:"+",plusdo:"∔",plusdu:"⨥",pluse:"⩲",PlusMinus:"±",plusmn:"±",plussim:"⨦",plustwo:"⨧",pm:pm,Poincareplane:"ℌ",pointint:"⨕",popf:"𝕡",Popf:"ℙ",pound:"£",prap:"⪷",Pr:Pr,pr:pr,prcue:"≼",precapprox:"⪷",prec:"≺",preccurlyeq:"≼",Precedes:"≺",PrecedesEqual:"⪯",PrecedesSlantEqual:"≼",PrecedesTilde:"≾",preceq:"⪯",precnapprox:"⪹",precneqq:"⪵",precnsim:"⋨",pre:"⪯",prE:"⪳",precsim:"≾",prime:"′",Prime:"″",primes:"ℙ",prnap:"⪹",prnE:"⪵",prnsim:"⋨",prod:"∏",Product:"∏",profalar:"⌮",profline:"⌒",profsurf:"⌓",prop:"∝",Proportional:"∝",Proportion:"∷",propto:"∝",prsim:"≾",prurel:"⊰",Pscr:"𝒫",pscr:"𝓅",Psi:"Ψ",psi:"ψ",puncsp:" ",Qfr:Qfr,qfr:qfr,qint:"⨌",qopf:"𝕢",Qopf:"ℚ",qprime:"⁗",Qscr:"𝒬",qscr:"𝓆",quaternions:"ℍ",quatint:"⨖",quest:"?",questeq:"≟",quot:'"',QUOT:'"',rAarr:"⇛",race:"∽̱",Racute:"Ŕ",racute:"ŕ",radic:"√",raemptyv:"⦳",rang:"⟩",Rang:"⟫",rangd:"⦒",range:"⦥",rangle:"⟩",raquo:"»",rarrap:"⥵",rarrb:"⇥",rarrbfs:"⤠",rarrc:"⤳",rarr:"→",Rarr:"↠",rArr:"⇒",rarrfs:"⤞",rarrhk:"↪",rarrlp:"↬",rarrpl:"⥅",rarrsim:"⥴",Rarrtl:"⤖",rarrtl:"↣",rarrw:"↝",ratail:"⤚",rAtail:"⤜",ratio:"∶",rationals:"ℚ",rbarr:"⤍",rBarr:"⤏",RBarr:"⤐",rbbrk:"❳",rbrace:"}",rbrack:"]",rbrke:"⦌",rbrksld:"⦎",rbrkslu:"⦐",Rcaron:"Ř",rcaron:"ř",Rcedil:"Ŗ",rcedil:"ŗ",rceil:"⌉",rcub:"}",Rcy:"Р",rcy:"р",rdca:"⤷",rdldhar:"⥩",rdquo:"”",rdquor:"”",rdsh:"↳",real:"ℜ",realine:"ℛ",realpart:"ℜ",reals:"ℝ",Re:Re,rect:"▭",reg:"®",REG:"®",ReverseElement:"∋",ReverseEquilibrium:"⇋",ReverseUpEquilibrium:"⥯",rfisht:"⥽",rfloor:"⌋",rfr:rfr,Rfr:"ℜ",rHar:"⥤",rhard:"⇁",rharu:"⇀",rharul:"⥬",Rho:"Ρ",rho:"ρ",rhov:"ϱ",RightAngleBracket:"⟩",RightArrowBar:"⇥",rightarrow:"→",RightArrow:"→",Rightarrow:"⇒",RightArrowLeftArrow:"⇄",rightarrowtail:"↣",RightCeiling:"⌉",RightDoubleBracket:"⟧",RightDownTeeVector:"⥝",RightDownVectorBar:"⥕",RightDownVector:"⇂",RightFloor:"⌋",rightharpoondown:"⇁",rightharpoonup:"⇀",rightleftarrows:"⇄",rightleftharpoons:"⇌",rightrightarrows:"⇉",rightsquigarrow:"↝",RightTeeArrow:"↦",RightTee:"⊢",RightTeeVector:"⥛",rightthreetimes:"⋌",RightTriangleBar:"⧐",RightTriangle:"⊳",RightTriangleEqual:"⊵",RightUpDownVector:"⥏",RightUpTeeVector:"⥜",RightUpVectorBar:"⥔",RightUpVector:"↾",RightVectorBar:"⥓",RightVector:"⇀",ring:"˚",risingdotseq:"≓",rlarr:"⇄",rlhar:"⇌",rlm:"‏",rmoustache:"⎱",rmoust:"⎱",rnmid:"⫮",roang:"⟭",roarr:"⇾",robrk:"⟧",ropar:"⦆",ropf:"𝕣",Ropf:"ℝ",roplus:"⨮",rotimes:"⨵",RoundImplies:"⥰",rpar:")",rpargt:"⦔",rppolint:"⨒",rrarr:"⇉",Rrightarrow:"⇛",rsaquo:"›",rscr:"𝓇",Rscr:"ℛ",rsh:"↱",Rsh:"↱",rsqb:"]",rsquo:"’",rsquor:"’",rthree:"⋌",rtimes:"⋊",rtri:"▹",rtrie:"⊵",rtrif:"▸",rtriltri:"⧎",RuleDelayed:"⧴",ruluhar:"⥨",rx:rx,Sacute:"Ś",sacute:"ś",sbquo:"‚",scap:"⪸",Scaron:"Š",scaron:"š",Sc:Sc,sc:sc,sccue:"≽",sce:"⪰",scE:"⪴",Scedil:"Ş",scedil:"ş",Scirc:"Ŝ",scirc:"ŝ",scnap:"⪺",scnE:"⪶",scnsim:"⋩",scpolint:"⨓",scsim:"≿",Scy:"С",scy:"с",sdotb:"⊡",sdot:"⋅",sdote:"⩦",searhk:"⤥",searr:"↘",seArr:"⇘",searrow:"↘",sect:"§",semi:";",seswar:"⤩",setminus:"∖",setmn:"∖",sext:"✶",Sfr:Sfr,sfr:sfr,sfrown:"⌢",sharp:"♯",SHCHcy:"Щ",shchcy:"щ",SHcy:"Ш",shcy:"ш",ShortDownArrow:"↓",ShortLeftArrow:"←",shortmid:"∣",shortparallel:"∥",ShortRightArrow:"→",ShortUpArrow:"↑",shy:"­",Sigma:"Σ",sigma:"σ",sigmaf:"ς",sigmav:"ς",sim:"∼",simdot:"⩪",sime:"≃",simeq:"≃",simg:"⪞",simgE:"⪠",siml:"⪝",simlE:"⪟",simne:"≆",simplus:"⨤",simrarr:"⥲",slarr:"←",SmallCircle:"∘",smallsetminus:"∖",smashp:"⨳",smeparsl:"⧤",smid:"∣",smile:"⌣",smt:"⪪",smte:"⪬",smtes:"⪬︀",SOFTcy:"Ь",softcy:"ь",solbar:"⌿",solb:"⧄",sol:"/",Sopf:"𝕊",sopf:"𝕤",spades:"♠",spadesuit:"♠",spar:"∥",sqcap:"⊓",sqcaps:"⊓︀",sqcup:"⊔",sqcups:"⊔︀",Sqrt:"√",sqsub:"⊏",sqsube:"⊑",sqsubset:"⊏",sqsubseteq:"⊑",sqsup:"⊐",sqsupe:"⊒",sqsupset:"⊐",sqsupseteq:"⊒",square:"□",Square:"□",SquareIntersection:"⊓",SquareSubset:"⊏",SquareSubsetEqual:"⊑",SquareSuperset:"⊐",SquareSupersetEqual:"⊒",SquareUnion:"⊔",squarf:"▪",squ:"□",squf:"▪",srarr:"→",Sscr:"𝒮",sscr:"𝓈",ssetmn:"∖",ssmile:"⌣",sstarf:"⋆",Star:"⋆",star:"☆",starf:"★",straightepsilon:"ϵ",straightphi:"ϕ",strns:"¯",sub:"⊂",Sub:"⋐",subdot:"⪽",subE:"⫅",sube:"⊆",subedot:"⫃",submult:"⫁",subnE:"⫋",subne:"⊊",subplus:"⪿",subrarr:"⥹",subset:"⊂",Subset:"⋐",subseteq:"⊆",subseteqq:"⫅",SubsetEqual:"⊆",subsetneq:"⊊",subsetneqq:"⫋",subsim:"⫇",subsub:"⫕",subsup:"⫓",succapprox:"⪸",succ:"≻",succcurlyeq:"≽",Succeeds:"≻",SucceedsEqual:"⪰",SucceedsSlantEqual:"≽",SucceedsTilde:"≿",succeq:"⪰",succnapprox:"⪺",succneqq:"⪶",succnsim:"⋩",succsim:"≿",SuchThat:"∋",sum:"∑",Sum:"∑",sung:"♪",sup1:"¹",sup2:"²",sup3:"³",sup:"⊃",Sup:"⋑",supdot:"⪾",supdsub:"⫘",supE:"⫆",supe:"⊇",supedot:"⫄",Superset:"⊃",SupersetEqual:"⊇",suphsol:"⟉",suphsub:"⫗",suplarr:"⥻",supmult:"⫂",supnE:"⫌",supne:"⊋",supplus:"⫀",supset:"⊃",Supset:"⋑",supseteq:"⊇",supseteqq:"⫆",supsetneq:"⊋",supsetneqq:"⫌",supsim:"⫈",supsub:"⫔",supsup:"⫖",swarhk:"⤦",swarr:"↙",swArr:"⇙",swarrow:"↙",swnwar:"⤪",szlig:"ß",Tab:Tab,target:"⌖",Tau:"Τ",tau:"τ",tbrk:"⎴",Tcaron:"Ť",tcaron:"ť",Tcedil:"Ţ",tcedil:"ţ",Tcy:"Т",tcy:"т",tdot:"⃛",telrec:"⌕",Tfr:Tfr,tfr:tfr,there4:"∴",therefore:"∴",Therefore:"∴",Theta:"Θ",theta:"θ",thetasym:"ϑ",thetav:"ϑ",thickapprox:"≈",thicksim:"∼",ThickSpace:"  ",ThinSpace:" ",thinsp:" ",thkap:"≈",thksim:"∼",THORN:"Þ",thorn:"þ",tilde:"˜",Tilde:"∼",TildeEqual:"≃",TildeFullEqual:"≅",TildeTilde:"≈",timesbar:"⨱",timesb:"⊠",times:"×",timesd:"⨰",tint:"∭",toea:"⤨",topbot:"⌶",topcir:"⫱",top:"⊤",Topf:"𝕋",topf:"𝕥",topfork:"⫚",tosa:"⤩",tprime:"‴",trade:"™",TRADE:"™",triangle:"▵",triangledown:"▿",triangleleft:"◃",trianglelefteq:"⊴",triangleq:"≜",triangleright:"▹",trianglerighteq:"⊵",tridot:"◬",trie:"≜",triminus:"⨺",TripleDot:"⃛",triplus:"⨹",trisb:"⧍",tritime:"⨻",trpezium:"⏢",Tscr:"𝒯",tscr:"𝓉",TScy:"Ц",tscy:"ц",TSHcy:"Ћ",tshcy:"ћ",Tstrok:"Ŧ",tstrok:"ŧ",twixt:"≬",twoheadleftarrow:"↞",twoheadrightarrow:"↠",Uacute:"Ú",uacute:"ú",uarr:"↑",Uarr:"↟",uArr:"⇑",Uarrocir:"⥉",Ubrcy:"Ў",ubrcy:"ў",Ubreve:"Ŭ",ubreve:"ŭ",Ucirc:"Û",ucirc:"û",Ucy:"У",ucy:"у",udarr:"⇅",Udblac:"Ű",udblac:"ű",udhar:"⥮",ufisht:"⥾",Ufr:Ufr,ufr:ufr,Ugrave:"Ù",ugrave:"ù",uHar:"⥣",uharl:"↿",uharr:"↾",uhblk:"▀",ulcorn:"⌜",ulcorner:"⌜",ulcrop:"⌏",ultri:"◸",Umacr:"Ū",umacr:"ū",uml:"¨",UnderBar:"_",UnderBrace:"⏟",UnderBracket:"⎵",UnderParenthesis:"⏝",Union:"⋃",UnionPlus:"⊎",Uogon:"Ų",uogon:"ų",Uopf:"𝕌",uopf:"𝕦",UpArrowBar:"⤒",uparrow:"↑",UpArrow:"↑",Uparrow:"⇑",UpArrowDownArrow:"⇅",updownarrow:"↕",UpDownArrow:"↕",Updownarrow:"⇕",UpEquilibrium:"⥮",upharpoonleft:"↿",upharpoonright:"↾",uplus:"⊎",UpperLeftArrow:"↖",UpperRightArrow:"↗",upsi:"υ",Upsi:"ϒ",upsih:"ϒ",Upsilon:"Υ",upsilon:"υ",UpTeeArrow:"↥",UpTee:"⊥",upuparrows:"⇈",urcorn:"⌝",urcorner:"⌝",urcrop:"⌎",Uring:"Ů",uring:"ů",urtri:"◹",Uscr:"𝒰",uscr:"𝓊",utdot:"⋰",Utilde:"Ũ",utilde:"ũ",utri:"▵",utrif:"▴",uuarr:"⇈",Uuml:"Ü",uuml:"ü",uwangle:"⦧",vangrt:"⦜",varepsilon:"ϵ",varkappa:"ϰ",varnothing:"∅",varphi:"ϕ",varpi:"ϖ",varpropto:"∝",varr:"↕",vArr:"⇕",varrho:"ϱ",varsigma:"ς",varsubsetneq:"⊊︀",varsubsetneqq:"⫋︀",varsupsetneq:"⊋︀",varsupsetneqq:"⫌︀",vartheta:"ϑ",vartriangleleft:"⊲",vartriangleright:"⊳",vBar:"⫨",Vbar:"⫫",vBarv:"⫩",Vcy:"В",vcy:"в",vdash:"⊢",vDash:"⊨",Vdash:"⊩",VDash:"⊫",Vdashl:"⫦",veebar:"⊻",vee:"∨",Vee:"⋁",veeeq:"≚",vellip:"⋮",verbar:"|",Verbar:"‖",vert:"|",Vert:"‖",VerticalBar:"∣",VerticalLine:"|",VerticalSeparator:"❘",VerticalTilde:"≀",VeryThinSpace:" ",Vfr:Vfr,vfr:vfr,vltri:"⊲",vnsub:"⊂⃒",vnsup:"⊃⃒",Vopf:"𝕍",vopf:"𝕧",vprop:"∝",vrtri:"⊳",Vscr:"𝒱",vscr:"𝓋",vsubnE:"⫋︀",vsubne:"⊊︀",vsupnE:"⫌︀",vsupne:"⊋︀",Vvdash:"⊪",vzigzag:"⦚",Wcirc:"Ŵ",wcirc:"ŵ",wedbar:"⩟",wedge:"∧",Wedge:"⋀",wedgeq:"≙",weierp:"℘",Wfr:"𝔚",wfr:"𝔴",Wopf:"𝕎",wopf:"𝕨",wp:"℘",wr:"≀",wreath:"≀",Wscr:"𝒲",wscr:"𝓌",xcap:"⋂",xcirc:"◯",xcup:"⋃",xdtri:"▽",Xfr:"𝔛",xfr:"𝔵",xharr:"⟷",xhArr:"⟺",Xi:"Ξ",xi:"ξ",xlarr:"⟵",xlArr:"⟸",xmap:"⟼",xnis:"⋻",xodot:"⨀",Xopf:"𝕏",xopf:"𝕩",xoplus:"⨁",xotime:"⨂",xrarr:"⟶",xrArr:"⟹",Xscr:"𝒳",xscr:"𝓍",xsqcup:"⨆",xuplus:"⨄",xutri:"△",xvee:"⋁",xwedge:"⋀",Yacute:"Ý",yacute:"ý",YAcy:"Я",yacy:"я",Ycirc:"Ŷ",ycirc:"ŷ",Ycy:"Ы",ycy:"ы",yen:"¥",Yfr:"𝔜",yfr:"𝔶",YIcy:"Ї",yicy:"ї",Yopf:"𝕐",yopf:"𝕪",Yscr:"𝒴",yscr:"𝓎",YUcy:"Ю",yucy:"ю",yuml:"ÿ",Yuml:"Ÿ",Zacute:"Ź",zacute:"ź",Zcaron:"Ž",zcaron:"ž",Zcy:"З",zcy:"з",Zdot:"Ż",zdot:"ż",zeetrf:"ℨ",ZeroWidthSpace:"​",Zeta:"Ζ",zeta:"ζ",zfr:"𝔷",Zfr:"ℨ",ZHcy:"Ж",zhcy:"ж",zigrarr:"⇝",zopf:"𝕫",Zopf:"ℤ",Zscr:"𝒵",zscr:"𝓏",zwj:"‍",zwnj:"‌"},Aacute="Á",aacute="á",Acirc="Â",acirc="â",acute="´",AElig="Æ",aelig="æ",Agrave="À",agrave="à",amp$1="&",AMP="&",Aring="Å",aring="å",Atilde="Ã",atilde="ã",Auml="Ä",auml="ä",brvbar="¦",Ccedil="Ç",ccedil="ç",cedil="¸",cent="¢",esm_copy="©",COPY="©",curren="¤",deg="°",divide="÷",Eacute="É",eacute="é",Ecirc="Ê",ecirc="ê",Egrave="È",egrave="è",ETH="Ð",eth="ð",Euml="Ë",euml="ë",frac12="½",frac14="¼",frac34="¾",gt$1=">",GT,Iacute="Í",iacute="í",Icirc="Î",icirc="î",iexcl="¡",Igrave="Ì",igrave="ì",iquest="¿",Iuml="Ï",iuml="ï",laquo="«",lt$1="<",LT,macr="¯",micro="µ",middot="·",nbsp=" ",not="¬",Ntilde="Ñ",ntilde="ñ",Oacute="Ó",oacute="ó",Ocirc="Ô",ocirc="ô",Ograve="Ò",ograve="ò",ordf="ª",ordm="º",Oslash="Ø",oslash="ø",Otilde="Õ",otilde="õ",Ouml="Ö",ouml="ö",para="¶",plusmn="±",pound="£",quot$1='"',QUOT='"',raquo="»",reg="®",REG="®",sect="§",shy="­",sup1="¹",sup2="²",sup3="³",szlig="ß",THORN="Þ",thorn="þ",times="×",Uacute="Ú",uacute="ú",Ucirc="Û",ucirc="û",Ugrave="Ù",ugrave="ù",uml="¨",Uuml="Ü",uuml="ü",Yacute="Ý",yacute="ý",yen="¥",yuml="ÿ",require$$1={Aacute:"Á",aacute:"á",Acirc:"Â",acirc:"â",acute:"´",AElig:"Æ",aelig:"æ",Agrave:"À",agrave:"à",amp:"&",AMP:"&",Aring:"Å",aring:"å",Atilde:"Ã",atilde:"ã",Auml:"Ä",auml:"ä",brvbar:"¦",Ccedil:"Ç",ccedil:"ç",cedil:"¸",cent:"¢",copy:"©",COPY:"©",curren:"¤",deg:"°",divide:"÷",Eacute:"É",eacute:"é",Ecirc:"Ê",ecirc:"ê",Egrave:"È",egrave:"è",ETH:"Ð",eth:"ð",Euml:"Ë",euml:"ë",frac12:"½",frac14:"¼",frac34:"¾",gt:">",GT:">",Iacute:"Í",iacute:"í",Icirc:"Î",icirc:"î",iexcl:"¡",Igrave:"Ì",igrave:"ì",iquest:"¿",Iuml:"Ï",iuml:"ï",laquo:"«",lt:"<",LT:"<",macr:"¯",micro:"µ",middot:"·",nbsp:" ",not:"¬",Ntilde:"Ñ",ntilde:"ñ",Oacute:"Ó",oacute:"ó",Ocirc:"Ô",ocirc:"ô",Ograve:"Ò",ograve:"ò",ordf:"ª",ordm:"º",Oslash:"Ø",oslash:"ø",Otilde:"Õ",otilde:"õ",Ouml:"Ö",ouml:"ö",para:"¶",plusmn:"±",pound:"£",quot:'"',QUOT:'"',raquo:"»",reg:"®",REG:"®",sect:"§",shy:"­",sup1:"¹",sup2:"²",sup3:"³",szlig:"ß",THORN:"Þ",thorn:"þ",times:"×",Uacute:"Ú",uacute:"ú",Ucirc:"Û",ucirc:"û",Ugrave:"Ù",ugrave:"ù",uml:"¨",Uuml:"Ü",uuml:"ü",Yacute:"Ý",yacute:"ý",yen:"¥",yuml:"ÿ"},amp="&",apos="'",gt,lt,quot='"',require$$0$1={amp:"&",apos:"'",gt:">",lt:"<",quot:'"'},decode_codepoint={},require$$0={0:65533,128:8364,130:8218,131:402,132:8222,133:8230,134:8224,135:8225,136:710,137:8240,138:352,139:8249,140:338,142:381,145:8216,146:8217,147:8220,148:8221,149:8226,150:8211,151:8212,152:732,153:8482,154:353,155:8250,156:339,158:382,159:376},__importDefault$2=commonjsGlobal&&commonjsGlobal.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(decode_codepoint,"__esModule",{value:!0});var decode_json_1=__importDefault$2(require$$0),fromCodePoint$2=String.fromCodePoint||function(codePoint){var output="";return codePoint>65535&&(codePoint-=65536,output+=String.fromCharCode(codePoint>>>10&1023|55296),codePoint=56320|1023&codePoint),output+=String.fromCharCode(codePoint)};function decodeCodePoint(codePoint){return codePoint>=55296&&codePoint<=57343||codePoint>1114111?"�":(codePoint in decode_json_1.default&&(codePoint=decode_json_1.default[codePoint]),fromCodePoint$2(codePoint))}decode_codepoint.default=decodeCodePoint;var __importDefault$1=commonjsGlobal&&commonjsGlobal.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(decode,"__esModule",{value:!0}),decode.decodeHTML=decode.decodeHTMLStrict=decode.decodeXML=void 0;var entities_json_1$1=__importDefault$1(require$$1$1),legacy_json_1=__importDefault$1(require$$1),xml_json_1$1=__importDefault$1(require$$0$1),decode_codepoint_1=__importDefault$1(decode_codepoint),strictEntityRe=/&(?:[a-zA-Z0-9]+|#[xX][\da-fA-F]+|#\d+);/g;function getStrictDecoder(map){var replace=getReplacer(map);return function(str){return String(str).replace(strictEntityRe,replace)}}decode.decodeXML=getStrictDecoder(xml_json_1$1.default),decode.decodeHTMLStrict=getStrictDecoder(entities_json_1$1.default);var sorter=function(a,b){return a<b?1:-1};function getReplacer(map){return function replace(str){if("#"===str.charAt(1)){var secondChar=str.charAt(2);return"X"===secondChar||"x"===secondChar?decode_codepoint_1.default(parseInt(str.substr(3),16)):decode_codepoint_1.default(parseInt(str.substr(2),10))}return map[str.slice(1,-1)]||str}}decode.decodeHTML=function(){for(var legacy=Object.keys(legacy_json_1.default).sort(sorter),keys=Object.keys(entities_json_1$1.default).sort(sorter),i=0,j=0;i<keys.length;i++)legacy[j]===keys[i]?(keys[i]+=";?",j++):keys[i]+=";";var re=new RegExp("&(?:"+keys.join("|")+"|#[xX][\\da-fA-F]+;?|#\\d+;?)","g"),replace=getReplacer(entities_json_1$1.default);function replacer(str){return";"!==str.substr(-1)&&(str+=";"),replace(str)}return function(str){return String(str).replace(re,replacer)}}();var encode={},esm_importDefault=commonjsGlobal&&commonjsGlobal.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(encode,"__esModule",{value:!0}),encode.escapeUTF8=encode.escape=encode.encodeNonAsciiHTML=encode.encodeHTML=encode.encodeXML=void 0;var xml_json_1,inverseXML=getInverseObj(esm_importDefault(require$$0$1).default),xmlReplacer=getInverseReplacer(inverseXML);encode.encodeXML=getASCIIEncoder(inverseXML);var entities_json_1,inverseHTML=getInverseObj(esm_importDefault(require$$1$1).default),htmlReplacer=getInverseReplacer(inverseHTML);function getInverseObj(obj){return Object.keys(obj).sort().reduce((function(inverse,name){return inverse[obj[name]]="&"+name+";",inverse}),{})}function getInverseReplacer(inverse){for(var single=[],multiple=[],_i=0,_a=Object.keys(inverse);_i<_a.length;_i++){var k=_a[_i];1===k.length?single.push("\\"+k):multiple.push(k)}single.sort();for(var start=0;start<single.length-1;start++){for(var end=start;end<single.length-1&&single[end].charCodeAt(1)+1===single[end+1].charCodeAt(1);)end+=1;var count=1+end-start;count<3||single.splice(start,count,single[start]+"-"+single[end])}return multiple.unshift("["+single.join("")+"]"),new RegExp(multiple.join("|"),"g")}encode.encodeHTML=getInverse(inverseHTML,htmlReplacer),encode.encodeNonAsciiHTML=getASCIIEncoder(inverseHTML);var reNonASCII=/(?:[\x80-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])/g,getCodePoint=null!=String.prototype.codePointAt?function(str){return str.codePointAt(0)}:function(c){return 1024*(c.charCodeAt(0)-55296)+c.charCodeAt(1)-56320+65536};function singleCharReplacer(c){return"&#x"+(c.length>1?getCodePoint(c):c.charCodeAt(0)).toString(16).toUpperCase()+";"}function getInverse(inverse,re){return function(data){return data.replace(re,(function(name){return inverse[name]})).replace(reNonASCII,singleCharReplacer)}}var reEscapeChars=new RegExp(xmlReplacer.source+"|"+reNonASCII.source,"g");function esm_escape(data){return data.replace(reEscapeChars,singleCharReplacer)}function escapeUTF8(data){return data.replace(xmlReplacer,singleCharReplacer)}function getASCIIEncoder(obj){return function(data){return data.replace(reEscapeChars,(function(c){return obj[c]||singleCharReplacer(c)}))}}encode.escape=esm_escape,encode.escapeUTF8=escapeUTF8,function(exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.decodeXMLStrict=exports.decodeHTML5Strict=exports.decodeHTML4Strict=exports.decodeHTML5=exports.decodeHTML4=exports.decodeHTMLStrict=exports.decodeHTML=exports.decodeXML=exports.encodeHTML5=exports.encodeHTML4=exports.escapeUTF8=exports.escape=exports.encodeNonAsciiHTML=exports.encodeHTML=exports.encodeXML=exports.encode=exports.decodeStrict=exports.decode=void 0;var decode_1=decode,encode_1=encode;function decode$1(data,level){return(!level||level<=0?decode_1.decodeXML:decode_1.decodeHTML)(data)}function decodeStrict(data,level){return(!level||level<=0?decode_1.decodeXML:decode_1.decodeHTMLStrict)(data)}function encode$1(data,level){return(!level||level<=0?encode_1.encodeXML:encode_1.encodeHTML)(data)}exports.decode=decode$1,exports.decodeStrict=decodeStrict,exports.encode=encode$1;var encode_2=encode;Object.defineProperty(exports,"encodeXML",{enumerable:!0,get:function(){return encode_2.encodeXML}}),Object.defineProperty(exports,"encodeHTML",{enumerable:!0,get:function(){return encode_2.encodeHTML}}),Object.defineProperty(exports,"encodeNonAsciiHTML",{enumerable:!0,get:function(){return encode_2.encodeNonAsciiHTML}}),Object.defineProperty(exports,"escape",{enumerable:!0,get:function(){return encode_2.escape}}),Object.defineProperty(exports,"escapeUTF8",{enumerable:!0,get:function(){return encode_2.escapeUTF8}}),Object.defineProperty(exports,"encodeHTML4",{enumerable:!0,get:function(){return encode_2.encodeHTML}}),Object.defineProperty(exports,"encodeHTML5",{enumerable:!0,get:function(){return encode_2.encodeHTML}});var decode_2=decode;Object.defineProperty(exports,"decodeXML",{enumerable:!0,get:function(){return decode_2.decodeXML}}),Object.defineProperty(exports,"decodeHTML",{enumerable:!0,get:function(){return decode_2.decodeHTML}}),Object.defineProperty(exports,"decodeHTMLStrict",{enumerable:!0,get:function(){return decode_2.decodeHTMLStrict}}),Object.defineProperty(exports,"decodeHTML4",{enumerable:!0,get:function(){return decode_2.decodeHTML}}),Object.defineProperty(exports,"decodeHTML5",{enumerable:!0,get:function(){return decode_2.decodeHTML}}),Object.defineProperty(exports,"decodeHTML4Strict",{enumerable:!0,get:function(){return decode_2.decodeHTMLStrict}}),Object.defineProperty(exports,"decodeHTML5Strict",{enumerable:!0,get:function(){return decode_2.decodeHTMLStrict}}),Object.defineProperty(exports,"decodeXMLStrict",{enumerable:!0,get:function(){return decode_2.decodeXML}})}(lib);var ENTITY="&(?:#x[a-f0-9]{1,6}|#[0-9]{1,7}|[a-z][a-z0-9]{1,31});",C_BACKSLASH$1=92,reBackslashOrAmp=/[\\&]/,ESCAPABLE="[!\"#$%&'()*+,./:;<=>?@[\\\\\\]^_`{|}~-]",reEntityOrEscapedChar=new RegExp("\\\\"+ESCAPABLE+"|"+ENTITY,"gi"),XMLSPECIAL='[&<>"]',reXmlSpecial=new RegExp('[&<>"]',"g"),unescapeChar=function(s){return 92===s.charCodeAt(0)?s.charAt(1):lib.decodeHTML(s)};function unescapeString(s){return reBackslashOrAmp.test(s)?s.replace(reEntityOrEscapedChar,unescapeChar):s}function normalizeURI(uri){try{return encode_1(uri)}catch(err){return uri}}function replaceUnsafeChar(s){switch(s){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";default:return s}}function escapeXml(s){return reXmlSpecial.test(s)?s.replace(reXmlSpecial,replaceUnsafeChar):s}function esm_repeat(str,count){for(var arr=[],i=0;i<count;i++)arr.push(str);return arr.join("")}function isEmpty(str){return!str||!/[^ \t]+/.test(str)}var NodeWalker=function(){function NodeWalker(root){this.current=root,this.root=root,this.entering=!0}return NodeWalker.prototype.next=function(){var cur=this.current,entering=this.entering;if(null===cur)return null;var container=esm_isContainer(cur);return entering&&container?cur.firstChild?(this.current=cur.firstChild,this.entering=!0):this.entering=!1:cur===this.root?this.current=null:null===cur.next?(this.current=cur.parent,this.entering=!1):(this.current=cur.next,this.entering=!0),{entering:entering,node:cur}},NodeWalker.prototype.resumeAt=function(node,entering){this.current=node,this.entering=!0===entering},NodeWalker}();function esm_isContainer(node){switch(node.type){case"document":case"blockQuote":case"list":case"item":case"paragraph":case"heading":case"emph":case"strong":case"strike":case"link":case"image":case"table":case"tableHead":case"tableBody":case"tableRow":case"tableCell":case"tableDelimRow":case"customInline":return!0;default:return!1}}var lastNodeId=1,nodeMap={};function getNodeById(id){return nodeMap[id]}function removeNodeById(id){delete nodeMap[id]}function removeAllNode(){nodeMap={}}var esm_Node=function(){function Node(nodeType,sourcepos){this.parent=null,this.prev=null,this.next=null,this.firstChild=null,this.lastChild=null,this.literal=null,this.id="document"===nodeType?-1:lastNodeId++,this.type=nodeType,this.sourcepos=sourcepos,nodeMap[this.id]=this}return Node.prototype.isContainer=function(){return esm_isContainer(this)},Node.prototype.unlink=function(){this.prev?this.prev.next=this.next:this.parent&&(this.parent.firstChild=this.next),this.next?this.next.prev=this.prev:this.parent&&(this.parent.lastChild=this.prev),this.parent=null,this.next=null,this.prev=null},Node.prototype.replaceWith=function(node){this.insertBefore(node),this.unlink()},Node.prototype.insertAfter=function(sibling){sibling.unlink(),sibling.next=this.next,sibling.next&&(sibling.next.prev=sibling),sibling.prev=this,this.next=sibling,this.parent&&(sibling.parent=this.parent,sibling.next||(sibling.parent.lastChild=sibling))},Node.prototype.insertBefore=function(sibling){sibling.unlink(),sibling.prev=this.prev,sibling.prev&&(sibling.prev.next=sibling),sibling.next=this,this.prev=sibling,sibling.parent=this.parent,sibling.prev||(sibling.parent.firstChild=sibling)},Node.prototype.appendChild=function(child){child.unlink(),child.parent=this,this.lastChild?(this.lastChild.next=child,child.prev=this.lastChild,this.lastChild=child):(this.firstChild=child,this.lastChild=child)},Node.prototype.prependChild=function(child){child.unlink(),child.parent=this,this.firstChild?(this.firstChild.prev=child,child.next=this.firstChild,this.firstChild=child):(this.firstChild=child,this.lastChild=child)},Node.prototype.walker=function(){return new NodeWalker(this)},Node}(),BlockNode=function(_super){function BlockNode(nodeType,sourcepos){var _this=_super.call(this,nodeType,sourcepos)||this;return _this.open=!0,_this.lineOffsets=null,_this.stringContent=null,_this.lastLineBlank=!1,_this.lastLineChecked=!1,_this.type=nodeType,_this}return esm_extends(BlockNode,_super),BlockNode}(esm_Node),ListNode=function(_super){function ListNode(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.listData=null,_this}return esm_extends(ListNode,_super),ListNode}(BlockNode),HeadingNode=function(_super){function HeadingNode(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.level=0,_this.headingType="atx",_this}return esm_extends(HeadingNode,_super),HeadingNode}(BlockNode),CodeBlockNode=function(_super){function CodeBlockNode(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.isFenced=!1,_this.fenceChar=null,_this.fenceLength=0,_this.fenceOffset=-1,_this.info=null,_this.infoPadding=0,_this}return esm_extends(CodeBlockNode,_super),CodeBlockNode}(BlockNode),TableNode=function(_super){function TableNode(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.columns=[],_this}return esm_extends(TableNode,_super),TableNode}(BlockNode),TableCellNode=function(_super){function TableCellNode(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.startIdx=0,_this.endIdx=0,_this.paddingLeft=0,_this.paddingRight=0,_this.ignored=!1,_this}return esm_extends(TableCellNode,_super),TableCellNode}(BlockNode),RefDefNode=function(_super){function RefDefNode(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.title="",_this.dest="",_this.label="",_this}return esm_extends(RefDefNode,_super),RefDefNode}(BlockNode),CustomBlockNode=function(_super){function CustomBlockNode(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.syntaxLength=0,_this.offset=-1,_this.info="",_this}return esm_extends(CustomBlockNode,_super),CustomBlockNode}(BlockNode),HtmlBlockNode=function(_super){function HtmlBlockNode(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.htmlBlockType=-1,_this}return esm_extends(HtmlBlockNode,_super),HtmlBlockNode}(BlockNode),LinkNode=function(_super){function LinkNode(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.destination=null,_this.title=null,_this.extendedAutolink=!1,_this}return esm_extends(LinkNode,_super),LinkNode}(esm_Node),CodeNode=function(_super){function CodeNode(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.tickCount=0,_this}return esm_extends(CodeNode,_super),CodeNode}(esm_Node),CustomInlineNode=function(_super){function CustomInlineNode(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.info="",_this}return esm_extends(CustomInlineNode,_super),CustomInlineNode}(esm_Node);function createNode(type,sourcepos){switch(type){case"heading":return new HeadingNode(type,sourcepos);case"list":case"item":return new ListNode(type,sourcepos);case"link":case"image":return new LinkNode(type,sourcepos);case"codeBlock":return new CodeBlockNode(type,sourcepos);case"htmlBlock":return new HtmlBlockNode(type,sourcepos);case"table":return new TableNode(type,sourcepos);case"tableCell":return new TableCellNode(type,sourcepos);case"document":case"paragraph":case"blockQuote":case"thematicBreak":case"tableRow":case"tableBody":case"tableHead":case"frontMatter":return new BlockNode(type,sourcepos);case"code":return new CodeNode(type,sourcepos);case"refDef":return new RefDefNode(type,sourcepos);case"customBlock":return new CustomBlockNode(type,sourcepos);case"customInline":return new CustomInlineNode(type,sourcepos);default:return new esm_Node(type,sourcepos)}}function isCodeBlock(node){return"codeBlock"===node.type}function isHtmlBlock(node){return"htmlBlock"===node.type}function isHeading(node){return"heading"===node.type}function isList(node){return"list"===node.type}function isTable(node){return"table"===node.type}function isRefDef(node){return"refDef"===node.type}function isCustomBlock(node){return"customBlock"===node.type}function isCustomInline(node){return"customInline"===node.type}function esm_text(s,sourcepos){var node=createNode("text",sourcepos);return node.literal=s,node}var TAGNAME="[A-Za-z][A-Za-z0-9-]*",ATTRIBUTENAME,UNQUOTEDVALUE,SINGLEQUOTEDVALUE="'[^']*'",DOUBLEQUOTEDVALUE='"[^"]*"',ATTRIBUTEVALUE,ATTRIBUTEVALUESPEC,esm_ATTRIBUTE,OPENTAG="<"+TAGNAME+("(?:\\s+"+"[a-zA-Z_:][a-zA-Z0-9:._-]*"+("(?:\\s*=\\s*"+("(?:"+"[^\"'=<>`\\x00-\\x20]+"+"|'[^']*'|\"[^\"]*\")")+")")+"?)")+"*\\s*/?>",CLOSETAG="</"+TAGNAME+"\\s*[>]",HTMLCOMMENT,PROCESSINGINSTRUCTION="[<][?].*?[?][>]",DECLARATION,CDATA,HTMLTAG,reHtmlTag=new RegExp("^"+("(?:"+OPENTAG+"|"+CLOSETAG+"|"+"\x3c!----\x3e|\x3c!--(?:-?[^>-])(?:-?[^-])*--\x3e"+"|[<][?].*?[?][>]|"+"<![A-Z]+\\s+[^>]*>"+"|"+"<!\\[CDATA\\[[\\s\\S]*?\\]\\]>"+")"),"i"),fromCodePoint;if(String.fromCodePoint)fromCodePoint=function(_){try{return String.fromCodePoint(_)}catch(e){if(e instanceof RangeError)return String.fromCharCode(65533);throw e}};else{var stringFromCharCode_1=String.fromCharCode,floor_1=Math.floor;fromCodePoint=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];var MAX_SIZE=16384,codeUnits=[],highSurrogate,lowSurrogate,index=-1,length=args.length;if(!length)return"";for(var result="";++index<length;){var codePoint=Number(args[index]);if(!isFinite(codePoint)||codePoint<0||codePoint>1114111||floor_1(codePoint)!==codePoint)return String.fromCharCode(65533);codePoint<=65535?codeUnits.push(codePoint):(highSurrogate=55296+((codePoint-=65536)>>10),lowSurrogate=codePoint%1024+56320,codeUnits.push(highSurrogate,lowSurrogate)),(index+1===length||codeUnits.length>MAX_SIZE)&&(result+=stringFromCharCode_1.apply(void 0,codeUnits),codeUnits.length=0)}return result}}var fromCodePoint$1=fromCodePoint,DOMAIN="(?:[w-]+.)*[A-Za-z0-9-]+.[A-Za-z0-9-]+",PATH="[^<\\s]*[^<?!.,:*_?~\\s]",EMAIL="[\\w.+-]+@(?:[\\w-]+\\.)+[\\w-]+";function trimUnmatchedTrailingParens(source){var trailingParen=/\)+$/.exec(source);if(trailingParen){for(var count=0,_i=0,source_1=source;_i<source_1.length;_i++){var ch=source_1[_i];"("===ch?count<0?count=1:count+=1:")"===ch&&(count-=1)}if(count<0){var trimCount=Math.min(-count,trailingParen[0].length);return source.substring(0,source.length-trimCount)}}return source}function trimTrailingEntity(source){return source.replace(/&[A-Za-z0-9]+;$/,"")}function parseEmailLink(source){for(var reEmailLink=new RegExp(EMAIL,"g"),result=[],m;m=reEmailLink.exec(source);){var text_1=m[0];/[_-]+$/.test(text_1)||result.push({text:text_1,range:[m.index,m.index+text_1.length-1],url:"mailto:"+text_1})}return result}function parseUrlLink(source){for(var reWwwAutolink=new RegExp("(www|https?://)."+DOMAIN+PATH,"g"),result=[],m;m=reWwwAutolink.exec(source);){var text_2=trimTrailingEntity(trimUnmatchedTrailingParens(m[0])),scheme="www"===m[1]?"http://":"";result.push({text:text_2,range:[m.index,m.index+text_2.length-1],url:""+scheme+text_2})}return result}function baseAutolinkParser(source){return esm_spreadArray(esm_spreadArray([],parseUrlLink(source)),parseEmailLink(source)).sort((function(a,b){return a.range[0]-b.range[0]}))}function convertExtAutoLinks(walker,autolinkParser){var event;"boolean"==typeof autolinkParser&&(autolinkParser=baseAutolinkParser);for(var _loop_1=function(){var entering=event.entering,node=event.node;if(entering&&"text"===node.type&&"link"!==node.parent.type){var literal=node.literal,linkInfos=autolinkParser(literal);if(!linkInfos||!linkInfos.length)return"continue";for(var lastIdx=0,_a=node.sourcepos[0],lineNum_1=_a[0],chPos_1=_a[1],sourcepos=function(startIdx,endIdx){return[[lineNum_1,chPos_1+startIdx],[lineNum_1,chPos_1+endIdx]]},newNodes=[],_i=0,linkInfos_1=linkInfos;_i<linkInfos_1.length;_i++){var _b=linkInfos_1[_i],range=_b.range,url=_b.url,linkText=_b.text;range[0]>lastIdx&&newNodes.push(esm_text(literal.substring(lastIdx,range[0]),sourcepos(lastIdx,range[0]-1)));var linkNode=createNode("link",sourcepos.apply(void 0,range));linkNode.appendChild(esm_text(linkText,sourcepos.apply(void 0,range))),linkNode.destination=url,linkNode.extendedAutolink=!0,newNodes.push(linkNode),lastIdx=range[1]+1}lastIdx<literal.length&&newNodes.push(esm_text(literal.substring(lastIdx),sourcepos(lastIdx,literal.length-1)));for(var _c=0,newNodes_1=newNodes;_c<newNodes_1.length;_c++){var newNode=newNodes_1[_c];node.insertBefore(newNode)}node.unlink()}};event=walker.next();)_loop_1()}function esm_last(arr){return arr[arr.length-1]}function normalizeReference(str){return str.slice(1,str.length-1).trim().replace(/[ \t\r\n]+/," ").toLowerCase().toUpperCase()}function iterateObject(obj,iteratee){Object.keys(obj).forEach((function(key){iteratee(key,obj[key])}))}function omit(obj){for(var propNames=[],_i=1;_i<arguments.length;_i++)propNames[_i-1]=arguments[_i];var resultMap=esm_assign({},obj);return propNames.forEach((function(key){delete resultMap[key]})),resultMap}function isEmptyObj(obj){return!Object.keys(obj).length}function clearObj(obj){Object.keys(obj).forEach((function(key){delete obj[key]}))}var C_NEWLINE=10,C_ASTERISK=42,C_UNDERSCORE=95,C_BACKTICK=96,C_OPEN_BRACKET$1=91,C_CLOSE_BRACKET=93,C_TILDE=126,C_LESSTHAN$1=60,C_BANG=33,C_BACKSLASH=92,C_AMPERSAND=38,C_OPEN_PAREN=40,C_CLOSE_PAREN=41,C_COLON=58,C_SINGLEQUOTE=39,C_DOUBLEQUOTE=34,C_DOLLAR=36,ESCAPED_CHAR="\\\\"+ESCAPABLE,rePunctuation=new RegExp(/[!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u0AF0\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166D\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E42\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC9\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDF3C-\uDF3E]|\uD809[\uDC70-\uDC74]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD82F\uDC9F|\uD836[\uDE87-\uDE8B]/),reLinkTitle=new RegExp('^(?:"('+ESCAPED_CHAR+'|[^"\\x00])*"|\'('+ESCAPED_CHAR+"|[^'\\x00])*'|\\(("+ESCAPED_CHAR+"|[^()\\x00])*\\))"),reLinkDestinationBraces=/^(?:<(?:[^<>\n\\\x00]|\\.)*>)/,reEscapable=new RegExp("^"+ESCAPABLE),reEntityHere=new RegExp("^"+ENTITY,"i"),reTicks=/`+/,reTicksHere=/^`+/,reEllipses=/\.\.\./g,reDash=/--+/g,reEmailAutolink=/^<([a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*)>/,reAutolink=/^<[A-Za-z][A-Za-z0-9.+-]{1,31}:[^<>\x00-\x20]*>/i,reSpnl=/^ *(?:\n *)?/,reWhitespaceChar=/^[ \t\n\x0b\x0c\x0d]/,reUnicodeWhitespaceChar=/^\s/,reFinalSpace=/ *$/,reInitialSpace=/^ */,reSpaceAtEndOfLine=/^ *(?:\n|$)/,reLinkLabel=/^\[(?:[^\\\[\]]|\\.){0,1000}\]/,reMain=/^[^\n`\[\]\\!<&*_'"~$]+/m,InlineParser=function(){function InlineParser(options){this.subject="",this.delimiters=null,this.brackets=null,this.pos=0,this.lineStartNum=0,this.lineIdx=0,this.lineOffsets=[0],this.linePosOffset=0,this.refMap={},this.refLinkCandidateMap={},this.refDefCandidateMap={},this.options=options}return InlineParser.prototype.sourcepos=function(start,end){var linePosOffset=this.linePosOffset+this.lineOffsets[this.lineIdx],lineNum=this.lineStartNum+this.lineIdx,startpos=[lineNum,start+linePosOffset];return"number"==typeof end?[startpos,[lineNum,end+linePosOffset]]:startpos},InlineParser.prototype.nextLine=function(){this.lineIdx+=1,this.linePosOffset=-this.pos},InlineParser.prototype.match=function(re){var m=re.exec(this.subject.slice(this.pos));return null===m?null:(this.pos+=m.index+m[0].length,m[0])},InlineParser.prototype.peek=function(){return this.pos<this.subject.length?this.subject.charCodeAt(this.pos):-1},InlineParser.prototype.spnl=function(){return this.match(reSpnl),!0},InlineParser.prototype.parseBackticks=function(block){var startpos=this.pos+1,ticks=this.match(reTicksHere);if(null===ticks)return!1;for(var afterOpenTicks=this.pos,matched;null!==(matched=this.match(reTicks));)if(matched===ticks){var contents=this.subject.slice(afterOpenTicks,this.pos-ticks.length),sourcepos=this.sourcepos(startpos,this.pos),lines=contents.split("\n");if(lines.length>1){var lastLine=esm_last(lines);this.lineIdx+=lines.length-1,this.linePosOffset=-(this.pos-lastLine.length-ticks.length),sourcepos[1]=this.sourcepos(this.pos),contents=lines.join(" ")}var node=createNode("code",sourcepos);return contents.length>0&&null!==contents.match(/[^ ]/)&&" "==contents[0]&&" "==contents[contents.length-1]?node.literal=contents.slice(1,contents.length-1):node.literal=contents,node.tickCount=ticks.length,block.appendChild(node),!0}return this.pos=afterOpenTicks,block.appendChild(esm_text(ticks,this.sourcepos(startpos,this.pos-1))),!0},InlineParser.prototype.parseBackslash=function(block){var subj=this.subject,node;this.pos+=1;var startpos=this.pos;return 10===this.peek()?(this.pos+=1,node=createNode("linebreak",this.sourcepos(this.pos-1,this.pos)),block.appendChild(node),this.nextLine()):reEscapable.test(subj.charAt(this.pos))?(block.appendChild(esm_text(subj.charAt(this.pos),this.sourcepos(startpos,this.pos))),this.pos+=1):block.appendChild(esm_text("\\",this.sourcepos(startpos,startpos))),!0},InlineParser.prototype.parseAutolink=function(block){var m,dest,node,startpos=this.pos+1;return(m=this.match(reEmailAutolink))?(dest=m.slice(1,m.length-1),(node=createNode("link",this.sourcepos(startpos,this.pos))).destination=normalizeURI("mailto:"+dest),node.title="",node.appendChild(esm_text(dest,this.sourcepos(startpos+1,this.pos-1))),block.appendChild(node),!0):!!(m=this.match(reAutolink))&&(dest=m.slice(1,m.length-1),(node=createNode("link",this.sourcepos(startpos,this.pos))).destination=normalizeURI(dest),node.title="",node.appendChild(esm_text(dest,this.sourcepos(startpos+1,this.pos-1))),block.appendChild(node),!0)},InlineParser.prototype.parseHtmlTag=function(block){var startpos=this.pos+1,m=this.match(reHtmlTag);if(null===m)return!1;var node=createNode("htmlInline",this.sourcepos(startpos,this.pos));return node.literal=m,block.appendChild(node),!0},InlineParser.prototype.scanDelims=function(cc){var numdelims=0,startpos=this.pos;if(39===cc||34===cc)numdelims++,this.pos++;else for(;this.peek()===cc;)numdelims++,this.pos++;if(0===numdelims||numdelims<2&&(126===cc||36===cc))return this.pos=startpos,null;var charBefore=0===startpos?"\n":this.subject.charAt(startpos-1),ccAfter=this.peek(),charAfter;charAfter=-1===ccAfter?"\n":fromCodePoint$1(ccAfter);var afterIsWhitespace=reUnicodeWhitespaceChar.test(charAfter),afterIsPunctuation=rePunctuation.test(charAfter),beforeIsWhitespace=reUnicodeWhitespaceChar.test(charBefore),beforeIsPunctuation=rePunctuation.test(charBefore),leftFlanking=!afterIsWhitespace&&(!afterIsPunctuation||beforeIsWhitespace||beforeIsPunctuation),rightFlanking=!beforeIsWhitespace&&(!beforeIsPunctuation||afterIsWhitespace||afterIsPunctuation),canOpen,canClose;return 95===cc?(canOpen=leftFlanking&&(!rightFlanking||beforeIsPunctuation),canClose=rightFlanking&&(!leftFlanking||afterIsPunctuation)):39===cc||34===cc?(canOpen=leftFlanking&&!rightFlanking,canClose=rightFlanking):36===cc?(canOpen=!afterIsWhitespace,canClose=!beforeIsWhitespace):(canOpen=leftFlanking,canClose=rightFlanking),this.pos=startpos,{numdelims:numdelims,canOpen:canOpen,canClose:canClose}},InlineParser.prototype.handleDelim=function(cc,block){var res=this.scanDelims(cc);if(!res)return!1;var numdelims=res.numdelims,startpos=this.pos+1,contents;this.pos+=numdelims;var node=esm_text(contents=39===cc?"’":34===cc?"“":this.subject.slice(startpos-1,this.pos),this.sourcepos(startpos,this.pos));return block.appendChild(node),(res.canOpen||res.canClose)&&(this.options.smart||39!==cc&&34!==cc)&&(this.delimiters={cc:cc,numdelims:numdelims,origdelims:numdelims,node:node,previous:this.delimiters,next:null,canOpen:res.canOpen,canClose:res.canClose},this.delimiters.previous&&(this.delimiters.previous.next=this.delimiters)),!0},InlineParser.prototype.removeDelimiter=function(delim){null!==delim.previous&&(delim.previous.next=delim.next),null===delim.next?this.delimiters=delim.previous:delim.next.previous=delim.previous},InlineParser.prototype.removeDelimitersBetween=function(bottom,top){bottom.next!==top&&(bottom.next=top,top.previous=bottom)},InlineParser.prototype.processEmphasis=function(stackBottom){var _a,opener,closer,oldCloser,openerInl,closerInl,openerFound,oddMatch=!1,openersBottom=((_a={})[95]=[stackBottom,stackBottom,stackBottom],_a[42]=[stackBottom,stackBottom,stackBottom],_a[39]=[stackBottom],_a[34]=[stackBottom],_a[126]=[stackBottom],_a[36]=[stackBottom],_a);for(closer=this.delimiters;null!==closer&&closer.previous!==stackBottom;)closer=closer.previous;for(;null!==closer;){var closercc=closer.cc,closerEmph=95===closercc||42===closercc;if(closer.canClose){for(opener=closer.previous,openerFound=!1;null!==opener&&opener!==stackBottom&&opener!==openersBottom[closercc][closerEmph?closer.origdelims%3:0];){if(oddMatch=closerEmph&&(closer.canOpen||opener.canClose)&&closer.origdelims%3!=0&&(opener.origdelims+closer.origdelims)%3==0,opener.cc===closer.cc&&opener.canOpen&&!oddMatch){openerFound=!0;break}opener=opener.previous}if(oldCloser=closer,closerEmph||126===closercc||36===closercc)if(openerFound){if(opener){var useDelims=closer.numdelims>=2&&opener.numdelims>=2?2:1,emptyDelims=closerEmph?0:1;openerInl=opener.node,closerInl=closer.node;var nodeType=closerEmph?1===useDelims?"emph":"strong":"strike";36===closercc&&(nodeType="customInline");var newNode=createNode(nodeType),openerEndPos=openerInl.sourcepos[1],closerStartPos=closerInl.sourcepos[0];newNode.sourcepos=[[openerEndPos[0],openerEndPos[1]-useDelims+1],[closerStartPos[0],closerStartPos[1]+useDelims-1]],openerInl.sourcepos[1][1]-=useDelims,closerInl.sourcepos[0][1]+=useDelims,openerInl.literal=openerInl.literal.slice(useDelims),closerInl.literal=closerInl.literal.slice(useDelims),opener.numdelims-=useDelims,closer.numdelims-=useDelims;for(var tmp=openerInl.next,next=void 0;tmp&&tmp!==closerInl;)next=tmp.next,tmp.unlink(),newNode.appendChild(tmp),tmp=next;if(36===closercc){var textNode=newNode.firstChild,literal=textNode.literal||"",info=literal.split(/\s/)[0];newNode.info=info,literal.length===info.length+1?textNode.unlink():(textNode.sourcepos[0][1]+=info.length,textNode.literal=literal.replace(info+" ",""))}if(openerInl.insertAfter(newNode),this.removeDelimitersBetween(opener,closer),opener.numdelims<=emptyDelims&&(0===opener.numdelims&&openerInl.unlink(),this.removeDelimiter(opener)),closer.numdelims<=emptyDelims){0===closer.numdelims&&closerInl.unlink();var tempstack=closer.next;this.removeDelimiter(closer),closer=tempstack}}}else closer=closer.next;else 39===closercc?(closer.node.literal="’",openerFound&&(opener.node.literal="‘"),closer=closer.next):34===closercc&&(closer.node.literal="”",openerFound&&(opener.node.literal="“"),closer=closer.next);openerFound||(openersBottom[closercc][closerEmph?oldCloser.origdelims%3:0]=oldCloser.previous,oldCloser.canOpen||this.removeDelimiter(oldCloser))}else closer=closer.next}for(;null!==this.delimiters&&this.delimiters!==stackBottom;)this.removeDelimiter(this.delimiters)},InlineParser.prototype.parseLinkTitle=function(){var title=this.match(reLinkTitle);return null===title?null:unescapeString(title.substr(1,title.length-2))},InlineParser.prototype.parseLinkDestination=function(){var res=this.match(reLinkDestinationBraces);if(null===res){if(60===this.peek())return null;for(var savepos=this.pos,openparens=0,c=void 0;-1!==(c=this.peek());)if(92===c&&reEscapable.test(this.subject.charAt(this.pos+1)))this.pos+=1,-1!==this.peek()&&(this.pos+=1);else if(40===c)this.pos+=1,openparens+=1;else if(41===c){if(openparens<1)break;this.pos+=1,openparens-=1}else{if(null!==reWhitespaceChar.exec(fromCodePoint$1(c)))break;this.pos+=1}return this.pos===savepos&&41!==c?null:0!==openparens?null:normalizeURI(unescapeString(res=this.subject.substr(savepos,this.pos-savepos)))}return normalizeURI(unescapeString(res.substr(1,res.length-2)))},InlineParser.prototype.parseLinkLabel=function(){var m=this.match(reLinkLabel);return null===m||m.length>1001?0:m.length},InlineParser.prototype.parseOpenBracket=function(block){var startpos=this.pos;this.pos+=1;var node=esm_text("[",this.sourcepos(this.pos,this.pos));return block.appendChild(node),this.addBracket(node,startpos,!1),!0},InlineParser.prototype.parseBang=function(block){var startpos=this.pos;if(this.pos+=1,91===this.peek()){this.pos+=1;var node=esm_text("![",this.sourcepos(this.pos-1,this.pos));block.appendChild(node),this.addBracket(node,startpos+1,!0)}else{var node=esm_text("!",this.sourcepos(this.pos,this.pos));block.appendChild(node)}return!0},InlineParser.prototype.parseCloseBracket=function(block){var dest=null,title=null,matched=!1;this.pos+=1;var startpos=this.pos,opener=this.brackets;if(null===opener)return block.appendChild(esm_text("]",this.sourcepos(startpos,startpos))),!0;if(!opener.active)return block.appendChild(esm_text("]",this.sourcepos(startpos,startpos))),this.removeBracket(),!0;var isImage=opener.image,savepos=this.pos;40===this.peek()&&(this.pos++,this.spnl()&&null!==(dest=this.parseLinkDestination())&&this.spnl()&&(reWhitespaceChar.test(this.subject.charAt(this.pos-1))&&(title=this.parseLinkTitle()),1)&&this.spnl()&&41===this.peek()?(this.pos+=1,matched=!0):this.pos=savepos);var refLabel="";if(!matched){var beforelabel=this.pos,n=this.parseLinkLabel();if(n>2?refLabel=this.subject.slice(beforelabel,beforelabel+n):opener.bracketAfter||(refLabel=this.subject.slice(opener.index,startpos)),0===n&&(this.pos=savepos),refLabel){refLabel=normalizeReference(refLabel);var link=this.refMap[refLabel];link&&(dest=link.destination,title=link.title,matched=!0)}}if(matched){var node=createNode(isImage?"image":"link");node.destination=dest,node.title=title||"",node.sourcepos=[opener.startpos,this.sourcepos(this.pos)];for(var tmp=opener.node.next,next=void 0;tmp;)next=tmp.next,tmp.unlink(),node.appendChild(tmp),tmp=next;if(block.appendChild(node),this.processEmphasis(opener.previousDelimiter),this.removeBracket(),opener.node.unlink(),!isImage)for(opener=this.brackets;null!==opener;)opener.image||(opener.active=!1),opener=opener.previous;return this.options.referenceDefinition&&(this.refLinkCandidateMap[block.id]={node:block,refLabel:refLabel}),!0}return this.removeBracket(),this.pos=startpos,block.appendChild(esm_text("]",this.sourcepos(startpos,startpos))),this.options.referenceDefinition&&(this.refLinkCandidateMap[block.id]={node:block,refLabel:refLabel}),!0},InlineParser.prototype.addBracket=function(node,index,image){null!==this.brackets&&(this.brackets.bracketAfter=!0),this.brackets={node:node,startpos:this.sourcepos(index+(image?0:1)),previous:this.brackets,previousDelimiter:this.delimiters,index:index,image:image,active:!0}},InlineParser.prototype.removeBracket=function(){this.brackets&&(this.brackets=this.brackets.previous)},InlineParser.prototype.parseEntity=function(block){var m,startpos=this.pos+1;return!!(m=this.match(reEntityHere))&&(block.appendChild(esm_text(lib.decodeHTML(m),this.sourcepos(startpos,this.pos))),!0)},InlineParser.prototype.parseString=function(block){var m,startpos=this.pos+1;if(m=this.match(reMain)){if(this.options.smart){var lit=m.replace(reEllipses,"…").replace(reDash,(function(chars){var enCount=0,emCount=0;return chars.length%3==0?emCount=chars.length/3:chars.length%2==0?enCount=chars.length/2:chars.length%3==2?(enCount=1,emCount=(chars.length-2)/3):(enCount=2,emCount=(chars.length-4)/3),esm_repeat("—",emCount)+esm_repeat("–",enCount)}));block.appendChild(esm_text(lit,this.sourcepos(startpos,this.pos)))}else{var node=esm_text(m,this.sourcepos(startpos,this.pos));block.appendChild(node)}return!0}return!1},InlineParser.prototype.parseNewline=function(block){this.pos+=1;var lastc=block.lastChild;if(lastc&&"text"===lastc.type&&" "===lastc.literal[lastc.literal.length-1]){var hardbreak=" "===lastc.literal[lastc.literal.length-2],litLen=lastc.literal.length;lastc.literal=lastc.literal.replace(reFinalSpace,"");var finalSpaceLen=litLen-lastc.literal.length;lastc.sourcepos[1][1]-=finalSpaceLen,block.appendChild(createNode(hardbreak?"linebreak":"softbreak",this.sourcepos(this.pos-finalSpaceLen,this.pos)))}else block.appendChild(createNode("softbreak",this.sourcepos(this.pos,this.pos)));return this.nextLine(),this.match(reInitialSpace),!0},InlineParser.prototype.parseReference=function(block,refMap){if(!this.options.referenceDefinition)return 0;this.subject=block.stringContent,this.pos=0;var title=null,startpos=this.pos,matchChars=this.parseLinkLabel();if(0===matchChars)return 0;var rawlabel=this.subject.substr(0,matchChars);if(58!==this.peek())return this.pos=startpos,0;this.pos++,this.spnl();var dest=this.parseLinkDestination();if(null===dest)return this.pos=startpos,0;var beforetitle=this.pos;this.spnl(),this.pos!==beforetitle&&(title=this.parseLinkTitle()),null===title&&(title="",this.pos=beforetitle);var atLineEnd=!0;if(null===this.match(reSpaceAtEndOfLine)&&(""===title?atLineEnd=!1:(title="",this.pos=beforetitle,atLineEnd=null!==this.match(reSpaceAtEndOfLine))),!atLineEnd)return this.pos=startpos,0;var normalLabel=normalizeReference(rawlabel);if(""===normalLabel)return this.pos=startpos,0;var sourcepos=this.getReferenceDefSourcepos(block);block.sourcepos[0][0]=sourcepos[1][0]+1;var node=createNode("refDef",sourcepos);return node.title=title,node.dest=dest,node.label=normalLabel,block.insertBefore(node),refMap[normalLabel]?this.refDefCandidateMap[node.id]=node:refMap[normalLabel]=createRefDefState(node),this.pos-startpos},InlineParser.prototype.mergeTextNodes=function(walker){for(var event,textNodes=[];event=walker.next();){var entering=event.entering,node=event.node;if(entering&&"text"===node.type)textNodes.push(node);else if(1===textNodes.length)textNodes=[];else if(textNodes.length>1){var firstNode=textNodes[0],lastNode=textNodes[textNodes.length-1];firstNode.sourcepos&&lastNode.sourcepos&&(firstNode.sourcepos[1]=lastNode.sourcepos[1]),firstNode.next=lastNode.next,firstNode.next&&(firstNode.next.prev=firstNode);for(var i=1;i<textNodes.length;i+=1)firstNode.literal+=textNodes[i].literal,textNodes[i].unlink();textNodes=[]}}},InlineParser.prototype.getReferenceDefSourcepos=function(block){for(var lines=block.stringContent.split(/\n|\r\n/),passedUrlLine=!1,quotationCount=0,lastLineOffset={line:0,ch:0},i=0;i<lines.length;i+=1){var line=lines[i];if(reWhitespaceChar.test(line))break;if(/\:/.test(line)&&0===quotationCount){if(passedUrlLine)break;var lineOffset=line.indexOf(":")===line.length-1?i+1:i;lastLineOffset={line:lineOffset,ch:lines[lineOffset].length},passedUrlLine=!0}var matched=line.match(/'|"/g);if(matched&&(quotationCount+=matched.length),2===quotationCount){lastLineOffset={line:i,ch:line.length};break}}return[[block.sourcepos[0][0],block.sourcepos[0][1]],[block.sourcepos[0][0]+lastLineOffset.line,lastLineOffset.ch]]},InlineParser.prototype.parseInline=function(block){var _a,res=!1,c=this.peek();if(-1===c)return!1;switch(c){case 10:res=this.parseNewline(block);break;case 92:res=this.parseBackslash(block);break;case 96:res=this.parseBackticks(block);break;case 42:case 95:case 126:case 36:res=this.handleDelim(c,block);break;case 39:case 34:res=!!(null===(_a=this.options)||void 0===_a?void 0:_a.smart)&&this.handleDelim(c,block);break;case 91:res=this.parseOpenBracket(block);break;case 33:res=this.parseBang(block);break;case 93:res=this.parseCloseBracket(block);break;case 60:res=this.parseAutolink(block)||this.parseHtmlTag(block);break;case 38:res=this.parseEntity(block);break;default:res=this.parseString(block)}return res||(this.pos+=1,block.appendChild(esm_text(fromCodePoint$1(c),this.sourcepos(this.pos,this.pos+1)))),!0},InlineParser.prototype.parse=function(block){for(this.subject=block.stringContent.trim(),this.pos=0,this.delimiters=null,this.brackets=null,this.lineOffsets=block.lineOffsets||[0],this.lineIdx=0,this.linePosOffset=0,this.lineStartNum=block.sourcepos[0][0],isHeading(block)&&(this.lineOffsets[0]+=block.level+1);this.parseInline(block););block.stringContent=null,this.processEmphasis(null),this.mergeTextNodes(block.walker());var _a=this.options,extendedAutolinks=_a.extendedAutolinks,customParser=_a.customParser;if(extendedAutolinks&&convertExtAutoLinks(block.walker(),extendedAutolinks),customParser&&block.firstChild)for(var event_1,walker=block.firstChild.walker();event_1=walker.next();){var node=event_1.node,entering=event_1.entering;customParser[node.type]&&customParser[node.type](node,{entering:entering,options:this.options})}},InlineParser}(),reTaskListItemMarker=/^\[([ \txX])\][ \t]+/;function taskListItemFinalize(_,block){if(block.firstChild&&"paragraph"===block.firstChild.type){var p=block.firstChild,m=p.stringContent.match(reTaskListItemMarker);if(m){var mLen=m[0].length;p.stringContent=p.stringContent.substring(mLen-1),p.sourcepos[0][1]+=mLen,p.lineOffsets[0]+=mLen,block.listData.task=!0,block.listData.checked=/[xX]/.test(m[1])}}}var table,tableBody$1,tableHead$1,tableDelimRow,tableDelimCell,tableRow,tableCell,CODE_INDENT=4,C_TAB=9,C_GREATERTHAN=62,C_LESSTHAN=60,C_SPACE=32,C_OPEN_BRACKET=91,reNonSpace=/[^ \t\f\v\r\n]/,reClosingCodeFence=/^(?:`{3,}|~{3,})(?= *$)/;function endsWithBlankLine(block){for(var curBlock=block;curBlock;){if(curBlock.lastLineBlank)return!0;var t=curBlock.type;if(curBlock.lastLineChecked||"list"!==t&&"item"!==t){curBlock.lastLineChecked=!0;break}curBlock.lastLineChecked=!0,curBlock=curBlock.lastChild}return!1}function peek(ln,pos){return pos<ln.length?ln.charCodeAt(pos):-1}function isBlank(s){return!reNonSpace.test(s)}function isSpaceOrTab(c){return 32===c||9===c}var reClosingCustomBlock=/^\$\$$/,customBlock$1,noop={continue:function(){return 1},finalize:function(){},canContain:function(){return!1},acceptsLines:!0},document$1,list,blockQuote$1,esm_item,esm_heading,thematicBreak$1,esm_codeBlock,htmlBlock$1,paragraph,refDef,frontMatter$2,blockHandlers={document:{continue:function(){return 0},finalize:function(){},canContain:function(t){return"item"!==t},acceptsLines:!1},list:{continue:function(){return 0},finalize:function(_,block){for(var item=block.firstChild;item;){if(endsWithBlankLine(item)&&item.next){block.listData.tight=!1;break}for(var subitem=item.firstChild;subitem;){if(endsWithBlankLine(subitem)&&(item.next||subitem.next)){block.listData.tight=!1;break}subitem=subitem.next}item=item.next}},canContain:function(t){return"item"===t},acceptsLines:!1},blockQuote:{continue:function(parser){var ln=parser.currentLine;return parser.indented||62!==peek(ln,parser.nextNonspace)?1:(parser.advanceNextNonspace(),parser.advanceOffset(1,!1),isSpaceOrTab(peek(ln,parser.offset))&&parser.advanceOffset(1,!0),0)},finalize:function(){},canContain:function(t){return"item"!==t},acceptsLines:!1},item:{continue:function(parser,container){if(parser.blank){if(null===container.firstChild)return 1;parser.advanceNextNonspace()}else{if(!(parser.indent>=container.listData.markerOffset+container.listData.padding))return 1;parser.advanceOffset(container.listData.markerOffset+container.listData.padding,!0)}return 0},finalize:taskListItemFinalize,canContain:function(t){return"item"!==t},acceptsLines:!1},heading:{continue:function(){return 1},finalize:function(){},canContain:function(){return!1},acceptsLines:!1},thematicBreak:{continue:function(){return 1},finalize:function(){},canContain:function(){return!1},acceptsLines:!1},codeBlock:{continue:function(parser,container){var ln=parser.currentLine,indent=parser.indent;if(container.isFenced){var match=indent<=3&&ln.charAt(parser.nextNonspace)===container.fenceChar&&ln.slice(parser.nextNonspace).match(reClosingCodeFence);if(match&&match[0].length>=container.fenceLength)return parser.lastLineLength=parser.offset+indent+match[0].length,parser.finalize(container,parser.lineNumber),2;for(var i=container.fenceOffset;i>0&&isSpaceOrTab(peek(ln,parser.offset));)parser.advanceOffset(1,!0),i--}else if(indent>=4)parser.advanceOffset(4,!0);else{if(!parser.blank)return 1;parser.advanceNextNonspace()}return 0},finalize:function(_,block){var _a;if(null!==block.stringContent){if(block.isFenced){var content=block.stringContent,newlinePos=content.indexOf("\n"),firstLine=content.slice(0,newlinePos),rest=content.slice(newlinePos+1),infoString=firstLine.match(/^(\s*)(.*)/);block.infoPadding=infoString[1].length,block.info=unescapeString(infoString[2].trim()),block.literal=rest}else block.literal=null===(_a=block.stringContent)||void 0===_a?void 0:_a.replace(/(\n *)+$/,"\n");block.stringContent=null}},canContain:function(){return!1},acceptsLines:!0},htmlBlock:{continue:function(parser,container){return!parser.blank||6!==container.htmlBlockType&&7!==container.htmlBlockType?0:1},finalize:function(_,block){var _a;block.literal=(null===(_a=block.stringContent)||void 0===_a?void 0:_a.replace(/(\n *)+$/,""))||null,block.stringContent=null},canContain:function(){return!1},acceptsLines:!0},paragraph:{continue:function(parser){return parser.blank?1:0},finalize:function(parser,block){if(null!==block.stringContent){for(var pos,hasReferenceDefs=!1;91===peek(block.stringContent,0)&&(pos=parser.inlineParser.parseReference(block,parser.refMap));)block.stringContent=block.stringContent.slice(pos),hasReferenceDefs=!0;hasReferenceDefs&&isBlank(block.stringContent)&&block.unlink()}},canContain:function(){return!1},acceptsLines:!0},table:{continue:function(){return 0},finalize:function(){},canContain:function(t){return"tableHead"===t||"tableBody"===t},acceptsLines:!1},tableBody:{continue:function(){return 0},finalize:function(){},canContain:function(t){return"tableRow"===t},acceptsLines:!1},tableHead:{continue:function(){return 1},finalize:function(){},canContain:function(t){return"tableRow"===t||"tableDelimRow"===t},acceptsLines:!1},tableRow:{continue:function(){return 1},finalize:function(){},canContain:function(t){return"tableCell"===t},acceptsLines:!1},tableCell:{continue:function(){return 1},finalize:function(){},canContain:function(){return!1},acceptsLines:!1},tableDelimRow:{continue:function(){return 1},finalize:function(){},canContain:function(t){return"tableDelimCell"===t},acceptsLines:!1},tableDelimCell:{continue:function(){return 1},finalize:function(){},canContain:function(){return!1},acceptsLines:!1},refDef:noop,customBlock:{continue:function(parser,container){var line=parser.currentLine,match=line.match(reClosingCustomBlock);if(match)return parser.lastLineLength=match[0].length,parser.finalize(container,parser.lineNumber),2;for(var i=container.offset;i>0&&isSpaceOrTab(peek(line,parser.offset));)parser.advanceOffset(1,!0),i--;return 0},finalize:function(_,block){if(null!==block.stringContent){var content=block.stringContent,newlinePos=content.indexOf("\n"),firstLine=content.slice(0,newlinePos),rest=content.slice(newlinePos+1),infoString=firstLine.match(/^(\s*)(.*)/);block.info=unescapeString(infoString[2].trim()),block.literal=rest,block.stringContent=null}},canContain:function(){return!1},acceptsLines:!0},frontMatter:noop};function parseRowContent(content){for(var startIdx=0,offset=0,cells=[],i=0,cell;i<content.length;i+=1)if("|"===content[i]&&"\\"!==content[i-1]){var cell=content.substring(startIdx,i);0===startIdx&&isEmpty(cell)?offset=i+1:cells.push(cell),startIdx=i+1}startIdx<content.length&&(isEmpty(cell=content.substring(startIdx,content.length))||cells.push(cell));return[offset,cells]}function generateTableCells(cellType,contents,lineNum,chPos){for(var cells=[],_i=0,contents_1=contents;_i<contents_1.length;_i++){var content=contents_1[_i],preSpaces=content.match(/^[ \t]+/),paddingLeft=preSpaces?preSpaces[0].length:0,paddingRight=void 0,trimmed=void 0;if(paddingLeft===content.length)paddingLeft=0,paddingRight=0,trimmed="";else{var postSpaces=content.match(/[ \t]+$/);paddingRight=postSpaces?postSpaces[0].length:0,trimmed=content.slice(paddingLeft,content.length-paddingRight)}var chPosStart=chPos+paddingLeft,tableCell=createNode(cellType,[[lineNum,chPos],[lineNum,chPos+content.length-1]]);tableCell.stringContent=trimmed.replace(/\\\|/g,"|"),tableCell.startIdx=cells.length,tableCell.endIdx=cells.length,tableCell.lineOffsets=[chPosStart-1],tableCell.paddingLeft=paddingLeft,tableCell.paddingRight=paddingRight,cells.push(tableCell),chPos+=content.length+1}return cells}function getColumnFromDelimCell(cellNode){var align=null,content=cellNode.stringContent,firstCh=content[0],lastCh;return":"===content[content.length-1]?align=":"===firstCh?"center":"right":":"===firstCh&&(align="left"),{align:align}}var tableHead=function(parser,container){var stringContent=container.stringContent;if("paragraph"===container.type&&!parser.indented&&!parser.blank){var lastNewLineIdx=stringContent.length-1,lastLineStartIdx=stringContent.lastIndexOf("\n",lastNewLineIdx-1)+1,headerContent=stringContent.slice(lastLineStartIdx,lastNewLineIdx),delimContent=parser.currentLine.slice(parser.nextNonspace),_a=parseRowContent(headerContent),headerOffset=_a[0],headerCells=_a[1],_b=parseRowContent(delimContent),delimOffset=_b[0],delimCells=_b[1],reValidDelimCell_1=/^[ \t]*:?-+:?[ \t]*$/;if(!headerCells.length||!delimCells.length||delimCells.some((function(cell){return!reValidDelimCell_1.test(cell)}))||1===delimCells.length&&0!==delimContent.indexOf("|"))return 0;var lineOffsets=container.lineOffsets,firstLineNum=parser.lineNumber-1,firstLineStart=esm_last(lineOffsets)+1,table=createNode("table",[[firstLineNum,firstLineStart],[parser.lineNumber,parser.offset]]);if(table.columns=delimCells.map((function(){return{align:null}})),container.insertAfter(table),1===lineOffsets.length)container.unlink();else{container.stringContent=stringContent.slice(0,lastLineStartIdx);var paraLastLineStartIdx,paraLastLineLen=lastLineStartIdx-(stringContent.lastIndexOf("\n",lastLineStartIdx-2)+1)-1;parser.lastLineLength=lineOffsets[lineOffsets.length-2]+paraLastLineLen,parser.finalize(container,firstLineNum-1)}parser.advanceOffset(parser.currentLine.length-parser.offset,!1);var tableHead_1=createNode("tableHead",[[firstLineNum,firstLineStart],[parser.lineNumber,parser.offset]]);table.appendChild(tableHead_1);var tableHeadRow_1=createNode("tableRow",[[firstLineNum,firstLineStart],[firstLineNum,firstLineStart+headerContent.length-1]]),tableDelimRow_1=createNode("tableDelimRow",[[parser.lineNumber,parser.nextNonspace+1],[parser.lineNumber,parser.offset]]);tableHead_1.appendChild(tableHeadRow_1),tableHead_1.appendChild(tableDelimRow_1),generateTableCells("tableCell",headerCells,firstLineNum,firstLineStart+headerOffset).forEach((function(cellNode){tableHeadRow_1.appendChild(cellNode)}));var delimCellNodes=generateTableCells("tableDelimCell",delimCells,parser.lineNumber,parser.nextNonspace+1+delimOffset);return delimCellNodes.forEach((function(cellNode){tableDelimRow_1.appendChild(cellNode)})),table.columns=delimCellNodes.map(getColumnFromDelimCell),parser.tip=table,2}return 0},tableBody=function(parser,container){if("table"!==container.type&&"tableBody"!==container.type||!parser.blank&&-1===parser.currentLine.indexOf("|"))return 0;if(parser.advanceOffset(parser.currentLine.length-parser.offset,!1),parser.blank){var table_1=container;return"tableBody"===container.type&&(table_1=container.parent,parser.finalize(container,parser.lineNumber-1)),parser.finalize(table_1,parser.lineNumber-1),0}var tableBody=container;"table"===container.type&&((tableBody=parser.addChild("tableBody",parser.nextNonspace)).stringContent=null);var tableRow=createNode("tableRow",[[parser.lineNumber,parser.nextNonspace+1],[parser.lineNumber,parser.currentLine.length]]);tableBody.appendChild(tableRow);var table=tableBody.parent,content,_a=parseRowContent(parser.currentLine.slice(parser.nextNonspace)),offset=_a[0],cellContents;return generateTableCells("tableCell",_a[1],parser.lineNumber,parser.nextNonspace+1+offset).forEach((function(cellNode,idx){idx>=table.columns.length&&(cellNode.ignored=!0),tableRow.appendChild(cellNode)})),2},reCustomBlock=/^(\$\$)(\s*[a-zA-Z])+/,reCanBeCustomInline=/^(\$\$)(\s*[a-zA-Z])+.*(\$\$)/,esm_customBlock=function(parser){var match;if(!parser.indented&&!reCanBeCustomInline.test(parser.currentLine)&&(match=parser.currentLine.match(reCustomBlock))){var syntaxLength=match[1].length;parser.closeUnmatchedBlocks();var container=parser.addChild("customBlock",parser.nextNonspace);return container.syntaxLength=syntaxLength,container.offset=parser.indent,parser.advanceNextNonspace(),parser.advanceOffset(syntaxLength,!1),2}return 0},reCodeFence=/^`{3,}(?!.*`)|^~{3,}/,reHtmlBlockOpen=[/./,/^<(?:script|pre|style)(?:\s|>|$)/i,/^<!--/,/^<[?]/,/^<![A-Z]/,/^<!\[CDATA\[/,/^<[/]?(?:address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[123456]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|nav|noframes|ol|optgroup|option|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul)(?:\s|[/]?[>]|$)/i,new RegExp("^(?:"+OPENTAG+"|"+CLOSETAG+")\\s*$","i")],reSetextHeadingLine=/^(?:=+|-+)[ \t]*$/,reATXHeadingMarker=/^#{1,6}(?:[ \t]+|$)/,reThematicBreak=/^(?:(?:\*[ \t]*){3,}|(?:_[ \t]*){3,}|(?:-[ \t]*){3,})[ \t]*$/,reBulletListMarker=/^[*+-]/,reOrderedListMarker=/^(\d{1,9})([.)])/;function parseListMarker(parser,container){var rest=parser.currentLine.slice(parser.nextNonspace),match,nextc,data={type:"bullet",tight:!0,bulletChar:"",start:0,delimiter:"",padding:0,markerOffset:parser.indent,task:!1,checked:!1};if(parser.indent>=4)return null;if(match=rest.match(reBulletListMarker))data.type="bullet",data.bulletChar=match[0][0];else{if(!(match=rest.match(reOrderedListMarker))||"paragraph"===container.type&&"1"!==match[1])return null;data.type="ordered",data.start=parseInt(match[1],10),data.delimiter=match[2]}if(-1!==(nextc=peek(parser.currentLine,parser.nextNonspace+match[0].length))&&9!==nextc&&32!==nextc)return null;if("paragraph"===container.type&&!parser.currentLine.slice(parser.nextNonspace+match[0].length).match(reNonSpace))return null;parser.advanceNextNonspace(),parser.advanceOffset(match[0].length,!0);var spacesStartCol=parser.column,spacesStartOffset=parser.offset;do{parser.advanceOffset(1,!0),nextc=peek(parser.currentLine,parser.offset)}while(parser.column-spacesStartCol<5&&isSpaceOrTab(nextc));var blankItem=-1===peek(parser.currentLine,parser.offset),spacesAfterMarker=parser.column-spacesStartCol;return spacesAfterMarker>=5||spacesAfterMarker<1||blankItem?(data.padding=match[0].length+1,parser.column=spacesStartCol,parser.offset=spacesStartOffset,isSpaceOrTab(peek(parser.currentLine,parser.offset))&&parser.advanceOffset(1,!0)):data.padding=match[0].length+spacesAfterMarker,data}function listsMatch(listData,itemData){return listData.type===itemData.type&&listData.delimiter===itemData.delimiter&&listData.bulletChar===itemData.bulletChar}function isDisallowedDeepHeading(parser,node){return parser.options.disallowDeepHeading&&("blockQuote"===node.type||"item"===node.type)}var esm_blockQuote,atxHeading,fencedCodeBlock,htmlBlock,seTextHeading,thematicBreak,listItem,indentedCodeBlock,blockStarts=[function(parser){return parser.indented||62!==peek(parser.currentLine,parser.nextNonspace)?0:(parser.advanceNextNonspace(),parser.advanceOffset(1,!1),isSpaceOrTab(peek(parser.currentLine,parser.offset))&&parser.advanceOffset(1,!0),parser.closeUnmatchedBlocks(),parser.addChild("blockQuote",parser.nextNonspace),1)},function(parser,container){var match;if(!parser.indented&&!isDisallowedDeepHeading(parser,container)&&(match=parser.currentLine.slice(parser.nextNonspace).match(reATXHeadingMarker))){parser.advanceNextNonspace(),parser.advanceOffset(match[0].length,!1),parser.closeUnmatchedBlocks();var heading=parser.addChild("heading",parser.nextNonspace);return heading.level=match[0].trim().length,heading.headingType="atx",heading.stringContent=parser.currentLine.slice(parser.offset).replace(/^[ \t]*#+[ \t]*$/,"").replace(/[ \t]+#+[ \t]*$/,""),parser.advanceOffset(parser.currentLine.length-parser.offset),2}return 0},function(parser){var match;if(!parser.indented&&(match=parser.currentLine.slice(parser.nextNonspace).match(reCodeFence))){var fenceLength=match[0].length;parser.closeUnmatchedBlocks();var container=parser.addChild("codeBlock",parser.nextNonspace);return container.isFenced=!0,container.fenceLength=fenceLength,container.fenceChar=match[0][0],container.fenceOffset=parser.indent,parser.advanceNextNonspace(),parser.advanceOffset(fenceLength,!1),2}return 0},function(parser,container){if(!parser.indented&&60===peek(parser.currentLine,parser.nextNonspace)){var s=parser.currentLine.slice(parser.nextNonspace),disallowedTags=parser.options.disallowedHtmlBlockTags,blockType=void 0;for(blockType=1;blockType<=7;blockType++){var matched=s.match(reHtmlBlockOpen[blockType]);if(matched){if(7===blockType){if("paragraph"===container.type)return 0;var reDisallowedTags;if(disallowedTags.length>0)if(new RegExp("</?(?:"+disallowedTags.join("|")+")","i").test(matched[0]))return 0}var b;return parser.closeUnmatchedBlocks(),parser.addChild("htmlBlock",parser.offset).htmlBlockType=blockType,2}}}return 0},function(parser,container){var match;if(null!==container.stringContent&&!parser.indented&&"paragraph"===container.type&&!isDisallowedDeepHeading(parser,container.parent)&&(match=parser.currentLine.slice(parser.nextNonspace).match(reSetextHeadingLine))){parser.closeUnmatchedBlocks();for(var pos=void 0;91===peek(container.stringContent,0)&&(pos=parser.inlineParser.parseReference(container,parser.refMap));)container.stringContent=container.stringContent.slice(pos);if(container.stringContent.length>0){var heading=createNode("heading",container.sourcepos);return heading.level="="===match[0][0]?1:2,heading.headingType="setext",heading.stringContent=container.stringContent,container.insertAfter(heading),container.unlink(),parser.tip=heading,parser.advanceOffset(parser.currentLine.length-parser.offset,!1),2}return 0}return 0},function(parser){return!parser.indented&&reThematicBreak.test(parser.currentLine.slice(parser.nextNonspace))?(parser.closeUnmatchedBlocks(),parser.addChild("thematicBreak",parser.nextNonspace),parser.advanceOffset(parser.currentLine.length-parser.offset,!1),2):0},function(parser,container){var data,currNode=container;return parser.indented&&"list"!==container.type||!(data=parseListMarker(parser,currNode))?0:(parser.closeUnmatchedBlocks(),"list"===parser.tip.type&&listsMatch(currNode.listData,data)||((currNode=parser.addChild("list",parser.nextNonspace)).listData=data),(currNode=parser.addChild("item",parser.nextNonspace)).listData=data,1)},function(parser){return parser.indented&&"paragraph"!==parser.tip.type&&!parser.blank?(parser.advanceOffset(4,!0),parser.closeUnmatchedBlocks(),parser.addChild("codeBlock",parser.offset),2):0},tableHead,tableBody,esm_customBlock],reFrontMatter=/^(-{3}|\+{3}|;{3})$/,frontMatter$1=function(parser,container){var currentLine=parser.currentLine,lineNumber=parser.lineNumber,indented=parser.indented,frontMatter_1;return 1===lineNumber&&!indented&&"document"===container.type&&reFrontMatter.test(currentLine)?(parser.closeUnmatchedBlocks(),parser.addChild("frontMatter",parser.nextNonspace).stringContent=currentLine,parser.advanceNextNonspace(),parser.advanceOffset(currentLine.length,!1),2):0},frontMatter={continue:function(parser,container){var line=parser.currentLine,match=line.match(reFrontMatter);return"frontMatter"===container.type&&match?(container.stringContent+=line,parser.lastLineLength=match[0].length,parser.finalize(container,parser.lineNumber),2):0},finalize:function(_,block){null!==block.stringContent&&(block.literal=block.stringContent,block.stringContent=null)},canContain:function(){return!1},acceptsLines:!0},reHtmlBlockClose=[/./,/<\/(?:script|pre|style)>/i,/-->/,/\?>/,/>/,/\]\]>/],reMaybeSpecial=/^[#`~*+_=<>0-9-;$]/,reLineEnding$1=/\r\n|\n|\r/;function esm_document(){return createNode("document",[[1,1],[0,0]])}var defaultOptions$1={smart:!1,tagFilter:!1,extendedAutolinks:!1,disallowedHtmlBlockTags:[],referenceDefinition:!1,disallowDeepHeading:!1,customParser:null,frontMatter:!1},Parser=function(){function Parser(options){this.options=esm_assign(esm_assign({},defaultOptions$1),options),this.doc=esm_document(),this.tip=this.doc,this.oldtip=this.doc,this.lineNumber=0,this.offset=0,this.column=0,this.nextNonspace=0,this.nextNonspaceColumn=0,this.indent=0,this.currentLine="",this.indented=!1,this.blank=!1,this.partiallyConsumedTab=!1,this.allClosed=!0,this.lastMatchedContainer=this.doc,this.refMap={},this.refLinkCandidateMap={},this.refDefCandidateMap={},this.lastLineLength=0,this.lines=[],this.options.frontMatter&&(blockHandlers.frontMatter=frontMatter,blockStarts.unshift(frontMatter$1)),this.inlineParser=new InlineParser(this.options)}return Parser.prototype.advanceOffset=function(count,columns){void 0===columns&&(columns=!1);for(var currentLine=this.currentLine,charsToTab,charsToAdvance,c;count>0&&(c=currentLine[this.offset]);)"\t"===c?(charsToTab=4-this.column%4,columns?(this.partiallyConsumedTab=charsToTab>count,charsToAdvance=charsToTab>count?count:charsToTab,this.column+=charsToAdvance,this.offset+=this.partiallyConsumedTab?0:1,count-=charsToAdvance):(this.partiallyConsumedTab=!1,this.column+=charsToTab,this.offset+=1,count-=1)):(this.partiallyConsumedTab=!1,this.offset+=1,this.column+=1,count-=1)},Parser.prototype.advanceNextNonspace=function(){this.offset=this.nextNonspace,this.column=this.nextNonspaceColumn,this.partiallyConsumedTab=!1},Parser.prototype.findNextNonspace=function(){for(var currentLine=this.currentLine,i=this.offset,cols=this.column,c;""!==(c=currentLine.charAt(i));)if(" "===c)i++,cols++;else{if("\t"!==c)break;i++,cols+=4-cols%4}this.blank="\n"===c||"\r"===c||""===c,this.nextNonspace=i,this.nextNonspaceColumn=cols,this.indent=this.nextNonspaceColumn-this.column,this.indented=this.indent>=4},Parser.prototype.addLine=function(){if(this.partiallyConsumedTab){this.offset+=1;var charsToTab=4-this.column%4;this.tip.stringContent+=esm_repeat(" ",charsToTab)}this.tip.lineOffsets?this.tip.lineOffsets.push(this.offset):this.tip.lineOffsets=[this.offset],this.tip.stringContent+=this.currentLine.slice(this.offset)+"\n"},Parser.prototype.addChild=function(tag,offset){for(;!blockHandlers[this.tip.type].canContain(tag);)this.finalize(this.tip,this.lineNumber-1);var columnNumber=offset+1,newBlock=createNode(tag,[[this.lineNumber,columnNumber],[0,0]]);return newBlock.stringContent="",this.tip.appendChild(newBlock),this.tip=newBlock,newBlock},Parser.prototype.closeUnmatchedBlocks=function(){if(!this.allClosed){for(;this.oldtip!==this.lastMatchedContainer;){var parent_1=this.oldtip.parent;this.finalize(this.oldtip,this.lineNumber-1),this.oldtip=parent_1}this.allClosed=!0}},Parser.prototype.finalize=function(block,lineNumber){var above=block.parent;block.open=!1,block.sourcepos[1]=[lineNumber,this.lastLineLength],blockHandlers[block.type].finalize(this,block),this.tip=above},Parser.prototype.processInlines=function(block){var event,customParser=this.options.customParser,walker=block.walker();for(this.inlineParser.refMap=this.refMap,this.inlineParser.refLinkCandidateMap=this.refLinkCandidateMap,this.inlineParser.refDefCandidateMap=this.refDefCandidateMap,this.inlineParser.options=this.options;event=walker.next();){var node=event.node,entering=event.entering,t=node.type;customParser&&customParser[t]&&customParser[t](node,{entering:entering,options:this.options}),entering||"paragraph"!==t&&"heading"!==t&&("tableCell"!==t||node.ignored)||this.inlineParser.parse(node)}},Parser.prototype.incorporateLine=function(ln){var container=this.doc;this.oldtip=this.tip,this.offset=0,this.column=0,this.blank=!1,this.partiallyConsumedTab=!1,this.lineNumber+=1,-1!==ln.indexOf("\0")&&(ln=ln.replace(/\0/g,"�")),this.currentLine=ln;for(var allMatched=!0,lastChild;(lastChild=container.lastChild)&&lastChild.open;){switch(container=lastChild,this.findNextNonspace(),blockHandlers[container.type].continue(this,container)){case 0:break;case 1:allMatched=!1;break;case 2:return void(this.lastLineLength=ln.length);default:throw new Error("continue returned illegal value, must be 0, 1, or 2")}if(!allMatched){container=container.parent;break}}this.allClosed=container===this.oldtip,this.lastMatchedContainer=container;for(var matchedLeaf="paragraph"!==container.type&&blockHandlers[container.type].acceptsLines,blockStartsLen=blockStarts.length;!matchedLeaf;){if(this.findNextNonspace(),"table"!==container.type&&"tableBody"!==container.type&&"paragraph"!==container.type&&!this.indented&&!reMaybeSpecial.test(ln.slice(this.nextNonspace))){this.advanceNextNonspace();break}for(var i=0;i<blockStartsLen;){var res=blockStarts[i](this,container);if(1===res){container=this.tip;break}if(2===res){container=this.tip,matchedLeaf=!0;break}i++}if(i===blockStartsLen){this.advanceNextNonspace();break}}if(this.allClosed||this.blank||"paragraph"!==this.tip.type){this.closeUnmatchedBlocks(),this.blank&&container.lastChild&&(container.lastChild.lastLineBlank=!0);for(var t=container.type,lastLineBlank=this.blank&&!("blockQuote"===t||isCodeBlock(container)&&container.isFenced||"item"===t&&!container.firstChild&&container.sourcepos[0][0]===this.lineNumber),cont=container;cont;)cont.lastLineBlank=lastLineBlank,cont=cont.parent;blockHandlers[t].acceptsLines?(this.addLine(),isHtmlBlock(container)&&container.htmlBlockType>=1&&container.htmlBlockType<=5&&reHtmlBlockClose[container.htmlBlockType].test(this.currentLine.slice(this.offset))&&(this.lastLineLength=ln.length,this.finalize(container,this.lineNumber))):this.offset<ln.length&&!this.blank&&(container=this.addChild("paragraph",this.offset),this.advanceNextNonspace(),this.addLine())}else this.addLine();this.lastLineLength=ln.length},Parser.prototype.parse=function(input,lineTexts){this.doc=esm_document(),this.tip=this.doc,this.lineNumber=0,this.lastLineLength=0,this.offset=0,this.column=0,this.lastMatchedContainer=this.doc,this.currentLine="";var lines=input.split(reLineEnding$1),len=lines.length;this.lines=lineTexts||lines,this.options.referenceDefinition&&this.clearRefMaps(),10===input.charCodeAt(input.length-1)&&(len-=1);for(var i=0;i<len;i++)this.incorporateLine(lines[i]);for(;this.tip;)this.finalize(this.tip,len);return this.processInlines(this.doc),this.doc},Parser.prototype.partialParseStart=function(lineNumber,lines){this.doc=esm_document(),this.tip=this.doc,this.lineNumber=lineNumber-1,this.lastLineLength=0,this.offset=0,this.column=0,this.lastMatchedContainer=this.doc,this.currentLine="";for(var len=lines.length,i=0;i<len;i++)this.incorporateLine(lines[i]);return this.doc},Parser.prototype.partialParseExtends=function(lines){for(var i=0;i<lines.length;i++)this.incorporateLine(lines[i])},Parser.prototype.partialParseFinish=function(){for(;this.tip;)this.finalize(this.tip,this.lineNumber);this.processInlines(this.doc)},Parser.prototype.setRefMaps=function(refMap,refLinkCandidateMap,refDefCandidateMap){this.refMap=refMap,this.refLinkCandidateMap=refLinkCandidateMap,this.refDefCandidateMap=refDefCandidateMap},Parser.prototype.clearRefMaps=function(){[this.refMap,this.refLinkCandidateMap,this.refDefCandidateMap].forEach((function(map){clearObj(map)}))},Parser}();function comparePos(p1,p2){return p1[0]<p2[0]?1:p1[0]>p2[0]?-1:p1[1]<p2[1]?1:p1[1]>p2[1]?-1:0}function compareRangeAndPos(_a,pos){var startPos=_a[0],endPos;return 1===comparePos(_a[1],pos)?1:-1===comparePos(startPos,pos)?-1:0}function removeNextUntil(node,last){if(node.parent===last.parent&&node!==last){for(var next=node.next;next&&next!==last;){for(var temp=next.next,_i=0,_a=["parent","prev","next"];_i<_a.length;_i++){var type=_a[_i];next[type]&&(removeNodeById(next[type].id),next[type]=null)}next=temp}node.next=last.next,last.next?last.next.prev=node:node.parent.lastChild=node}}function getChildNodes(parent){for(var nodes=[],curr=parent.firstChild;curr;)nodes.push(curr),curr=curr.next;return nodes}function insertNodesBefore(target,nodes){for(var _i=0,nodes_1=nodes;_i<nodes_1.length;_i++){var node=nodes_1[_i];target.insertBefore(node)}}function prependChildNodes(parent,nodes){for(var i=nodes.length-1;i>=0;i-=1)parent.prependChild(nodes[i])}function updateNextLineNumbers(base,diff){if(base&&base.parent&&0!==diff){var walker=base.parent.walker(),event;for(walker.resumeAt(base,!0);event=walker.next();){var node=event.node,entering;event.entering&&(node.sourcepos[0][0]+=diff,node.sourcepos[1][0]+=diff)}}}function compareRangeAndLine(_a,line){var startPos=_a[0],endPos;return _a[1][0]<line?1:startPos[0]>line?-1:0}function findChildNodeAtLine(parent,line){for(var node=parent.firstChild;node;){var comp=compareRangeAndLine(node.sourcepos,line);if(0===comp)return node;if(-1===comp)return node.prev||node;node=node.next}return parent.lastChild}function lastLeafNode(node){for(;node.lastChild;)node=node.lastChild;return node}function sameLineTopAncestor(node){for(;node.parent&&"document"!==node.parent.type&&node.parent.sourcepos[0][0]===node.sourcepos[0][0];)node=node.parent;return node}function findFirstNodeAtLine(parent,line){for(var node=parent.firstChild,prev=null;node;){var comp=compareRangeAndLine(node.sourcepos,line);if(0===comp){if(node.sourcepos[0][0]===line||!node.firstChild)return node;prev=node,node=node.firstChild}else{if(-1===comp)break;prev=node,node=node.next}}return prev?sameLineTopAncestor(lastLeafNode(prev)):null}function findNodeAtPosition(parent,pos){for(var node=parent,prev=null;node;){var comp=compareRangeAndPos(node.sourcepos,pos);if(0===comp){if(!node.firstChild)return node;prev=node,node=node.firstChild}else{if(-1===comp)return prev;if(!node.next)return prev;node=node.next}}return node}function findNodeById(id){return getNodeById(id)||null}function invokeNextUntil(callback,start,end){if(void 0===end&&(end=null),start)for(var walker=start.walker();start&&start!==end;){callback(start);var next=walker.next();if(!next)break;start=next.node}}function isUnlinked(id){var node=findNodeById(id);if(!node)return!0;for(;node&&"document"!==node.type;){if(!node.parent&&!node.prev&&!node.next)return!0;node=node.parent}return!1}var reLineEnding=/\r\n|\n|\r/;function canBeContinuedListItem(lineText){var spaceMatch=lineText.match(/^[ \t]+/);if(spaceMatch&&(spaceMatch[0].length>=2||/\t/.test(spaceMatch[0])))return!0;var leftTrimmed=spaceMatch?lineText.slice(spaceMatch.length):lineText;return reBulletListMarker.test(leftTrimmed)||reOrderedListMarker.test(leftTrimmed)}function canBeContinuedTableBody(lineText){return!isBlank(lineText)&&-1!==lineText.indexOf("|")}function createRefDefState(node){var id,title,sourcepos,dest;return{id:node.id,title:node.title,sourcepos:node.sourcepos,unlinked:!1,destination:node.dest}}var ToastMark=function(){function ToastMark(contents,options){this.refMap={},this.refLinkCandidateMap={},this.refDefCandidateMap={},this.referenceDefinition=!!(null==options?void 0:options.referenceDefinition),this.parser=new Parser(options),this.parser.setRefMaps(this.refMap,this.refLinkCandidateMap,this.refDefCandidateMap),this.eventHandlerMap={change:[]},contents=contents||"",this.lineTexts=contents.split(reLineEnding),this.root=this.parser.parse(contents,this.lineTexts)}return ToastMark.prototype.updateLineTexts=function(startPos,endPos,newText){var _a,startLine=startPos[0],startCol=startPos[1],endLine=endPos[0],endCol=endPos[1],newLines=newText.split(reLineEnding),newLineLen=newLines.length,startLineText=this.lineTexts[startLine-1],endLineText=this.lineTexts[endLine-1];newLines[0]=startLineText.slice(0,startCol-1)+newLines[0],newLines[newLineLen-1]=newLines[newLineLen-1]+endLineText.slice(endCol-1);var removedLineLen=endLine-startLine+1;return(_a=this.lineTexts).splice.apply(_a,esm_spreadArray([startLine-1,removedLineLen],newLines)),newLineLen-removedLineLen},ToastMark.prototype.updateRootNodeState=function(){if(1===this.lineTexts.length&&""===this.lineTexts[0])return this.root.lastLineBlank=!0,void(this.root.sourcepos=[[1,1],[1,0]]);this.root.lastChild&&(this.root.lastLineBlank=this.root.lastChild.lastLineBlank);for(var lineTexts=this.lineTexts,idx=lineTexts.length-1;""===lineTexts[idx];)idx-=1;lineTexts.length-2>idx&&(idx+=1),this.root.sourcepos[1]=[idx+1,lineTexts[idx].length]},ToastMark.prototype.replaceRangeNodes=function(startNode,endNode,newNodes){startNode?(insertNodesBefore(startNode,newNodes),removeNextUntil(startNode,endNode),[startNode.id,endNode.id].forEach((function(id){return removeNodeById(id)})),startNode.unlink()):endNode?(insertNodesBefore(endNode,newNodes),removeNodeById(endNode.id),endNode.unlink()):prependChildNodes(this.root,newNodes)},ToastMark.prototype.getNodeRange=function(startPos,endPos){var startNode=findChildNodeAtLine(this.root,startPos[0]),endNode=findChildNodeAtLine(this.root,endPos[0]);return endNode&&endNode.next&&endPos[0]+1===endNode.next.sourcepos[0][0]&&(endNode=endNode.next),[startNode,endNode]},ToastMark.prototype.trigger=function(eventName,param){this.eventHandlerMap[eventName].forEach((function(handler){handler(param)}))},ToastMark.prototype.extendEndLine=function(line){for(;""===this.lineTexts[line];)line+=1;return line},ToastMark.prototype.parseRange=function(startNode,endNode,startLine,endLine){startNode&&startNode.prev&&(isList(startNode.prev)&&canBeContinuedListItem(this.lineTexts[startLine-1])||isTable(startNode.prev)&&canBeContinuedTableBody(this.lineTexts[startLine-1]))&&(startLine=(startNode=startNode.prev).sourcepos[0][0]);for(var editedLines=this.lineTexts.slice(startLine-1,endLine),root=this.parser.partialParseStart(startLine,editedLines),nextNode=endNode?endNode.next:this.root.firstChild,lastChild=root.lastChild,isOpenedLastChildCodeBlock=lastChild&&isCodeBlock(lastChild)&&lastChild.open,isOpenedLastChildCustomBlock=lastChild&&isCustomBlock(lastChild)&&lastChild.open,isLastChildList=lastChild&&isList(lastChild);(isOpenedLastChildCodeBlock||isOpenedLastChildCustomBlock)&&nextNode||isLastChildList&&nextNode&&("list"===nextNode.type||nextNode.sourcepos[0][1]>=2);){var newEndLine=this.extendEndLine(nextNode.sourcepos[1][0]);this.parser.partialParseExtends(this.lineTexts.slice(endLine,newEndLine)),startNode||(startNode=endNode),endNode=nextNode,endLine=newEndLine,nextNode=nextNode.next}var newNodes;return this.parser.partialParseFinish(),{newNodes:getChildNodes(root),extStartNode:startNode,extEndNode:endNode}},ToastMark.prototype.getRemovedNodeRange=function(extStartNode,extEndNode){return!extStartNode||extStartNode&&isRefDef(extStartNode)||extEndNode&&isRefDef(extEndNode)?null:{id:[extStartNode.id,extEndNode.id],line:[extStartNode.sourcepos[0][0]-1,extEndNode.sourcepos[1][0]-1]}},ToastMark.prototype.markDeletedRefMap=function(extStartNode,extEndNode){var _this=this;if(!isEmptyObj(this.refMap)){var markDeleted=function(node){if(isRefDef(node)){var refDefState=_this.refMap[node.label];refDefState&&node.id===refDefState.id&&(refDefState.unlinked=!0)}};extStartNode&&invokeNextUntil(markDeleted,extStartNode.parent,extEndNode),extEndNode&&invokeNextUntil(markDeleted,extEndNode)}},ToastMark.prototype.replaceWithNewRefDefState=function(nodes){var _this=this;if(!isEmptyObj(this.refMap)){var replaceWith_1=function(node){if(isRefDef(node)){var label=node.label,refDefState=_this.refMap[label];refDefState&&!refDefState.unlinked||(_this.refMap[label]=createRefDefState(node))}};nodes.forEach((function(node){invokeNextUntil(replaceWith_1,node)}))}},ToastMark.prototype.replaceWithRefDefCandidate=function(){var _this=this;isEmptyObj(this.refDefCandidateMap)||iterateObject(this.refDefCandidateMap,(function(_,candidate){var label=candidate.label,sourcepos=candidate.sourcepos,refDefState=_this.refMap[label];(!refDefState||refDefState.unlinked||refDefState.sourcepos[0][0]>sourcepos[0][0])&&(_this.refMap[label]=createRefDefState(candidate))}))},ToastMark.prototype.getRangeWithRefDef=function(startLine,endLine,startNode,endNode,lineDiff){if(this.referenceDefinition&&!isEmptyObj(this.refMap)){var prevNode=findChildNodeAtLine(this.root,startLine-1),nextNode=findChildNodeAtLine(this.root,endLine+1);prevNode&&isRefDef(prevNode)&&prevNode!==startNode&&prevNode!==endNode&&(startLine=(startNode=prevNode).sourcepos[0][0]),nextNode&&isRefDef(nextNode)&&nextNode!==startNode&&nextNode!==endNode&&(endNode=nextNode,endLine=this.extendEndLine(endNode.sourcepos[1][0]+lineDiff))}return[startNode,endNode,startLine,endLine]},ToastMark.prototype.parse=function(startPos,endPos,lineDiff){void 0===lineDiff&&(lineDiff=0);var range=this.getNodeRange(startPos,endPos),startNode=range[0],endNode=range[1],startLine=startNode?Math.min(startNode.sourcepos[0][0],startPos[0]):startPos[0],endLine=this.extendEndLine((endNode?Math.max(endNode.sourcepos[1][0],endPos[0]):endPos[0])+lineDiff),parseResult=this.parseRange.apply(this,this.getRangeWithRefDef(startLine,endLine,startNode,endNode,lineDiff)),newNodes=parseResult.newNodes,extStartNode=parseResult.extStartNode,extEndNode=parseResult.extEndNode,removedNodeRange=this.getRemovedNodeRange(extStartNode,extEndNode),nextNode=extEndNode?extEndNode.next:this.root.firstChild;return this.referenceDefinition?(this.markDeletedRefMap(extStartNode,extEndNode),this.replaceRangeNodes(extStartNode,extEndNode,newNodes),this.replaceWithNewRefDefState(newNodes)):this.replaceRangeNodes(extStartNode,extEndNode,newNodes),{nodes:newNodes,removedNodeRange:removedNodeRange,nextNode:nextNode}},ToastMark.prototype.parseRefLink=function(){var _this=this,result=[];return isEmptyObj(this.refMap)||iterateObject(this.refMap,(function(label,value){value.unlinked&&delete _this.refMap[label],iterateObject(_this.refLinkCandidateMap,(function(_,candidate){var node=candidate.node,refLabel;candidate.refLabel===label&&result.push(_this.parse(node.sourcepos[0],node.sourcepos[1]))}))})),result},ToastMark.prototype.removeUnlinkedCandidate=function(){isEmptyObj(this.refDefCandidateMap)||[this.refLinkCandidateMap,this.refDefCandidateMap].forEach((function(candidateMap){iterateObject(candidateMap,(function(id){isUnlinked(id)&&delete candidateMap[id]}))}))},ToastMark.prototype.editMarkdown=function(startPos,endPos,newText){var lineDiff=this.updateLineTexts(startPos,endPos,newText),parseResult=this.parse(startPos,endPos,lineDiff),editResult=omit(parseResult,"nextNode");updateNextLineNumbers(parseResult.nextNode,lineDiff),this.updateRootNodeState();var result=[editResult];return this.referenceDefinition&&(this.removeUnlinkedCandidate(),this.replaceWithRefDefCandidate(),result=result.concat(this.parseRefLink())),this.trigger("change",result),result},ToastMark.prototype.getLineTexts=function(){return this.lineTexts},ToastMark.prototype.getRootNode=function(){return this.root},ToastMark.prototype.findNodeAtPosition=function(pos){var node=findNodeAtPosition(this.root,pos);return node&&node!==this.root?node:null},ToastMark.prototype.findFirstNodeAtLine=function(line){return findFirstNodeAtLine(this.root,line)},ToastMark.prototype.on=function(eventName,callback){this.eventHandlerMap[eventName].push(callback)},ToastMark.prototype.off=function(eventName,callback){var handlers=this.eventHandlerMap[eventName],idx=handlers.indexOf(callback);handlers.splice(idx,1)},ToastMark.prototype.findNodeById=function(id){return findNodeById(id)},ToastMark.prototype.removeAllNode=function(){removeAllNode()},ToastMark}(),disallowedTags,reDisallowedTag=new RegExp("<(/?(?:"+["title","textarea","style","xmp","iframe","noembed","noframes","script","plaintext"].join("|")+")[^>]*>)","ig");function filterDisallowedTags(str){return reDisallowedTag.test(str)?str.replace(reDisallowedTag,(function(_,group){return"&lt;"+group})):str}var baseConvertors={heading:function(node,_a){var entering;return{type:_a.entering?"openTag":"closeTag",tagName:"h"+node.level,outerNewLine:!0}},text:function(node){return{type:"text",content:node.literal}},softbreak:function(_,_a){var options;return{type:"html",content:_a.options.softbreak}},linebreak:function(){return{type:"html",content:"<br />\n"}},emph:function(_,_a){var entering;return{type:_a.entering?"openTag":"closeTag",tagName:"em"}},strong:function(_,_a){var entering;return{type:_a.entering?"openTag":"closeTag",tagName:"strong"}},paragraph:function(node,_a){var _b,entering=_a.entering,grandparent=null===(_b=node.parent)||void 0===_b?void 0:_b.parent;return grandparent&&"list"===grandparent.type&&grandparent.listData.tight?null:{type:entering?"openTag":"closeTag",tagName:"p",outerNewLine:!0}},thematicBreak:function(){return{type:"openTag",tagName:"hr",outerNewLine:!0,selfClose:!0}},blockQuote:function(_,_a){var entering;return{type:_a.entering?"openTag":"closeTag",tagName:"blockquote",outerNewLine:!0,innerNewLine:!0}},list:function(node,_a){var entering=_a.entering,_b=node.listData,type=_b.type,start=_b.start,tagName="bullet"===type?"ul":"ol",attributes={};return"ol"===tagName&&null!==start&&1!==start&&(attributes.start=start.toString()),{type:entering?"openTag":"closeTag",tagName:tagName,attributes:attributes,outerNewLine:!0}},item:function(_,_a){var entering;return{type:_a.entering?"openTag":"closeTag",tagName:"li",outerNewLine:!0}},htmlInline:function(node,_a){var options,content;return{type:"html",content:_a.options.tagFilter?filterDisallowedTags(node.literal):node.literal}},htmlBlock:function(node,_a){var options=_a.options,content=options.tagFilter?filterDisallowedTags(node.literal):node.literal;return options.nodeId?[{type:"openTag",tagName:"div",outerNewLine:!0},{type:"html",content:content},{type:"closeTag",tagName:"div",outerNewLine:!0}]:{type:"html",content:content,outerNewLine:!0}},code:function(node){return[{type:"openTag",tagName:"code"},{type:"text",content:node.literal},{type:"closeTag",tagName:"code"}]},codeBlock:function(node){var infoStr=node.info,infoWords=infoStr?infoStr.split(/\s+/):[],codeClassNames=[];return infoWords.length>0&&infoWords[0].length>0&&codeClassNames.push("language-"+escapeXml(infoWords[0])),[{type:"openTag",tagName:"pre",outerNewLine:!0},{type:"openTag",tagName:"code",classNames:codeClassNames},{type:"text",content:node.literal},{type:"closeTag",tagName:"code"},{type:"closeTag",tagName:"pre",outerNewLine:!0}]},link:function(node,_a){var entering;if(_a.entering){var _b=node,title=_b.title,destination=_b.destination;return{type:"openTag",tagName:"a",attributes:esm_assign({href:escapeXml(destination)},title&&{title:escapeXml(title)})}}return{type:"closeTag",tagName:"a"}},image:function(node,_a){var getChildrenText=_a.getChildrenText,skipChildren=_a.skipChildren,_b=node,title=_b.title,destination=_b.destination;return skipChildren(),{type:"openTag",tagName:"img",selfClose:!0,attributes:esm_assign({src:escapeXml(destination),alt:getChildrenText(node)},title&&{title:escapeXml(title)})}},customBlock:function(node,context,convertors){var info,customConvertor=convertors[node.info.trim().toLowerCase()];if(customConvertor)try{return customConvertor(node,context)}catch(e){console.warn(e)}return[{type:"openTag",tagName:"div",outerNewLine:!0},{type:"text",content:node.literal},{type:"closeTag",tagName:"div",outerNewLine:!0}]},frontMatter:function(node){return[{type:"openTag",tagName:"div",outerNewLine:!0,attributes:{style:"white-space: pre; display: none;"}},{type:"text",content:node.literal},{type:"closeTag",tagName:"div",outerNewLine:!0}]},customInline:function(node,context,convertors){var info,customConvertor=convertors[node.info.trim().toLowerCase()];return customConvertor?customConvertor(node,context):{type:context.entering?"openTag":"closeTag",tagName:"span"}}},gfmConvertors={strike:function(_,_a){var entering;return{type:_a.entering?"openTag":"closeTag",tagName:"del"}},item:function(node,_a){var entering=_a.entering,_b=node.listData,checked=_b.checked,task=_b.task;if(entering){var itemTag={type:"openTag",tagName:"li",outerNewLine:!0};return task?[itemTag,{type:"openTag",tagName:"input",selfClose:!0,attributes:esm_assign(esm_assign({},checked&&{checked:""}),{disabled:"",type:"checkbox"})},{type:"text",content:" "}]:itemTag}return{type:"closeTag",tagName:"li",outerNewLine:!0}},table:function(_,_a){var entering;return{type:_a.entering?"openTag":"closeTag",tagName:"table",outerNewLine:!0}},tableHead:function(_,_a){var entering;return{type:_a.entering?"openTag":"closeTag",tagName:"thead",outerNewLine:!0}},tableBody:function(_,_a){var entering;return{type:_a.entering?"openTag":"closeTag",tagName:"tbody",outerNewLine:!0}},tableRow:function(node,_a){var entering;if(_a.entering)return{type:"openTag",tagName:"tr",outerNewLine:!0};var result=[];if(node.lastChild)for(var columnLen=node.parent.parent.columns.length,lastColIdx,i=node.lastChild.endIdx+1;i<columnLen;i+=1)result.push({type:"openTag",tagName:"td",outerNewLine:!0},{type:"closeTag",tagName:"td",outerNewLine:!0});return result.push({type:"closeTag",tagName:"tr",outerNewLine:!0}),result},tableCell:function(node,_a){var entering=_a.entering;if(node.ignored)return{type:"text",content:""};var tablePart=node.parent.parent,tagName="tableHead"===tablePart.type?"th":"td",table,columnInfo=tablePart.parent.columns[node.startIdx],attributes=(null==columnInfo?void 0:columnInfo.align)?{align:columnInfo.align}:null;return entering?esm_assign({type:"openTag",tagName:tagName,outerNewLine:!0},attributes&&{attributes:attributes}):{type:"closeTag",tagName:tagName,outerNewLine:!0}}},defaultOptions={softbreak:"\n",gfm:!1,tagFilter:!1,nodeId:!1};function esm_getChildrenText(node){for(var buffer=[],walker=node.walker(),event=null;event=walker.next();){var node_1=event.node;"text"===node_1.type&&buffer.push(node_1.literal)}return buffer.join("")}var Renderer=function(){function Renderer(customOptions){this.buffer=[],this.options=esm_assign(esm_assign({},defaultOptions),customOptions),this.convertors=this.createConvertors(),delete this.options.convertors}return Renderer.prototype.createConvertors=function(){var convertors=esm_assign({},baseConvertors);if(this.options.gfm&&(convertors=esm_assign(esm_assign({},convertors),gfmConvertors)),this.options.convertors){var customConvertors_1=this.options.convertors,nodeTypes=Object.keys(customConvertors_1),defaultConvertors_1=esm_assign(esm_assign({},baseConvertors),gfmConvertors);nodeTypes.forEach((function(nodeType){var orgConvertor=convertors[nodeType],convertor=customConvertors_1[nodeType],convertorType=-1===Object.keys(defaultConvertors_1).indexOf(nodeType)?nodeType.toLowerCase():nodeType;convertors[convertorType]=orgConvertor?function(node,context){return context.origin=function(){return orgConvertor(node,context)},convertor(node,context)}:convertor}))}return convertors},Renderer.prototype.getConvertors=function(){return this.convertors},Renderer.prototype.getOptions=function(){return this.options},Renderer.prototype.render=function(rootNode){var _this=this;this.buffer=[];for(var walker=rootNode.walker(),event=null,_loop_1=function(){var node=event.node,entering=event.entering,convertor=this_1.convertors[node.type];if(!convertor)return"continue";var skipped=!1,context={entering:entering,leaf:!esm_isContainer(node),options:this_1.options,getChildrenText:esm_getChildrenText,skipChildren:function(){skipped=!0}},converted=isCustomBlock(node)||isCustomInline(node)?convertor(node,context,this_1.convertors):convertor(node,context),htmlNodes;converted&&((Array.isArray(converted)?converted:[converted]).forEach((function(htmlNode,index){"openTag"===htmlNode.type&&_this.options.nodeId&&0===index&&(htmlNode.attributes||(htmlNode.attributes={}),htmlNode.attributes["data-nodeid"]=String(node.id)),_this.renderHTMLNode(htmlNode)})),skipped&&(walker.resumeAt(node,!1),walker.next()))},this_1=this;event=walker.next();)_loop_1();return this.addNewLine(),this.buffer.join("")},Renderer.prototype.renderHTMLNode=function(node){switch(node.type){case"openTag":case"closeTag":this.renderElementNode(node);break;case"text":this.renderTextNode(node);break;case"html":this.renderRawHtmlNode(node)}},Renderer.prototype.generateOpenTagString=function(node){var _this=this,tagName=node.tagName,classNames=node.classNames,attributes=node.attributes;this.buffer.push("<"+tagName),classNames&&classNames.length>0&&this.buffer.push(' class="'+classNames.join(" ")+'"'),attributes&&Object.keys(attributes).forEach((function(attrName){var attrValue=attributes[attrName];_this.buffer.push(" "+attrName+'="'+attrValue+'"')})),node.selfClose&&this.buffer.push(" /"),this.buffer.push(">")},Renderer.prototype.generateCloseTagString=function(_a){var tagName=_a.tagName;this.buffer.push("</"+tagName+">")},Renderer.prototype.addNewLine=function(){this.buffer.length&&"\n"!==esm_last(esm_last(this.buffer))&&this.buffer.push("\n")},Renderer.prototype.addOuterNewLine=function(node){node.outerNewLine&&this.addNewLine()},Renderer.prototype.addInnerNewLine=function(node){node.innerNewLine&&this.addNewLine()},Renderer.prototype.renderTextNode=function(node){this.buffer.push(escapeXml(node.content))},Renderer.prototype.renderRawHtmlNode=function(node){this.addOuterNewLine(node),this.buffer.push(node.content),this.addOuterNewLine(node)},Renderer.prototype.renderElementNode=function(node){"openTag"===node.type?(this.addOuterNewLine(node),this.generateOpenTagString(node),node.selfClose?this.addOuterNewLine(node):this.addInnerNewLine(node)):(this.addInnerNewLine(node),this.generateCloseTagString(node),this.addOuterNewLine(node))},Renderer}(),reXSSHtmlAttr=new RegExp("^(abbr|align|alt|axis|bgcolor|border|cellpadding|cellspacing|class|clear|color|cols|compact|coords|dir|face|headers|height|hreflang|hspace|ismap|lang|language|nohref|nowrap|rel|rev|rows|rules|scope|scrolling|shape|size|span|start|summary|tabindex|target|title|type|valign|value|vspace|width|checked|mathvariant|encoding|id|name|background|cite|href|longdesc|src|usemap|xlink:href|data-+|checked|style)","g"),reXSSSvgAttr=new RegExp("^(accent-height|accumulate|additive|alphabetic|arabic-form|ascent|baseProfile|bbox|begin|by|calcMode|cap-height|class|color|color-rendering|content|cx|cy|d|dx|dy|descent|display|dur|end|fill|fill-rule|font-family|font-size|font-stretch|font-style|font-variant|font-weight|from|fx|fy|g1|g2|glyph-name|gradientUnits|hanging|height|horiz-adv-x|horiz-origin-x|ideographic|k|keyPoints|keySplines|keyTimes|lang|marker-end|marker-mid|marker-start|markerHeight|markerUnits|markerWidth|mathematical|max|min|offset|opacity|orient|origin|overline-position|overline-thickness|panose-1|path|pathLength|points|preserveAspectRatio|r|refX|refY|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|rotate|rx|ry|slope|stemh|stemv|stop-color|stop-opacity|strikethrough-position|strikethrough-thickness|stroke|stroke-dasharray|stroke-dashoffset|stroke-linecap|stroke-linejoin|stroke-miterlimit|stroke-opacity|stroke-width|systemLanguage|target|text-anchor|to|transform|type|u1|u2|underline-position|underline-thickness|unicode|unicode-range|units-per-em|values|version|viewBox|visibility|width|widths|x|x-height|x1|x2|xlink:actuate|xlink:arcrole|xlink:role|xlink:show|xlink:title|xlink:type|xml:base|xml:lang|xml:space|xmlns|xmlns:xlink|y|y1|y2|zoomAndPan)","g"),reXSSAttr=/href|src|background/i,reXSSAttrValue=/((java|vb|live)script|x):/i,reOnEvent=/^on\S+/i,reComment=/<!--[\s\S]*?-->/g,DEFAULT_TAG_BLACK_LIST,CAN_BE_TAG_WHITE_LIST=["iframe","embed","details","summary"],tagBlacklist=__spreadArray([],["script","iframe","textarea","form","button","select","input","meta","style","link","title","embed","object","details","summary"]);function registerTagWhitelistIfPossible(tagName){common_includes(CAN_BE_TAG_WHITE_LIST,tagName)&&tagBlacklist.splice(tagBlacklist.indexOf(tagName),1)}function sanitizeHTML(html){var root=document.createElement("div");return isString_default()(html)&&(html=html.replace(reComment,""),root.innerHTML=html),removeUnnecessaryTags(root),leaveOnlyWhitelistAttribute(root),finalizeHtml(root,!0)}function removeUnnecessaryTags(html){var removedTags;findNodes(html,tagBlacklist.join(",")).forEach((function(node){removeNode(node)}))}function isXSSAttribute(attrName,attrValue){return attrName.match(reXSSAttr)&&attrValue.match(reXSSAttrValue)}function removeBlacklistAttributes(node,blacklistAttrs){blacklistAttrs.forEach((function(_a){var name=_a.name;reOnEvent.test(name)&&(node[name]=null),node.getAttribute(name)&&node.removeAttribute(name)}))}function leaveOnlyWhitelistAttribute(html){findNodes(html,"*").forEach((function(node){var attributes=node.attributes,blacklist;removeBlacklistAttributes(node,toArray_default()(attributes).filter((function(attr){var name=attr.name,value=attr.value,htmlAttr=name.match(reXSSHtmlAttr),svgAttr=name.match(reXSSSvgAttr),xssAttr=htmlAttr&&isXSSAttribute(name,value);return!htmlAttr&&!svgAttr||xssAttr})))}))}function sanitizeXSSAttributeValue(attrValue){return attrValue=attrValue.replace(reComment,""),reXSSAttrValue.test(attrValue)?"":attrValue}function getChildrenHTML(node,typeName){return node.literal.replace(new RegExp("(<\\s*"+typeName+"[^>]+?>)|(</"+typeName+"\\s*[>])","ig"),"").trim()}function getHTMLAttrsByHTMLString(html){var attrs=(html=html.match(reHTMLTag)[0]).match(new RegExp(ATTRIBUTE,"g"));return attrs?attrs.reduce((function(acc,attr){var _a=attr.trim().split("="),name=_a[0],values=_a.slice(1);return values.length&&(acc[name]=values.join("=").replace(/'|"/g,"").trim()),acc}),{}):{}}function getHTMLAttrs(dom){return toArray_default()(dom.attributes).reduce((function(acc,attr){return acc[attr.nodeName]=attr.nodeValue,acc}),{})}function sanitizeDOM(node,typeName,sanitizer,wwToDOMAdaptor){var dom=wwToDOMAdaptor.getToDOMNode(typeName)(node),html=sanitizer(dom.outerHTML),container=document.createElement("div"),htmlAttrs;return container.innerHTML=html,{dom:dom=container.firstChild,htmlAttrs:getHTMLAttrs(dom)}}var schemaFactory={htmlBlock:function(typeName,sanitizeHTML,wwToDOMAdaptor){return{atom:!0,content:"block+",group:"block",attrs:{htmlAttrs:{default:{}},childrenHTML:{default:""},htmlBlock:{default:!0}},parseDOM:[{tag:typeName,getAttrs:function(dom){return{htmlAttrs:getHTMLAttrs(dom),childrenHTML:dom.innerHTML}}}],toDOM:function(node){var _a=sanitizeDOM(node,typeName,sanitizeHTML,wwToDOMAdaptor),dom=_a.dom,htmlAttrs=_a.htmlAttrs;return htmlAttrs.class=htmlAttrs.class?htmlAttrs.class+" html-block":"html-block",__spreadArray([typeName,htmlAttrs],toArray_default()(dom.childNodes))}}},htmlInline:function(typeName,sanitizeHTML,wwToDOMAdaptor){return{attrs:{htmlAttrs:{default:{}},htmlInline:{default:!0}},parseDOM:[{tag:typeName,getAttrs:function(dom){return{htmlAttrs:getHTMLAttrs(dom)}}}],toDOM:function(node){var htmlAttrs=sanitizeDOM(node,typeName,sanitizeHTML,wwToDOMAdaptor).htmlAttrs;return[typeName,htmlAttrs,0]}}}};function createHTMLSchemaMap(convertorMap,sanitizeHTML,wwToDOMAdaptor){var htmlSchemaMap={nodes:{},marks:{}};return["htmlBlock","htmlInline"].forEach((function(htmlType){convertorMap[htmlType]&&Object.keys(convertorMap[htmlType]).forEach((function(type){var targetType="htmlBlock"===htmlType?"nodes":"marks";registerTagWhitelistIfPossible(type),htmlSchemaMap[targetType][type]=schemaFactory[htmlType](type,sanitizeHTML,wwToDOMAdaptor)}))})),htmlSchemaMap}var reCloseTag=/^\s*<\s*\//,htmlRenderConvertors_baseConvertors={paragraph:function(_,_a){var entering=_a.entering,origin=_a.origin,options;return _a.options.nodeId?{type:entering?"openTag":"closeTag",outerNewLine:!0,tagName:"p"}:origin()},softbreak:function(node){var isPrevNodeHTML,isPrevBR,content;return{type:"html",content:node.prev&&"htmlInline"===node.prev.type&&/<br ?\/?>/.test(node.prev.literal)?"\n":"<br>\n"}},item:function(node,_a){var entering;if(_a.entering){var attributes={},classNames=[];return node.listData.task&&(attributes["data-task"]="",classNames.push("task-list-item"),node.listData.checked&&(classNames.push("checked"),attributes["data-task-checked"]="")),{type:"openTag",tagName:"li",classNames:classNames,attributes:attributes,outerNewLine:!0}}return{type:"closeTag",tagName:"li",outerNewLine:!0}},code:function(node){var attributes;return[{type:"openTag",tagName:"code",attributes:{"data-backticks":String(node.tickCount)}},{type:"text",content:node.literal},{type:"closeTag",tagName:"code"}]},codeBlock:function(node){var _a=node,fenceLength=_a.fenceLength,info=_a.info,infoWords=info?info.split(/\s+/):[],preClasses=[],codeAttrs={};if(fenceLength>3&&(codeAttrs["data-backticks"]=fenceLength),infoWords.length>0&&infoWords[0].length>0){var lang=infoWords[0];preClasses.push("lang-"+lang),codeAttrs["data-language"]=lang}return[{type:"openTag",tagName:"pre",classNames:preClasses},{type:"openTag",tagName:"code",attributes:codeAttrs},{type:"text",content:node.literal},{type:"closeTag",tagName:"code"},{type:"closeTag",tagName:"pre"}]},customInline:function(node,_a){var origin=_a.origin,entering=_a.entering,skipChildren=_a.skipChildren,info=node.info,content,htmlInline;return-1!==info.indexOf("widget")&&entering?(skipChildren(),[{type:"openTag",tagName:"span",classNames:["tui-widget"]},{type:"html",content:widgetToDOM(info,getWidgetContent(node)).outerHTML},{type:"closeTag",tagName:"span"}]):origin()}};function getHTMLRenderConvertors(linkAttributes,customConvertors){var convertors=__assign({},htmlRenderConvertors_baseConvertors);return linkAttributes&&(convertors.link=function(_,_a){var entering=_a.entering,origin,result=(0,_a.origin)();return entering&&(result.attributes=__assign(__assign({},result.attributes),linkAttributes)),result}),customConvertors&&Object.keys(customConvertors).forEach((function(nodeType){var orgConvertor=convertors[nodeType],customConvertor=customConvertors[nodeType];orgConvertor&&isFunction_default()(customConvertor)?convertors[nodeType]=function(node,context){var newContext=__assign({},context);return newContext.origin=function(){return orgConvertor(node,context)},customConvertor(node,newContext)}:common_includes(["htmlBlock","htmlInline"],nodeType)&&!isFunction_default()(customConvertor)?convertors[nodeType]=function(node,context){var matched=node.literal.match(reHTMLTag);if(matched){var rootHTML=matched[0],openTagName=matched[1],closeTagName=matched[3],typeName=(openTagName||closeTagName).toLowerCase(),htmlConvertor=customConvertor[typeName],childrenHTML=getChildrenHTML(node,typeName);if(htmlConvertor){var newNode=__assign({},node);return newNode.attrs=getHTMLAttrsByHTMLString(rootHTML),newNode.childrenHTML=childrenHTML,newNode.type=typeName,context.entering=!reCloseTag.test(node.literal),htmlConvertor(newNode,context)}}return context.origin()}:convertors[nodeType]=customConvertor})),convertors}var nestableTypes=["list","item","blockQuote"],nestableTagNames=["UL","OL","BLOCKQUOTE"];function isBlankLine(doc,index){var _a,pmNode=doc.child(index);return!pmNode.childCount||1===pmNode.childCount&&!(null===(_a=pmNode.firstChild.text)||void 0===_a?void 0:_a.trim())}function getNextNonBlankElement(mdNode){for(var next=mdNode.next,parent=mdNode.parent;!next&&parent;)next=parent.next,parent=parent.parent;return next?document.querySelector('[data-nodeid="'+next.id+'"]'):null}function getEditorRangeHeightInfo(doc,mdNode,children){var start=getMdStartLine(mdNode)-1,end=getMdEndLine(mdNode)-1,rect=children[start].getBoundingClientRect(),height=children[end].offsetTop-children[start].offsetTop+children[end].clientHeight;return{height:height<=0?children[start].clientHeight:height+getBlankLinesHeight(doc,children,Math.min(end+1,doc.childCount-1)),rect:rect}}function getBlankLinesHeight(doc,children,start){for(var end=doc.childCount-1,height=0;start<=end&&isBlankLine(doc,start);)height+=children[start].clientHeight,start+=1;return height}function findAncestorHavingId(el,root){for(;!el.getAttribute("data-nodeid")&&el.parentElement!==root;)el=el.parentElement;return el}function getTotalOffsetTop(el,root){for(var offsetTop=0;el&&el!==root&&(common_includes(nestableTagNames,el.tagName)||(offsetTop+=el.offsetTop),el.offsetParent!==root.offsetParent);)el=el.parentElement;return offsetTop}function findAdjacentElementToScrollTop(scrollTop,root){for(var el=root,prev=null;el;){var firstElementChild=el.firstElementChild,lastSibling;if(!firstElementChild)break;prev=el,el=findLastSiblingElementToScrollTop(firstElementChild,scrollTop,getTotalOffsetTop(el,root))}var adjacentEl=el||prev;return adjacentEl===root?null:adjacentEl}function findLastSiblingElementToScrollTop(el,scrollTop,offsetTop){return el&&scrollTop>offsetTop+el.offsetTop?findLastSiblingElementToScrollTop(el.nextElementSibling,scrollTop,offsetTop)||el:null}function getAdditionalPos(scrollTop,offsetTop,height,targetNodeHeight){var ratio;return Math.min((scrollTop-offsetTop)/height,1)*targetNodeHeight}function getParentNodeObj(mdNode){for(var el=document.querySelector('[data-nodeid="'+mdNode.id+'"]');!el||isStyledInlineNode(mdNode);)mdNode=mdNode.parent,el=document.querySelector('[data-nodeid="'+mdNode.id+'"]');return getNonNestableNodeObj({mdNode:mdNode,el:el})}function getNonNestableNodeObj(_a){for(var mdNode=_a.mdNode,el=_a.el;(common_includes(nestableTypes,mdNode.type)||"table"===mdNode.type)&&mdNode.firstChild;)mdNode=mdNode.firstChild,el=el.firstElementChild;return{mdNode:mdNode,el:el}}var offsetInfoMap={};function setHeight(id,height){offsetInfoMap[id]=offsetInfoMap[id]||{},offsetInfoMap[id].height=height}function setOffsetTop(id,offsetTop){offsetInfoMap[id]=offsetInfoMap[id]||{},offsetInfoMap[id].offsetTop=offsetTop}function getHeight(id){return offsetInfoMap[id]&&offsetInfoMap[id].height}function getOffsetTop(id){return offsetInfoMap[id]&&offsetInfoMap[id].offsetTop}function removeOffsetInfoByNode(node){node&&(delete offsetInfoMap[Number(node.getAttribute("data-nodeid"))],toArray_default()(node.children).forEach((function(child){removeOffsetInfoByNode(child)})))}function getAndSaveOffsetInfo(node,root,mdNodeId){var cachedHeight=getHeight(mdNodeId),cachedTop=getOffsetTop(mdNodeId),nodeHeight=cachedHeight||node.clientHeight,offsetTop=cachedTop||getTotalOffsetTop(node,root)||node.offsetTop;return cachedHeight||setHeight(mdNodeId,nodeHeight),cachedTop||setOffsetTop(mdNodeId,offsetTop),{nodeHeight:nodeHeight,offsetTop:offsetTop}}var CLASS_HIGHLIGHT=cls("md-preview-highlight");function findTableCell(tableRow,chOffset){for(var cell=tableRow.firstChild;cell&&cell.next&&!(getMdStartCh(cell.next)>chOffset+1);)cell=cell.next;return cell}var MarkdownPreview,mdPreview=function(){function MarkdownPreview(eventEmitter,options){var el=document.createElement("div");this.el=el,this.eventEmitter=eventEmitter,this.isViewer=!!options.isViewer,this.el.className=cls("md-preview");var linkAttributes=options.linkAttributes,customHTMLRenderer=options.customHTMLRenderer,sanitizer=options.sanitizer,_a=options.highlight,highlight=void 0!==_a&&_a;this.renderer=new Renderer({gfm:!0,nodeId:!0,convertors:getHTMLRenderConvertors(linkAttributes,customHTMLRenderer)}),this.cursorNodeId=null,this.sanitizer=sanitizer,this.initEvent(highlight),this.initContentSection()}return MarkdownPreview.prototype.initContentSection=function(){this.previewContent=createElementWith('<div class="'+cls("contents")+'"></div>'),this.el.appendChild(this.previewContent)},MarkdownPreview.prototype.toggleActive=function(active){toggleClass(this.el,"active",active)},MarkdownPreview.prototype.initEvent=function(highlight){var _this=this;this.eventEmitter.listen("updatePreview",this.update.bind(this)),highlight&&(this.eventEmitter.listen("changeToolbarState",(function(_a){var mdNode=_a.mdNode,cursorPos=_a.cursorPos;_this.updateCursorNode(mdNode,cursorPos)})),this.eventEmitter.listen("blur",(function(){_this.removeHighlight()}))),on_default()(this.el,"scroll",(function(event){_this.eventEmitter.emit("scroll","preview",findAdjacentElementToScrollTop(event.target.scrollTop,_this.previewContent))})),this.eventEmitter.listen("changePreviewTabPreview",(function(){return _this.toggleActive(!0)})),this.eventEmitter.listen("changePreviewTabWrite",(function(){return _this.toggleActive(!1)}))},MarkdownPreview.prototype.removeHighlight=function(){if(this.cursorNodeId){var currentEl=this.getElementByNodeId(this.cursorNodeId);currentEl&&removeClass_default()(currentEl,CLASS_HIGHLIGHT)}},MarkdownPreview.prototype.updateCursorNode=function(cursorNode,cursorPos){cursorNode&&("tableRow"===(cursorNode=findClosestNode(cursorNode,(function(mdNode){return!isInlineNode(mdNode)}))).type?cursorNode=findTableCell(cursorNode,cursorPos[1]):"tableBody"===cursorNode.type&&(cursorNode=null));var cursorNodeId=cursorNode?cursorNode.id:null;if(this.cursorNodeId!==cursorNodeId){var oldEL=this.getElementByNodeId(this.cursorNodeId),newEL=this.getElementByNodeId(cursorNodeId);oldEL&&removeClass_default()(oldEL,CLASS_HIGHLIGHT),newEL&&addClass_default()(newEL,CLASS_HIGHLIGHT),this.cursorNodeId=cursorNodeId}},MarkdownPreview.prototype.getElementByNodeId=function(nodeId){return nodeId?this.previewContent.querySelector('[data-nodeid="'+nodeId+'"]'):null},MarkdownPreview.prototype.update=function(changed){var _this=this;changed.forEach((function(editResult){return _this.replaceRangeNodes(editResult)})),this.eventEmitter.emit("afterPreviewRender",this)},MarkdownPreview.prototype.replaceRangeNodes=function(editResult){var _this=this,nodes=editResult.nodes,removedNodeRange=editResult.removedNodeRange,contentEl=this.previewContent,newHtml=this.eventEmitter.emitReduce("beforePreviewRender",this.sanitizer(nodes.map((function(node){return _this.renderer.render(node)})).join("")));if(removedNodeRange){var _a=removedNodeRange.id,startNodeId=_a[0],endNodeId=_a[1],startEl=this.getElementByNodeId(startNodeId),endEl=this.getElementByNodeId(endNodeId);if(startEl){startEl.insertAdjacentHTML("beforebegin",newHtml);for(var el=startEl;el&&el!==endEl;){var nextEl=el.nextElementSibling;removeNode(el),removeOffsetInfoByNode(el),el=nextEl}(null==el?void 0:el.parentNode)&&(removeNode(el),removeOffsetInfoByNode(el))}}else contentEl.insertAdjacentHTML("afterbegin",newHtml)},MarkdownPreview.prototype.getRenderer=function(){return this.renderer},MarkdownPreview.prototype.destroy=function(){off_default()(this.el,"scroll"),this.el=null},MarkdownPreview.prototype.getElement=function(){return this.el},MarkdownPreview.prototype.getHTML=function(){return this.previewContent.innerHTML},MarkdownPreview.prototype.setHTML=function(html){this.previewContent.innerHTML=html},MarkdownPreview.prototype.setHeight=function(height){css_default()(this.el,{height:height+"px"})},MarkdownPreview.prototype.setMinHeight=function(minHeight){css_default()(this.el,{minHeight:minHeight+"px"})},MarkdownPreview}();function findNodeBy(pos,condition){for(var depth=pos.depth;depth;){var node=pos.node(depth);if(condition(node,depth))return{node:node,depth:depth,offset:depth>0?pos.before(depth):0};depth-=1}return null}function node_isListNode(_a){var type=_a.type;return"bulletList"===type.name||"orderedList"===type.name}function isInListNode(pos){return!!findNodeBy(pos,(function(_a){var type=_a.type;return"listItem"===type.name||"bulletList"===type.name||"orderedList"===type.name}))}function isInTableNode(pos){return!!findNodeBy(pos,(function(_a){var type=_a.type;return"tableHeadCell"===type.name||"tableBodyCell"===type.name}))}function findListItem(pos){return findNodeBy(pos,(function(_a){var type;return"listItem"===_a.type.name}))}function createDOMInfoParsedRawHTML(tag){return{tag:tag,getAttrs:function(dom){var rawHTML=dom.getAttribute("data-raw-html");return __assign({},rawHTML&&{rawHTML:rawHTML})}}}function createCellAttrs(attrs){return Object.keys(attrs).reduce((function(acc,attrName){return"rawHTML"!==attrName&&attrs[attrName]&&(acc[attrName="className"===attrName?"class":attrName]=attrs[attrName]),acc}),{})}function createParsedCellDOM(tag){return{tag:tag,getAttrs:function(dom){return["rawHTML","colspan","rowspan","extended"].reduce((function(acc,attrName){var attrNameInDOM="rawHTML"===attrName?"data-raw-html":attrName,attrValue=dom.getAttribute(attrNameInDOM);return attrValue&&(acc[attrName]=common_includes(["rawHTML","extended"],attrName)?attrValue:Number(attrValue)),acc}),{})}}}function getDefaultCustomAttrs(){return{htmlAttrs:{default:null},classNames:{default:null}}}function getCustomAttrs(attrs){var htmlAttrs=attrs.htmlAttrs,classNames=attrs.classNames;return __assign(__assign({},htmlAttrs),{class:classNames?classNames.join(" "):null})}function list_findWrappingOutside(range,type){var parent=range.parent,startIndex=range.startIndex,endIndex=range.endIndex,around=parent.contentMatchAt(startIndex).findWrapping(type);if(around){var outer=around.length?around[0]:type;return parent.canReplaceWith(startIndex,endIndex,outer)?around:null}return null}function list_findWrappingInside(range,type){var parent=range.parent,startIndex=range.startIndex,endIndex=range.endIndex,inner=parent.child(startIndex),inside=type.contentMatch.findWrapping(inner.type);if(inside){for(var lastType,innerMatch=(inside.length?inside[inside.length-1]:type).contentMatch,i=startIndex;innerMatch&&i<endIndex;i+=1)innerMatch=innerMatch.matchType(parent.child(i).type);if(innerMatch&&innerMatch.validEnd)return inside}return null}function findWrappers(range,innerRange,nodeType,attrs){var around=list_findWrappingOutside(range,nodeType),inner=list_findWrappingInside(innerRange,nodeType);if(around&&inner){var aroundNodes=around.map((function(type){return{type:type}})),innerNodes=inner.map((function(type){return{type:type,attrs:attrs}}));return aroundNodes.concat({type:nodeType}).concat(innerNodes)}return null}function wrapInList(tr,_a,wrappers,joinBefore,list){for(var start=_a.start,end=_a.end,startIndex=_a.startIndex,endIndex=_a.endIndex,parent=_a.parent,content=Fragment.empty,i=wrappers.length-1;i>=0;i-=1)content=Fragment.from(wrappers[i].type.create(wrappers[i].attrs,content));tr.step(new ReplaceAroundStep(start-(joinBefore?2:0),end,start,end,new Slice(content,0,0),wrappers.length,!0));for(var foundListIndex=0,i=0;i<wrappers.length;i+=1)if(wrappers[i].type===list){foundListIndex=i+1;break}for(var splitDepth=wrappers.length-foundListIndex,splitPos=start+wrappers.length-(joinBefore?2:0),i=startIndex,len=endIndex;i<len;i+=1){var first;!(i===startIndex)&&canSplit(tr.doc,splitPos,splitDepth)&&(tr.split(splitPos,splitDepth),splitPos+=2*splitDepth),splitPos+=parent.child(i).nodeSize}return tr}function changeToList(tr,range,list,attrs){var $from=range.$from,$to=range.$to,depth=range.depth,outerRange=range,joinBefore=!1;if(depth>=2&&$from.node(depth-1).type.compatibleContent(list)&&0===range.startIndex&&$from.index(depth-1)){var start=tr.doc.resolve(range.start-2);outerRange=new NodeRange(start,start,depth),range.endIndex<range.parent.childCount&&(range=new NodeRange($from,tr.doc.resolve($to.end(depth)),depth)),joinBefore=!0}var wrappers=findWrappers(outerRange,range,list,attrs);return wrappers?wrapInList(tr,range,wrappers,joinBefore,list):tr}function getBeforeLineListItem(doc,offset){for(var endListItemPos=doc.resolve(offset);"paragraph"!==endListItemPos.node().type.name;)offset-=2,endListItemPos=doc.resolve(offset);return findListItem(endListItemPos)}function toggleTaskListItems(tr,_a){var $from=_a.$from,$to=_a.$to,startListItem=findListItem($from),endListItem=findListItem($to);if(startListItem&&endListItem)for(;endListItem;){var offset=endListItem.offset,node,attrs={task:!endListItem.node.attrs.task,checked:!1};if(tr.setNodeMarkup(offset,null,attrs),offset===startListItem.offset)break;endListItem=getBeforeLineListItem(tr.doc,offset)}return tr}function changeListType(tr,_a,list){var $from=_a.$from,$to=_a.$to,startListItem=findListItem($from),endListItem=findListItem($to);if(startListItem&&endListItem)for(;endListItem;){var offset=endListItem.offset,node=endListItem.node,depth=endListItem.depth;node.attrs.task&&tr.setNodeMarkup(offset,null,{task:!1,checked:!1});var resolvedPos=tr.doc.resolve(offset);if(resolvedPos.parent.type!==list){var parentOffset=resolvedPos.before(depth-1);tr.setNodeMarkup(parentOffset,list)}if(offset===startListItem.offset)break;endListItem=getBeforeLineListItem(tr.doc,offset)}return tr}function changeList(list){return function(_a,dispatch){var selection=_a.selection,tr=_a.tr,$from=selection.$from,$to=selection.$to,range=$from.blockRange($to),newTr;return!!range&&(dispatch(isInListNode($from)?changeListType(tr,range,list):changeToList(tr,range,list)),!0)}}function toggleTask(){return function(_a,dispatch){var selection=_a.selection,tr=_a.tr,schema=_a.schema,$from=selection.$from,$to=selection.$to,range=$from.blockRange($to),newTr;return!!range&&(dispatch(isInListNode($from)?toggleTaskListItems(tr,range):changeToList(tr,range,schema.nodes.bulletList,{task:!0})),!0)}}function sinkListItem(listItem){return function(_a,dispatch){var tr=_a.tr,selection=_a.selection,$from=selection.$from,$to=selection.$to,range=$from.blockRange($to,(function(_a){var childCount=_a.childCount,firstChild=_a.firstChild;return!!childCount&&firstChild.type===listItem}));if(range&&range.startIndex>0){var parent=range.parent,nodeBefore=parent.child(range.startIndex-1);if(nodeBefore.type!==listItem)return!1;var nestedBefore=nodeBefore.lastChild&&nodeBefore.lastChild.type===parent.type,inner=nestedBefore?Fragment.from(listItem.create()):null,slice=new Slice(Fragment.from(listItem.create(null,Fragment.from(parent.type.create(null,inner)))),nestedBefore?3:1,0),before=range.start,after=range.end;return tr.step(new ReplaceAroundStep(before-(nestedBefore?3:1),after,before,after,slice,1,!0)),dispatch(tr),!0}return!1}}function liftToOuterList(tr,range,listItem){var $from=range.$from,$to=range.$to,end=range.end,depth=range.depth,parent=range.parent,endOfList=$to.end(depth);return end<endOfList&&(tr.step(new ReplaceAroundStep(end-1,endOfList,end,endOfList,new Slice(Fragment.from(listItem.create(null,parent.copy())),1,0),1,!0)),range=new NodeRange(tr.doc.resolve($from.pos),tr.doc.resolve(endOfList),depth)),tr.lift(range,index_es_liftTarget(range)),tr}function liftOutOfList(tr,range){for(var list=range.parent,pos=range.end,i=range.endIndex-1,len=range.startIndex;i>len;i-=1)pos-=list.child(i).nodeSize,tr.delete(pos-1,pos+1);var startPos=tr.doc.resolve(range.start),listItem=startPos.nodeAfter,atStart=0===range.startIndex,atEnd=range.endIndex===list.childCount,parent=startPos.node(-1),indexBefore=startPos.index(-1),canReplaceParent=parent.canReplace(indexBefore+(atStart?0:1),indexBefore+1,null==listItem?void 0:listItem.content.append(atEnd?Fragment.empty:Fragment.from(list)));if(listItem&&canReplaceParent){var start=startPos.pos,end=start+listItem.nodeSize;tr.step(new ReplaceAroundStep(start-(atStart?1:0),end+(atEnd?1:0),start+1,end-1,new Slice((atStart?Fragment.empty:Fragment.from(list.copy(Fragment.empty))).append(atEnd?Fragment.empty:Fragment.from(list.copy(Fragment.empty))),atStart?0:1,atEnd?0:1),atStart?0:1))}return tr}function liftListItem(listItem){return function(_a,dispatch){var tr=_a.tr,selection=_a.selection,$from=selection.$from,$to=selection.$to,range=$from.blockRange($to,(function(_a){var childCount=_a.childCount,firstChild=_a.firstChild;return!!childCount&&firstChild.type===listItem})),topListItem,newTr;return!!range&&(dispatch($from.node(range.depth-1).type===listItem?liftToOuterList(tr,range,listItem):liftOutOfList(tr,range)),!0)}}function splitListItem(listItem){return function(_a,dispatch){var tr=_a.tr,selection=_a.selection,$from=selection.$from,$to=selection.$to;if($from.depth<2||!$from.sameParent($to))return!1;var grandParent=$from.node(-1);if(grandParent.type!==listItem)return!1;if(0===$from.parent.content.size&&$from.node(-1).childCount===$from.indexAfter(-1)){if(2===$from.depth||$from.node(-3).type!==listItem||$from.index(-2)!==$from.node(-2).childCount-1)return!1;for(var keepItem=$from.index(-1)>0,wrapper=Fragment.empty,depth=$from.depth-(keepItem?1:2);depth>=$from.depth-3;depth-=1)wrapper=Fragment.from($from.node(depth).copy(wrapper));return wrapper=wrapper.append(Fragment.from(listItem.createAndFill())),tr.replace(keepItem?$from.before():$from.before(-1),$from.after(-3),new Slice(wrapper,keepItem?3:2,2)),tr.setSelection(Selection.near(tr.doc.resolve($from.pos+(keepItem?3:2)))),dispatch(tr),!0}var nextType=$to.pos===$from.end()?grandParent.contentMatchAt(0).defaultType:null,types=nextType&&[null,{type:nextType}];return tr.delete($from.pos,$to.pos),!!canSplit(tr.doc,$from.pos,2,types)&&(tr.split($from.pos,2,types),dispatch(tr),!0)}}function indent(){return function(){return function(state,dispatch){var selection=state.selection,schema=state.schema,$from=selection.$from,$to=selection.$to,range;return!(!$from.blockRange($to)||!isInListNode($from))&&sinkListItem(schema.nodes.listItem)(state,dispatch)}}}function outdent(){return function(){return function(state,dispatch){var selection=state.selection,schema=state.schema,$from=selection.$from,$to=selection.$to,range;return!(!$from.blockRange($to)||!isInListNode($from))&&liftListItem(schema.nodes.listItem)(state,dispatch)}}}function getWwCommands(){return{indent:indent(),outdent:outdent()}}var cache=new Map,TableOffsetMap=function(){function TableOffsetMap(table,tableRows,tableStartPos,rowInfo){this.table=table,this.tableRows=tableRows,this.tableStartPos=tableStartPos,this.rowInfo=rowInfo}return TableOffsetMap.create=function(cellPos){var table=findNodeBy(cellPos,(function(_a){var type;return"table"===_a.type.name}));if(table){var node=table.node,depth=table.depth,offset=table.offset,cached=cache.get(node);if((null==cached?void 0:cached.tableStartPos)===offset+1)return cached;var rows_1=[],tablePos=cellPos.start(depth),thead=node.child(0),tbody=node.child(1),theadCellInfo=createOffsetMap(thead,tablePos),tbodyCellInfo=createOffsetMap(tbody,tablePos+thead.nodeSize);thead.forEach((function(row){return rows_1.push(row)})),tbody.forEach((function(row){return rows_1.push(row)}));var map=new TableOffsetMap(node,rows_1,tablePos,theadCellInfo.concat(tbodyCellInfo));return cache.set(node,map),map}return null},Object.defineProperty(TableOffsetMap.prototype,"totalRowCount",{get:function(){return this.rowInfo.length},enumerable:!1,configurable:!0}),Object.defineProperty(TableOffsetMap.prototype,"totalColumnCount",{get:function(){return this.rowInfo[0].length},enumerable:!1,configurable:!0}),Object.defineProperty(TableOffsetMap.prototype,"tableStartOffset",{get:function(){return this.tableStartPos},enumerable:!1,configurable:!0}),Object.defineProperty(TableOffsetMap.prototype,"tableEndOffset",{get:function(){return this.tableStartPos+this.table.nodeSize-1},enumerable:!1,configurable:!0}),TableOffsetMap.prototype.getCellInfo=function(rowIdx,colIdx){return this.rowInfo[rowIdx][colIdx]},TableOffsetMap.prototype.posAt=function(rowIdx,colIdx){for(var i=0,rowStart=this.tableStartPos;;i+=1){var rowEnd=rowStart+this.tableRows[i].nodeSize;if(i===rowIdx){for(var index=colIdx;index<this.totalColumnCount&&this.rowInfo[i][index].offset<rowStart;)index+=1;return index===this.totalColumnCount?rowEnd:this.rowInfo[i][index].offset}rowStart=rowEnd}},TableOffsetMap.prototype.getNodeAndPos=function(rowIdx,colIdx){var cellInfo=this.rowInfo[rowIdx][colIdx];return{node:this.table.nodeAt(cellInfo.offset-1),pos:cellInfo.offset}},TableOffsetMap.prototype.extendedRowspan=function(rowIdx,colIdx){return!1},TableOffsetMap.prototype.extendedColspan=function(rowIdx,colIdx){return!1},TableOffsetMap.prototype.getRowspanCount=function(rowIdx,colIdx){return 0},TableOffsetMap.prototype.getColspanCount=function(rowIdx,colIdx){return 0},TableOffsetMap.prototype.decreaseColspanCount=function(rowIdx,colIdx){return 0},TableOffsetMap.prototype.decreaseRowspanCount=function(rowIdx,colIdx){return 0},TableOffsetMap.prototype.getColspanStartInfo=function(rowIdx,colIdx){return null},TableOffsetMap.prototype.getRowspanStartInfo=function(rowIdx,colIdx){return null},TableOffsetMap.prototype.getCellStartOffset=function(rowIdx,colIdx){var offset=this.rowInfo[rowIdx][colIdx].offset;return this.extendedRowspan(rowIdx,colIdx)?this.posAt(rowIdx,colIdx):offset},TableOffsetMap.prototype.getCellEndOffset=function(rowIdx,colIdx){var _a=this.rowInfo[rowIdx][colIdx],offset=_a.offset,nodeSize=_a.nodeSize;return this.extendedRowspan(rowIdx,colIdx)?this.posAt(rowIdx,colIdx):offset+nodeSize},TableOffsetMap.prototype.getCellIndex=function(cellPos){for(var rowIdx=0;rowIdx<this.totalRowCount;rowIdx+=1)for(var rowInfo=this.rowInfo[rowIdx],colIdx=0;colIdx<this.totalColumnCount;colIdx+=1)if(rowInfo[colIdx].offset+1>cellPos.pos)return[rowIdx,colIdx];return[0,0]},TableOffsetMap.prototype.getRectOffsets=function(startCellPos,endCellPos){var _a,_b,_c;void 0===endCellPos&&(endCellPos=startCellPos),startCellPos.pos>endCellPos.pos&&(startCellPos=(_a=[endCellPos,startCellPos])[0],endCellPos=_a[1]);var _d=this.getCellIndex(startCellPos),startRowIdx=_d[0],startColIdx=_d[1],_e=this.getCellIndex(endCellPos),endRowIdx=_e[0],endColIdx=_e[1];return startRowIdx=(_b=getSortedNumPair(startRowIdx,endRowIdx))[0],endRowIdx=_b[1],startColIdx=(_c=getSortedNumPair(startColIdx,endColIdx))[0],endColIdx=_c[1],this.getSpannedOffsets({startRowIdx:startRowIdx,startColIdx:startColIdx,endRowIdx:endRowIdx,endColIdx:endColIdx})},TableOffsetMap.prototype.getSpannedOffsets=function(selectionInfo){return selectionInfo},TableOffsetMap}(),createOffsetMap=function(headOrBody,startOffset){var cellInfoMatrix=[];return headOrBody.forEach((function(row,rowOffset){var rowInfo={rowspanMap:{},colspanMap:{},length:0};row.forEach((function(_a,cellOffset){for(var nodeSize=_a.nodeSize,colIdx=0;rowInfo[colIdx];)colIdx+=1;rowInfo[colIdx]={offset:startOffset+rowOffset+cellOffset+2,nodeSize:nodeSize},rowInfo.length+=1})),cellInfoMatrix.push(rowInfo)})),cellInfoMatrix};function mixinTableOffsetMapPrototype(offsetMapMixin,createOffsetMapMixin){return common_assign(TableOffsetMap.prototype,offsetMapMixin),createOffsetMap=createOffsetMapMixin,TableOffsetMap}function getSelectionRanges(doc,map,_a){for(var startRowIdx=_a.startRowIdx,startColIdx=_a.startColIdx,endRowIdx=_a.endRowIdx,endColIdx=_a.endColIdx,ranges=[],rowIdx=startRowIdx;rowIdx<=endRowIdx;rowIdx+=1)for(var colIdx=startColIdx;colIdx<=endColIdx;colIdx+=1){var _b=map.getCellInfo(rowIdx,colIdx),offset=_b.offset,nodeSize=_b.nodeSize;ranges.push(new SelectionRange(doc.resolve(offset+1),doc.resolve(offset+nodeSize-1)))}return ranges}function createTableFragment(tableHead,tableBody){var fragment=[];return tableHead.childCount&&fragment.push(tableHead),tableBody.childCount&&fragment.push(tableBody),Fragment.from(fragment)}var CellSelection,selection_cellSelection=function(_super){function CellSelection(startCellPos,endCellPos){void 0===endCellPos&&(endCellPos=startCellPos);var _this=this,doc=startCellPos.node(0),map=TableOffsetMap.create(startCellPos),selectionInfo=map.getRectOffsets(startCellPos,endCellPos),ranges=getSelectionRanges(doc,map,selectionInfo);return(_this=_super.call(this,ranges[0].$from,ranges[0].$to,ranges)||this).startCell=startCellPos,_this.endCell=endCellPos,_this.offsetMap=map,_this.isCellSelection=!0,_this.visible=!1,_this}return __extends(CellSelection,_super),CellSelection.prototype.map=function(doc,mapping){var startPos=this.startCell.pos,endPos=this.endCell.pos,startCell=doc.resolve(mapping.map(startPos)),endCell=doc.resolve(mapping.map(endPos)),map=TableOffsetMap.create(startCell);if(this.offsetMap.totalColumnCount>map.totalColumnCount||this.offsetMap.totalRowCount>map.totalRowCount){var depthMap,depthFromTable={tableBody:1,tableRow:2,tableCell:3,paragraph:4}[endCell.parent.type.name],tableEndPos=endCell.end(endCell.depth-depthFromTable),from=Math.min(tableEndPos-4,endCell.pos);return TextSelection.create(doc,from)}return new CellSelection(startCell,endCell)},CellSelection.prototype.eq=function(cell){return cell instanceof CellSelection&&cell.startCell.pos===this.startCell.pos&&cell.endCell.pos===this.endCell.pos},CellSelection.prototype.content=function(){for(var table=this.startCell.node(-2),tableOffset=this.startCell.start(-2),row=table.child(1).firstChild,tableHead=table.child(0).type.create(),tableBody=table.child(1).type.create(),map=TableOffsetMap.create(this.startCell),selectionInfo=map.getRectOffsets(this.startCell,this.endCell),startRowIdx=selectionInfo.startRowIdx,startColIdx=selectionInfo.startColIdx,endRowIdx=selectionInfo.endRowIdx,endColIdx=selectionInfo.endColIdx,isTableHeadCell=!1,rowIdx=startRowIdx;rowIdx<=endRowIdx;rowIdx+=1){for(var cells=[],colIdx=startColIdx;colIdx<=endColIdx;colIdx+=1){var offset=map.getCellInfo(rowIdx,colIdx).offset,cell=table.nodeAt(offset-tableOffset);cell&&(isTableHeadCell="tableHeadCell"===cell.type.name,map.extendedRowspan(rowIdx,colIdx)||map.extendedColspan(rowIdx,colIdx)?cells.push(cell.type.create({extended:!0})):cells.push(cell.copy(cell.content)))}var copiedRow=row.copy(Fragment.from(cells)),targetNode=isTableHeadCell?tableHead:tableBody;targetNode.content=targetNode.content.append(Fragment.from(copiedRow))}return new Slice(createTableFragment(tableHead,tableBody),1,1)},CellSelection}(Selection);function createTableHeadRow(columnCount,schema,data){for(var _a=schema.nodes,tableRow=_a.tableRow,tableHeadCell=_a.tableHeadCell,paragraph=_a.paragraph,cells=[],index=0;index<columnCount;index+=1){var text=data&&data[index],para=paragraph.create(null,text?schema.text(text):[]);cells.push(tableHeadCell.create(null,para))}return[tableRow.create(null,cells)]}function createTableBodyRows(rowCount,columnCount,schema,data){for(var _a=schema.nodes,tableRow=_a.tableRow,tableBodyCell=_a.tableBodyCell,paragraph=_a.paragraph,tableRows=[],rowIdx=0;rowIdx<rowCount;rowIdx+=1){for(var cells=[],colIdx=0;colIdx<columnCount;colIdx+=1){var text=data&&data[rowIdx*columnCount+colIdx],para=paragraph.create(null,text?schema.text(text):[]);cells.push(tableBodyCell.create(null,para))}tableRows.push(tableRow.create(null,cells))}return tableRows}function createDummyCells(columnCount,rowIdx,schema,attrs){void 0===attrs&&(attrs=null);for(var _a=schema.nodes,tableHeadCell=_a.tableHeadCell,tableBodyCell=_a.tableBodyCell,paragraph=_a.paragraph,cell=0===rowIdx?tableHeadCell:tableBodyCell,cells=[],index=0;index<columnCount;index+=1)cells.push(cell.create(attrs,paragraph.create()));return cells}function findCellElement(node,root){for(;node&&node!==root;){if("TD"===node.nodeName||"TH"===node.nodeName)return node;node=node.parentNode}return null}function findCell(pos){return findNodeBy(pos,(function(_a){var type=_a.type;return"tableHeadCell"===type.name||"tableBodyCell"===type.name}))}function getResolvedSelection(selection){if(selection instanceof TextSelection){var $anchor=selection.$anchor,foundCell=findCell($anchor);if(foundCell){var anchor=$anchor.node(0).resolve($anchor.before(foundCell.depth));return{anchor:anchor,head:anchor}}}var _a=selection,startCell,endCell;return{anchor:_a.startCell,head:_a.endCell}}function getTableContentFromSlice(slice){var _a;if(slice.size){var content=slice.content,openStart=slice.openStart,openEnd=slice.openEnd;if(1!==content.childCount)return null;for(;1===content.childCount&&(openStart>0&&openEnd>0||"table"===(null===(_a=content.firstChild)||void 0===_a?void 0:_a.type.name));)openStart-=1,openEnd-=1,content=content.firstChild.content;if("tableHead"===content.firstChild.type.name||"tableBody"===content.firstChild.type.name)return content}return null}function getRowAndColumnCount(_a){var startRowIdx=_a.startRowIdx,startColIdx=_a.startColIdx,endRowIdx,endColIdx,rowCount,columnCount;return{rowCount:_a.endRowIdx-startRowIdx+1,columnCount:_a.endColIdx-startColIdx+1}}function setAttrs(cell,attrs){return __assign(__assign({},cell.attrs),attrs)}var tableSelectionView_pluginKey=new PluginKey("cellSelection"),MOUSE_RIGHT_BUTTON=2,TableSelection,tableSelectionView=function(){function TableSelection(view){this.view=view,this.handlers={mousedown:this.handleMousedown.bind(this),mousemove:this.handleMousemove.bind(this),mouseup:this.handleMouseup.bind(this)},this.startCellPos=null,this.init()}return TableSelection.prototype.init=function(){this.view.dom.addEventListener("mousedown",this.handlers.mousedown)},TableSelection.prototype.handleMousedown=function(ev){var foundCell=findCellElement(ev.target,this.view.dom);if(2!==ev.button){if(foundCell){var startCellPos=this.getCellPos(ev);startCellPos&&(this.startCellPos=startCellPos),this.bindEvent()}}else ev.preventDefault()},TableSelection.prototype.handleMousemove=function(ev){var prevEndCellOffset=tableSelectionView_pluginKey.getState(this.view.state),endCellPos=this.getCellPos(ev),startCellPos=this.startCellPos,prevEndCellPos;prevEndCellOffset?prevEndCellPos=this.view.state.doc.resolve(prevEndCellOffset):startCellPos!==endCellPos&&(prevEndCellPos=startCellPos),prevEndCellPos&&startCellPos&&endCellPos&&this.setCellSelection(startCellPos,endCellPos)},TableSelection.prototype.handleMouseup=function(){this.startCellPos=null,this.unbindEvent(),null!==tableSelectionView_pluginKey.getState(this.view.state)&&this.view.dispatch(this.view.state.tr.setMeta(tableSelectionView_pluginKey,-1))},TableSelection.prototype.bindEvent=function(){var dom=this.view.dom;dom.addEventListener("mousemove",this.handlers.mousemove),dom.addEventListener("mouseup",this.handlers.mouseup)},TableSelection.prototype.unbindEvent=function(){var dom=this.view.dom;dom.removeEventListener("mousemove",this.handlers.mousemove),dom.removeEventListener("mouseup",this.handlers.mouseup)},TableSelection.prototype.getCellPos=function(_a){var clientX=_a.clientX,clientY=_a.clientY,mousePos=this.view.posAtCoords({left:clientX,top:clientY});if(mousePos){var doc=this.view.state.doc,currentPos=doc.resolve(mousePos.pos),foundCell=findCell(currentPos);if(foundCell){var cellOffset=currentPos.before(foundCell.depth);return doc.resolve(cellOffset)}}return null},TableSelection.prototype.setCellSelection=function(startCellPos,endCellPos){var _a=this.view.state,selection=_a.selection,tr=_a.tr,starting=null===tableSelectionView_pluginKey.getState(this.view.state),cellSelection=new selection_cellSelection(startCellPos,endCellPos);if(starting||!selection.eq(cellSelection)){var newTr=tr.setSelection(cellSelection);starting&&newTr.setMeta(tableSelectionView_pluginKey,endCellPos.pos),this.view.dispatch(newTr)}},TableSelection.prototype.destroy=function(){this.view.dom.removeEventListener("mousedown",this.handlers.mousedown)},TableSelection}(),SELECTED_CELL_CLASS_NAME=cls("cell-selected");function drawCellSelection(_a){var selection=_a.selection,doc=_a.doc;if(selection instanceof selection_cellSelection){var cells_1=[],ranges;return selection.ranges.forEach((function(_a){var $from=_a.$from,$to=_a.$to;cells_1.push(Decoration.node($from.pos-1,$to.pos+1,{class:SELECTED_CELL_CLASS_NAME}))})),DecorationSet.create(doc,cells_1)}return null}function tableSelection(){return new Plugin({key:tableSelectionView_pluginKey,state:{init:function(){return null},apply:function(tr,value){var cellOffset=tr.getMeta(tableSelectionView_pluginKey);if(cellOffset)return-1===cellOffset?null:cellOffset;if(isNull_default()(value)||!tr.docChanged)return value;var _a=tr.mapping.mapResult(value),deleted=_a.deleted,pos=_a.pos;return deleted?null:pos}},props:{decorations:drawCellSelection,createSelectionBetween:function(_a){var state=_a.state;return isNull_default()(tableSelectionView_pluginKey.getState(state))?null:state.selection}},view:function(editorView){return new tableSelectionView(editorView)}})}var inArray=__webpack_require__(928),inArray_default=__webpack_require__.n(inArray),map_Map,utils_map=function(){function Map(){this.keys=[],this.values=[]}return Map.prototype.getKeyIndex=function(key){return inArray_default()(key,this.keys)},Map.prototype.get=function(key){return this.values[this.getKeyIndex(key)]},Map.prototype.set=function(key,value){var keyIndex=this.getKeyIndex(key);return keyIndex>-1?this.values[keyIndex]=value:(this.keys.push(key),this.values.push(value)),this},Map.prototype.has=function(key){return this.getKeyIndex(key)>-1},Map.prototype.delete=function(key){var keyIndex=this.getKeyIndex(key);return keyIndex>-1&&(this.keys.splice(keyIndex,1),this.values.splice(keyIndex,1),!0)},Map.prototype.forEach=function(callback,thisArg){var _this=this;void 0===thisArg&&(thisArg=this),this.values.forEach((function(value,index){value&&_this.keys[index]&&callback.call(thisArg,value,_this.keys[index],_this)}))},Map.prototype.clear=function(){this.keys=[],this.values=[]},Map}(),DEFAULT_CODE="en-US",I18n,i18n=new(function(){function I18n(){this.code="en-US",this.langs=new utils_map}return I18n.prototype.setCode=function(code){this.code=code||"en-US"},I18n.prototype.setLanguage=function(codes,data){var _this=this;(codes=[].concat(codes)).forEach((function(code){if(_this.langs.has(code)){var langData=_this.langs.get(code);_this.langs.set(code,extend_default()(langData,data))}else _this.langs.set(code,data)}))},I18n.prototype.get=function(key,code){code||(code=this.code);var langSet=this.langs.get(code);langSet||(langSet=this.langs.get("en-US"));var text=langSet[key];if(!text)throw new Error('There is no text key "'+key+'" in '+code);return text},I18n}()),contextMenuGroups=[[{action:"Add row to up",command:"addRowToUp",disableInThead:!0,className:"add-row-up"},{action:"Add row to down",command:"addRowToDown",disableInThead:!0,className:"add-row-down"},{action:"Remove row",command:"removeRow",disableInThead:!0,className:"remove-row"}],[{action:"Add column to left",command:"addColumnToLeft",className:"add-column-left"},{action:"Add column to right",command:"addColumnToRight",className:"add-column-right"},{action:"Remove column",command:"removeColumn",className:"remove-column"}],[{action:"Align column to left",command:"alignColumn",payload:{align:"left"},className:"align-column-left"},{action:"Align column to center",command:"alignColumn",payload:{align:"center"},className:"align-column-center"},{action:"Align column to right",command:"alignColumn",payload:{align:"right"},className:"align-column-right"}],[{action:"Remove table",command:"removeTable",className:"remove-table"}]];function getContextMenuGroups(eventEmitter,inTableHead){return contextMenuGroups.map((function(contextMenuGroup){return contextMenuGroup.map((function(_a){var action=_a.action,command=_a.command,payload=_a.payload,disableInThead=_a.disableInThead,className=_a.className;return{label:i18n.get(action),onClick:function(){eventEmitter.emit("command",command,payload)},disabled:inTableHead&&!!disableInThead,className:className}}))})).concat()}function tableContextMenu(eventEmitter){return new Plugin({props:{handleDOMEvents:{contextmenu:function(view,ev){var tableCell=findCellElement(ev.target,view.dom);if(tableCell){ev.preventDefault();var _a=ev,clientX=_a.clientX,clientY=_a.clientY,_b=view.dom.parentNode.getBoundingClientRect(),left=_b.left,top=_b.top,inTableHead="TH"===tableCell.nodeName;return eventEmitter.emit("contextmenu",{pos:{left:clientX-left+10+"px",top:clientY-top+30+"px"},menuGroups:getContextMenuGroups(eventEmitter,inTableHead),tableCell:tableCell}),!0}return!1}}}})}function task(){return new Plugin({props:{handleDOMEvents:{mousedown:function(view,ev){var _a=ev,clientX=_a.clientX,clientY=_a.clientY,mousePos=view.posAtCoords({left:clientX,top:clientY});if(mousePos){var _b=view.state,doc=_b.doc,tr=_b.tr,currentPos=doc.resolve(mousePos.pos),listItem=findListItem(currentPos),target=ev.target,style=getComputedStyle(target,":before"),_c=ev,offsetX=_c.offsetX,offsetY=_c.offsetY;if(!listItem||!isPositionInBox(style,offsetX,offsetY))return!1;ev.preventDefault();var offset=currentPos.before(listItem.depth),attrs=listItem.node.attrs;return tr.setNodeMarkup(offset,null,__assign(__assign({},attrs),{checked:!attrs.checked})),view.dispatch(tr),!0}return!1}}}})}var EXCEPT_TYPES=["image","link","customBlock","frontMatter"],MARK_TYPES=["strong","strike","emph","code"],LIST_TYPES=["bulletList","orderedList","taskList"];function toolbarState_getToolbarStateType(node,parentNode){var type=node.type.name;return"listItem"===type?node.attrs.task?"taskList":parentNode.type.name:-1!==type.indexOf("table")?"table":type}function setListNodeToolbarState(type,nodeTypeState){nodeTypeState[type]=!0,LIST_TYPES.filter((function(listName){return listName!==type})).forEach((function(listType){nodeTypeState[listType]&&delete nodeTypeState[listType]}))}function getMarkTypeStates(from,to,schema){var markTypeState={};return MARK_TYPES.forEach((function(type){var mark=schema.marks[type],marksAtPos=from.marksAcross(to)||[],foundMark;!!mark.isInSet(marksAtPos)&&(markTypeState[type]=!0)})),markTypeState}function toolbarState_getToolbarState(selection,doc,schema){var $from=selection.$from,$to=selection.$to,from=selection.from,to=selection.to,nodeTypeState={},markTypeState={};return doc.nodesBetween(from,to,(function(node,_,parentNode){var type=toolbarState_getToolbarStateType(node,parentNode);common_includes(EXCEPT_TYPES,type)||(common_includes(LIST_TYPES,type)?setListNodeToolbarState(type,nodeTypeState):"paragraph"===type||"text"===type?markTypeState=getMarkTypeStates($from,$to,schema):nodeTypeState[type]=!0)})),__assign(__assign({},nodeTypeState),markTypeState)}function toolbarState(eventEmitter){return new Plugin({view:function(){return{update:function(view){var _a=view.state,selection=_a.selection,doc=_a.doc,schema=_a.schema;eventEmitter.emit("changeToolbarState",{toolbarState:toolbarState_getToolbarState(selection,doc,schema)})}}}})}var CustomBlockView=function(){function CustomBlockView(node,view,getPos,toDOMAdaptor){var _this=this;this.openEditor=function(){if(_this.innerEditorView)throw new Error("The editor is already opened.");_this.wrapper.style.display="none",_this.innerViewContainer.style.display="block",_this.innerEditorView=new EditorView(_this.innerViewContainer,{state:EditorState.create({doc:_this.node,plugins:[keymap({"Mod-z":function(){return undo(_this.innerEditorView.state,_this.innerEditorView.dispatch)},"Shift-Mod-z":function(){return redo(_this.innerEditorView.state,_this.innerEditorView.dispatch)},Tab:function(state,dispatch){return dispatch(state.tr.insertText("\t")),!0},Enter:newlineInCode,Escape:function(){return _this.cancelEditing(),!0},"Ctrl-Enter":function(){return _this.saveAndFinishEditing(),!0}}),index_es_history()]}),dispatchTransaction:function(tr){return _this.dispatchInner(tr)},handleDOMEvents:{mousedown:function(){return _this.editorView.hasFocus()&&_this.innerEditorView.focus(),!0},blur:function(){return _this.saveAndFinishEditing(),!0}}}),_this.innerEditorView.focus()},this.node=node,this.editorView=view,this.getPos=getPos,this.toDOMAdaptor=toDOMAdaptor,this.innerEditorView=null,this.canceled=!1,this.dom=document.createElement("div"),this.dom.className=cls("custom-block"),this.wrapper=document.createElement("div"),this.wrapper.className=cls("custom-block-view"),this.createInnerViewContainer(),this.renderCustomBlock(),this.dom.appendChild(this.innerViewContainer),this.dom.appendChild(this.wrapper)}return CustomBlockView.prototype.renderToolArea=function(){var _this=this,tool=document.createElement("div"),span=document.createElement("span"),button=document.createElement("button");tool.className="tool",span.textContent=this.node.attrs.info,span.className="info",button.type="button",button.addEventListener("click",(function(){return _this.openEditor()})),tool.appendChild(span),tool.appendChild(button),this.wrapper.appendChild(tool)},CustomBlockView.prototype.renderCustomBlock=function(){var toDOMNode=this.toDOMAdaptor.getToDOMNode(this.node.attrs.info);if(toDOMNode){for(var node=toDOMNode(this.node);this.wrapper.hasChildNodes();)this.wrapper.removeChild(this.wrapper.lastChild);node&&this.wrapper.appendChild(node),this.renderToolArea()}},CustomBlockView.prototype.createInnerViewContainer=function(){this.innerViewContainer=document.createElement("div"),this.innerViewContainer.className=cls("custom-block-editor"),this.innerViewContainer.style.display="none"},CustomBlockView.prototype.closeEditor=function(){this.innerEditorView&&(this.innerEditorView.destroy(),this.innerEditorView=null,this.innerViewContainer.style.display="none"),this.wrapper.style.display="block"},CustomBlockView.prototype.saveAndFinishEditing=function(){var to=this.editorView.state.selection.to,outerState=this.editorView.state;this.editorView.dispatch(outerState.tr.setSelection(createTextSelection(outerState.tr,to))),this.editorView.focus(),this.renderCustomBlock(),this.closeEditor()},CustomBlockView.prototype.cancelEditing=function(){var undoableCount=undoDepth(this.innerEditorView.state);for(this.canceled=!0;undoableCount--;)undo(this.innerEditorView.state,this.innerEditorView.dispatch),undo(this.editorView.state,this.editorView.dispatch);this.canceled=!1;var to=this.editorView.state.selection.to,outerState=this.editorView.state;this.editorView.dispatch(outerState.tr.setSelection(TextSelection.create(outerState.doc,to))),this.editorView.focus(),this.closeEditor()},CustomBlockView.prototype.dispatchInner=function(tr){var _a=this.innerEditorView.state.applyTransaction(tr),state=_a.state,transactions=_a.transactions;if(this.innerEditorView.updateState(state),!this.canceled&&isFunction_default()(this.getPos)){for(var outerTr=this.editorView.state.tr,offsetMap=StepMap.offset(this.getPos()+1),i=0;i<transactions.length;i+=1)for(var steps=transactions[i].steps,j=0;j<steps.length;j+=1)outerTr.step(steps[j].map(offsetMap));outerTr.docChanged&&this.editorView.dispatch(outerTr)}},CustomBlockView.prototype.update=function(node){return!!node.sameMarkup(this.node)&&(this.node=node,this.innerEditorView||this.renderCustomBlock(),!0)},CustomBlockView.prototype.stopEvent=function(event){return!!this.innerEditorView&&!!event.target&&this.innerEditorView.dom.contains(event.target)},CustomBlockView.prototype.ignoreMutation=function(){return!0},CustomBlockView.prototype.destroy=function(){this.dom.removeEventListener("dblclick",this.openEditor),this.closeEditor()},CustomBlockView}(),IMAGE_LINK_CLASS_NAME="image-link",ImageView=function(){function ImageView(node,view,getPos,eventEmitter){var _this=this,_a;this.handleMousedown=function(ev){ev.preventDefault();var target=ev.target,offsetX=ev.offsetX,offsetY=ev.offsetY;if(_this.imageLink&&isFunction_default()(_this.getPos)&&hasClass_default()(target,"image-link")){var style=getComputedStyle(target,":before");if(ev.stopPropagation(),isPositionInBox(style,offsetX,offsetY)){var tr=_this.view.state.tr,pos=_this.getPos();tr.setSelection(createTextSelection(tr,pos,pos+1)),_this.view.dispatch(tr),_this.eventEmitter.emit("openPopup","link",_this.imageLink.attrs)}}},this.node=node,this.view=view,this.getPos=getPos,this.eventEmitter=eventEmitter,this.imageLink=null!==(_a=node.marks.filter((function(_a){var type;return"link"===_a.type.name}))[0])&&void 0!==_a?_a:null,this.dom=this.createElement(),this.bindEvent()}return ImageView.prototype.createElement=function(){var image=this.createImageElement(this.node);if(this.imageLink){var wrapper=document.createElement("span");return wrapper.className="image-link",wrapper.appendChild(image),wrapper}return image},ImageView.prototype.createImageElement=function(node){var image=document.createElement("img"),_a=node.attrs,imageUrl=_a.imageUrl,altText=_a.altText,attrs=getCustomAttrs(node.attrs);return image.src=imageUrl,altText&&(image.alt=altText),setAttributes(attrs,image),image},ImageView.prototype.bindEvent=function(){this.imageLink&&this.dom.addEventListener("mousedown",this.handleMousedown)},ImageView.prototype.stopEvent=function(){return!0},ImageView.prototype.destroy=function(){this.imageLink&&this.dom.removeEventListener("mousedown",this.handleMousedown)},ImageView}(),WRAPPER_CLASS_NAME="toastui-editor-ww-code-block",CODE_BLOCK_LANG_CLASS_NAME="toastui-editor-ww-code-block-language",CodeBlockView=function(){function CodeBlockView(node,view,getPos,eventEmitter){var _this=this;this.dom=null,this.contentDOM=null,this.input=null,this.handleMousedown=function(ev){var target=ev.target,style;if("none"!==getComputedStyle(target,":after").backgroundImage&&isFunction_default()(_this.getPos)){var _a=_this.view.coordsAtPos(_this.getPos()),top=_a.top,right=_a.right;_this.createLanguageEditor({top:top,right:right})}},this.handleKeydown=function(ev){"Enter"===ev.key&&_this.input&&(ev.preventDefault(),_this.changeLanguage())},this.node=node,this.view=view,this.getPos=getPos,this.eventEmitter=eventEmitter,this.createElement(),this.bindDOMEvent(),this.bindEvent()}return CodeBlockView.prototype.createElement=function(){var language=this.node.attrs.language,wrapper=document.createElement("div");wrapper.setAttribute("data-language",language||"text"),wrapper.className=WRAPPER_CLASS_NAME;var pre=this.createCodeBlockElement(),code=pre.firstChild;wrapper.appendChild(pre),this.dom=wrapper,this.contentDOM=code},CodeBlockView.prototype.createCodeBlockElement=function(){var pre=document.createElement("pre"),code=document.createElement("code"),language=this.node.attrs.language,attrs=getCustomAttrs(this.node.attrs);return language&&code.setAttribute("data-language",language),setAttributes(attrs,pre),pre.appendChild(code),pre},CodeBlockView.prototype.createLanguageEditor=function(_a){var _this=this,top=_a.top,right=_a.right,wrapper=document.createElement("span");wrapper.className=CODE_BLOCK_LANG_CLASS_NAME;var input=document.createElement("input");input.type="text",input.value=this.node.attrs.language,wrapper.appendChild(input),document.querySelector(".toastui-editor.ww-mode").appendChild(wrapper);var wrpperWidth=wrapper.clientWidth;css_default()(wrapper,{top:top+10+"px",left:right-wrpperWidth-10+"px",width:wrpperWidth+"px"}),this.input=input,this.input.addEventListener("blur",(function(){return _this.changeLanguage()})),this.input.addEventListener("keydown",this.handleKeydown),setTimeout((function(){return _this.input.focus()}))},CodeBlockView.prototype.bindDOMEvent=function(){this.dom&&this.dom.addEventListener("click",this.handleMousedown)},CodeBlockView.prototype.bindEvent=function(){var _this=this;this.eventEmitter.listen("scroll",(function(){_this.input&&_this.reset()}))},CodeBlockView.prototype.changeLanguage=function(){if(this.input&&isFunction_default()(this.getPos)){var value=this.input.value;this.reset();var pos=this.getPos(),tr=this.view.state.tr;tr.setNodeMarkup(pos,null,{language:value}),this.view.dispatch(tr)}},CodeBlockView.prototype.reset=function(){var _a;if(null===(_a=this.input)||void 0===_a?void 0:_a.parentElement){var parent=this.input.parentElement;this.input=null,removeNode(parent)}},CodeBlockView.prototype.stopEvent=function(){return!0},CodeBlockView.prototype.update=function(node){return!!node.sameMarkup(this.node)&&(this.node=node,!0)},CodeBlockView.prototype.destroy=function(){this.reset(),this.dom&&this.dom.removeEventListener("click",this.handleMousedown)},CodeBlockView}(),reMSOListClassName=/MsoListParagraph/,reMSOStylePrefix=/style=(.|\n)*mso-/,reMSOListStyle=/mso-list:(.*)/,reMSOTagName=/O:P/,reMSOListBullet=/^(n|u|l)/,MSO_CLASS_NAME_LIST_PARA="p.MsoListParagraph";function isFromMso(html){return reMSOStylePrefix.test(html)}function getListItemContents(para){for(var removedNodes=[],walker=document.createTreeWalker(para,1,null,!1);walker.nextNode();){var node=walker.currentNode;if(isElemNode(node)){var _a=node,outerHTML=_a.outerHTML,textContent=_a.textContent,msoSpan=reMSOStylePrefix.test(outerHTML),bulletSpan=reMSOListStyle.test(outerHTML);msoSpan&&!bulletSpan&&textContent?removedNodes.push([node,!0]):(reMSOTagName.test(node.nodeName)||msoSpan&&!textContent||bulletSpan)&&removedNodes.push([node,!1])}}return removedNodes.forEach((function(_a){var node=_a[0],isUnwrap;_a[1]?unwrapNode(node):removeNode(node)})),para.innerHTML.trim()}function createListItemDataFromParagraph(para,index){var styleAttr=para.getAttribute("style");if(styleAttr){var _a,listItemInfo,_b,levelStr=styleAttr.match(reMSOListStyle)[1].trim().split(" ")[1],level,unordered;return{id:index,level:parseInt(levelStr.replace("level",""),10),prev:null,parent:null,children:[],unordered:reMSOListBullet.test(para.textContent||""),contents:getListItemContents(para)}}return null}function addListItemDetailData(data,prevData){if(prevData.level<data.level)prevData.children.push(data),data.parent=prevData;else{for(;prevData&&prevData.level!==data.level;)prevData=prevData.parent;prevData&&(data.prev=prevData,data.parent=prevData.parent,data.parent&&data.parent.children.push(data))}}function createListData(paras){var listData=[];return paras.forEach((function(para,index){var prevListItemData=listData[index-1],listItemData=createListItemDataFromParagraph(para,index);listItemData&&(prevListItemData&&addListItemDetailData(listItemData,prevListItemData),listData.push(listItemData))})),listData}function makeList(listData){var listTagName=listData[0].unordered?"ul":"ol",list=document.createElement(listTagName);return listData.forEach((function(data){var children=data.children,contents=data.contents,listItem=document.createElement("li");listItem.innerHTML=contents,list.appendChild(listItem),children.length&&list.appendChild(makeList(children))})),list}function makeListFromParagraphs(paras){var listData,rootChildren;return makeList(createListData(paras).filter((function(_a){var parent;return!_a.parent})))}function isMsoListParagraphEnd(node){for(;node&&!isElemNode(node);)node=node.nextSibling;return!node||!reMSOListClassName.test(node.className)}function convertMsoParagraphsToList(html){var container=document.createElement("div");container.innerHTML=html;var paras=[],foundParas=findNodes(container,"p.MsoListParagraph"),extraHTML;return foundParas.forEach((function(para){var msoListParaEnd=isMsoListParagraphEnd(para.nextSibling);if(paras.push(para),msoListParaEnd){var list=makeListFromParagraphs(paras),nextSibling=para.nextSibling;nextSibling?insertBeforeNode(list,nextSibling):appendNodes(container,list),paras=[]}removeNode(para)})),""+(foundParas.length?"<p></p>":"")+container.innerHTML}var START_FRAGMENT_COMMENT="\x3c!--StartFragment--\x3e",END_FRAGMENT_COMMENT="\x3c!--EndFragment--\x3e";function getContentBetweenFragmentComments(html){var startFragmentIndex=html.indexOf(START_FRAGMENT_COMMENT),endFragmentIndex=html.lastIndexOf(END_FRAGMENT_COMMENT);return startFragmentIndex>-1&&endFragmentIndex>-1&&(html=html.slice(startFragmentIndex+START_FRAGMENT_COMMENT.length,endFragmentIndex)),html}function convertMsoTableToCompletedTable(html){return/<\/td>((?!<\/tr>)[\s\S])*$/i.test(html)&&(html="<tr>"+html+"</tr>"),/<\/tr>((?!<\/table>)[\s\S])*$/i.test(html)&&(html="<table>"+html+"</table>"),html}function changePastedHTML(html){return isFromMso(html=convertMsoTableToCompletedTable(html=getContentBetweenFragmentComments(html)))&&(html=convertMsoParagraphsToList(html)),html}function getMaxColumnCount(rows){var row;return rows.reduce((function(prevRow,currentRow){return prevRow.childCount>currentRow.childCount?prevRow:currentRow})).childCount}function createCells(orgRow,maxColumnCount,cell){for(var cells=[],cellCount=orgRow.childCount,colIdx=0;colIdx<cellCount;colIdx+=1)if(!orgRow.child(colIdx).attrs.extended){var copiedCell=colIdx<cellCount?cell.create(orgRow.child(colIdx).attrs,orgRow.child(colIdx).content):cell.createAndFill();cells.push(copiedCell)}return cells}function copyTableHeadRow(orgRow,maxColumnCount,schema){var _a=schema.nodes,tableRow=_a.tableRow,tableHeadCell,cells=createCells(orgRow,maxColumnCount,_a.tableHeadCell);return tableRow.create(null,cells)}function copyTableBodyRow(orgRow,maxColumnCount,schema){var _a=schema.nodes,tableRow=_a.tableRow,tableBodyCell,cells=createCells(orgRow,maxColumnCount,_a.tableBodyCell);return tableRow.create(null,cells)}function creatTableBodyDummyRow(columnCount,schema){for(var _a=schema.nodes,tableRow=_a.tableRow,tableBodyCell=_a.tableBodyCell,cells=[],columnIndex=0;columnIndex<columnCount;columnIndex+=1){var dummyCell=tableBodyCell.createAndFill();cells.push(dummyCell)}return tableRow.create({dummyRowForPasting:!0},cells)}function createRowsFromPastingTable(tableContent){var tableHeadRows=[],tableBodyRows=[],tableHead,tableBody;"tableHead"===tableContent.firstChild.type.name&&tableContent.firstChild.forEach((function(row){return tableHeadRows.push(row)}));"tableBody"===tableContent.lastChild.type.name&&tableContent.lastChild.forEach((function(row){return tableBodyRows.push(row)}));return __spreadArray(__spreadArray([],tableHeadRows),tableBodyRows)}function createTableHead(tableHeadRow,maxColumnCount,schema){var copiedRow=copyTableHeadRow(tableHeadRow,maxColumnCount,schema);return schema.nodes.tableHead.create(null,copiedRow)}function paste_createTableBody(tableBodyRows,maxColumnCount,schema){var copiedRows=tableBodyRows.map((function(tableBodyRow){return copyTableBodyRow(tableBodyRow,maxColumnCount,schema)}));if(!tableBodyRows.length){var dummyTableRow=creatTableBodyDummyRow(maxColumnCount,schema);copiedRows.push(dummyTableRow)}return schema.nodes.tableBody.create(null,copiedRows)}function createTableFromPastingTable(rows,schema,startFromBody){var columnCount=getMaxColumnCount(rows);if(startFromBody)return schema.nodes.table.create(null,[paste_createTableBody(rows,columnCount,schema)]);var tableHeadRow=rows[0],tableBodyRows=rows.slice(1),nodes=[createTableHead(tableHeadRow,columnCount,schema)];return tableBodyRows.length&&nodes.push(paste_createTableBody(tableBodyRows,columnCount,schema)),schema.nodes.table.create(null,nodes)}function changePastedSlice(slice,schema){var nodes=[];return slice.content.forEach((function(node){if("table"===node.type.name){var tableContent=getTableContentFromSlice(new Slice(Fragment.from(node),0,0));if(tableContent){var rows=createRowsFromPastingTable(tableContent),startFromBody="tableBody"===tableContent.firstChild.type.name,table=createTableFromPastingTable(rows,schema,startFromBody);nodes.push(table)}}else nodes.push(node)})),new Slice(Fragment.from(nodes),0,0)}var DUMMY_CELL_SIZE=4,TR_NODES_SIZE=2;function getDummyCellSize(dummyCellCount){return 4*dummyCellCount}function createPastingCells(tableContent,curSelectionInfo,schema){var pastingRows=[],pastingTableRows=createRowsFromPastingTable(tableContent),columnCount=pastingTableRows[0].childCount,rowCount=pastingTableRows.length,startToTableHead=0===curSelectionInfo.startRowIdx,slicedRows=pastingTableRows.slice(0,rowCount);if(startToTableHead){var tableHeadRow=slicedRows.shift();if(tableHeadRow){var content=copyTableHeadRow(tableHeadRow,columnCount,schema).content;pastingRows.push(content)}}return slicedRows.forEach((function(tableBodyRow){if(!tableBodyRow.attrs.dummyRowForPasting){var content=copyTableBodyRow(tableBodyRow,columnCount,schema).content;pastingRows.push(content)}})),pastingRows}function getPastingRangeInfo(map,_a,pastingCells){for(var startRowIdx=_a.startRowIdx,startColIdx=_a.startColIdx,pastingRowCount=pastingCells.length,pastingColumnCount=0,_loop_1=function(i){var columnCount=pastingCells[i].childCount;pastingCells[i].forEach((function(_a){var attrs,colspan=_a.attrs.colspan;colspan>1&&(columnCount+=colspan-1)})),pastingColumnCount=Math.max(pastingColumnCount,columnCount)},i=0;i<pastingRowCount;i+=1)_loop_1(i);var endRowIdx=startRowIdx+pastingRowCount-1,endColIdx=startColIdx+pastingColumnCount-1,addedRowCount,addedColumnCount;return{startRowIdx:startRowIdx,startColIdx:startColIdx,endRowIdx:endRowIdx,endColIdx:endColIdx,addedRowCount:Math.max(endRowIdx+1-map.totalRowCount,0),addedColumnCount:Math.max(endColIdx+1-map.totalColumnCount,0)}}function addReplacedOffsets(_a,cellsOffsets){for(var startRowIdx=_a.startRowIdx,startColIdx=_a.startColIdx,endRowIdx=_a.endRowIdx,endColIdx=_a.endColIdx,addedRowCount=_a.addedRowCount,addedColumnCount=_a.addedColumnCount,rowIdx=startRowIdx;rowIdx<=endRowIdx-addedRowCount;rowIdx+=1)cellsOffsets.push({rowIdx:rowIdx,startColIdx:startColIdx,endColIdx:endColIdx-addedColumnCount})}function expandColumns(tr,schema,map,_a,cellsOffsets){for(var startRowIdx=_a.startRowIdx,startColIdx=_a.startColIdx,endRowIdx=_a.endRowIdx,endColIdx=_a.endColIdx,addedRowCount=_a.addedRowCount,addedColumnCount=_a.addedColumnCount,totalRowCount=map.totalRowCount,index=0,rowIdx=0;rowIdx<totalRowCount;rowIdx+=1){var _b=map.getCellInfo(rowIdx,endColIdx-addedColumnCount),offset=_b.offset,nodeSize=_b.nodeSize,insertOffset=tr.mapping.map(offset+nodeSize),cells=createDummyCells(addedColumnCount,rowIdx,schema);if(tr.insert(insertOffset,cells),rowIdx>=startRowIdx&&rowIdx<=endRowIdx-addedRowCount){var cellInfo=map.getCellInfo(rowIdx,endColIdx-addedColumnCount),startCellOffset=tr.mapping.map(cellInfo.offset),endCellOffset=insertOffset+getDummyCellSize(addedColumnCount);cellsOffsets[index]={rowIdx:rowIdx,startColIdx:startColIdx,endColIdx:endColIdx,dummyOffsets:[startCellOffset,endCellOffset]},index+=1}}}function expandRows(tr,schema,map,_a,cellsOffsets){var addedRowCount=_a.addedRowCount,addedColumnCount=_a.addedColumnCount,startColIdx=_a.startColIdx,endColIdx=_a.endColIdx,mapStart=tr.mapping.maps.length,tableEndPos=map.tableEndOffset-2,rows=createTableBodyRows(addedRowCount,map.totalColumnCount+addedColumnCount,schema),startOffset=tableEndPos;tr.insert(tr.mapping.slice(mapStart).map(startOffset),rows);for(var rowIndex=0;rowIndex<addedRowCount;rowIndex+=1){var startCellOffset=startOffset+getDummyCellSize(startColIdx)+1,endCellOffset=startOffset+getDummyCellSize(endColIdx+1)+1,nextCellOffset=startOffset+getDummyCellSize(map.totalColumnCount+addedColumnCount)+2;cellsOffsets.push({rowIdx:rowIndex+map.totalRowCount,startColIdx:startColIdx,endColIdx:endColIdx,dummyOffsets:[startCellOffset,endCellOffset]}),startOffset=nextCellOffset}}function replaceCells(tr,pastingRows,cellsOffsets,map){var mapStart=tr.mapping.maps.length;cellsOffsets.forEach((function(offsets,index){var rowIdx=offsets.rowIdx,startColIdx=offsets.startColIdx,endColIdx=offsets.endColIdx,dummyOffsets=offsets.dummyOffsets,mapping=tr.mapping.slice(mapStart),cells=new Slice(pastingRows[index],0,0),from=dummyOffsets?dummyOffsets[0]:map.getCellStartOffset(rowIdx,startColIdx),to=dummyOffsets?dummyOffsets[1]:map.getCellEndOffset(rowIdx,endColIdx);tr.replace(mapping.map(from),mapping.map(to),cells)}))}function pasteToTable(view,slice){var _a=view.state,selection=_a.selection,schema=_a.schema,tr=_a.tr,_b=getResolvedSelection(selection),anchor=_b.anchor,head=_b.head;if(anchor&&head){var tableContent=getTableContentFromSlice(slice);if(!tableContent)return!1;var map=TableOffsetMap.create(anchor),curSelectionInfo=map.getRectOffsets(anchor,head),pastingCells=createPastingCells(tableContent,curSelectionInfo,schema),pastingInfo=getPastingRangeInfo(map,curSelectionInfo,pastingCells),cellsOffsets=[];return canMerge(map,pastingInfo)&&(addReplacedOffsets(pastingInfo,cellsOffsets),pastingInfo.addedColumnCount&&expandColumns(tr,schema,map,pastingInfo,cellsOffsets),pastingInfo.addedRowCount&&expandRows(tr,schema,map,pastingInfo,cellsOffsets),replaceCells(tr,pastingCells,cellsOffsets,map),view.dispatch(tr),setSelection(view,cellsOffsets,map.getCellInfo(0,0).offset)),!0}return!1}function setSelection(view,cellsOffsets,pos){var _a=view.state,tr=_a.tr,doc=_a.doc,map=TableOffsetMap.create(doc.resolve(pos)),_b=cellsOffsets[0],startRowIdx=_b.rowIdx,startColIdx=_b.startColIdx,_c=last(cellsOffsets),endRowIdx=_c.rowIdx,endColIdx=_c.endColIdx,startOffset=map.getCellInfo(startRowIdx,startColIdx).offset,endOffset=map.getCellInfo(endRowIdx,endColIdx).offset;view.dispatch(tr.setSelection(new selection_cellSelection(doc.resolve(startOffset),doc.resolve(endOffset))))}function canMerge(map,pastingInfo){var ranges,_a=getRowAndColumnCount(map.getSpannedOffsets(pastingInfo)),rowCount=_a.rowCount,columnCount=_a.columnCount,_b=getRowAndColumnCount(pastingInfo),pastingRowCount=_b.rowCount,pastingColumnCount=_b.columnCount;return rowCount===pastingRowCount&&columnCount===pastingColumnCount}var doc_Doc=function(_super){function Doc(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(Doc,_super),Object.defineProperty(Doc.prototype,"name",{get:function(){return"doc"},enumerable:!1,configurable:!0}),Object.defineProperty(Doc.prototype,"schema",{get:function(){return{content:"block+"}},enumerable:!1,configurable:!0}),Doc}(node),paragraph_Paragraph=function(_super){function Paragraph(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(Paragraph,_super),Object.defineProperty(Paragraph.prototype,"name",{get:function(){return"paragraph"},enumerable:!1,configurable:!0}),Object.defineProperty(Paragraph.prototype,"schema",{get:function(){return{content:"inline*",group:"block listGroup",attrs:__assign({},{htmlAttrs:{default:null},classNames:{default:null}}),parseDOM:[{tag:"p"}],toDOM:function(_a){var attrs;return["p",getCustomAttrs(_a.attrs),0]}}},enumerable:!1,configurable:!0}),Paragraph}(node),reSoftTabLen=/\s{1,4}$/,text_Text=function(_super){function Text(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(Text,_super),Object.defineProperty(Text.prototype,"name",{get:function(){return"text"},enumerable:!1,configurable:!0}),Object.defineProperty(Text.prototype,"schema",{get:function(){return{group:"inline"}},enumerable:!1,configurable:!0}),Text.prototype.addSpaces=function(){return function(_a,dispatch){var selection=_a.selection,tr=_a.tr,$from=selection.$from,$to=selection.$to,range;return!(!$from.blockRange($to)||isInListNode($from)||isInTableNode($from))&&(dispatch(tr.insertText("    ",$from.pos,$to.pos)),!0)}},Text.prototype.removeSpaces=function(){return function(_a,dispatch){var selection=_a.selection,tr=_a.tr,$from=selection.$from,$to=selection.$to,from=selection.from,range;if($from.blockRange($to)&&!isInListNode($from)&&!isInTableNode($from)){var nodeBefore=$from.nodeBefore;if(nodeBefore&&nodeBefore.isText){var text=nodeBefore.text,removedSpaceText=text.replace(reSoftTabLen,""),spaces=text.length-removedSpaceText.length;return dispatch(tr.delete(from-spaces,from)),!0}}return!1}},Text.prototype.keymaps=function(){return{Tab:this.addSpaces(),"Shift-Tab":this.removeSpaces()}},Text}(node),heading_Heading=function(_super){function Heading(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(Heading,_super),Object.defineProperty(Heading.prototype,"name",{get:function(){return"heading"},enumerable:!1,configurable:!0}),Object.defineProperty(Heading.prototype,"levels",{get:function(){return[1,2,3,4,5,6]},enumerable:!1,configurable:!0}),Object.defineProperty(Heading.prototype,"schema",{get:function(){var parseDOM=this.levels.map((function(level){return{tag:"h"+level,getAttrs:function(dom){var rawHTML=dom.getAttribute("data-raw-html");return __assign({level:level},rawHTML&&{rawHTML:rawHTML})}}}));return{attrs:__assign({level:{default:1},headingType:{default:"atx"},rawHTML:{default:null}},{htmlAttrs:{default:null},classNames:{default:null}}),content:"inline*",group:"block",defining:!0,parseDOM:parseDOM,toDOM:function(_a){var attrs=_a.attrs;return["h"+attrs.level,getCustomAttrs(attrs),0]}}},enumerable:!1,configurable:!0}),Heading.prototype.commands=function(){return function(payload){return function(state,dispatch){return setBlockType(state.schema.nodes.heading,payload)(state,dispatch)}}},Heading}(node),codeBlock_CodeBlock=function(_super){function CodeBlock(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(CodeBlock,_super),Object.defineProperty(CodeBlock.prototype,"name",{get:function(){return"codeBlock"},enumerable:!1,configurable:!0}),Object.defineProperty(CodeBlock.prototype,"schema",{get:function(){return{content:"text*",group:"block",attrs:__assign({language:{default:null},rawHTML:{default:null}},{htmlAttrs:{default:null},classNames:{default:null}}),code:!0,defining:!0,marks:"",parseDOM:[{tag:"pre",preserveWhitespace:"full",getAttrs:function(dom){var rawHTML=dom.getAttribute("data-raw-html"),child=dom.firstElementChild;return __assign({language:(null==child?void 0:child.getAttribute("data-language"))||null},rawHTML&&{rawHTML:rawHTML})}}],toDOM:function(_a){var attrs=_a.attrs;return[attrs.rawHTML||"pre",["code",__assign({"data-language":attrs.language},getCustomAttrs(attrs)),0]]}}},enumerable:!1,configurable:!0}),CodeBlock.prototype.commands=function(){return function(){return function(state,dispatch){return setBlockType(state.schema.nodes.codeBlock)(state,dispatch)}}},CodeBlock.prototype.moveCursor=function(direction){var _this=this;return function(state,dispatch){var tr=state.tr,doc=state.doc,schema=state.schema,$from=state.selection.$from,view;if(_this.context.view.endOfTextblock(direction)&&"codeBlock"===$from.node().type.name){var lines=$from.parent.textContent.split("\n"),offset="up"===direction?$from.start():$from.end(),range="up"===direction?[offset,lines[0].length+offset]:[offset-last(lines).length,offset],pos=doc.resolve("up"===direction?$from.before():$from.after()),node="up"===direction?pos.nodeBefore:pos.nodeAfter;if(between($from.pos,range[0],range[1])&&!node){var newTr=addParagraph(tr,pos,schema);if(newTr)return dispatch(newTr),!0}}return!1}},CodeBlock.prototype.keymaps=function(){var codeCommand=this.commands()();return{"Shift-Mod-p":codeCommand,"Shift-Mod-P":codeCommand,ArrowUp:this.moveCursor("up"),ArrowDown:this.moveCursor("down")}},CodeBlock}(node),BulletList=function(_super){function BulletList(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(BulletList,_super),Object.defineProperty(BulletList.prototype,"name",{get:function(){return"bulletList"},enumerable:!1,configurable:!0}),Object.defineProperty(BulletList.prototype,"schema",{get:function(){return{content:"listItem+",group:"block listGroup",attrs:__assign({rawHTML:{default:null}},{htmlAttrs:{default:null},classNames:{default:null}}),parseDOM:[createDOMInfoParsedRawHTML("ul")],toDOM:function(_a){var attrs;return["ul",getCustomAttrs(_a.attrs),0]}}},enumerable:!1,configurable:!0}),BulletList.prototype.changeList=function(){return function(state,dispatch){return changeList(state.schema.nodes.bulletList)(state,dispatch)}},BulletList.prototype.commands=function(){return{bulletList:this.changeList,taskList:toggleTask}},BulletList.prototype.keymaps=function(){var bulletListCommand=this.changeList(),_a=getWwCommands(),indent=_a.indent,outdent=_a.outdent;return{"Mod-u":bulletListCommand,"Mod-U":bulletListCommand,Tab:indent(),"Shift-Tab":outdent()}},BulletList}(node),OrderedList=function(_super){function OrderedList(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(OrderedList,_super),Object.defineProperty(OrderedList.prototype,"name",{get:function(){return"orderedList"},enumerable:!1,configurable:!0}),Object.defineProperty(OrderedList.prototype,"schema",{get:function(){return{content:"listItem+",group:"block listGroup",attrs:__assign({order:{default:1},rawHTML:{default:null}},{htmlAttrs:{default:null},classNames:{default:null}}),parseDOM:[{tag:"ol",getAttrs:function(dom){var start=dom.getAttribute("start"),rawHTML=dom.getAttribute("data-raw-html");return __assign({order:dom.hasAttribute("start")?Number(start):1},rawHTML&&{rawHTML:rawHTML})}}],toDOM:function(_a){var attrs=_a.attrs;return[attrs.rawHTML||"ol",__assign({start:1===attrs.order?null:attrs.order},getCustomAttrs(attrs)),0]}}},enumerable:!1,configurable:!0}),OrderedList.prototype.commands=function(){return function(){return function(state,dispatch){return changeList(state.schema.nodes.orderedList)(state,dispatch)}}},OrderedList.prototype.keymaps=function(){var orderedListCommand=this.commands()(),_a=getWwCommands(),indent=_a.indent,outdent=_a.outdent;return{"Mod-o":orderedListCommand,"Mod-O":orderedListCommand,Tab:indent(),"Shift-Tab":outdent()}},OrderedList}(node),listItem_ListItem=function(_super){function ListItem(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(ListItem,_super),Object.defineProperty(ListItem.prototype,"name",{get:function(){return"listItem"},enumerable:!1,configurable:!0}),Object.defineProperty(ListItem.prototype,"schema",{get:function(){return{content:"paragraph listGroup*",attrs:{task:{default:!1},checked:{default:!1},rawHTML:{default:null}},defining:!0,parseDOM:[{tag:"li",getAttrs:function(dom){var rawHTML=dom.getAttribute("data-raw-html");return __assign({task:dom.hasAttribute("data-task"),checked:dom.hasAttribute("data-task-checked")},rawHTML&&{rawHTML:rawHTML})}}],toDOM:function(_a){var attrs=_a.attrs,task=attrs.task,checked=attrs.checked;if(!task)return[attrs.rawHTML||"li",0];var classNames=["task-list-item"];return checked&&classNames.push("checked"),[attrs.rawHTML||"li",__assign({class:classNames.join(" "),"data-task":task},checked&&{"data-task-checked":checked}),0]}}},enumerable:!1,configurable:!0}),ListItem.prototype.liftToPrevListItem=function(){return function(state,dispatch){var selection=state.selection,tr=state.tr,schema=state.schema,$from=selection.$from,empty=selection.empty,listItem=schema.nodes.listItem,parent=$from.parent,listItemParent=$from.node(-1);if(empty&&!parent.childCount&&listItemParent.type===listItem){if($from.index(-2)>=1)return tr.delete($from.start(-1)-1,$from.end(-1)),dispatch(tr),!0;var grandParentListItem;if($from.node(-3).type===listItem)return tr.delete($from.start(-2)-1,$from.end(-1)),dispatch(tr),!0}return!1}},ListItem.prototype.keymaps=function(){var split=function(state,dispatch){return splitListItem(state.schema.nodes.listItem)(state,dispatch)};return{Backspace:this.liftToPrevListItem(),Enter:split}},ListItem}(node),blockQuote_BlockQuote=function(_super){function BlockQuote(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(BlockQuote,_super),Object.defineProperty(BlockQuote.prototype,"name",{get:function(){return"blockQuote"},enumerable:!1,configurable:!0}),Object.defineProperty(BlockQuote.prototype,"schema",{get:function(){return{attrs:__assign({rawHTML:{default:null}},{htmlAttrs:{default:null},classNames:{default:null}}),content:"block+",group:"block",parseDOM:[createDOMInfoParsedRawHTML("blockquote")],toDOM:function(_a){var attrs;return["blockquote",getCustomAttrs(_a.attrs),0]}}},enumerable:!1,configurable:!0}),BlockQuote.prototype.commands=function(){return function(){return function(state,dispatch){return wrapIn(state.schema.nodes.blockQuote)(state,dispatch)}}},BlockQuote.prototype.keymaps=function(){var blockQutoeCommand=this.commands()();return{"Alt-q":blockQutoeCommand,"Alt-Q":blockQutoeCommand}},BlockQuote}(node),cellOffsetFnMap={left:getLeftCellOffset,right:getRightCellOffset,up:getUpCellOffset,down:getDownCellOffset},Direction;function isInFirstListItem(pos,doc,_a){var paraDepth=_a[0],listDepth=_a[1],listItemNode=doc.resolve(pos.before(paraDepth-1));return listDepth===paraDepth&&!listItemNode.nodeBefore}function isInLastListItem(pos){for(var _a,depth=pos.depth,parentNode;depth&&"tableBodyCell"!==(parentNode=pos.node(depth)).type.name;){if("listItem"===parentNode.type.name){var grandParent,lastListItem=pos.node(depth-1).lastChild===parentNode,hasChildren="paragraph"!==(null===(_a=parentNode.lastChild)||void 0===_a?void 0:_a.type.name);return!!lastListItem&&!hasChildren}depth-=1}return!1}function canMoveToBeforeCell(direction,_a,from,doc,inList){var paraDepth=_a[0],listDepth=_a[1],curDepth=_a[2];if(direction===Direction.LEFT||direction===Direction.UP){if(inList&&!isInFirstListItem(from,doc,[paraDepth,listDepth]))return!1;var endOffset=from.before(curDepth),nodeBefore;if(doc.resolve(endOffset).nodeBefore)return!1}return!0}function canMoveToAfterCell(direction,curDepth,from,doc,inList){if(direction===Direction.RIGHT||direction===Direction.DOWN){if(inList&&!isInLastListItem(from))return!1;var endOffset=from.after(curDepth),nodeAfter;if(doc.resolve(endOffset).nodeAfter)return!1}return!0}function canMoveBetweenCells(direction,_a,from,doc){var cellDepth=_a[0],paraDepth=_a[1],listDepth=cellDepth+3,inList=paraDepth>=listDepth,curDepth=inList?cellDepth+1:paraDepth,moveBeforeCell=canMoveToBeforeCell(direction,[paraDepth,listDepth,curDepth],from,doc,inList),moveAfterCell=canMoveToAfterCell(direction,curDepth,from,doc,inList);return moveBeforeCell&&moveAfterCell}function canBeOutOfTable(direction,map,_a){var rowIdx=_a[0],colIdx=_a[1],rowspanInfo=map.getRowspanStartInfo(rowIdx,colIdx),inFirstRow=direction===Direction.UP&&0===rowIdx,inLastRow=direction===Direction.DOWN&&((null==rowspanInfo?void 0:rowspanInfo.count)>1?rowIdx+rowspanInfo.count-1:rowIdx)===map.totalRowCount-1;return inFirstRow||inLastRow}function addParagraphBeforeTable(tr,map,schema){var tableStartPos=tr.doc.resolve(map.tableStartOffset-1);return tableStartPos.nodeBefore?tr.setSelection(Selection.near(tableStartPos,-1)):addParagraph(tr,tableStartPos,schema)}function addParagraphAfterTable(tr,map,schema){var tableEndPos=tr.doc.resolve(map.tableEndOffset);return tableEndPos.nodeAfter?tr.setSelection(Selection.near(tableEndPos,1)):addParagraph(tr,tableEndPos,schema)}function getRightCellOffset(_a,map){var rowIdx=_a[0],colIdx=_a[1],totalRowCount=map.totalRowCount,totalColumnCount=map.totalColumnCount,lastCellInRow=colIdx===totalColumnCount-1,lastCellInTable;if(!(rowIdx===totalRowCount-1&&lastCellInRow)){var nextColIdx=colIdx+1,colspanInfo=map.getColspanStartInfo(rowIdx,colIdx),offset;return(null==colspanInfo?void 0:colspanInfo.count)>1&&(nextColIdx+=colspanInfo.count-1),(lastCellInRow||nextColIdx===totalColumnCount)&&(rowIdx+=1,nextColIdx=0),map.getCellInfo(rowIdx,nextColIdx).offset+2}return null}function getLeftCellOffset(_a,map){var rowIdx=_a[0],colIdx=_a[1],totalColumnCount=map.totalColumnCount,firstCellInRow=0===colIdx,firstCellInTable;if(!(0===rowIdx&&firstCellInRow)){colIdx-=1,firstCellInRow&&(rowIdx-=1,colIdx=totalColumnCount-1);var _b=map.getCellInfo(rowIdx,colIdx),offset,nodeSize;return _b.offset+_b.nodeSize-2}return null}function getUpCellOffset(_a,map){var rowIdx=_a[0],colIdx=_a[1];if(rowIdx>0){var _b=map.getCellInfo(rowIdx-1,colIdx),offset,nodeSize;return _b.offset+_b.nodeSize-2}return null}function getDownCellOffset(_a,map){var rowIdx=_a[0],colIdx=_a[1],totalRowCount;if(rowIdx<map.totalRowCount-1){var nextRowIdx=rowIdx+1,rowspanInfo=map.getRowspanStartInfo(rowIdx,colIdx),offset;return(null==rowspanInfo?void 0:rowspanInfo.count)>1&&(nextRowIdx+=rowspanInfo.count-1),map.getCellInfo(nextRowIdx,colIdx).offset+2}return null}function moveToCell(direction,tr,cellIndex,map){var cellOffsetFn,offset=(0,cellOffsetFnMap[direction])(cellIndex,map);if(offset){var dir=direction===Direction.RIGHT||direction===Direction.DOWN?1:-1;return tr.setSelection(Selection.near(tr.doc.resolve(offset),dir))}return null}function canSelectTableNode(direction,map,_a){var rowIdx=_a[0],colIdx=_a[1];if(direction===Direction.UP||direction===Direction.DOWN)return!1;var tableStartOffset=map.tableStartOffset,tableEndOffset=map.tableEndOffset,_b=map.getCellInfo(rowIdx,colIdx),offset=_b.offset,nodeSize=_b.nodeSize,pos,curPos;return(direction===Direction.LEFT?tableStartOffset:tableEndOffset)===(direction===Direction.LEFT?offset-2:offset+nodeSize+3)}function selectNode(tr,pos,depth){var tablePos=tr.doc.resolve(pos.before(depth-3));return tr.setSelection(new index_es_NodeSelection(tablePos))}function getTargetRowInfo(direction,map,selectionInfo){var targetRowIdx,insertColIdx,nodeSize;return direction===Direction.UP?(targetRowIdx=selectionInfo.startRowIdx,insertColIdx=0,nodeSize=-1):(targetRowIdx=selectionInfo.endRowIdx,insertColIdx=map.totalColumnCount-1,nodeSize=map.getCellInfo(targetRowIdx,insertColIdx).nodeSize+1),{targetRowIdx:targetRowIdx,insertColIdx:insertColIdx,nodeSize:nodeSize}}function getRowRanges(map,rowIdx,totalColumnCount){var startOffset=map.getCellInfo(rowIdx,0).offset,_a=map.getCellInfo(rowIdx,totalColumnCount-1),offset,nodeSize;return{from:startOffset,to:_a.offset+_a.nodeSize}}!function(Direction){Direction.LEFT="left",Direction.RIGHT="right",Direction.UP="up",Direction.DOWN="down"}(Direction||(Direction={}));var table_Table=function(_super){function Table(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(Table,_super),Object.defineProperty(Table.prototype,"name",{get:function(){return"table"},enumerable:!1,configurable:!0}),Object.defineProperty(Table.prototype,"schema",{get:function(){return{content:"tableHead{1} tableBody{1}",group:"block",attrs:__assign({rawHTML:{default:null}},{htmlAttrs:{default:null},classNames:{default:null}}),parseDOM:[createDOMInfoParsedRawHTML("table")],toDOM:function(_a){var attrs;return["table",getCustomAttrs(_a.attrs),0]}}},enumerable:!1,configurable:!0}),Table.prototype.addTable=function(){return function(payload){return void 0===payload&&(payload={rowCount:2,columnCount:1,data:[]}),function(state,dispatch){var rowCount=payload.rowCount,columnCount=payload.columnCount,data=payload.data,schema=state.schema,selection=state.selection,tr=state.tr,from=selection.from,to=selection.to,$from=selection.$from,collapsed;if(from===to&&!isInTableNode($from)){var _a=schema.nodes,tableHead=_a.tableHead,tableBody=_a.tableBody,theadData=null==data?void 0:data.slice(0,columnCount),tbodyData=null==data?void 0:data.slice(columnCount,data.length),tableHeadRow=createTableHeadRow(columnCount,schema,theadData),tableBodyRows=createTableBodyRows(rowCount-1,columnCount,schema,tbodyData),table=schema.nodes.table.create(null,[tableHead.create(null,tableHeadRow),tableBody.create(null,tableBodyRows)]);return dispatch(tr.replaceSelectionWith(table)),!0}return!1}}},Table.prototype.removeTable=function(){return function(){return function(state,dispatch){var selection=state.selection,tr=state.tr,map=TableOffsetMap.create(selection.$anchor);if(map){var tableStartOffset=map.tableStartOffset,tableEndOffset=map.tableEndOffset,startOffset=tableStartOffset-1,cursorPos=createTextSelection(tr.delete(startOffset,tableEndOffset),startOffset);return dispatch(tr.setSelection(cursorPos)),!0}return!1}}},Table.prototype.addColumn=function(direction){return function(){return function(state,dispatch){var selection=state.selection,tr=state.tr,schema=state.schema,_a=getResolvedSelection(selection),anchor=_a.anchor,head=_a.head;if(anchor&&head){for(var map=TableOffsetMap.create(anchor),selectionInfo=map.getRectOffsets(anchor,head),targetColIdx=direction===Direction.LEFT?selectionInfo.startColIdx:selectionInfo.endColIdx+1,columnCount=getRowAndColumnCount(selectionInfo).columnCount,totalRowCount=map.totalRowCount,rowIdx=0;rowIdx<totalRowCount;rowIdx+=1){var cells=createDummyCells(columnCount,rowIdx,schema);tr.insert(tr.mapping.map(map.posAt(rowIdx,targetColIdx)),cells)}return dispatch(tr),!0}return!1}}},Table.prototype.removeColumn=function(){return function(){return function(state,dispatch){var selection=state.selection,tr=state.tr,_a=getResolvedSelection(selection),anchor=_a.anchor,head=_a.head;if(anchor&&head){var map=TableOffsetMap.create(anchor),selectionInfo=map.getRectOffsets(anchor,head),totalColumnCount=map.totalColumnCount,totalRowCount=map.totalRowCount,columnCount,selectedAllColumn;if(getRowAndColumnCount(selectionInfo).columnCount===totalColumnCount)return!1;for(var startColIdx=selectionInfo.startColIdx,endColIdx=selectionInfo.endColIdx,mapStart=tr.mapping.maps.length,rowIdx=0;rowIdx<totalRowCount;rowIdx+=1)for(var colIdx=endColIdx;colIdx>=startColIdx;colIdx-=1){var _b=map.getCellInfo(rowIdx,colIdx),offset=_b.offset,nodeSize=_b.nodeSize,from=tr.mapping.slice(mapStart).map(offset),to=from+nodeSize;tr.delete(from,to)}return dispatch(tr),!0}return!1}}},Table.prototype.addRow=function(direction){return function(){return function(state,dispatch){var selection=state.selection,schema=state.schema,tr=state.tr,_a=getResolvedSelection(selection),anchor=_a.anchor,head=_a.head;if(anchor&&head){var map=TableOffsetMap.create(anchor),totalColumnCount=map.totalColumnCount,selectionInfo=map.getRectOffsets(anchor,head),rowCount=getRowAndColumnCount(selectionInfo).rowCount,_b=getTargetRowInfo(direction,map,selectionInfo),targetRowIdx=_b.targetRowIdx,insertColIdx=_b.insertColIdx,nodeSize=_b.nodeSize,selectedThead;if(!(0===targetRowIdx)){for(var rows=[],from=tr.mapping.map(map.posAt(targetRowIdx,insertColIdx))+nodeSize,cells=[],colIdx=0;colIdx<totalColumnCount;colIdx+=1)cells=cells.concat(createDummyCells(1,targetRowIdx,schema));for(var i=0;i<rowCount;i+=1)rows.push(schema.nodes.tableRow.create(null,cells));return dispatch(tr.insert(from,rows)),!0}}return!1}}},Table.prototype.removeRow=function(){return function(){return function(state,dispatch){var selection=state.selection,tr=state.tr,_a=getResolvedSelection(selection),anchor=_a.anchor,head=_a.head;if(anchor&&head){var map=TableOffsetMap.create(anchor),totalRowCount=map.totalRowCount,totalColumnCount=map.totalColumnCount,selectionInfo=map.getRectOffsets(anchor,head),rowCount=getRowAndColumnCount(selectionInfo).rowCount,startRowIdx=selectionInfo.startRowIdx,endRowIdx=selectionInfo.endRowIdx,selectedThead,selectedAllTbodyRow;if(rowCount===totalRowCount-1||0===startRowIdx)return!1;for(var rowIdx=endRowIdx;rowIdx>=startRowIdx;rowIdx-=1){var _b=getRowRanges(map,rowIdx,totalColumnCount),from=_b.from,to=_b.to;tr.delete(from-1,to+1)}return dispatch(tr),!0}return!1}}},Table.prototype.alignColumn=function(){return function(payload){return void 0===payload&&(payload={align:"center"}),function(state,dispatch){var align=payload.align,selection=state.selection,tr=state.tr,_a=getResolvedSelection(selection),anchor=_a.anchor,head=_a.head;if(anchor&&head){for(var map=TableOffsetMap.create(anchor),totalRowCount=map.totalRowCount,selectionInfo=map.getRectOffsets(anchor,head),startColIdx=selectionInfo.startColIdx,endColIdx=selectionInfo.endColIdx,rowIdx=0;rowIdx<totalRowCount;rowIdx+=1)for(var colIdx=startColIdx;colIdx<=endColIdx;colIdx+=1)if(!map.extendedRowspan(rowIdx,colIdx)&&!map.extendedColspan(rowIdx,colIdx)){var _b=map.getNodeAndPos(rowIdx,colIdx),node=_b.node,pos=_b.pos,attrs=setAttrs(node,{align:align});tr.setNodeMarkup(pos,null,attrs)}return dispatch(tr),!0}return!1}}},Table.prototype.moveToCell=function(direction){return function(state,dispatch){var selection=state.selection,tr=state.tr,schema=state.schema,_a=getResolvedSelection(selection),anchor=_a.anchor,head=_a.head;if(anchor&&head){var map=TableOffsetMap.create(anchor),cellIndex=map.getCellIndex(anchor),newTr=void 0;if(newTr=canBeOutOfTable(direction,map,cellIndex)?addParagraphAfterTable(tr,map,schema):moveToCell(direction,tr,cellIndex,map))return dispatch(newTr),!0}return!1}},Table.prototype.moveInCell=function(direction){var _this=this;return function(state,dispatch){var selection=state.selection,tr=state.tr,doc=state.doc,schema=state.schema,$from=selection.$from,view;if(!_this.context.view.endOfTextblock(direction))return!1;var cell=findNodeBy($from,(function(_a){var type=_a.type;return"tableHeadCell"===type.name||"tableBodyCell"===type.name}));if(cell){var para=findNodeBy($from,(function(_a){var type;return"paragraph"===_a.type.name})),cellDepth=cell.depth;if(para&&canMoveBetweenCells(direction,[cellDepth,para.depth],$from,doc)){var anchor=getResolvedSelection(selection).anchor,map=TableOffsetMap.create(anchor),cellIndex=map.getCellIndex(anchor),newTr=void 0;if(canSelectTableNode(direction,map,cellIndex)?newTr=selectNode(tr,$from,cellDepth):canBeOutOfTable(direction,map,cellIndex)?direction===Direction.UP?newTr=addParagraphBeforeTable(tr,map,schema):direction===Direction.DOWN&&(newTr=addParagraphAfterTable(tr,map,schema)):newTr=moveToCell(direction,tr,cellIndex,map),newTr)return dispatch(newTr),!0}}return!1}},Table.prototype.deleteCells=function(){return function(state,dispatch){var schema=state.schema,selection=state.selection,tr=state.tr,_a=getResolvedSelection(selection),anchor=_a.anchor,head=_a.head,textSelection;if(anchor&&head&&!(selection instanceof TextSelection)){for(var map=TableOffsetMap.create(anchor),_b=map.getRectOffsets(anchor,head),startRowIdx=_b.startRowIdx,startColIdx=_b.startColIdx,endRowIdx=_b.endRowIdx,endColIdx=_b.endColIdx,rowIdx=startRowIdx;rowIdx<=endRowIdx;rowIdx+=1)for(var colIdx=startColIdx;colIdx<=endColIdx;colIdx+=1)if(!map.extendedRowspan(rowIdx,colIdx)&&!map.extendedColspan(rowIdx,colIdx)){var _c=map.getNodeAndPos(rowIdx,colIdx),node=_c.node,pos=_c.pos,cells=createDummyCells(1,rowIdx,schema,node.attrs);tr.replaceWith(tr.mapping.map(pos),tr.mapping.map(pos+node.nodeSize),cells)}return dispatch(tr),!0}return!1}},Table.prototype.commands=function(){return{addTable:this.addTable(),removeTable:this.removeTable(),addColumnToLeft:this.addColumn(Direction.LEFT),addColumnToRight:this.addColumn(Direction.RIGHT),removeColumn:this.removeColumn(),addRowToUp:this.addRow(Direction.UP),addRowToDown:this.addRow(Direction.DOWN),removeRow:this.removeRow(),alignColumn:this.alignColumn()}},Table.prototype.keymaps=function(){var deleteCellContent=this.deleteCells();return{Tab:this.moveToCell(Direction.RIGHT),"Shift-Tab":this.moveToCell(Direction.LEFT),ArrowUp:this.moveInCell(Direction.UP),ArrowDown:this.moveInCell(Direction.DOWN),ArrowLeft:this.moveInCell(Direction.LEFT),ArrowRight:this.moveInCell(Direction.RIGHT),Backspace:deleteCellContent,"Mod-Backspace":deleteCellContent,Delete:deleteCellContent,"Mod-Delete":deleteCellContent}},Table}(node),TableHead=function(_super){function TableHead(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(TableHead,_super),Object.defineProperty(TableHead.prototype,"name",{get:function(){return"tableHead"},enumerable:!1,configurable:!0}),Object.defineProperty(TableHead.prototype,"schema",{get:function(){return{content:"tableRow{1}",attrs:__assign({rawHTML:{default:null}},{htmlAttrs:{default:null},classNames:{default:null}}),parseDOM:[createDOMInfoParsedRawHTML("thead")],toDOM:function(_a){var attrs;return["thead",getCustomAttrs(_a.attrs),0]}}},enumerable:!1,configurable:!0}),TableHead}(node),TableBody=function(_super){function TableBody(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(TableBody,_super),Object.defineProperty(TableBody.prototype,"name",{get:function(){return"tableBody"},enumerable:!1,configurable:!0}),Object.defineProperty(TableBody.prototype,"schema",{get:function(){return{content:"tableRow+",attrs:__assign({rawHTML:{default:null}},{htmlAttrs:{default:null},classNames:{default:null}}),parseDOM:[{tag:"tbody",getAttrs:function(dom){var rows,columns=dom.querySelectorAll("tr")[0].children.length,rawHTML=dom.getAttribute("data-raw-html");return!!columns&&__assign({},rawHTML&&{rawHTML:rawHTML})}}],toDOM:function(_a){var attrs;return["tbody",getCustomAttrs(_a.attrs),0]}}},enumerable:!1,configurable:!0}),TableBody}(node),TableRow=function(_super){function TableRow(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(TableRow,_super),Object.defineProperty(TableRow.prototype,"name",{get:function(){return"tableRow"},enumerable:!1,configurable:!0}),Object.defineProperty(TableRow.prototype,"schema",{get:function(){return{content:"(tableHeadCell | tableBodyCell)*",attrs:__assign({rawHTML:{default:null}},{htmlAttrs:{default:null},classNames:{default:null}}),parseDOM:[{tag:"tr",getAttrs:function(dom){var columns=dom.children.length,rawHTML=dom.getAttribute("data-raw-html");return!!columns&&__assign({},rawHTML&&{rawHTML:rawHTML})}}],toDOM:function(_a){var attrs;return["tr",getCustomAttrs(_a.attrs),0]}}},enumerable:!1,configurable:!0}),TableRow}(node),TableHeadCell=function(_super){function TableHeadCell(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(TableHeadCell,_super),Object.defineProperty(TableHeadCell.prototype,"name",{get:function(){return"tableHeadCell"},enumerable:!1,configurable:!0}),Object.defineProperty(TableHeadCell.prototype,"schema",{get:function(){return{content:"paragraph+",attrs:__assign({align:{default:null},className:{default:null},rawHTML:{default:null},colspan:{default:null},extended:{default:null}},{htmlAttrs:{default:null},classNames:{default:null}}),isolating:!0,parseDOM:[createParsedCellDOM("th")],toDOM:function(_a){var attrs=_a.attrs,cellAttrs=createCellAttrs(attrs);return["th",__assign(__assign({},cellAttrs),getCustomAttrs(attrs)),0]}}},enumerable:!1,configurable:!0}),TableHeadCell}(node),TableBodyCell=function(_super){function TableBodyCell(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(TableBodyCell,_super),Object.defineProperty(TableBodyCell.prototype,"name",{get:function(){return"tableBodyCell"},enumerable:!1,configurable:!0}),Object.defineProperty(TableBodyCell.prototype,"schema",{get:function(){return{content:"(paragraph | bulletList | orderedList)+",attrs:{align:{default:null},className:{default:null},rawHTML:{default:null},colspan:{default:null},rowspan:{default:null},extended:{default:null}},isolating:!0,parseDOM:[createParsedCellDOM("td")],toDOM:function(_a){var attrs,cellAttrs;return["td",createCellAttrs(_a.attrs),0]}}},enumerable:!1,configurable:!0}),TableBodyCell}(node),Image=function(_super){function Image(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(Image,_super),Object.defineProperty(Image.prototype,"name",{get:function(){return"image"},enumerable:!1,configurable:!0}),Object.defineProperty(Image.prototype,"schema",{get:function(){return{inline:!0,attrs:__assign({imageUrl:{default:""},altText:{default:null},rawHTML:{default:null}},{htmlAttrs:{default:null},classNames:{default:null}}),group:"inline",selectable:!1,parseDOM:[{tag:"img[src]",getAttrs:function(dom){var imageUrl=dom.getAttribute("src")||"",rawHTML=dom.getAttribute("data-raw-html");return __assign({imageUrl:sanitizeXSSAttributeValue(imageUrl),altText:dom.getAttribute("alt")},rawHTML&&{rawHTML:rawHTML})}}],toDOM:function(_a){var attrs=_a.attrs;return[attrs.rawHTML||"img",__assign(__assign({src:attrs.imageUrl},attrs.altText&&{alt:attrs.altText}),getCustomAttrs(attrs))]}}},enumerable:!1,configurable:!0}),Image.prototype.addImage=function(){return function(payload){return function(_a,dispatch){var schema=_a.schema,tr=_a.tr,_b=payload,imageUrl=_b.imageUrl,altText=_b.altText;if(!imageUrl)return!1;var node=schema.nodes.image.createAndFill(__assign({imageUrl:encodeMarkdownText(imageUrl)},altText&&{altText:altText}));return dispatch(tr.replaceSelectionWith(node).scrollIntoView()),!0}}},Image.prototype.commands=function(){return{addImage:this.addImage()}},Image}(node),ROOT_BLOCK_DEPTH=1,thematicBreak_ThematicBreak=function(_super){function ThematicBreak(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(ThematicBreak,_super),Object.defineProperty(ThematicBreak.prototype,"name",{get:function(){return"thematicBreak"},enumerable:!1,configurable:!0}),Object.defineProperty(ThematicBreak.prototype,"schema",{get:function(){return{attrs:__assign({rawHTML:{default:null}},{htmlAttrs:{default:null},classNames:{default:null}}),group:"block",parseDOM:[{tag:"hr"}],selectable:!1,toDOM:function(_a){var attrs=_a.attrs;return["div",getCustomAttrs(attrs),[attrs.rawHTML||"hr"]]}}},enumerable:!1,configurable:!0}),ThematicBreak.prototype.hr=function(){var _this=this;return function(){return function(state,dispatch){var _a,_b=state.selection,$from=_b.$from,$to;if($from===_b.$to){var doc=state.doc,_c=state.schema.nodes,thematicBreak=_c.thematicBreak,paragraph=_c.paragraph,nodes=[thematicBreak.create()],rootBlock=$from.node(1),lastBlock=doc.child(doc.childCount-1)===rootBlock,blockEnd=doc.resolve($from.after(1)),nextHr=(null===(_a=$from.nodeAfter)||void 0===_a?void 0:_a.type.name)===_this.name;return(lastBlock||nextHr)&&nodes.push(paragraph.create()),dispatch(state.tr.insert(blockEnd.pos,nodes).scrollIntoView()),!0}return!1}}},ThematicBreak.prototype.commands=function(){return{hr:this.hr()}},ThematicBreak.prototype.keymaps=function(){var hrCommand=this.hr()();return{"Mod-l":hrCommand,"Mod-L":hrCommand}},ThematicBreak}(node),strong_Strong=function(_super){function Strong(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(Strong,_super),Object.defineProperty(Strong.prototype,"name",{get:function(){return"strong"},enumerable:!1,configurable:!0}),Object.defineProperty(Strong.prototype,"schema",{get:function(){var parseDOM=["b","strong"].map((function(tag){return{tag:tag,getAttrs:function(dom){var rawHTML=dom.getAttribute("data-raw-html");return __assign({},rawHTML&&{rawHTML:rawHTML})}}}));return{attrs:__assign({rawHTML:{default:null}},{htmlAttrs:{default:null},classNames:{default:null}}),parseDOM:parseDOM,toDOM:function(_a){var attrs=_a.attrs;return[attrs.rawHTML||"strong",getCustomAttrs(attrs)]}}},enumerable:!1,configurable:!0}),Strong.prototype.bold=function(){return function(){return function(state,dispatch){return toggleMark(state.schema.marks.strong)(state,dispatch)}}},Strong.prototype.commands=function(){return{bold:this.bold()}},Strong.prototype.keymaps=function(){var boldCommand=this.bold()();return{"Mod-b":boldCommand,"Mod-B":boldCommand}},Strong}(mark),emph_Emph=function(_super){function Emph(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(Emph,_super),Object.defineProperty(Emph.prototype,"name",{get:function(){return"emph"},enumerable:!1,configurable:!0}),Object.defineProperty(Emph.prototype,"schema",{get:function(){var parseDOM=["i","em"].map((function(tag){return{tag:tag,getAttrs:function(dom){var rawHTML=dom.getAttribute("data-raw-html");return __assign({},rawHTML&&{rawHTML:rawHTML})}}}));return{attrs:__assign({rawHTML:{default:null}},{htmlAttrs:{default:null},classNames:{default:null}}),parseDOM:parseDOM,toDOM:function(_a){var attrs=_a.attrs;return[attrs.rawHTML||"em",getCustomAttrs(attrs)]}}},enumerable:!1,configurable:!0}),Emph.prototype.italic=function(){return function(){return function(state,dispatch){return toggleMark(state.schema.marks.emph)(state,dispatch)}}},Emph.prototype.commands=function(){return{italic:this.italic()}},Emph.prototype.keymaps=function(){var italicCommand=this.italic()();return{"Mod-i":italicCommand,"Mod-I":italicCommand}},Emph}(mark),strike_Strike=function(_super){function Strike(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(Strike,_super),Object.defineProperty(Strike.prototype,"name",{get:function(){return"strike"},enumerable:!1,configurable:!0}),Object.defineProperty(Strike.prototype,"schema",{get:function(){var parseDOM=["s","del"].map((function(tag){return{tag:tag,getAttrs:function(dom){var rawHTML=dom.getAttribute("data-raw-html");return __assign({},rawHTML&&{rawHTML:rawHTML})}}}));return{attrs:__assign({rawHTML:{default:null}},{htmlAttrs:{default:null},classNames:{default:null}}),parseDOM:parseDOM,toDOM:function(_a){var attrs=_a.attrs;return[attrs.rawHTML||"del",getCustomAttrs(attrs)]}}},enumerable:!1,configurable:!0}),Strike.prototype.commands=function(){return function(){return function(state,dispatch){return toggleMark(state.schema.marks.strike)(state,dispatch)}}},Strike.prototype.keymaps=function(){var strikeCommand=this.commands()();return{"Mod-s":strikeCommand,"Mod-S":strikeCommand}},Strike}(mark),link_Link=function(_super){function Link(linkAttributes){var _this=_super.call(this)||this;return _this.linkAttributes=linkAttributes,_this}return __extends(Link,_super),Object.defineProperty(Link.prototype,"name",{get:function(){return"link"},enumerable:!1,configurable:!0}),Object.defineProperty(Link.prototype,"schema",{get:function(){var _this=this;return{attrs:__assign({linkUrl:{default:""},linkText:{default:null},rawHTML:{default:null}},{htmlAttrs:{default:null},classNames:{default:null}}),inclusive:!1,parseDOM:[{tag:"a[href]",getAttrs:function(dom){var href=dom.getAttribute("href")||"",rawHTML=dom.getAttribute("data-raw-html");return __assign({linkUrl:sanitizeXSSAttributeValue(href),linkText:dom.textContent},rawHTML&&{rawHTML:rawHTML})}}],toDOM:function(_a){var attrs=_a.attrs;return[attrs.rawHTML||"a",__assign(__assign({href:attrs.linkUrl},_this.linkAttributes),getCustomAttrs(attrs))]}}},enumerable:!1,configurable:!0}),Link.prototype.addLink=function(){return function(payload){return function(state,dispatch){var _a=payload,linkUrl=_a.linkUrl,_b=_a.linkText,linkText=void 0===_b?"":_b,schema=state.schema,tr=state.tr,selection=state.selection,empty=selection.empty,from=selection.from,to=selection.to;if(from&&to&&linkUrl){var attrs={linkUrl:encodeMarkdownText(linkUrl),linkText:escapeMarkdownText(linkText)},mark=schema.mark("link",attrs);if(empty&&linkText){var node=createTextNode(schema,linkText,mark);tr.replaceRangeWith(from,to,node)}else tr.addMark(from,to,mark);return dispatch(tr.scrollIntoView()),!0}return!1}}},Link.prototype.toggleLink=function(){return function(payload){return function(state,dispatch){return toggleMark(state.schema.marks.link,payload)(state,dispatch)}}},Link.prototype.commands=function(){return{addLink:this.addLink(),toggleLink:this.toggleLink()}},Link}(mark),code_Code=function(_super){function Code(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(Code,_super),Object.defineProperty(Code.prototype,"name",{get:function(){return"code"},enumerable:!1,configurable:!0}),Object.defineProperty(Code.prototype,"schema",{get:function(){return{attrs:__assign({rawHTML:{default:null}},{htmlAttrs:{default:null},classNames:{default:null}}),parseDOM:[{tag:"code",getAttrs:function(dom){var rawHTML=dom.getAttribute("data-raw-html");return __assign({},rawHTML&&{rawHTML:rawHTML})}}],toDOM:function(_a){var attrs=_a.attrs;return[attrs.rawHTML||"code",getCustomAttrs(attrs)]}}},enumerable:!1,configurable:!0}),Code.prototype.commands=function(){return function(){return function(state,dispatch){return toggleMark(state.schema.marks.code)(state,dispatch)}}},Code.prototype.keymaps=function(){var codeCommand=this.commands()();return{"Shift-Mod-c":codeCommand,"Shift-Mod-C":codeCommand}},Code}(mark),customBlock_CustomBlock=function(_super){function CustomBlock(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(CustomBlock,_super),Object.defineProperty(CustomBlock.prototype,"name",{get:function(){return"customBlock"},enumerable:!1,configurable:!0}),Object.defineProperty(CustomBlock.prototype,"schema",{get:function(){return{content:"text*",group:"block",attrs:{info:{default:null}},atom:!0,code:!0,defining:!0,parseDOM:[{tag:"div[data-custom-info]",getAttrs:function(dom){var info;return{info:dom.getAttribute("data-custom-info")}}}],toDOM:function(_a){var attrs;return["div",{"data-custom-info":_a.attrs.info||null},0]}}},enumerable:!1,configurable:!0}),CustomBlock}(node),FrontMatter=function(_super){function FrontMatter(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(FrontMatter,_super),Object.defineProperty(FrontMatter.prototype,"name",{get:function(){return"frontMatter"},enumerable:!1,configurable:!0}),Object.defineProperty(FrontMatter.prototype,"schema",{get:function(){return{content:"text*",group:"block",code:!0,parseDOM:[{tag:"div[data-front-matter]"}],toDOM:function(){return["div",{"data-front-matter":"true"},0]}}},enumerable:!1,configurable:!0}),FrontMatter.prototype.commands=function(){return function(){return function(state,dispatch,view){var $from=state.selection.$from;return!(!view.endOfTextblock("down")||"frontMatter"!==$from.node().type.name)&&exitCode(state,dispatch)}}},FrontMatter.prototype.keymaps=function(){return{Enter:this.commands()()}},FrontMatter}(node);function createSpecs(linkAttributes){return new specManager([new doc_Doc,new paragraph_Paragraph,new text_Text,new heading_Heading,new codeBlock_CodeBlock,new BulletList,new OrderedList,new listItem_ListItem,new blockQuote_BlockQuote,new table_Table,new TableHead,new TableBody,new TableRow,new TableHeadCell,new TableBodyCell,new Image,new thematicBreak_ThematicBreak,new strong_Strong,new emph_Emph,new strike_Strike,new link_Link(linkAttributes),new code_Code,new customBlock_CustomBlock,new FrontMatter,new Widget])}var CONTENTS_CLASS_NAME=cls("contents"),WysiwygEditor,wwEditor=function(_super){function WysiwygEditor(eventEmitter,options){var _this=_super.call(this,eventEmitter)||this,toDOMAdaptor=options.toDOMAdaptor,_a=options.htmlSchemaMap,htmlSchemaMap=void 0===_a?{}:_a,_b=options.linkAttributes,linkAttributes=void 0===_b?{}:_b,_c=options.useCommandShortcut,useCommandShortcut=void 0===_c||_c,_d=options.wwPlugins,wwPlugins=void 0===_d?[]:_d,_e=options.wwNodeViews,wwNodeViews=void 0===_e?{}:_e;return _this.editorType="wysiwyg",_this.el.classList.add("ww-mode"),_this.toDOMAdaptor=toDOMAdaptor,_this.linkAttributes=linkAttributes,_this.extraPlugins=wwPlugins,_this.pluginNodeViews=wwNodeViews,_this.specs=_this.createSpecs(),_this.schema=_this.createSchema(htmlSchemaMap),_this.context=_this.createContext(),_this.keymaps=_this.createKeymaps(useCommandShortcut),_this.view=_this.createView(),_this.commands=_this.createCommands(),_this.specs.setContext(__assign(__assign({},_this.context),{view:_this.view})),_this.initEvent(),_this}return __extends(WysiwygEditor,_super),WysiwygEditor.prototype.createSpecs=function(){return createSpecs(this.linkAttributes)},WysiwygEditor.prototype.createContext=function(){return{schema:this.schema,eventEmitter:this.eventEmitter}},WysiwygEditor.prototype.createSchema=function(htmlSchemaMap){return new Schema({nodes:__assign(__assign({},this.specs.nodes),htmlSchemaMap.nodes),marks:__assign(__assign({},this.specs.marks),htmlSchemaMap.marks)})},WysiwygEditor.prototype.createPlugins=function(){return this.defaultPlugins.concat(__spreadArray([tableSelection(),tableContextMenu(this.eventEmitter),task(),toolbarState(this.eventEmitter)],this.createPluginProps()))},WysiwygEditor.prototype.createPluginNodeViews=function(){var _a=this,eventEmitter=_a.eventEmitter,pluginNodeViews=_a.pluginNodeViews,pluginNodeViewMap={};return pluginNodeViews&&Object.keys(pluginNodeViews).forEach((function(key){pluginNodeViewMap[key]=function(node,view,getPos){return pluginNodeViews[key](node,view,getPos,eventEmitter)}})),pluginNodeViewMap},WysiwygEditor.prototype.createView=function(){var _this=this,_a=this,toDOMAdaptor=_a.toDOMAdaptor,eventEmitter=_a.eventEmitter;return new EditorView(this.el,{state:this.createState(),attributes:{class:CONTENTS_CLASS_NAME},nodeViews:__assign({customBlock:function(node,view,getPos){return new CustomBlockView(node,view,getPos,toDOMAdaptor)},image:function(node,view,getPos){return new ImageView(node,view,getPos,eventEmitter)},codeBlock:function(node,view,getPos){return new CodeBlockView(node,view,getPos,eventEmitter)},widget:widgetNodeView},this.createPluginNodeViews()),dispatchTransaction:function(tr){var state=_this.view.state.applyTransaction(tr).state;_this.view.updateState(state),_this.emitChangeEvent(tr.scrollIntoView()),_this.eventEmitter.emit("setFocusedNode",state.selection.$from.node(1))},transformPastedHTML:changePastedHTML,transformPasted:function(slice){return changePastedSlice(slice,_this.schema)},handlePaste:function(view,_,slice){return pasteToTable(view,slice)},handleKeyDown:function(_,ev){return _this.eventEmitter.emit("keydown",_this.editorType,ev),!1},handleDOMEvents:{paste:function(_,ev){var clipboardData=ev.clipboardData||window.clipboardData,items=clipboardData&&clipboardData.items;if(items){var imageBlob=pasteImageOnly(items);imageBlob&&(ev.preventDefault(),emitImageBlobHook(_this.eventEmitter,imageBlob,ev.type))}return!1},keyup:function(_,ev){return _this.eventEmitter.emit("keyup",_this.editorType,ev),!1},scroll:function(){return _this.eventEmitter.emit("scroll","editor"),!0}}})},WysiwygEditor.prototype.createCommands=function(){return this.specs.commands(this.view,getWwCommands())},WysiwygEditor.prototype.getHTML=function(){return this.view.dom.innerHTML},WysiwygEditor.prototype.getModel=function(){return this.view.state.doc},WysiwygEditor.prototype.getSelection=function(){var _a=this.view.state.selection,from,to;return[_a.from,_a.to]},WysiwygEditor.prototype.getSchema=function(){return this.view.state.schema},WysiwygEditor.prototype.replaceSelection=function(text,start,end){var _a=this.view.state,schema=_a.schema,tr=_a.tr,lineTexts,paras=text.split("\n").map((function(lineText){return createParagraph(schema,createNodesWithWidget(lineText,schema))})),slice=new Slice(Fragment.from(paras),1,1),newTr=isNumber_default()(start)&&isNumber_default()(end)?tr.replaceRange(start,end,slice):tr.replaceSelection(slice);this.view.dispatch(newTr),this.focus()},WysiwygEditor.prototype.deleteSelection=function(start,end){var tr=this.view.state.tr,newTr=isNumber_default()(start)&&isNumber_default()(end)?tr.deleteRange(start,end):tr.deleteSelection();this.view.dispatch(newTr.scrollIntoView())},WysiwygEditor.prototype.getSelectedText=function(start,end){var _a=this.view.state,doc=_a.doc,selection=_a.selection,from=selection.from,to=selection.to;return isNumber_default()(start)&&isNumber_default()(end)&&(from=start,to=end),doc.textBetween(from,to,"\n")},WysiwygEditor.prototype.setModel=function(newDoc,cursorToEnd){void 0===cursorToEnd&&(cursorToEnd=!1);var _a=this.view.state,tr=_a.tr,doc=_a.doc;this.view.dispatch(tr.replaceWith(0,doc.content.size,newDoc)),cursorToEnd&&this.moveCursorToEnd()},WysiwygEditor.prototype.setSelection=function(start,end){void 0===end&&(end=start);var tr=this.view.state.tr,selection=createTextSelection(tr,start,end);this.view.dispatch(tr.setSelection(selection).scrollIntoView())},WysiwygEditor.prototype.addWidget=function(node,style,pos){var _a=this.view,dispatch=_a.dispatch,state=_a.state;dispatch(state.tr.setMeta("widget",{pos:null!=pos?pos:state.selection.to,node:node,style:style}))},WysiwygEditor.prototype.replaceWithWidget=function(start,end,text){var _a=this.view.state,tr=_a.tr,schema,nodes=createNodesWithWidget(text,_a.schema);this.view.dispatch(tr.replaceWith(start,end,nodes))},WysiwygEditor.prototype.getRangeInfoOfNode=function(pos){var _a=this.view.state,doc=_a.doc,selection=_a.selection,$pos=pos?doc.resolve(pos):selection.$from,marks=$pos.marks(),node=$pos.node(),start=$pos.start(),end=$pos.end(),type=node.type.name;if(marks.length||"paragraph"===type){var mark_1=marks[marks.length-1],maybeHasMark_1=function(nodeMarks){return!nodeMarks.length||common_includes(nodeMarks,mark_1)};type=mark_1?mark_1.type.name:"text",node.forEach((function(child,offset){var isText=child.isText,nodeSize=child.nodeSize,nodeMarks=child.marks,startOffset=$pos.pos-start;isText&&offset<=startOffset&&offset+nodeSize>=startOffset&&maybeHasMark_1(nodeMarks)&&(end=(start+=offset)+nodeSize)}))}return{range:[start,end],type:type}},WysiwygEditor}(src_base),isFalsy=__webpack_require__(404),isFalsy_default=__webpack_require__.n(isFalsy),eventTypeList=["afterPreviewRender","updatePreview","changeMode","needChangeMode","command","changePreviewStyle","changePreviewTabPreview","changePreviewTabWrite","scroll","contextmenu","show","hide","changeLanguage","changeToolbarState","toggleScrollSync","mixinTableOffsetMapPrototype","setFocusedNode","removePopupWidget","openPopup","closePopup","addImageBlobHook","beforePreviewRender","beforeConvertWysiwygToMarkdown","load","change","caretChange","destroy","focus","blur","keydown","keyup"],EventEmitter,eventEmitter=function(){function EventEmitter(){var _this=this;this.events=new utils_map,this.eventTypes=eventTypeList.reduce((function(types,type){return __assign(__assign({},types),{type:type})}),{}),this.hold=!1,eventTypeList.forEach((function(eventType){_this.addEventType(eventType)}))}return EventEmitter.prototype.listen=function(type,handler){var typeInfo=this.getTypeInfo(type),eventHandlers=this.events.get(typeInfo.type)||[];if(!this.hasEventType(typeInfo.type))throw new Error("There is no event type "+typeInfo.type);typeInfo.namespace&&(handler.namespace=typeInfo.namespace),eventHandlers.push(handler),this.events.set(typeInfo.type,eventHandlers)},EventEmitter.prototype.emit=function(type){for(var args=[],_i=1;_i<arguments.length;_i++)args[_i-1]=arguments[_i];var typeInfo=this.getTypeInfo(type),eventHandlers=this.events.get(typeInfo.type),results=[];return!this.hold&&eventHandlers&&eventHandlers.forEach((function(handler){var result=handler.apply(void 0,args);isUndefined_default()(result)||results.push(result)})),results},EventEmitter.prototype.emitReduce=function(type,source){for(var args=[],_i=2;_i<arguments.length;_i++)args[_i-2]=arguments[_i];var eventHandlers=this.events.get(type);return!this.hold&&eventHandlers&&eventHandlers.forEach((function(handler){var result=handler.apply(void 0,__spreadArray([source],args));isFalsy_default()(result)||(source=result)})),source},EventEmitter.prototype.getTypeInfo=function(type){var splited=type.split(".");return{type:splited[0],namespace:splited[1]}},EventEmitter.prototype.hasEventType=function(type){return!isUndefined_default()(this.eventTypes[this.getTypeInfo(type).type])},EventEmitter.prototype.addEventType=function(type){if(this.hasEventType(type))throw new Error("There is already have event type "+type);this.eventTypes[type]=type},EventEmitter.prototype.removeEventHandler=function(eventType,handler){var _this=this,_a=this.getTypeInfo(eventType),type=_a.type,namespace=_a.namespace;type&&handler?this.removeEventHandlerWithHandler(type,handler):type&&!namespace?this.events.delete(type):!type&&namespace?this.events.forEach((function(_,evtType){_this.removeEventHandlerWithTypeInfo(evtType,namespace)})):type&&namespace&&this.removeEventHandlerWithTypeInfo(type,namespace)},EventEmitter.prototype.removeEventHandlerWithHandler=function(type,handler){var eventHandlers=this.events.get(type);if(eventHandlers){var handlerIndex=eventHandlers.indexOf(handler);eventHandlers.indexOf(handler)>=0&&eventHandlers.splice(handlerIndex,1)}},EventEmitter.prototype.removeEventHandlerWithTypeInfo=function(type,namespace){var handlersToSurvive=[],eventHandlers=this.events.get(type);eventHandlers&&(eventHandlers.map((function(handler){return handler.namespace!==namespace&&handlersToSurvive.push(handler),null})),this.events.set(type,handlersToSurvive))},EventEmitter.prototype.getEvents=function(){return this.events},EventEmitter.prototype.holdEventInvoke=function(fn){this.hold=!0,fn(),this.hold=!1},EventEmitter}(),CommandManager,commandManager=function(){function CommandManager(eventEmitter,mdCommands,wwCommands,getEditorType){this.eventEmitter=eventEmitter,this.mdCommands=mdCommands,this.wwCommands=wwCommands,this.getEditorType=getEditorType,this.initEvent()}return CommandManager.prototype.initEvent=function(){var _this=this;this.eventEmitter.listen("command",(function(command,payload){_this.exec(command,payload)}))},CommandManager.prototype.addCommand=function(type,name,command){"markdown"===type?this.mdCommands[name]=command:this.wwCommands[name]=command},CommandManager.prototype.deleteCommand=function(type,name){"markdown"===type?delete this.mdCommands[name]:delete this.wwCommands[name]},CommandManager.prototype.exec=function(name,payload){var type;"markdown"===this.getEditorType()?this.mdCommands[name](payload):this.wwCommands[name](payload)},CommandManager}();function getTextWithoutTrailingNewline(text){return"\n"===text[text.length-1]?text.slice(0,text.length-1):text}function isCustomHTMLInlineNode(_a,node){var schema=_a.schema,html,matched=node.literal.match(reHTMLTag);if(matched){var openTagName=matched[1],closeTagName=matched[3],typeName=(openTagName||closeTagName).toLowerCase();return"htmlInline"===node.type&&!(!schema.marks[typeName]&&!schema.nodes[typeName])}return!1}function htmlToWwConvertors_isInlineNode(_a){var type;return common_includes(["text","strong","emph","strike","image","link","code"],_a.type)}function htmlToWwConvertors_isListNode(_a){var type=_a.type,literal=_a.literal,matched="htmlInline"===type&&literal.match(reHTMLTag);if(matched){var openTagName=matched[1],closeTagName=matched[3],tagName=openTagName||closeTagName;if(tagName)return common_includes(["ul","ol","li"],tagName.toLowerCase())}return!1}function getListItemAttrs(_a){var literal=_a.literal,task,checked;return{task:/data-task/.test(literal),checked:/data-task-checked/.test(literal)}}function getMatchedAttributeValue(rawHTML,attrName){var wrapper=document.createElement("div"),el;return wrapper.innerHTML=rawHTML,wrapper.firstChild.getAttribute(attrName)||""}function createConvertors(convertors){var convertorMap={};return Object.keys(convertors).forEach((function(key){var tagNames;key.split(", ").forEach((function(tagName){var name=tagName.toLowerCase();convertorMap[name]=convertors[key]}))})),convertorMap}var convertors,htmlToWwConvertors=createConvertors({"b, strong":function(state,_,openTagName){var strong=state.schema.marks.strong;openTagName?state.openMark(strong.create({rawHTML:openTagName})):state.closeMark(strong)},"i, em":function(state,_,openTagName){var emph=state.schema.marks.emph;openTagName?state.openMark(emph.create({rawHTML:openTagName})):state.closeMark(emph)},"s, del":function(state,_,openTagName){var strike=state.schema.marks.strike;openTagName?state.openMark(strike.create({rawHTML:openTagName})):state.closeMark(strike)},code:function(state,_,openTagName){var code=state.schema.marks.code;openTagName?state.openMark(code.create({rawHTML:openTagName})):state.closeMark(code)},a:function(state,node,openTagName){var tag=node.literal,link=state.schema.marks.link;if(openTagName){var linkUrl=getMatchedAttributeValue(tag,"href");state.openMark(link.create({linkUrl:sanitizeXSSAttributeValue(linkUrl),rawHTML:openTagName}))}else state.closeMark(link)},img:function(state,node,openTagName){var tag=node.literal,imageUrl=getMatchedAttributeValue(tag,"src");if(imageUrl){var altText=getMatchedAttributeValue(tag,"alt"),image=state.schema.nodes.image;state.addNode(image,__assign({rawHTML:openTagName,imageUrl:sanitizeXSSAttributeValue(imageUrl)},altText&&{altText:altText}))}},hr:function(state,_,openTagName){state.addNode(state.schema.nodes.thematicBreak,{rawHTML:openTagName})},br:function(state,node){var _a,_b,paragraph=state.schema.nodes.paragraph;"paragraph"===(null===(_a=node.parent)||void 0===_a?void 0:_a.type)?(node.prev&&state.openNode(paragraph),node.next&&state.closeNode()):"tableCell"===(null===(_b=node.parent)||void 0===_b?void 0:_b.type)&&(node.prev&&(htmlToWwConvertors_isInlineNode(node.prev)||isCustomHTMLInlineNode(state,node.prev))&&state.closeNode(),node.next&&(htmlToWwConvertors_isInlineNode(node.next)||isCustomHTMLInlineNode(state,node.next))&&state.openNode(paragraph))},pre:function(state,node,openTagName){var _a,_b,container=document.createElement("div");container.innerHTML=node.literal;var literal=null===(_b=null===(_a=container.firstChild)||void 0===_a?void 0:_a.firstChild)||void 0===_b?void 0:_b.textContent;state.openNode(state.schema.nodes.codeBlock,{rawHTML:openTagName}),state.addText(getTextWithoutTrailingNewline(literal)),state.closeNode()},"ul, ol":function(state,node,openTagName){if("tableCell"===node.parent.type){var _a=state.schema.nodes,bulletList=_a.bulletList,orderedList=_a.orderedList,paragraph=_a.paragraph,list="ul"===openTagName?bulletList:orderedList;openTagName?(node.prev&&!htmlToWwConvertors_isListNode(node.prev)&&state.closeNode(),state.openNode(list,{rawHTML:openTagName})):(state.closeNode(),node.next&&!htmlToWwConvertors_isListNode(node.next)&&state.openNode(paragraph))}},li:function(state,node,openTagName){var _a;if("tableCell"===(null===(_a=node.parent)||void 0===_a?void 0:_a.type)){var _b=state.schema.nodes,listItem=_b.listItem,paragraph=_b.paragraph;if(openTagName){var attrs=getListItemAttrs(node);node.prev&&!htmlToWwConvertors_isListNode(node.prev)&&state.closeNode(),state.openNode(listItem,__assign({rawHTML:openTagName},attrs)),node.next&&!htmlToWwConvertors_isListNode(node.next)&&state.openNode(paragraph)}else node.prev&&!htmlToWwConvertors_isListNode(node.prev)&&state.closeNode(),state.closeNode()}}});function isBRTag(node){return"htmlInline"===node.type&&/<br ?\/?>/.test(node.literal)}function addRawHTMLAttributeToDOM(parent){toArray_default()(parent.childNodes).forEach((function(child){if(isElemNode(child)){var openTagName=child.nodeName.toLowerCase();child.setAttribute("data-raw-html",openTagName),child.childNodes&&addRawHTMLAttributeToDOM(child)}}))}var toWwConvertors={text:function(state,node){state.addText(node.literal||"")},paragraph:function(state,node,_a,customAttrs){var _b,entering;if(_a.entering){var paragraph=state.schema.nodes.paragraph;"paragraph"===(null===(_b=node.prev)||void 0===_b?void 0:_b.type)&&(state.openNode(paragraph,customAttrs),state.closeNode()),state.openNode(paragraph,customAttrs)}else state.closeNode()},heading:function(state,node,_a,customAttrs){var entering;if(_a.entering){var _b=node,level=_b.level,headingType=_b.headingType;state.openNode(state.schema.nodes.heading,__assign({level:level,headingType:headingType},customAttrs))}else state.closeNode()},codeBlock:function(state,node,customAttrs){var codeBlock=state.schema.nodes.codeBlock,_a=node,info=_a.info,literal=_a.literal;state.openNode(codeBlock,__assign({language:info},customAttrs)),state.addText(getTextWithoutTrailingNewline(literal||"")),state.closeNode()},list:function(state,node,_a,customAttrs){var entering;if(_a.entering){var _b=state.schema.nodes,bulletList=_b.bulletList,orderedList=_b.orderedList,_c=node.listData,type=_c.type,start=_c.start;"bullet"===type?state.openNode(bulletList,customAttrs):state.openNode(orderedList,__assign({order:start},customAttrs))}else state.closeNode()},item:function(state,node,_a,customAttrs){var entering=_a.entering,listItem=state.schema.nodes.listItem,_b=node.listData,task=_b.task,checked=_b.checked;if(entering){var attrs=__assign(__assign(__assign({},task&&{task:task}),checked&&{checked:checked}),customAttrs);state.openNode(listItem,attrs)}else state.closeNode()},blockQuote:function(state,_,_a,customAttrs){var entering;_a.entering?state.openNode(state.schema.nodes.blockQuote,customAttrs):state.closeNode()},image:function(state,node,_a,customAttrs){var entering=_a.entering,skipChildren=_a.skipChildren,image=state.schema.nodes.image,_b=node,destination=_b.destination,firstChild=_b.firstChild;entering&&skipChildren&&skipChildren(),state.addNode(image,__assign(__assign({imageUrl:destination},firstChild&&{altText:firstChild.literal}),customAttrs))},thematicBreak:function(state,node,_,customAttrs){state.addNode(state.schema.nodes.thematicBreak,customAttrs)},strong:function(state,_,_a,customAttrs){var entering=_a.entering,strong=state.schema.marks.strong;entering?state.openMark(strong.create(customAttrs)):state.closeMark(strong)},emph:function(state,_,_a,customAttrs){var entering=_a.entering,emph=state.schema.marks.emph;entering?state.openMark(emph.create(customAttrs)):state.closeMark(emph)},link:function(state,node,_a,customAttrs){var entering=_a.entering,link=state.schema.marks.link,_b=node,destination=_b.destination,title=_b.title;if(entering){var attrs=__assign(__assign({linkUrl:destination},title&&{linkText:title}),customAttrs);state.openMark(link.create(attrs))}else state.closeMark(link)},softbreak:function(state,node){if("paragraph"===node.parent.type){var prev=node.prev,next=node.next;prev&&!isBRTag(prev)&&state.closeNode(),next&&!isBRTag(next)&&state.openNode(state.schema.nodes.paragraph)}},table:function(state,_,_a,customAttrs){var entering;_a.entering?state.openNode(state.schema.nodes.table,customAttrs):state.closeNode()},tableHead:function(state,_,_a,customAttrs){var entering;_a.entering?state.openNode(state.schema.nodes.tableHead,customAttrs):state.closeNode()},tableBody:function(state,_,_a,customAttrs){var entering;_a.entering?state.openNode(state.schema.nodes.tableBody,customAttrs):state.closeNode()},tableRow:function(state,_,_a,customAttrs){var entering;_a.entering?state.openNode(state.schema.nodes.tableRow,customAttrs):state.closeNode()},tableCell:function(state,node,_a){var entering=_a.entering;if(!node.ignored){var hasParaNode=function(childNode){return childNode&&(htmlToWwConvertors_isInlineNode(childNode)||isCustomHTMLInlineNode(state,childNode))};if(entering){var _b=state.schema.nodes,tableHeadCell=_b.tableHeadCell,tableBodyCell=_b.tableBodyCell,paragraph=_b.paragraph,tablePart=node.parent.parent,cell="tableHead"===tablePart.type?tableHeadCell:tableBodyCell,table,align=tablePart.parent.columns[node.startIdx].align,attrs=__assign({},node.attrs);align&&(attrs.align=align),state.openNode(cell,attrs),hasParaNode(node.firstChild)&&state.openNode(paragraph)}else hasParaNode(node.lastChild)&&state.closeNode(),state.closeNode()}},strike:function(state,_,_a,customAttrs){var entering=_a.entering,strike=state.schema.marks.strike;entering?state.openMark(strike.create(customAttrs)):state.closeMark(strike)},code:function(state,node,_,customAttrs){var code=state.schema.marks.code;state.openMark(code.create(customAttrs)),state.addText(getTextWithoutTrailingNewline(node.literal||"")),state.closeMark(code)},customBlock:function(state,node){var _a=state.schema.nodes,customBlock=_a.customBlock,paragraph=_a.paragraph,_b=node,info=_b.info,literal=_b.literal;state.openNode(customBlock,{info:info}),state.addText(getTextWithoutTrailingNewline(literal||"")),state.closeNode(),node.next||(state.openNode(paragraph),state.closeNode())},frontMatter:function(state,node){state.openNode(state.schema.nodes.frontMatter),state.addText(node.literal),state.closeNode()},htmlInline:function(state,node){var html=node.literal,matched=html.match(reHTMLTag),openTagName=matched[1],closeTagName=matched[3],typeName=(openTagName||closeTagName).toLowerCase(),markType=state.schema.marks[typeName];if(null==markType?void 0:markType.spec.attrs.htmlInline)if(openTagName){var htmlAttrs=getHTMLAttrsByHTMLString(html);state.openMark(markType.create({htmlAttrs:htmlAttrs}))}else state.closeMark(markType);else{var htmlToWwConvertor=htmlToWwConvertors[typeName];htmlToWwConvertor&&htmlToWwConvertor(state,node,openTagName)}},htmlBlock:function(state,node){var html=node.literal,container=document.createElement("div"),matched=html.match(reHTMLTag),openTagName=matched[1],closeTagName=matched[3],typeName=(openTagName||closeTagName).toLowerCase(),nodeType=state.schema.nodes[typeName];if(null==nodeType?void 0:nodeType.spec.attrs.htmlBlock){var htmlAttrs=getHTMLAttrsByHTMLString(html),childrenHTML=getChildrenHTML(node,typeName);state.addNode(nodeType,{htmlAttrs:htmlAttrs,childrenHTML:childrenHTML})}else container.innerHTML=html,addRawHTMLAttributeToDOM(container),state.convertByDOMParser(container)},customInline:function(state,node,_a){var entering=_a.entering,skipChildren=_a.skipChildren,info=node.info,schema=state.schema;if(-1!==info.indexOf("widget")&&entering){var content=getWidgetContent(node);skipChildren(),state.addNode(schema.nodes.widget,{info:info},[schema.text(createWidgetContent(info,content))])}}};function createWwConvertors(customConvertors){var customConvertorTypes=Object.keys(customConvertors),convertors=__assign({},toWwConvertors),renderer,orgConvertors=new Renderer({gfm:!0,nodeId:!0,convertors:customConvertors}).getConvertors();return customConvertorTypes.forEach((function(type){var wwConvertor=toWwConvertors[type];wwConvertor&&!common_includes(["htmlBlock","htmlInline"],type)&&(convertors[type]=function(state,node,context){context.origin=function(){return orgConvertors[type](node,context)};var tokens=customConvertors[type](node,context),attrs;if(tokens){var _a=Array.isArray(tokens)?tokens[0]:tokens,htmlAttrs,classNames;attrs={htmlAttrs:_a.attributes,classNames:_a.classNames}}wwConvertor(state,node,context,attrs)})})),convertors}function mergeMarkText(a,b){return!!(a.isText&&b.isText&&Mark.sameSet(a.marks,b.marks))&&a.withText(a.text+b.text)}var ToWwConvertorState,toWwConvertorState=function(){function ToWwConvertorState(schema,convertors){this.schema=schema,this.convertors=convertors,this.stack=[{type:this.schema.topNodeType,attrs:null,content:[]}],this.marks=Mark.none}return ToWwConvertorState.prototype.top=function(){return last(this.stack)},ToWwConvertorState.prototype.push=function(node){this.stack.length&&this.top().content.push(node)},ToWwConvertorState.prototype.addText=function(text){if(text){var nodes=this.top().content,lastNode=last(nodes),node=this.schema.text(text,this.marks),merged=lastNode&&mergeMarkText(lastNode,node);merged?nodes[nodes.length-1]=merged:nodes.push(node)}},ToWwConvertorState.prototype.openMark=function(mark){this.marks=mark.addToSet(this.marks)},ToWwConvertorState.prototype.closeMark=function(mark){this.marks=mark.removeFromSet(this.marks)},ToWwConvertorState.prototype.addNode=function(type,attrs,content){var node=type.createAndFill(attrs,content,this.marks);return node?(this.push(node),node):null},ToWwConvertorState.prototype.openNode=function(type,attrs){this.stack.push({type:type,attrs:attrs,content:[]})},ToWwConvertorState.prototype.closeNode=function(){this.marks.length&&(this.marks=Mark.none);var _a=this.stack.pop(),type=_a.type,attrs=_a.attrs,content=_a.content;return this.addNode(type,attrs,content)},ToWwConvertorState.prototype.convertByDOMParser=function(root){var _this=this,doc;DOMParser.fromSchema(this.schema).parse(root).content.forEach((function(node){return _this.push(node)}))},ToWwConvertorState.prototype.convert=function(mdNode,infoForPosSync){for(var walker=mdNode.walker(),event=walker.next(),_loop_1=function(){var node=event.node,entering=event.entering,convertor=this_1.convertors[node.type],skipped=!1;if(convertor){var context={entering:entering,leaf:!isContainer(node),getChildrenText:getChildrenText,options:{gfm:!0,nodeId:!1,tagFilter:!1,softbreak:"\n"},skipChildren:function(){skipped=!0}};if(convertor(this_1,node,context),(null==infoForPosSync?void 0:infoForPosSync.node)===node){var pos=this_1.stack.reduce((function(nodeSize,stackItem){return nodeSize+stackItem.content.reduce((function(contentSize,pmNode){return contentSize+pmNode.nodeSize}),0)}),0)+1;infoForPosSync.setMappedPos(pos)}}skipped&&(walker.resumeAt(node,!1),walker.next()),event=walker.next()},this_1=this;event;)_loop_1()},ToWwConvertorState.prototype.convertNode=function(mdNode,infoForPosSync){return this.convert(mdNode,infoForPosSync),this.stack.length?this.closeNode():null},ToWwConvertorState}();function convertToRawHTMLHavingInlines(state,node,_a){var openTag=_a[0],closeTag=_a[1];state.write(openTag),state.convertInline(node),state.write(closeTag)}function convertToRawHTMLHavingBlocks(state,_a,_b){var node=_a.node,parent=_a.parent,openTag=_b[0],closeTag=_b[1];state.stopNewline=!0,state.write(openTag),state.convertNode(node),state.write(closeTag),"doc"===(null==parent?void 0:parent.type.name)&&(state.closeBlock(node),state.stopNewline=!1)}function createTableHeadDelim(textContent,columnAlign){var textLen=textContent.length,leftDelim="",rightDelim="";return"left"===columnAlign?(leftDelim=":",textLen-=1):"right"===columnAlign?(rightDelim=":",textLen-=1):"center"===columnAlign&&(leftDelim=":",rightDelim=":",textLen-=2),""+leftDelim+repeat("-",Math.max(textLen,3))+rightDelim}var nodeTypeWriters={text:function(state,_a){var _b,node=_a.node;state.text(null!==(_b=node.text)&&void 0!==_b?_b:"")},paragraph:function(state,_a){var node=_a.node,parent=_a.parent,_b=_a.index,index=void 0===_b?0:_b;if(state.stopNewline)state.convertInline(node);else{var firstChildNode=0===index,prevNode=!firstChildNode&&parent.child(index-1),prevEmptyNode=prevNode&&0===prevNode.childCount,nextNode=index<parent.childCount-1&&parent.child(index+1),nextParaNode=nextNode&&"paragraph"===nextNode.type.name,emptyNode=0===node.childCount;emptyNode&&prevEmptyNode?state.write("<br>\n"):!emptyNode||prevEmptyNode||firstChildNode?(state.convertInline(node),nextParaNode?state.write("\n"):state.closeBlock(node)):state.write("\n")}},heading:function(state,_a,_b){var node=_a.node,delim=_b.delim,headingType;"atx"===node.attrs.headingType?(state.write(delim+" "),state.convertInline(node),state.closeBlock(node)):(state.convertInline(node),state.ensureNewLine(),state.write(delim),state.closeBlock(node))},codeBlock:function(state,_a,_b){var node=_a.node,delim=_b.delim,text=_b.text,_c=delim,openDelim=_c[0],closeDelim=_c[1];state.write(openDelim),state.ensureNewLine(),state.text(text,!1),state.ensureNewLine(),state.write(closeDelim),state.closeBlock(node)},blockQuote:function(state,_a,_b){var node=_a.node,parent=_a.parent,delim=_b.delim;(null==parent?void 0:parent.type.name)===node.type.name&&state.flushClose(1),state.wrapBlock(delim,null,node,(function(){return state.convertNode(node)}))},bulletList:function(state,_a,_b){var node=_a.node,delim=_b.delim;state.convertList(node,repeat(" ",4),(function(){return delim+" "}))},orderedList:function(state,_a){var node=_a.node,start=node.attrs.order||1;state.convertList(node,repeat(" ",4),(function(index){var orderedNum;return String(start+index)+". "}))},listItem:function(state,_a){var node=_a.node,_b=node.attrs,task=_b.task,checked=_b.checked;task&&state.write("["+(checked?"x":" ")+"] "),state.convertNode(node)},image:function(state,_,_a){var attrs=_a.attrs;state.write("!["+(null==attrs?void 0:attrs.altText)+"]("+(null==attrs?void 0:attrs.imageUrl)+")")},thematicBreak:function(state,_a,_b){var node=_a.node,delim=_b.delim;state.write(delim),state.closeBlock(node)},table:function(state,_a){var node=_a.node;state.convertNode(node),state.closeBlock(node)},tableHead:function(state,_a,_b){var node=_a.node,delim=_b.delim,row=node.firstChild;state.convertNode(node);var result=null!=delim?delim:"";!delim&&row&&row.forEach((function(_a){var textContent,attrs,headDelim=createTableHeadDelim(_a.textContent,_a.attrs.align);result+="| "+headDelim+" "})),state.write(result+"|"),state.ensureNewLine()},tableBody:function(state,_a){var node=_a.node;state.convertNode(node)},tableRow:function(state,_a){var node=_a.node;state.convertNode(node),state.write("|"),state.ensureNewLine()},tableHeadCell:function(state,_a,_b){var node=_a.node,_c=_b.delim,delim=void 0===_c?"| ":_c;state.write(delim),state.convertTableCell(node),state.write(" ")},tableBodyCell:function(state,_a,_b){var node=_a.node,_c=_b.delim,delim=void 0===_c?"| ":_c;state.write(delim),state.convertTableCell(node),state.write(" ")},customBlock:function(state,_a,_b){var node=_a.node,delim=_b.delim,text=_b.text,_c=delim,openDelim=_c[0],closeDelim=_c[1];state.write(openDelim),state.ensureNewLine(),state.text(text,!1),state.ensureNewLine(),state.write(closeDelim),state.closeBlock(node)},frontMatter:function(state,_a,_b){var node=_a.node,text=_b.text;state.text(text,!1),state.closeBlock(node)},widget:function(state,_,_a){var text=_a.text;state.write(text)},html:function(state,_,_a){var text=_a.text;state.write(text)}};function write(type,_a){var state=_a.state,nodeInfo=_a.nodeInfo,params=_a.params,rawHTML=params.rawHTML;rawHTML?inArray_default()(type,["heading","codeBlock"])>-1?convertToRawHTMLHavingInlines(state,nodeInfo.node,rawHTML):inArray_default()(type,["image","thematicBreak"])>-1?state.write(rawHTML):convertToRawHTMLHavingBlocks(state,nodeInfo,rawHTML):nodeTypeWriters[type](state,nodeInfo,params)}function addBackticks(node,side){var text=node.text,ticks=/`+/g,len=0;if(node.isText&&text)for(var matched=ticks.exec(text);matched;)len=Math.max(len,matched[0].length),matched=ticks.exec(text);for(var result=len>0&&side>0?" `":"`",i=0;i<len;i+=1)result+="`";return len>0&&side<0&&(result+=" "),result}function getPairRawHTML(rawHTML){return rawHTML?["<"+rawHTML+">","</"+rawHTML+">"]:null}function getOpenRawHTML(rawHTML){return rawHTML?"<"+rawHTML+">":null}function getCloseRawHTML(rawHTML){return rawHTML?"</"+rawHTML+">":null}var toMdConvertors={heading:function(_a){var node,attrs=_a.node.attrs,level=attrs.level,delim=repeat("#",level);return"setext"===attrs.headingType&&(delim=1===level?"===":"---"),{delim:delim,rawHTML:getPairRawHTML(attrs.rawHTML)}},codeBlock:function(_a){var node,_b=_a.node,attrs=_b.attrs,textContent=_b.textContent;return{delim:["```"+(attrs.language||""),"```"],rawHTML:getPairRawHTML(attrs.rawHTML),text:textContent}},blockQuote:function(_a){var node;return{delim:"> ",rawHTML:getPairRawHTML(_a.node.attrs.rawHTML)}},bulletList:function(_a,_b){var node=_a.node,inTable=_b.inTable,rawHTML=node.attrs.rawHTML;return inTable&&(rawHTML=rawHTML||"ul"),{delim:"*",rawHTML:getPairRawHTML(rawHTML)}},orderedList:function(_a,_b){var node=_a.node,inTable=_b.inTable,rawHTML=node.attrs.rawHTML;return inTable&&(rawHTML=rawHTML||"ol"),{rawHTML:getPairRawHTML(rawHTML)}},listItem:function(_a,_b){var node=_a.node,inTable=_b.inTable,_c=node.attrs,task=_c.task,checked=_c.checked,rawHTML=node.attrs.rawHTML,className,dataset;return inTable&&(rawHTML=rawHTML||"li"),{rawHTML:rawHTML?["<"+rawHTML+(task?' class="task-list-item'+(checked?" checked":"")+'"':"")+(task?" data-task"+(checked?" data-task-checked":""):"")+">","</"+rawHTML+">"]:null}},table:function(_a){var node;return{rawHTML:getPairRawHTML(_a.node.attrs.rawHTML)}},tableHead:function(_a){var node;return{rawHTML:getPairRawHTML(_a.node.attrs.rawHTML)}},tableBody:function(_a){var node;return{rawHTML:getPairRawHTML(_a.node.attrs.rawHTML)}},tableRow:function(_a){var node;return{rawHTML:getPairRawHTML(_a.node.attrs.rawHTML)}},tableHeadCell:function(_a){var node;return{rawHTML:getPairRawHTML(_a.node.attrs.rawHTML)}},tableBodyCell:function(_a){var node;return{rawHTML:getPairRawHTML(_a.node.attrs.rawHTML)}},image:function(_a){var node,attrs=_a.node.attrs,altText=common_escape(attrs.altText||""),imageUrl=common_escape(attrs.imageUrl),altAttr=altText?' alt="'+altText+'"':"";return{rawHTML:attrs.rawHTML?"<"+attrs.rawHTML+' src="'+imageUrl+'"'+altAttr+">":null,attrs:{altText:altText,imageUrl:imageUrl}}},thematicBreak:function(_a){var node;return{delim:"***",rawHTML:getOpenRawHTML(_a.node.attrs.rawHTML)}},customBlock:function(_a){var node,_b=_a.node,attrs=_b.attrs,textContent=_b.textContent;return{delim:["$$"+attrs.info,"$$"],text:textContent}},frontMatter:function(_a){var node;return{text:_a.node.textContent}},widget:function(_a){var node;return{text:_a.node.textContent}},strong:function(_a,_b){var node=_a.node,entering=_b.entering,rawHTML=node.attrs.rawHTML;return{delim:"**",rawHTML:entering?getOpenRawHTML(rawHTML):getCloseRawHTML(rawHTML)}},emph:function(_a,_b){var node=_a.node,entering=_b.entering,rawHTML=node.attrs.rawHTML;return{delim:"*",rawHTML:entering?getOpenRawHTML(rawHTML):getCloseRawHTML(rawHTML)}},strike:function(_a,_b){var node=_a.node,entering=_b.entering,rawHTML=node.attrs.rawHTML;return{delim:"~~",rawHTML:entering?getOpenRawHTML(rawHTML):getCloseRawHTML(rawHTML)}},link:function(_a,_b){var node=_a.node,entering=_b.entering,attrs=node.attrs,linkUrl=common_escape(attrs.linkUrl),rawHTML=attrs.rawHTML,linkText;return entering?{delim:"[",rawHTML:rawHTML?"<"+rawHTML+' href="'+linkUrl+'">':null}:{delim:"]("+(attrs.title?" "+quote(attrs.linkText):"")+linkUrl+")",rawHTML:getCloseRawHTML(rawHTML)}},code:function(_a,_b){var node=_a.node,parent=_a.parent,_c=_a.index,index=void 0===_c?0:_c,entering=_b.entering,delim,rawHTML;return{delim:entering?addBackticks(parent.child(index),-1):addBackticks(parent.child(index-1),1),rawHTML:entering?getOpenRawHTML(node.attrs.rawHTML):getCloseRawHTML(node.attrs.rawHTML)}},html:function(_a,_b){var node=_a.node,entering=_b.entering,tagName=node.type.name,attrs=node.attrs.htmlAttrs,openTag="<"+tagName,closeTag="</"+tagName+">";return Object.keys(attrs).forEach((function(attrName){openTag+=" "+attrName+'="'+attrs[attrName]+'"'})),openTag+=">",node.attrs.htmlInline?{rawHTML:entering?openTag:closeTag}:{text:""+openTag+node.attrs.childrenHTML+closeTag}}},markTypeOptions={strong:{mixable:!0,removedEnclosingWhitespace:!0},emph:{mixable:!0,removedEnclosingWhitespace:!0},strike:{mixable:!0,removedEnclosingWhitespace:!0},code:{escape:!1},link:null,html:null};function createNodeTypeConvertors(convertors){var nodeTypeConvertors={},nodeTypes;return Object.keys(nodeTypeWriters).forEach((function(type){nodeTypeConvertors[type]=function(state,nodeInfo){var writer;if(nodeTypeWriters[type]){var convertor=convertors[type],params=convertor?convertor(nodeInfo,{inTable:state.inTable}):{};write(type,{state:state,nodeInfo:nodeInfo,params:params})}}})),nodeTypeConvertors}function createMarkTypeConvertors(convertors){var markTypeConvertors={},markTypes;return Object.keys(markTypeOptions).forEach((function(type){markTypeConvertors[type]=function(nodeInfo,entering){var markOption=markTypeOptions[type],convertor=convertors[type],runConvertor,params=convertor&&nodeInfo&&!isUndefined_default()(entering)?convertor(nodeInfo,{entering:entering}):{};return __assign(__assign({},params),markOption)}})),markTypeConvertors}function createMdConvertors(customConvertors){var customConvertorTypes,nodeTypeConvertors,markTypeConvertors;return Object.keys(customConvertors).forEach((function(type){var baseConvertor=toMdConvertors[type],customConvertor=customConvertors[type];toMdConvertors[type]=baseConvertor?function(nodeInfo,context){return context.origin=function(){return baseConvertor(nodeInfo,context)},customConvertor(nodeInfo,context)}:customConvertor,delete customConvertors[type]})),{nodeTypeConvertors:createNodeTypeConvertors(toMdConvertors),markTypeConvertors:createMarkTypeConvertors(toMdConvertors)}}var ToMdConvertorState,toMdConvertorState=function(){function ToMdConvertorState(_a){var nodeTypeConvertors=_a.nodeTypeConvertors,markTypeConvertors=_a.markTypeConvertors;this.nodeTypeConvertors=nodeTypeConvertors,this.markTypeConvertors=markTypeConvertors,this.delim="",this.result="",this.closed=!1,this.tightList=!1,this.stopNewline=!1,this.inTable=!1}return ToMdConvertorState.prototype.getMarkConvertor=function(mark){var type=mark.attrs.htmlInline?"html":mark.type.name;return this.markTypeConvertors[type]},ToMdConvertorState.prototype.isInBlank=function(){return/(^|\n)$/.test(this.result)},ToMdConvertorState.prototype.markText=function(mark,entering,parent,index){var convertor=this.getMarkConvertor(mark);if(convertor){var _a=convertor({node:mark,parent:parent,index:index},entering),delim=_a.delim,rawHTML;return _a.rawHTML||delim}return""},ToMdConvertorState.prototype.flushClose=function(size){if(!this.stopNewline&&this.closed){if(this.isInBlank()||(this.result+="\n"),size||(size=2),size>1){var delimMin=this.delim,trim=/\s+$/.exec(delimMin);trim&&(delimMin=delimMin.slice(0,delimMin.length-trim[0].length));for(var i=1;i<size;i+=1)this.result+=delimMin+"\n"}this.closed=!1}},ToMdConvertorState.prototype.wrapBlock=function(delim,firstDelim,node,fn){var old=this.delim;this.write(firstDelim||delim),this.delim+=delim,fn(),this.delim=old,this.closeBlock(node)},ToMdConvertorState.prototype.ensureNewLine=function(){this.isInBlank()||(this.result+="\n")},ToMdConvertorState.prototype.write=function(content){void 0===content&&(content=""),this.flushClose(),this.delim&&this.isInBlank()&&(this.result+=this.delim),content&&(this.result+=content)},ToMdConvertorState.prototype.closeBlock=function(node){this.closed=node},ToMdConvertorState.prototype.text=function(text,escaped){for(var lines=text.split("\n"),i=0;i<lines.length;i+=1){var startOfLine=this.isInBlank()||!!this.closed;this.write(),this.result+=!1!==escaped?common_escape(lines[i],startOfLine):lines[i],i!==lines.length-1&&(this.result+="\n")}},ToMdConvertorState.prototype.convertBlock=function(node,parent,index){var type=node.type.name,convertor=this.nodeTypeConvertors[type],nodeInfo={node:node,parent:parent,index:index};node.attrs.htmlBlock?this.nodeTypeConvertors.html(this,nodeInfo):convertor&&convertor(this,nodeInfo)},ToMdConvertorState.prototype.convertInline=function(parent){var _this=this,active=[],trailing="",progress=function(node,_,index){var marks=node?node.marks:[],leading=trailing,removedWhitespace;if(trailing="",node&&node.isText&&marks.some((function(mark){var markConvertor=_this.getMarkConvertor(mark),info=markConvertor&&markConvertor();return info&&info.removedEnclosingWhitespace}))&&node&&node.text){var _a=/^(\s*)(.*?)(\s*)$/m.exec(node.text),lead=_a[1],mark=_a[2],trail=_a[3];leading+=lead,trailing=trail,(lead||trail)&&((node=mark?node.withText(mark):null)||(marks=active))}for(var lastMark=marks.length&&last(marks),markConvertor=lastMark&&_this.getMarkConvertor(lastMark),markType=markConvertor&&markConvertor(),noEscape=markType&&!1===markType.escape,len=marks.length-(noEscape?1:0),i=0;i<len;i+=1){var mark=marks[i];if(markType&&!markType.mixable)break;for(var j=0;j<active.length;j+=1){var other=active[j];if(markType&&!markType.mixable)break;if(mark.eq(other)){i>j?marks=marks.slice(0,j).concat(mark).concat(marks.slice(j,i)).concat(marks.slice(i+1,len)):j>i&&(marks=marks.slice(0,i).concat(marks.slice(i+1,j)).concat(mark).concat(marks.slice(j,len)));break}}}for(var keep=0;keep<Math.min(active.length,len)&&marks[keep].eq(active[keep]);)keep+=1;for(;keep<active.length;){var activedMark=active.pop();activedMark&&_this.text(_this.markText(activedMark,!1,parent,index),!1)}if(leading&&_this.text(leading),node){for(;active.length<len;){var mark=marks[active.length];active.push(mark),_this.text(_this.markText(mark,!0,parent,index),!1)}noEscape&&node.isText?_this.text(_this.markText(lastMark,!0,parent,index)+node.text+_this.markText(lastMark,!1,parent,index+1),!1):_this.convertBlock(node,parent,index)}};parent.forEach(progress),progress(null,null,parent.childCount)},ToMdConvertorState.prototype.convertList=function(node,delim,firstDelimFn){var _this=this,_a;this.closed&&this.closed.type===node.type?this.flushClose(3):this.tightList&&this.flushClose(1);var tight=null===(_a=node.attrs.tight)||void 0===_a||_a,prevTight=this.tightList;this.tightList=tight,node.forEach((function(child,_,index){index&&tight&&_this.flushClose(1),_this.wrapBlock(delim,firstDelimFn(index),node,(function(){return _this.convertBlock(child,node,index)}))})),this.tightList=prevTight},ToMdConvertorState.prototype.convertTableCell=function(node){var _this=this;this.stopNewline=!0,this.inTable=!0,node.forEach((function(child,_,index){var nextChild;common_includes(["bulletList","orderedList"],child.type.name)?(_this.convertBlock(child,node,index),_this.closed=!1):(_this.convertInline(child),index<node.childCount-1&&"paragraph"===node.child(index+1).type.name&&_this.write("<br>"))})),this.stopNewline=!1,this.inTable=!1},ToMdConvertorState.prototype.convertNode=function(parent,infoForPosSync){var _this=this;return parent.forEach((function(node,_,index){if(_this.convertBlock(node,parent,index),(null==infoForPosSync?void 0:infoForPosSync.node)===node){var lineTexts=_this.result.split("\n");infoForPosSync.setMappedPos([lineTexts.length,last(lineTexts).length+1])}})),this.result},ToMdConvertorState}(),Convertor,convertor=function(){function Convertor(schema,toMdConvertors,toHTMLConvertors,eventEmitter){var _this=this;this.setMappedPos=function(pos){_this.mappedPosWhenConverting=pos},this.schema=schema,this.eventEmitter=eventEmitter,this.focusedNode=null,this.mappedPosWhenConverting=null,this.toWwConvertors=createWwConvertors(toHTMLConvertors),this.toMdConvertors=createMdConvertors(toMdConvertors||{}),this.eventEmitter.listen("setFocusedNode",(function(node){return _this.focusedNode=node}))}return Convertor.prototype.getMappedPos=function(){return this.mappedPosWhenConverting},Convertor.prototype.getInfoForPosSync=function(){return{node:this.focusedNode,setMappedPos:this.setMappedPos}},Convertor.prototype.toWysiwygModel=function(mdNode){var state;return new toWwConvertorState(this.schema,this.toWwConvertors).convertNode(mdNode,this.getInfoForPosSync())},Convertor.prototype.toMarkdownText=function(wwNode){var state,markdownText=new toMdConvertorState(this.toMdConvertors).convertNode(wwNode,this.getInfoForPosSync());return markdownText=this.eventEmitter.emitReduce("beforeConvertWysiwygToMarkdown",markdownText)},Convertor}();function execPlugin(plugin,eventEmitter,usageStatistics){var pmState,pmView,pmModel,context={eventEmitter:eventEmitter,usageStatistics:usageStatistics,pmState:{Plugin:Plugin,Selection:Selection,TextSelection:TextSelection},pmView:{Decoration:Decoration,DecorationSet:DecorationSet},pmModel:{Fragment:Fragment},i18n:i18n};if(isArray_default()(plugin)){var pluginFn=plugin[0],_a=plugin[1],options;return pluginFn(context,void 0===_a?{}:_a)}return plugin(context)}function getPluginInfo(plugins,eventEmitter,usageStatistics){return eventEmitter.listen("mixinTableOffsetMapPrototype",mixinTableOffsetMapPrototype),(null!=plugins?plugins:[]).reduce((function(acc,plugin){var pluginInfoResult=execPlugin(plugin,eventEmitter,usageStatistics);if(!pluginInfoResult)throw new Error("The return value of the executed plugin is empty.");var markdownParsers=pluginInfoResult.markdownParsers,toHTMLRenderers=pluginInfoResult.toHTMLRenderers,toMarkdownRenderers=pluginInfoResult.toMarkdownRenderers,markdownPlugins=pluginInfoResult.markdownPlugins,wysiwygPlugins=pluginInfoResult.wysiwygPlugins,wysiwygNodeViews=pluginInfoResult.wysiwygNodeViews,markdownCommands=pluginInfoResult.markdownCommands,wysiwygCommands=pluginInfoResult.wysiwygCommands,toolbarItems=pluginInfoResult.toolbarItems;return toHTMLRenderers&&(acc.toHTMLRenderers=deepMergedCopy(acc.toHTMLRenderers,toHTMLRenderers)),toMarkdownRenderers&&(acc.toMarkdownRenderers=deepMergedCopy(acc.toMarkdownRenderers,toMarkdownRenderers)),markdownPlugins&&(acc.mdPlugins=acc.mdPlugins.concat(markdownPlugins)),wysiwygPlugins&&(acc.wwPlugins=acc.wwPlugins.concat(wysiwygPlugins)),wysiwygNodeViews&&(acc.wwNodeViews=__assign(__assign({},acc.wwNodeViews),wysiwygNodeViews)),markdownCommands&&(acc.mdCommands=__assign(__assign({},acc.mdCommands),markdownCommands)),wysiwygCommands&&(acc.wwCommands=__assign(__assign({},acc.wwCommands),wysiwygCommands)),toolbarItems&&(acc.toolbarItems=acc.toolbarItems.concat(toolbarItems)),markdownParsers&&(acc.markdownParsers=__assign(__assign({},acc.markdownParsers),markdownParsers)),acc}),{toHTMLRenderers:{},toMarkdownRenderers:{},mdPlugins:[],wwPlugins:[],wwNodeViews:{},mdCommands:{},wwCommands:{},toolbarItems:[],markdownParsers:{}})}var TASK_ATTR_NAME="data-task",DISABLED_TASK_ATTR_NAME="data-task-disabled",TASK_CHECKED_CLASS_NAME="checked",ToastUIEditorViewer,viewer=function(){function ToastUIEditorViewer(options){var _this=this;this.options=extend_default()({linkAttributes:null,extendedAutolinks:!1,customHTMLRenderer:null,referenceDefinition:!1,customHTMLSanitizer:null,frontMatter:!1,usageStatistics:!0,theme:"light"},options),this.eventEmitter=new eventEmitter;var linkAttributes=sanitizeLinkAttribute(this.options.linkAttributes),_a=getPluginInfo(this.options.plugins,this.eventEmitter,this.options.usageStatistics)||{},toHTMLRenderers=_a.toHTMLRenderers,markdownParsers=_a.markdownParsers,_b=this.options,customHTMLRenderer=_b.customHTMLRenderer,extendedAutolinks=_b.extendedAutolinks,referenceDefinition=_b.referenceDefinition,frontMatter=_b.frontMatter,customHTMLSanitizer=_b.customHTMLSanitizer,rendererOptions={linkAttributes:linkAttributes,customHTMLRenderer:__assign(__assign({},toHTMLRenderers),customHTMLRenderer),extendedAutolinks:extendedAutolinks,referenceDefinition:referenceDefinition,frontMatter:frontMatter,sanitizer:customHTMLSanitizer||sanitizeHTML};this.options.events&&forEachOwnProperties_default()(this.options.events,(function(fn,key){_this.on(key,fn)}));var _c=this.options,el=_c.el,initialValue=_c.initialValue,theme=_c.theme,existingHTML=el.innerHTML;"light"!==theme&&el.classList.add(cls(theme)),el.innerHTML="",this.toastMark=new ToastMark("",{disallowedHtmlBlockTags:["br","img"],extendedAutolinks:extendedAutolinks,referenceDefinition:referenceDefinition,disallowDeepHeading:!0,frontMatter:frontMatter,customParser:markdownParsers}),this.preview=new mdPreview(this.eventEmitter,__assign(__assign({},rendererOptions),{isViewer:!0})),on_default()(this.preview.el,"mousedown",this.toggleTask.bind(this)),initialValue?this.setMarkdown(initialValue):existingHTML&&this.preview.setHTML(existingHTML),el.appendChild(this.preview.previewContent),this.eventEmitter.emit("load",this)}return ToastUIEditorViewer.prototype.toggleTask=function(ev){var element=ev.target,style=getComputedStyle(element,":before");!element.hasAttribute("data-task-disabled")&&element.hasAttribute("data-task")&&isPositionInBox(style,ev.offsetX,ev.offsetY)&&toggleClass(element,"checked")},ToastUIEditorViewer.prototype.setMarkdown=function(markdown){var lineTexts=this.toastMark.getLineTexts(),length,lastLine,endSourcepos=[lineTexts.length,last(lineTexts).length+1],editResult=this.toastMark.editMarkdown([1,1],endSourcepos,markdown||"");this.eventEmitter.emit("updatePreview",editResult)},ToastUIEditorViewer.prototype.on=function(type,handler){this.eventEmitter.listen(type,handler)},ToastUIEditorViewer.prototype.off=function(type){this.eventEmitter.removeEventHandler(type)},ToastUIEditorViewer.prototype.addHook=function(type,handler){this.eventEmitter.removeEventHandler(type),this.eventEmitter.listen(type,handler)},ToastUIEditorViewer.prototype.destroy=function(){off_default()(this.preview.el,"mousedown",this.toggleTask.bind(this)),this.preview.destroy(),this.eventEmitter.emit("destroy")},ToastUIEditorViewer.prototype.isViewer=function(){return!0},ToastUIEditorViewer.prototype.isMarkdownMode=function(){return!1},ToastUIEditorViewer.prototype.isWysiwygMode=function(){return!1},ToastUIEditorViewer}();function isPmNode(node){return node instanceof index_es_Node}function mdLikeNode_isContainer(type){var containerTypes;return common_includes(["document","blockQuote","bulletList","orderedList","listItem","paragraph","heading","emph","strong","strike","link","image","table","tableHead","tableBody","tableRow","tableHeadCell","tableBodyCell"],type)}function createMdLikeNode(node){var attrs=node.attrs,type,nodeType=node.type.name,mdLikeNode={type:nodeType,wysiwygNode:!0,literal:!mdLikeNode_isContainer(nodeType)&&isPmNode(node)?node.textContent:null},nodeTypeMap,nodeInfo={heading:{level:attrs.level},link:{destination:attrs.linkUrl,title:attrs.linkText},image:{destination:attrs.imageUrl},codeBlock:{info:attrs.language},bulletList:{type:"list",listData:{type:"bullet"}},orderedList:{type:"list",listData:{type:"ordered",start:attrs.order}},listItem:{type:"item",listData:{task:attrs.task,checked:attrs.checked}},tableHeadCell:{type:"tableCell",cellType:"head",align:attrs.align},tableBodyCell:{type:"tableCell",cellType:"body",align:attrs.align},customBlock:{info:attrs.info}}[nodeType],attributes=__assign(__assign({},mdLikeNode),nodeInfo),_a=node.attrs,htmlAttrs=_a.htmlAttrs,childrenHTML=_a.childrenHTML;return htmlAttrs?__assign(__assign({},attributes),{attrs:htmlAttrs,childrenHTML:childrenHTML}):attributes}var tokenToDOMNode={openTag:function(token,stack){var _a=token,tagName=_a.tagName,classNames=_a.classNames,attributes=_a.attributes,el=document.createElement(tagName),attrs={};classNames&&(el.className=classNames.join(" ")),attributes&&(attrs=__assign(__assign({},attrs),attributes)),setAttributes(attrs,el),stack.push(el)},closeTag:function(_,stack){if(stack.length>1){var el=stack.pop();last(stack).appendChild(el)}},html:function(token,stack){last(stack).insertAdjacentHTML("beforeend",token.content)},text:function(token,stack){var textNode=document.createTextNode(token.content);last(stack).appendChild(textNode)}},WwToDOMAdaptor=function(){function WwToDOMAdaptor(linkAttributes,customRenderer){var convertors=getHTMLRenderConvertors(linkAttributes,customRenderer),customHTMLConvertor=__assign(__assign({},customRenderer.htmlBlock),customRenderer.htmlInline);this.customConvertorKeys=Object.keys(customRenderer).concat(Object.keys(customHTMLConvertor)),this.renderer=new Renderer({gfm:!0,convertors:__assign(__assign({},convertors),customHTMLConvertor)}),this.convertors=this.renderer.getConvertors()}return WwToDOMAdaptor.prototype.generateTokens=function(node){var mdLikeNode=createMdLikeNode(node),context={entering:!0,leaf:!!isPmNode(node)&&node.isLeaf,options:this.renderer.getOptions(),getChildrenText:function(){return isPmNode(node)?node.textContent:""},skipChildren:function(){return!1}},convertor=this.convertors[node.type.name],converted=convertor(mdLikeNode,context,this.convertors),tokens=isArray_default()(converted)?converted:[converted];return(mdLikeNode_isContainer(node.type.name)||node.attrs.htmlInline)&&(context.entering=!1,tokens.push({type:"text",content:isPmNode(node)?node.textContent:""}),tokens=tokens.concat(convertor(mdLikeNode,context,this.convertors))),tokens},WwToDOMAdaptor.prototype.toDOMNode=function(node){var tokens=this.generateTokens(node),stack=[];return tokens.forEach((function(token){return tokenToDOMNode[token.type](token,stack)})),stack[0]},WwToDOMAdaptor.prototype.getToDOMNode=function(name){return common_includes(this.customConvertorKeys,name)?this.toDOMNode.bind(this):null},WwToDOMAdaptor}(),ANIMATION_TIME=100,SCROLL_BLOCKING_RESET_DELAY=15,currentTimeoutId=null,releaseTimer=null;function animation_run(deltaScrollTop,_a){var syncScrollTop=_a.syncScrollTop,releaseEventBlock=_a.releaseEventBlock;releaseTimer&&clearTimeout(releaseTimer),syncScrollTop(deltaScrollTop),releaseTimer=setTimeout((function(){releaseEventBlock()}),15)}function animate(curScrollTop,targetScrollTop,syncCallbacks){var diff=targetScrollTop-curScrollTop,startTime=Date.now(),step=function(){var stepTime,progress=(Date.now()-startTime)/100,deltaValue;currentTimeoutId&&clearTimeout(currentTimeoutId),progress<1?(deltaValue=curScrollTop+diff*Math.cos((1-progress)*Math.PI/2),animation_run(Math.ceil(deltaValue),syncCallbacks),currentTimeoutId=setTimeout(step,1)):(animation_run(targetScrollTop,syncCallbacks),currentTimeoutId=null)};step()}var EDITOR_BOTTOM_PADDING=18,ScrollSync=function(){function ScrollSync(mdEditor,preview,eventEmitter){this.latestEditorScrollTop=null,this.latestPreviewScrollTop=null,this.blockedScroll=null,this.active=!0;var previewRoot=preview.previewContent,previewEl=preview.el;this.previewRoot=previewRoot,this.previewEl=previewEl,this.mdEditor=mdEditor,this.editorView=mdEditor.view,this.toastMark=mdEditor.getToastMark(),this.eventEmitter=eventEmitter,this.addScrollSyncEvent()}return ScrollSync.prototype.addScrollSyncEvent=function(){var _this=this;this.eventEmitter.listen("afterPreviewRender",(function(){setTimeout((function(){_this.syncPreviewScrollTop(!0)}),200)})),this.eventEmitter.listen("scroll",(function(type,data){_this.active&&("editor"===type&&"editor"!==_this.blockedScroll?_this.syncPreviewScrollTop():"preview"===type&&"preview"!==_this.blockedScroll&&_this.syncEditorScrollTop(data))})),this.eventEmitter.listen("toggleScrollSync",(function(active){_this.active=active}))},ScrollSync.prototype.getMdNodeAtPos=function(doc,posInfo){var indexInfo,line=doc.content.findIndex(posInfo.pos).index;return this.toastMark.findFirstNodeAtLine(line+1)},ScrollSync.prototype.getScrollTopByCaretPos=function(){var pos=this.mdEditor.getSelection(),firstMdNode=this.toastMark.findFirstNodeAtLine(pos[0][0]),previewHeight=this.previewEl.clientHeight,el=getParentNodeObj(firstMdNode).el,totalOffsetTop,nodeHeight,targetScrollTop=(getTotalOffsetTop(el,this.previewRoot)||el.offsetTop)+el.clientHeight-.5*previewHeight,diff;return this.latestEditorScrollTop=null,el.getBoundingClientRect().top-this.previewEl.getBoundingClientRect().top<previewHeight?null:targetScrollTop},ScrollSync.prototype.syncPreviewScrollTop=function(editing){void 0===editing&&(editing=!1);var _a=this,editorView=_a.editorView,previewEl=_a.previewEl,previewRoot=_a.previewRoot,_b=editorView.dom.getBoundingClientRect(),left=_b.left,top=_b.top,posInfo=editorView.posAtCoords({left:left,top:top}),doc=editorView.state.doc,firstMdNode=this.getMdNodeAtPos(doc,posInfo);if(firstMdNode&&!isHTMLNode(firstMdNode)){var curScrollTop=previewEl.scrollTop,_c=editorView.dom,scrollTop=_c.scrollTop,scrollHeight=_c.scrollHeight,clientHeight=_c.clientHeight,children=_c.children,isBottomPos=scrollHeight-scrollTop<=clientHeight+18,targetScrollTop=isBottomPos?previewEl.scrollHeight:0;if(scrollTop&&!isBottomPos){if(editing){var scrollTopByEditing=this.getScrollTopByCaretPos();if(!scrollTopByEditing)return;targetScrollTop=scrollTopByEditing}else{var _d=getParentNodeObj(firstMdNode),el=_d.el,mdNode,_e=getEditorRangeHeightInfo(doc,_d.mdNode,children),height=_e.height,rect=_e.rect,totalOffsetTop,nodeHeight,ratio;targetScrollTop=(getTotalOffsetTop(el,previewRoot)||el.offsetTop)+el.clientHeight*(top>rect.top?Math.min((top-rect.top)/height,1):0)}targetScrollTop=this.getResolvedScrollTop("editor",scrollTop,targetScrollTop,curScrollTop),this.latestEditorScrollTop=scrollTop}targetScrollTop!==curScrollTop&&this.run("editor",targetScrollTop,curScrollTop)}},ScrollSync.prototype.syncEditorScrollTop=function(targetNode){var _a=this,toastMark=_a.toastMark,editorView=_a.editorView,previewRoot=_a.previewRoot,previewEl=_a.previewEl,dom=editorView.dom,state=editorView.state,scrollTop=previewEl.scrollTop,clientHeight=previewEl.clientHeight,scrollHeight,isBottomPos=previewEl.scrollHeight-scrollTop<=clientHeight,curScrollTop=dom.scrollTop,targetScrollTop=isBottomPos?dom.scrollHeight:0;if(scrollTop&&targetNode&&!isBottomPos){if(!(targetNode=findAncestorHavingId(targetNode,previewRoot)).getAttribute("data-nodeid"))return;var children=dom.children,mdNodeId=Number(targetNode.getAttribute("data-nodeid")),_b=getParentNodeObj(toastMark.findNodeById(mdNodeId)),mdNode=_b.mdNode,el=_b.el,mdNodeStartLine;targetScrollTop=children[getMdStartLine(mdNode)-1].offsetTop;var height=getEditorRangeHeightInfo(state.doc,mdNode,children).height,_c=getAndSaveOffsetInfo(el,previewRoot,mdNodeId),nodeHeight=_c.nodeHeight,offsetTop;targetScrollTop+=getAdditionalPos(scrollTop,_c.offsetTop,nodeHeight,height),targetScrollTop=this.getResolvedScrollTop("preview",scrollTop,targetScrollTop,curScrollTop),this.latestPreviewScrollTop=scrollTop}targetScrollTop!==curScrollTop&&this.run("preview",targetScrollTop,curScrollTop)},ScrollSync.prototype.getResolvedScrollTop=function(from,scrollTop,targetScrollTop,curScrollTop){var latestScrollTop="editor"===from?this.latestEditorScrollTop:this.latestPreviewScrollTop;return null===latestScrollTop?targetScrollTop:latestScrollTop<scrollTop?Math.max(targetScrollTop,curScrollTop):Math.min(targetScrollTop,curScrollTop)},ScrollSync.prototype.run=function(from,targetScrollTop,curScrollTop){var _this=this,scrollTarget,syncCallbacks;"editor"===from?(scrollTarget=this.previewEl,this.blockedScroll="preview"):(scrollTarget=this.editorView.dom,this.blockedScroll="editor"),animate(curScrollTop,targetScrollTop,{syncScrollTop:function(scrollTop){return scrollTarget.scrollTop=scrollTop},releaseEventBlock:function(){return _this.blockedScroll=null}})},ScrollSync.prototype.destroy=function(){this.eventEmitter.removeEventHandler("scroll"),this.eventEmitter.removeEventHandler("afterPreviewRender")},ScrollSync}(),ToastUIEditorCore,editorCore=function(){function ToastUIEditorCore(options){var _this=this;this.initialHtml=options.el.innerHTML,options.el.innerHTML="",this.options=extend_default()({previewStyle:"tab",previewHighlight:!0,initialEditType:"markdown",height:"300px",minHeight:"200px",language:"en-US",useCommandShortcut:!0,usageStatistics:!0,toolbarItems:[["heading","bold","italic","strike"],["hr","quote"],["ul","ol","task","indent","outdent"],["table","image","link"],["code","codeblock"],["scrollSync"]],hideModeSwitch:!1,linkAttributes:null,extendedAutolinks:!1,customHTMLRenderer:null,customMarkdownRenderer:null,referenceDefinition:!1,customHTMLSanitizer:null,frontMatter:!1,widgetRules:[],theme:"light"},options);var _a=this.options,customHTMLRenderer=_a.customHTMLRenderer,extendedAutolinks=_a.extendedAutolinks,referenceDefinition=_a.referenceDefinition,frontMatter=_a.frontMatter,customMarkdownRenderer=_a.customMarkdownRenderer,useCommandShortcut=_a.useCommandShortcut,initialEditType=_a.initialEditType,widgetRules=_a.widgetRules,customHTMLSanitizer=_a.customHTMLSanitizer;this.mode=initialEditType||"markdown",this.mdPreviewStyle=this.options.previewStyle,this.eventEmitter=new eventEmitter,setWidgetRules(widgetRules);var linkAttributes=sanitizeLinkAttribute(this.options.linkAttributes);this.pluginInfo=getPluginInfo(this.options.plugins,this.eventEmitter,this.options.usageStatistics);var _b=this.pluginInfo,toHTMLRenderers=_b.toHTMLRenderers,toMarkdownRenderers=_b.toMarkdownRenderers,mdPlugins=_b.mdPlugins,wwPlugins=_b.wwPlugins,wwNodeViews=_b.wwNodeViews,mdCommands=_b.mdCommands,wwCommands=_b.wwCommands,markdownParsers=_b.markdownParsers,rendererOptions={linkAttributes:linkAttributes,customHTMLRenderer:deepMergedCopy(toHTMLRenderers,customHTMLRenderer),extendedAutolinks:extendedAutolinks,referenceDefinition:referenceDefinition,frontMatter:frontMatter,sanitizer:customHTMLSanitizer||sanitizeHTML},wwToDOMAdaptor=new WwToDOMAdaptor(linkAttributes,rendererOptions.customHTMLRenderer),htmlSchemaMap=createHTMLSchemaMap(rendererOptions.customHTMLRenderer,rendererOptions.sanitizer,wwToDOMAdaptor);this.i18n=i18n,this.i18n.setCode(this.options.language),this.toastMark=new ToastMark("",{disallowedHtmlBlockTags:["br","img"],extendedAutolinks:extendedAutolinks,referenceDefinition:referenceDefinition,disallowDeepHeading:!0,frontMatter:frontMatter,customParser:markdownParsers}),this.mdEditor=new mdEditor(this.eventEmitter,{toastMark:this.toastMark,useCommandShortcut:useCommandShortcut,mdPlugins:mdPlugins}),this.preview=new mdPreview(this.eventEmitter,__assign(__assign({},rendererOptions),{isViewer:!1,highlight:this.options.previewHighlight})),this.wwEditor=new wwEditor(this.eventEmitter,{toDOMAdaptor:wwToDOMAdaptor,useCommandShortcut:useCommandShortcut,htmlSchemaMap:htmlSchemaMap,linkAttributes:linkAttributes,wwPlugins:wwPlugins,wwNodeViews:wwNodeViews}),this.convertor=new convertor(this.wwEditor.getSchema(),__assign(__assign({},toMarkdownRenderers),customMarkdownRenderer),getHTMLRenderConvertors(linkAttributes,rendererOptions.customHTMLRenderer),this.eventEmitter),this.setMinHeight(this.options.minHeight),this.setHeight(this.options.height),this.setMarkdown(this.options.initialValue,!1),this.options.placeholder&&this.setPlaceholder(this.options.placeholder),this.options.initialValue||this.setHTML(this.initialHtml,!1),this.commandManager=new commandManager(this.eventEmitter,this.mdEditor.commands,this.wwEditor.commands,(function(){return _this.mode})),this.options.usageStatistics&&sendHostName(),this.scrollSync=new ScrollSync(this.mdEditor,this.preview,this.eventEmitter),this.addInitEvent(),this.addInitCommand(mdCommands,wwCommands),this.options.hooks&&forEachOwnProperties_default()(this.options.hooks,(function(fn,key){return _this.addHook(key,fn)})),this.options.events&&forEachOwnProperties_default()(this.options.events,(function(fn,key){return _this.on(key,fn)})),this.eventEmitter.emit("load",this),this.moveCursorToStart()}return ToastUIEditorCore.prototype.addInitEvent=function(){this.on("needChangeMode",this.changeMode.bind(this)),addDefaultImageBlobHook(this.eventEmitter)},ToastUIEditorCore.prototype.addInitCommand=function(mdCommands,wwCommands){var _this=this,addPluginCommands=function(type,commandMap){Object.keys(commandMap).forEach((function(name){_this.addCommand(type,name,commandMap[name])}))};this.addCommand("markdown","toggleScrollSync",(function(payload){return _this.eventEmitter.emit("toggleScrollSync",payload.active),!0})),addPluginCommands("markdown",mdCommands),addPluginCommands("wysiwyg",wwCommands)},ToastUIEditorCore.prototype.getCurrentModeEditor=function(){return this.isMarkdownMode()?this.mdEditor:this.wwEditor},ToastUIEditorCore.factory=function(options){return options.viewer?new viewer(options):new ToastUIEditorCore(options)},ToastUIEditorCore.setLanguage=function(code,data){i18n.setLanguage(code,data)},ToastUIEditorCore.prototype.changePreviewStyle=function(style){this.mdPreviewStyle!==style&&(this.mdPreviewStyle=style,this.eventEmitter.emit("changePreviewStyle",style))},ToastUIEditorCore.prototype.exec=function(name,payload){this.commandManager.exec(name,payload)},ToastUIEditorCore.prototype.addCommand=function(type,name,command){var _this=this,commandHoc=function(paylaod){void 0===paylaod&&(paylaod={});var view=("markdown"===type?_this.mdEditor:_this.wwEditor).view;command(paylaod,view.state,view.dispatch,view)};this.commandManager.addCommand(type,name,commandHoc)},ToastUIEditorCore.prototype.on=function(type,handler){this.eventEmitter.listen(type,handler)},ToastUIEditorCore.prototype.off=function(type){this.eventEmitter.removeEventHandler(type)},ToastUIEditorCore.prototype.addHook=function(type,handler){this.eventEmitter.removeEventHandler(type),this.eventEmitter.listen(type,handler)},ToastUIEditorCore.prototype.removeHook=function(type){this.eventEmitter.removeEventHandler(type)},ToastUIEditorCore.prototype.focus=function(){this.getCurrentModeEditor().focus()},ToastUIEditorCore.prototype.blur=function(){this.getCurrentModeEditor().blur()},ToastUIEditorCore.prototype.moveCursorToEnd=function(){this.getCurrentModeEditor().moveCursorToEnd()},ToastUIEditorCore.prototype.moveCursorToStart=function(){this.getCurrentModeEditor().moveCursorToStart()},ToastUIEditorCore.prototype.setMarkdown=function(markdown,cursorToEnd){if(void 0===markdown&&(markdown=""),void 0===cursorToEnd&&(cursorToEnd=!0),this.mdEditor.setMarkdown(markdown,cursorToEnd),this.isWysiwygMode()){var mdNode=this.toastMark.getRootNode(),wwNode=this.convertor.toWysiwygModel(mdNode);this.wwEditor.setModel(wwNode,cursorToEnd)}},ToastUIEditorCore.prototype.setHTML=function(html,cursorToEnd){void 0===html&&(html=""),void 0===cursorToEnd&&(cursorToEnd=!0);var container=document.createElement("div");container.innerHTML=replaceBRWithEmptyBlock(html);var wwNode=DOMParser.fromSchema(this.wwEditor.schema).parse(container);this.isMarkdownMode()?this.mdEditor.setMarkdown(this.convertor.toMarkdownText(wwNode),cursorToEnd):this.wwEditor.setModel(wwNode,cursorToEnd)},ToastUIEditorCore.prototype.getMarkdown=function(){return this.isMarkdownMode()?this.mdEditor.getMarkdown():this.convertor.toMarkdownText(this.wwEditor.getModel())},ToastUIEditorCore.prototype.getHTML=function(){var _this=this;this.eventEmitter.holdEventInvoke((function(){_this.isWysiwygMode()&&_this.mdEditor.setMarkdown(_this.convertor.toMarkdownText(_this.wwEditor.getModel()))}));var mdNode=this.toastMark.getRootNode(),mdRenderer;return this.preview.getRenderer().render(mdNode).replace(/\sdata-nodeid="\d{1,}"/g,"").trim()},ToastUIEditorCore.prototype.insertText=function(text){this.getCurrentModeEditor().replaceSelection(text)},ToastUIEditorCore.prototype.setSelection=function(start,end){this.getCurrentModeEditor().setSelection(start,end)},ToastUIEditorCore.prototype.replaceSelection=function(text,start,end){this.getCurrentModeEditor().replaceSelection(text,start,end)},ToastUIEditorCore.prototype.deleteSelection=function(start,end){this.getCurrentModeEditor().deleteSelection(start,end)},ToastUIEditorCore.prototype.getSelectedText=function(start,end){return this.getCurrentModeEditor().getSelectedText(start,end)},ToastUIEditorCore.prototype.getRangeInfoOfNode=function(pos){return this.getCurrentModeEditor().getRangeInfoOfNode(pos)},ToastUIEditorCore.prototype.addWidget=function(node,style,pos){this.getCurrentModeEditor().addWidget(node,style,pos)},ToastUIEditorCore.prototype.replaceWithWidget=function(start,end,text){this.getCurrentModeEditor().replaceWithWidget(start,end,text)},ToastUIEditorCore.prototype.setHeight=function(height){var el=this.options.el;isString_default()(height)&&("auto"===height?(addClass_default()(el,"auto-height"),this.setMinHeight(this.getMinHeight())):(removeClass_default()(el,"auto-height"),this.setMinHeight(height))),css_default()(el,{height:height}),this.height=height},ToastUIEditorCore.prototype.getHeight=function(){return this.height},ToastUIEditorCore.prototype.setMinHeight=function(minHeight){var _a;this.minHeight=minHeight;var editorHeight,editorSectionHeight,diffHeight=this.options.el.clientHeight-((null===(_a=document.querySelector("."+cls("main")))||void 0===_a?void 0:_a.clientHeight)||0),minHeightNum=parseInt(minHeight,10);minHeightNum=Math.max(minHeightNum-diffHeight,0),this.wwEditor.setMinHeight(minHeightNum),this.mdEditor.setMinHeight(minHeightNum),this.preview.setMinHeight(minHeightNum)},ToastUIEditorCore.prototype.getMinHeight=function(){return this.minHeight},ToastUIEditorCore.prototype.isMarkdownMode=function(){return"markdown"===this.mode},ToastUIEditorCore.prototype.isWysiwygMode=function(){return"wysiwyg"===this.mode},ToastUIEditorCore.prototype.isViewer=function(){return!1},ToastUIEditorCore.prototype.getCurrentPreviewStyle=function(){return this.mdPreviewStyle},ToastUIEditorCore.prototype.changeMode=function(mode,withoutFocus){if(this.mode!==mode){if(this.mode=mode,this.isWysiwygMode()){var mdNode=this.toastMark.getRootNode(),wwNode=this.convertor.toWysiwygModel(mdNode);this.wwEditor.setModel(wwNode)}else{var wwNode=this.wwEditor.getModel();this.mdEditor.setMarkdown(this.convertor.toMarkdownText(wwNode),!withoutFocus)}if(this.eventEmitter.emit("removePopupWidget"),this.eventEmitter.emit("changeMode",mode),!withoutFocus){var pos=this.convertor.getMappedPos();this.focus(),this.isWysiwygMode()&&isNumber_default()(pos)?this.wwEditor.setSelection(pos):Array.isArray(pos)&&this.mdEditor.setSelection(pos)}}},ToastUIEditorCore.prototype.destroy=function(){var _this=this;this.wwEditor.destroy(),this.mdEditor.destroy(),this.preview.destroy(),this.scrollSync.destroy(),this.eventEmitter.emit("destroy"),this.eventEmitter.getEvents().forEach((function(_,type){return _this.off(type)}))},ToastUIEditorCore.prototype.hide=function(){this.eventEmitter.emit("hide")},ToastUIEditorCore.prototype.show=function(){this.eventEmitter.emit("show")},ToastUIEditorCore.prototype.setScrollTop=function(value){this.getCurrentModeEditor().setScrollTop(value)},ToastUIEditorCore.prototype.getScrollTop=function(){return this.getCurrentModeEditor().getScrollTop()},ToastUIEditorCore.prototype.reset=function(){this.wwEditor.setModel([]),this.mdEditor.setMarkdown("")},ToastUIEditorCore.prototype.getSelection=function(){return this.getCurrentModeEditor().getSelection()},ToastUIEditorCore.prototype.setPlaceholder=function(placeholder){this.mdEditor.setPlaceholder(placeholder),this.wwEditor.setPlaceholder(placeholder)},ToastUIEditorCore.prototype.getEditorElements=function(){return{mdEditor:this.mdEditor.getElement(),mdPreview:this.preview.getElement(),wwEditor:this.wwEditor.getElement()}},ToastUIEditorCore}();function htm(n){for(var l,e,s=arguments,t=1,r="",u="",a=[0],c=function(n){1===t&&(n||(r=r.replace(/^\s*\n\s*|\s*\n\s*$/g,"")))?a.push(n?s[n]:r):3===t&&(n||r)?(a[1]=n?s[n]:r,t=2):2===t&&"..."===r&&n?a[2]=common_assign(a[2]||{},s[n]):2===t&&r&&!n?(a[2]=a[2]||{})[r]=!0:t>=5&&(5===t?((a[2]=a[2]||{})[e]=n?r?r+s[n]:s[n]:r,t=6):(n||r)&&(a[2][e]+=n?r+s[n]:r)),r=""},h=0;h<n.length;h++){h&&(1===t&&c(),c(h));for(var i=0;i<n[h].length;i++)l=n[h][i],1===t?"<"===l?(c(),a=[a,"",null],t=3):r+=l:4===t?"--"===r&&">"===l?(t=1,r=""):r=l+r[0]:u?l===u?u="":r+=l:'"'===l||"'"===l?u=l:">"===l?(c(),t=1):t&&("="===l?(t=5,e=r,r=""):"/"===l&&(t<5||">"===n[h][i+1])?(c(),3===t&&(a=a[0]),t=a,(a=a[0]).push(this.apply(null,t.slice(1))),t=0):" "===l||"\t"===l||"\n"===l||"\r"===l?(c(),t=2):r+=l),3===t&&"!--"===r&&(t=4,a=a[0])}return c(),a.length>2?a.slice(1):a[1]}var isBoolean=__webpack_require__(326),isBoolean_default=__webpack_require__.n(isBoolean),VNodeWalker=function(){function VNodeWalker(current){this.current=current,this.root=current,this.entering=!0}return VNodeWalker.prototype.walk=function(){var _a=this,entering=_a.entering,cur=_a.current;return cur?(entering?cur.firstChild?(this.current=cur.firstChild,this.entering=!0):this.entering=!1:cur===this.root?this.current=null:cur.next?(this.current=cur.next,this.entering=!0):(this.current=cur.parent,this.entering=!1),{vnode:cur,entering:entering}):null},VNodeWalker}(),VNode=function(){function VNode(type,props,children){this.parent=null,this.old=null,this.firstChild=null,this.next=null,this.skip=!1,this.type=type,this.props=props,this.children=children,this.props.children=children,props.ref&&(this.ref=props.ref,delete props.ref),props.key&&(this.key=props.key,delete props.key)}return VNode.prototype.walker=function(){return new VNodeWalker(this)},VNode.removalNodes=[],VNode}();function template_createTextNode(text){return new VNode("TEXT_NODE",{nodeValue:text},[])}function excludeUnnecessaryChild(child,flatted){var vnode=child;isBoolean_default()(child)||null==child?vnode=null:(isString_default()(child)||isNumber_default()(child))&&(vnode=template_createTextNode(String(child))),vnode&&flatted.push(vnode)}function h(type,props){for(var children=[],_i=2;_i<arguments.length;_i++)children[_i-2]=arguments[_i];var flatted=[];return children.forEach((function(child){Array.isArray(child)?child.forEach((function(vnode){excludeUnnecessaryChild(vnode,flatted)})):excludeUnnecessaryChild(child,flatted)})),new VNode(type,props||{},flatted)}var template=htm.bind(h),type_isObject=__webpack_require__(73),isObject_default=__webpack_require__.n(type_isObject);function dom_createNode(vnode){var node;return"TEXT_NODE"===vnode.type?node=document.createTextNode(vnode.props.nodeValue):setProps(node=document.createElement(vnode.type),{},vnode.props),node}function dom_removeNode(vnode,parentNode){vnode.node?parentNode.removeChild(vnode.node):dom_removeNode(vnode.firstChild,parentNode)}function innerDiff(node,prevProps,nextProps){Object.keys(prevProps).forEach((function(propName){if(/^on/.test(propName)){if(!nextProps[propName]||prevProps[propName]!==nextProps[propName]){var eventName=propName.slice(2).toLowerCase();node.removeEventListener(eventName,prevProps[propName])}}else"children"===propName||nextProps[propName]||isTextNode(node)||node.removeAttribute(propName)})),setProps(node,prevProps,nextProps,(function(propName){return!shallowEqual(prevProps[propName],nextProps[propName])}))}var reNonDimension=/acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i;function setProps(node,prevProps,props,condition){Object.keys(props).forEach((function(propName){if(!condition||condition(propName))if(/^on/.test(propName)){var eventName=propName.slice(2).toLowerCase();node.addEventListener(eventName,props[propName])}else"nodeValue"===propName?node[propName]=props[propName]:"style"===propName&&isObject_default()(props[propName])?setStyleProps(node,prevProps[propName],props[propName]):"children"!==propName&&(!1===props[propName]?node.removeAttribute(propName):node.setAttribute(propName,props[propName]))}))}function setStyleProps(node,prevStyleProps,styleProps){prevStyleProps&&Object.keys(prevStyleProps).forEach((function(styleProp){node.style[styleProp]=""})),Object.keys(styleProps).forEach((function(styleProp){var value=styleProps[styleProp];node.style[styleProp]=isNumber_default()(value)&&!reNonDimension.test(styleProp)?value+"px":value}))}function commit(vnode){if(VNode.removalNodes.forEach((function(removalNode){return diff(removalNode)})),vnode)for(var next=void 0,walker=vnode.walker();next=walker.walk();)if(vnode=next.vnode,next.entering)diff(vnode);else if(isFunction_default()(vnode.type)){var comp=vnode.component;if(!vnode.old&&comp.mounted&&comp.mounted(),vnode.old&&comp.updated){var prevProps=comp.prevProps||{};comp.updated(prevProps)}}}function getParentNode(vnode){for(var parent=vnode.parent;!parent.node;)parent=parent.parent;return parent.node}function diff(vnode){if(vnode&&vnode.parent){if(vnode.node){var parentNode=getParentNode(vnode);"A"===vnode.effect?parentNode.appendChild(vnode.node):"U"===vnode.effect&&innerDiff(vnode.node,vnode.old.props,vnode.props)}if("D"===vnode.effect)for(var next=void 0,walker=vnode.walker();next=walker.walk();)if(vnode=next.vnode,!next.entering)if(isFunction_default()(vnode.type)){var comp=vnode.component;comp.beforeDestroy&&comp.beforeDestroy()}else{var parentNode;dom_removeNode(vnode,parentNode=getParentNode(vnode))}vnode.ref&&(vnode.component?vnode.ref(vnode.component):vnode.node&&vnode.ref(vnode.node))}}function createComponent(Comp,vnode){var props=vnode.props,component=vnode.component;return component?(component.prevProps=component.props,component.props=vnode.props,component):new Comp(props)}function buildVNode(vnode){for(var root=vnode;vnode&&!vnode.skip;){if(isFunction_default()(vnode.type)){var instance=createComponent(vnode.type,vnode);instance.vnode=vnode,vnode.component=instance,vnode.props.children=vnode.children=[instance.render()],buildChildrenVNode(vnode)}else vnode.node||(vnode.node=dom_createNode(vnode)),buildChildrenVNode(vnode);if(vnode.firstChild)vnode=vnode.firstChild;else{for(;vnode&&vnode.parent&&!vnode.next&&(vnode=vnode.parent)!==root;);vnode=vnode.next}}}function isSameType(old,vnode){return old&&vnode&&vnode.type===old.type&&(!vnode.key||vnode.key===old.key)}function buildChildrenVNode(parent){var children=parent.children,old=parent.old?parent.old.firstChild:null,prev=null;children.forEach((function(vnode,index){var sameType=isSameType(old,vnode);sameType&&(vnode.old=old,vnode.parent=parent,vnode.node=old.node,vnode.component=old.component,vnode.effect="U"),vnode&&!sameType&&(vnode.old=null,vnode.parent=parent,vnode.node=null,vnode.effect="A"),old&&!sameType&&(VNode.removalNodes.push(old),old.effect="D"),old&&(old=old.next),0===index?parent.firstChild=vnode:vnode&&(prev.next=vnode),prev=vnode}));var lastChild=last(children);if(!children.length)for(;old;)VNode.removalNodes.push(old),old.effect="D",old=old.next;for(;old&&lastChild;)old&&lastChild.old!==old&&(VNode.removalNodes.push(old),old.effect="D",old=old.next)}function destroy(vnode){vnode.effect="D",VNode.removalNodes=[vnode],commit(),VNode.removalNodes=[]}function rerender(comp){var root=comp.vnode;root.effect="U",root.old=root,root.next&&(root.next.skip=!0),VNode.removalNodes=[],buildVNode(root),commit(root),root.next&&(root.next.skip=!1)}function render(container,vnode){var root=new VNode(container.tagName.toLowerCase(),{},[vnode]);return root.node=container,VNode.removalNodes=[],buildVNode(root),commit(root),function(){return destroy(root.firstChild)}}var Component=function(){function Component(props){this.props=props,this.state={},this.refs={}}return Component.prototype.setState=function(state){var newState=__assign(__assign({},this.state),state);shallowEqual(this.state,newState)||(this.state=newState,rerender(this))},Component}(),Switch=function(_super){function Switch(props){var _this=_super.call(this,props)||this;return _this.state={hide:!1},_this}return __extends(Switch,_super),Switch.prototype.show=function(){this.setState({hide:!1})},Switch.prototype.hide=function(){this.setState({hide:!0})},Switch.prototype.render=function(){var _a=this.props,editorType=_a.editorType,eventEmitter=_a.eventEmitter;return template(templateObject_1||(templateObject_1=__makeTemplateObject(['\n      <div class="','" style="display: ','">\n        <div\n          class="tab-item','"\n          onClick=',"\n        >\n          ",'\n        </div>\n        <div\n          class="tab-item','"\n          onClick=',"\n        >\n          ","\n        </div>\n      </div>\n    "],['\n      <div class="','" style="display: ','">\n        <div\n          class="tab-item','"\n          onClick=',"\n        >\n          ",'\n        </div>\n        <div\n          class="tab-item','"\n          onClick=',"\n        >\n          ","\n        </div>\n      </div>\n    "])),cls("mode-switch"),this.state.hide?"none":"block","markdown"===editorType?" active":"",(function(){eventEmitter.emit("needChangeMode","markdown")}),i18n.get("Markdown"),"wysiwyg"===editorType?" active":"",(function(){eventEmitter.emit("needChangeMode","wysiwyg")}),i18n.get("WYSIWYG"))},Switch}(Component),templateObject_1,throttle=__webpack_require__(423),throttle_default=__webpack_require__.n(throttle),HeadingPopupBody=function(_super){function HeadingPopupBody(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(HeadingPopupBody,_super),HeadingPopupBody.prototype.execCommand=function(ev){var el=closest(ev.target,"li");this.props.execCommand("heading",{level:Number(el.getAttribute("data-level"))})},HeadingPopupBody.prototype.render=function(){var _this=this;return template(templateObject_2||(templateObject_2=__makeTemplateObject(["\n      <ul onClick=",">\n        ",'\n        <li data-type="Paragraph"><div>',"</div></li>\n      </ul>\n    "],["\n      <ul onClick=",">\n        ",'\n        <li data-type="Paragraph"><div>',"</div></li>\n      </ul>\n    "])),(function(ev){return _this.execCommand(ev)}),[1,2,3,4,5,6].map((function(level){return template(headingPopupBody_templateObject_1||(headingPopupBody_templateObject_1=__makeTemplateObject(['\n              <li data-level="','" data-type="Heading">\n                <',">"," ","</$>\n              </li>\n            "],['\n              <li data-level="','" data-type="Heading">\n                <',">"," ","</$>\n              </li>\n            "])),level,"h"+level,i18n.get("Heading"),level)})),i18n.get("Paragraph"))},HeadingPopupBody}(Component),headingPopupBody_templateObject_1,templateObject_2,Tabs=function(_super){function Tabs(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(Tabs,_super),Tabs.prototype.toggleTab=function(ev,activeTab){this.props.onClick(ev,activeTab)},Tabs.prototype.render=function(){var _this=this;return template(tabs_templateObject_2||(tabs_templateObject_2=__makeTemplateObject(['\n      <div class="','">\n        ',"\n      </div>\n    "],['\n      <div class="','">\n        ',"\n      </div>\n    "])),cls("tabs"),this.props.tabs.map((function(_a){var name=_a.name,text=_a.text;return template(tabs_templateObject_1||(tabs_templateObject_1=__makeTemplateObject(['\n            <div\n              class="tab-item','"\n              onClick=',"\n            >\n              ","\n            </div>\n          "],['\n            <div\n              class="tab-item','"\n              onClick=',"\n            >\n              ","\n            </div>\n          "])),_this.props.activeTab===name?" active":"",(function(ev){return _this.toggleTab(ev,name)}),i18n.get(text))})))},Tabs}(Component),tabs_templateObject_1,tabs_templateObject_2,TYPE_UI="ui",ImagePopupBody=function(_super){function ImagePopupBody(props){var _this=_super.call(this,props)||this;return _this.initialize=function(activeTab){void 0===activeTab&&(activeTab="file");var urlEl=_this.refs.url;urlEl.value="",_this.refs.altText.value="",_this.refs.file.value="",removeClass_default()(urlEl,"wrong"),_this.setState({activeTab:activeTab,file:null,fileNameElClassName:""})},_this.execCommand=function(){"file"===_this.state.activeTab?_this.emitAddImageBlob():_this.emitAddImage()},_this.toggleTab=function(_,activeTab){activeTab!==_this.state.activeTab&&_this.initialize(activeTab)},_this.showFileSelectBox=function(){_this.refs.file.click()},_this.changeFile=function(ev){var files=ev.target.files;(null==files?void 0:files.length)&&_this.setState({file:files[0]})},_this.state={activeTab:"file",file:null,fileNameElClassName:""},_this.tabs=[{name:"file",text:"File"},{name:"url",text:"URL"}],_this}return __extends(ImagePopupBody,_super),ImagePopupBody.prototype.emitAddImageBlob=function(){var _this=this,files=this.refs.file.files,altTextEl=this.refs.altText,fileNameElClassName=" wrong";if(null==files?void 0:files.length){fileNameElClassName="";var imageFile=files.item(0),hookCallback=function(url,text){return _this.props.execCommand("addImage",{imageUrl:url,altText:text||altTextEl.value})};this.props.eventEmitter.emit("addImageBlobHook",imageFile,hookCallback,"ui")}this.setState({fileNameElClassName:fileNameElClassName})},ImagePopupBody.prototype.emitAddImage=function(){var imageUrlEl=this.refs.url,altTextEl=this.refs.altText,imageUrl=imageUrlEl.value,altText=altTextEl.value||"image";removeClass_default()(imageUrlEl,"wrong"),imageUrl.length?imageUrl&&this.props.execCommand("addImage",{imageUrl:imageUrl,altText:altText}):addClass_default()(imageUrlEl,"wrong")},ImagePopupBody.prototype.preventSelectStart=function(ev){ev.preventDefault()},ImagePopupBody.prototype.updated=function(){this.props.show||this.initialize()},ImagePopupBody.prototype.render=function(){var _this=this,_a=this.state,activeTab=_a.activeTab,file=_a.file,fileNameElClassName=_a.fileNameElClassName;return template(imagePopupBody_templateObject_1||(imagePopupBody_templateObject_1=__makeTemplateObject(["\n      <div>\n        <"," tabs="," activeTab="," onClick=",' />\n        <div style="display:','">\n          <label for="toastuiImageUrlInput">','</label>\n          <input\n            id="toastuiImageUrlInput"\n            type="text"\n            ref=','\n          />\n        </div>\n        <div style="display:',';position: relative;">\n          <label for="toastuiImageFileInput">','</label>\n          <span\n            class="',"",'"\n            onClick=',"\n            onSelectstart=","\n          >\n            ",'\n          </span>\n          <button\n            type="button"\n            class="','"\n            onClick=',"\n          >\n            ",'\n          </button>\n          <input\n            id="toastuiImageFileInput"\n            type="file"\n            accept="image/*"\n            onChange=',"\n            ref=",'\n          />\n        </div>\n        <label for="toastuiAltTextInput">','</label>\n        <input\n          id="toastuiAltTextInput"\n          type="text"\n          ref=','\n        />\n        <div class="','">\n          <button type="button" class="','" onClick=',">\n            ",'\n          </button>\n          <button type="button" class="','" onClick=',">\n            ","\n          </button>\n        </div>\n      </div>\n    "],["\n      <div>\n        <"," tabs="," activeTab="," onClick=",' />\n        <div style="display:','">\n          <label for="toastuiImageUrlInput">','</label>\n          <input\n            id="toastuiImageUrlInput"\n            type="text"\n            ref=','\n          />\n        </div>\n        <div style="display:',';position: relative;">\n          <label for="toastuiImageFileInput">','</label>\n          <span\n            class="',"",'"\n            onClick=',"\n            onSelectstart=","\n          >\n            ",'\n          </span>\n          <button\n            type="button"\n            class="','"\n            onClick=',"\n          >\n            ",'\n          </button>\n          <input\n            id="toastuiImageFileInput"\n            type="file"\n            accept="image/*"\n            onChange=',"\n            ref=",'\n          />\n        </div>\n        <label for="toastuiAltTextInput">','</label>\n        <input\n          id="toastuiAltTextInput"\n          type="text"\n          ref=','\n        />\n        <div class="','">\n          <button type="button" class="','" onClick=',">\n            ",'\n          </button>\n          <button type="button" class="','" onClick=',">\n            ","\n          </button>\n        </div>\n      </div>\n    "])),Tabs,this.tabs,activeTab,this.toggleTab,"url"===activeTab?"block":"none",i18n.get("Image URL"),(function(el){return _this.refs.url=el}),"file"===activeTab?"block":"none",i18n.get("Select image file"),cls("file-name"),file?" has-file":fileNameElClassName,this.showFileSelectBox,this.preventSelectStart,file?file.name:i18n.get("No file"),cls("file-select-button"),this.showFileSelectBox,i18n.get("Choose a file"),this.changeFile,(function(el){return _this.refs.file=el}),i18n.get("Description"),(function(el){return _this.refs.altText=el}),cls("button-container"),cls("close-button"),this.props.hidePopup,i18n.get("Cancel"),cls("ok-button"),this.execCommand,i18n.get("OK"))},ImagePopupBody}(Component),imagePopupBody_templateObject_1,LinkPopupBody=function(_super){function LinkPopupBody(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.execCommand=function(){var linkUrlEl=_this.refs.url,linkTextEl=_this.refs.text,checkLinkText;(removeClass_default()(linkUrlEl,"wrong"),removeClass_default()(linkTextEl,"wrong"),linkUrlEl.value.length<1)?addClass_default()(linkUrlEl,"wrong"):isUndefined_default()(_this.props.initialValues.linkUrl)&&linkTextEl.value.length<1?addClass_default()(linkTextEl,"wrong"):_this.props.execCommand("addLink",{linkUrl:linkUrlEl.value,linkText:linkTextEl.value})},_this}return __extends(LinkPopupBody,_super),LinkPopupBody.prototype.initialize=function(){var _a=this.props.initialValues,linkUrl=_a.linkUrl,linkText=_a.linkText,linkUrlEl=this.refs.url,linkTextEl=this.refs.text;removeClass_default()(linkUrlEl,"wrong"),removeClass_default()(linkTextEl,"wrong","disabled"),linkTextEl.removeAttribute("disabled"),linkUrl&&(addClass_default()(linkTextEl,"disabled"),linkTextEl.setAttribute("disabled","disabled")),linkUrlEl.value=linkUrl||"",linkTextEl.value=linkText||""},LinkPopupBody.prototype.mounted=function(){this.initialize()},LinkPopupBody.prototype.updated=function(prevProps){!prevProps.show&&this.props.show&&this.initialize()},LinkPopupBody.prototype.render=function(){var _this=this;return template(linkPopupBody_templateObject_1||(linkPopupBody_templateObject_1=__makeTemplateObject(['\n      <div>\n        <label for="toastuiLinkUrlInput">','</label>\n        <input\n          id="toastuiLinkUrlInput"\n          type="text"\n          ref=','\n        />\n        <label for="toastuiLinkTextInput">','</label>\n        <input\n          id="toastuiLinkTextInput"\n          type="text"\n          ref=','\n        />\n        <div class="','">\n          <button type="button" class="','" onClick=',">\n            ",'\n          </button>\n          <button type="button" class="','" onClick=',">\n            ","\n          </button>\n        </div>\n      </div>\n    "],['\n      <div>\n        <label for="toastuiLinkUrlInput">','</label>\n        <input\n          id="toastuiLinkUrlInput"\n          type="text"\n          ref=','\n        />\n        <label for="toastuiLinkTextInput">','</label>\n        <input\n          id="toastuiLinkTextInput"\n          type="text"\n          ref=','\n        />\n        <div class="','">\n          <button type="button" class="','" onClick=',">\n            ",'\n          </button>\n          <button type="button" class="','" onClick=',">\n            ","\n          </button>\n        </div>\n      </div>\n    "])),i18n.get("URL"),(function(el){return _this.refs.url=el}),i18n.get("Link text"),(function(el){return _this.refs.text=el}),cls("button-container"),cls("close-button"),this.props.hidePopup,i18n.get("Cancel"),cls("ok-button"),this.execCommand,i18n.get("OK"))},LinkPopupBody}(Component),linkPopupBody_templateObject_1,CELL_WIDTH=20,CELL_HEIGHT=20,MIN_ROW_INDEX=5,MAX_ROW_INDEX=14,MIN_COL_INDEX=5,MAX_COL_INDEX=9,MIN_ROW_SELECTION_INDEX=1,MIN_COL_SELECTION_INDEX=1,BORDER_WIDTH=1,TablePopupBody=function(_super){function TablePopupBody(props){var _this=_super.call(this,props)||this;return _this.extendSelectionRange=function(_a){var pageX=_a.pageX,pageY=_a.pageY,x=pageX-_this.offsetRect.left,y=pageY-_this.offsetRect.top,range=_this.getSelectionRangeByOffset(x,y);_this.setState(__assign({},range))},_this.execCommand=function(){_this.props.execCommand("addTable",{rowCount:_this.state.rowIdx+1,columnCount:_this.state.colIdx+1})},_this.state={rowIdx:-1,colIdx:-1},_this}return __extends(TablePopupBody,_super),TablePopupBody.prototype.getDescription=function(){return-1===this.state.colIdx?"":this.state.colIdx+1+" x "+(this.state.rowIdx+1)},TablePopupBody.prototype.getBoundByRange=function(colIdx,rowIdx){return{width:20*(colIdx+1),height:20*(rowIdx+1)}},TablePopupBody.prototype.getRangeByOffset=function(x,y){return{colIdx:Math.floor(x/20),rowIdx:Math.floor(y/20)}},TablePopupBody.prototype.getTableRange=function(){var _a=this.state,orgColIdx=_a.colIdx,orgRowIdx=_a.rowIdx,colIdx=Math.max(orgColIdx,5),rowIdx=Math.max(orgRowIdx,5);return orgColIdx>=5&&colIdx<9&&(colIdx+=1),orgRowIdx>=5&&rowIdx<14&&(rowIdx+=1),{colIdx:colIdx+1,rowIdx:rowIdx+1}},TablePopupBody.prototype.getSelectionAreaBound=function(){var _a=this.getBoundByRange(this.state.colIdx,this.state.rowIdx),width=_a.width,height=_a.height;return width||height?{width:width-1,height:height-1,display:"block"}:{display:"none"}},TablePopupBody.prototype.getSelectionRangeByOffset=function(x,y){var range=this.getRangeByOffset(x,y);return range.rowIdx=Math.min(Math.max(range.rowIdx,1),14),range.colIdx=Math.min(Math.max(range.colIdx,1),9),range},TablePopupBody.prototype.mounted=function(){var _a=this.refs.tableEl.getBoundingClientRect(),left=_a.left,top=_a.top;this.offsetRect={left:window.pageXOffset+left,top:window.pageYOffset+top}},TablePopupBody.prototype.updated=function(){this.props.show||this.setState({colIdx:-1,rowIdx:-1})},TablePopupBody.prototype.createTableArea=function(tableRange){for(var colIdx=tableRange.colIdx,rowIdx=tableRange.rowIdx,rows=[],i=0;i<rowIdx;i+=1){for(var cells=[],j=0;j<colIdx;j+=1){var cellClassNames=cls("table-cell")+(i>0?"":" header");cells.push(template(tablePopupBody_templateObject_1||(tablePopupBody_templateObject_1=__makeTemplateObject(['<div class="','"></div>'],['<div class="','"></div>'])),cellClassNames))}rows.push(template(tablePopupBody_templateObject_2||(tablePopupBody_templateObject_2=__makeTemplateObject(['<div class="','">',"</div>"],['<div class="','">',"</div>"])),cls("table-row"),cells))}return template(templateObject_3||(templateObject_3=__makeTemplateObject(['<div class="','">',"</div>"],['<div class="','">',"</div>"])),cls("table"),rows)},TablePopupBody.prototype.render=function(){var _this=this,tableRange=this.getTableRange(),selectionAreaBound=this.getSelectionAreaBound();return template(templateObject_4||(templateObject_4=__makeTemplateObject(['\n      <div>\n        <div\n          class="','"\n          ref=',"\n          onMousemove=","\n          onClick=","\n        >\n          ",'\n          <div class="','" style=','></div>\n        </div>\n        <p class="','">',"</p>\n      </div>\n    "],['\n      <div>\n        <div\n          class="','"\n          ref=',"\n          onMousemove=","\n          onClick=","\n        >\n          ",'\n          <div class="','" style=','></div>\n        </div>\n        <p class="','">',"</p>\n      </div>\n    "])),cls("table-selection"),(function(el){return _this.refs.tableEl=el}),this.extendSelectionRange,this.execCommand,this.createTableArea(tableRange),cls("table-selection-layer"),selectionAreaBound,cls("table-description"),this.getDescription())},TablePopupBody}(Component),tablePopupBody_templateObject_1,tablePopupBody_templateObject_2,templateObject_3,templateObject_4,CustomPopupBody=function(_super){function CustomPopupBody(props){var _this=_super.call(this,props)||this;return props.eventEmitter.listen("closePopup",_this.props.hidePopup),_this}return __extends(CustomPopupBody,_super),CustomPopupBody.prototype.mounted=function(){this.refs.el.appendChild(this.props.body)},CustomPopupBody.prototype.render=function(){var _this=this;return template(customPopupBody_templateObject_1||(customPopupBody_templateObject_1=__makeTemplateObject(["<div ref=","></div>"],["<div ref=","></div>"])),(function(el){return _this.refs.el=el}))},CustomPopupBody}(Component),customPopupBody_templateObject_1,toolbarItemFactory_templateObject_1,toolbarItemFactory_templateObject_2,toolbarItemFactory_templateObject_3,toolbarItemFactory_templateObject_4,templateObject_5;function createToolbarItemInfo(type){return isString_default()(type)?createDefaultToolbarItemInfo(type):type}function createScrollSyncToolbarItem(){var label=document.createElement("label"),checkbox=document.createElement("input"),toggleSwitch=document.createElement("span");label.className="scroll-sync active",checkbox.type="checkbox",checkbox.checked=!0,toggleSwitch.className="switch";var onMounted=function(execCommand){return checkbox.addEventListener("change",(function(ev){var checked=ev.target.checked;checked?addClass_default()(label,"active"):removeClass_default()(label,"active"),execCommand("toggleScrollSync",{active:checked})}))};return label.appendChild(checkbox),label.appendChild(toggleSwitch),{name:"scrollSync",el:label,onMounted:onMounted}}function createDefaultToolbarItemInfo(type){var info;switch(type){case"heading":info={name:"heading",className:"heading",tooltip:i18n.get("Headings"),state:"heading"};break;case"bold":info={name:"bold",className:"bold",command:"bold",tooltip:i18n.get("Bold"),state:"strong"};break;case"italic":info={name:"italic",className:"italic",command:"italic",tooltip:i18n.get("Italic"),state:"emph"};break;case"strike":info={name:"strike",className:"strike",command:"strike",tooltip:i18n.get("Strike"),state:"strike"};break;case"hr":info={name:"hr",className:"hrline",command:"hr",tooltip:i18n.get("Line"),state:"thematicBreak"};break;case"quote":info={name:"quote",className:"quote",command:"blockQuote",tooltip:i18n.get("Blockquote"),state:"blockQuote"};break;case"ul":info={name:"ul",className:"bullet-list",command:"bulletList",tooltip:i18n.get("Unordered list"),state:"bulletList"};break;case"ol":info={name:"ol",className:"ordered-list",command:"orderedList",tooltip:i18n.get("Ordered list"),state:"orderedList"};break;case"task":info={name:"task",className:"task-list",command:"taskList",tooltip:i18n.get("Task"),state:"taskList"};break;case"table":info={name:"table",className:"table",tooltip:i18n.get("Insert table"),state:"table"};break;case"image":info={name:"image",className:"image",tooltip:i18n.get("Insert image")};break;case"link":info={name:"link",className:"link",tooltip:i18n.get("Insert link")};break;case"code":info={name:"code",className:"code",command:"code",tooltip:i18n.get("Code"),state:"code"};break;case"codeblock":info={name:"codeblock",className:"codeblock",command:"codeBlock",tooltip:i18n.get("Insert CodeBlock"),state:"codeBlock"};break;case"indent":info={name:"indent",className:"indent",command:"indent",tooltip:i18n.get("Indent")};break;case"outdent":info={name:"outdent",className:"outdent",command:"outdent",tooltip:i18n.get("Outdent")};break;case"scrollSync":info=createScrollSyncToolbarItem();break;case"more":info={name:"more",className:"more",tooltip:i18n.get("More")}}return"scrollSync"!==info.name&&(info.className+=" "+cls("toolbar-icons")),info}function createPopupInfo(type,payload){var el=payload.el,pos=payload.pos,popup=payload.popup,initialValues=payload.initialValues;switch(type){case"heading":return{render:function(props){return template(toolbarItemFactory_templateObject_1||(toolbarItemFactory_templateObject_1=__makeTemplateObject(["<"," ..."," />"],["<"," ..."," />"])),HeadingPopupBody,props)},className:cls("popup-add-heading"),fromEl:el,pos:pos};case"link":return{render:function(props){return template(toolbarItemFactory_templateObject_2||(toolbarItemFactory_templateObject_2=__makeTemplateObject(["<"," ..."," />"],["<"," ..."," />"])),LinkPopupBody,props)},className:cls("popup-add-link"),fromEl:el,pos:pos,initialValues:initialValues};case"image":return{render:function(props){return template(toolbarItemFactory_templateObject_3||(toolbarItemFactory_templateObject_3=__makeTemplateObject(["<"," ..."," />"],["<"," ..."," />"])),ImagePopupBody,props)},className:cls("popup-add-image"),fromEl:el,pos:pos};case"table":return{render:function(props){return template(toolbarItemFactory_templateObject_4||(toolbarItemFactory_templateObject_4=__makeTemplateObject(["<"," ..."," />"],["<"," ..."," />"])),TablePopupBody,props)},className:cls("popup-add-table"),fromEl:el,pos:pos};case"customPopupBody":return popup?__assign({render:function(props){return template(templateObject_5||(templateObject_5=__makeTemplateObject(["<"," ..."," body="," />"],["<"," ..."," body="," />"])),CustomPopupBody,props,popup.body)},fromEl:el,pos:pos},popup):null;default:return null}}function setGroupState(group){group.hidden=group.length===group.filter((function(info){return info.hidden})).length}function groupToolbarItems(toolbarItems,hiddenScrollSync){var toggleScrollSyncState=function(item){return item.hidden="scrollSync"===item.name&&hiddenScrollSync,item};return toolbarItems.reduce((function(acc,item){acc.push(item.map((function(type){return toggleScrollSyncState(createToolbarItemInfo(type))})));var group=acc[(acc.length||1)-1];return group&&setGroupState(group),acc}),[])}function toggleScrollSync(toolbarItems,hiddenScrollSync){toolbarItems.forEach((function(group){group.forEach((function(item){return item.hidden="scrollSync"===item.name&&hiddenScrollSync})),setGroupState(group)}))}var Popup=function(_super){function Popup(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.handleMousedown=function(ev){closest(ev.target,"."+cls("popup"))||closest(ev.target,_this.props.info.fromEl)||_this.props.hidePopup()},_this}return __extends(Popup,_super),Popup.prototype.mounted=function(){document.addEventListener("mousedown",this.handleMousedown)},Popup.prototype.beforeDestroy=function(){document.removeEventListener("mousedown",this.handleMousedown)},Popup.prototype.render=function(){var _a=this.props,info=_a.info,show=_a.show,hidePopup=_a.hidePopup,eventEmitter=_a.eventEmitter,execCommand=_a.execCommand,_b=info||{},_c=_b.className,className=void 0===_c?"":_c,style=_b.style,render=_b.render,pos=_b.pos,_d=_b.initialValues,initialValues=void 0===_d?{}:_d,popupStyle=__assign({display:show?"block":"none"},style);return pos&&(popupStyle.left=pos.left,popupStyle.top=pos.top),template(popup_templateObject_1||(popup_templateObject_1=__makeTemplateObject(['\n      <div class="'," ",'" style=','>\n        <div class="','">\n          ',"\n        </div>\n      </div>\n    "],['\n      <div class="'," ",'" style=','>\n        <div class="','">\n          ',"\n        </div>\n      </div>\n    "])),cls("popup"),className,popupStyle,cls("popup-body"),render&&render({eventEmitter:eventEmitter,show:show,hidePopup:hidePopup,execCommand:execCommand,initialValues:initialValues}))},Popup}(Component),popup_templateObject_1,TOOLTIP_INDENT=6,buttonHoc_templateObject_1;function connectHOC(WrappedComponent){return function(_super){function ButtonHOC(props){var _this=_super.call(this,props)||this;return _this.showTooltip=function(el){var tooltip=_this.props.item.tooltip;if(!_this.props.disabled&&tooltip){var bound=_this.getBound(el),left=bound.left+6+"px",top=bound.top+6+"px";css_default()(_this.props.tooltipRef.current,{display:"block",left:left,top:top}),_this.props.tooltipRef.current.querySelector(".text").textContent=tooltip}},_this.hideTooltip=function(){css_default()(_this.props.tooltipRef.current,"display","none")},_this.state={active:!1},_this.addEvent(),_this}return __extends(ButtonHOC,_super),ButtonHOC.prototype.addEvent=function(){var _this=this,_a=this.props,item=_a.item,eventEmitter=_a.eventEmitter;item.state&&eventEmitter.listen("changeToolbarState",(function(_a){var toolbarState,active=!!_a.toolbarState[item.state];_this.setState({active:active})}))},ButtonHOC.prototype.getBound=function(el){var _a=getTotalOffset(el,closest(el,"."+cls("toolbar"))),offsetLeft=_a.offsetLeft,offsetTop=_a.offsetTop;return{left:offsetLeft,top:el.offsetHeight+offsetTop}},ButtonHOC.prototype.render=function(){return template(buttonHoc_templateObject_1||(buttonHoc_templateObject_1=__makeTemplateObject(["\n        <","\n          ...","\n          active=","\n          showTooltip=","\n          hideTooltip=","\n          getBound=","\n        />\n      "],["\n        <","\n          ...","\n          active=","\n          showTooltip=","\n          hideTooltip=","\n          getBound=","\n        />\n      "])),WrappedComponent,this.props,this.state.active,this.showTooltip,this.hideTooltip,this.getBound)},ButtonHOC}(Component)}var DEFAULT_WIDTH=80,ToolbarButtonComp,ToolbarButton=connectHOC(function(_super){function ToolbarButtonComp(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.showTooltip=function(){_this.props.showTooltip(_this.refs.el)},_this.execCommand=function(){var _a=_this.props,item=_a.item,execCommand=_a.execCommand,setPopupInfo=_a.setPopupInfo,getBound=_a.getBound,command=item.command,name=item.name,popup=item.popup;if(command)execCommand(command);else{var popupName,info=createPopupInfo(popup?"customPopupBody":name,{el:_this.refs.el,pos:getBound(_this.refs.el),popup:popup});info&&setPopupInfo(info)}},_this}return __extends(ToolbarButtonComp,_super),ToolbarButtonComp.prototype.mounted=function(){this.setItemWidth()},ToolbarButtonComp.prototype.updated=function(prevProps){prevProps.item.name!==this.props.item.name&&this.setItemWidth()},ToolbarButtonComp.prototype.setItemWidth=function(){var _a=this.props,setItemWidth=_a.setItemWidth,item=_a.item;setItemWidth&&setItemWidth(item.name,getOuterWidth(this.refs.el)+(item.hidden?80:0))},ToolbarButtonComp.prototype.render=function(){var _this=this,_a=this.props,hideTooltip=_a.hideTooltip,disabled=_a.disabled,item=_a.item,active=_a.active,style=__assign({display:item.hidden?"none":null},item.style),classNames=(item.className||"")+(active?" active":"");return template(toolbarButton_templateObject_1||(toolbarButton_templateObject_1=__makeTemplateObject(["\n      <button\n        ref=",'\n        type="button"\n        style=',"\n        class=","\n        onClick=","\n        onMouseover=","\n        onMouseout=","\n        disabled=","\n      >\n        ","\n      </button>\n    "],["\n      <button\n        ref=",'\n        type="button"\n        style=',"\n        class=","\n        onClick=","\n        onMouseover=","\n        onMouseout=","\n        disabled=","\n      >\n        ","\n      </button>\n    "])),(function(el){return _this.refs.el=el}),style,classNames,this.execCommand,this.showTooltip,hideTooltip,!!disabled,item.text||"")},ToolbarButtonComp}(Component)),toolbarButton_templateObject_1,CustomToolbarItemComp,CustomToolbarItem=connectHOC(function(_super){function CustomToolbarItemComp(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.showTooltip=function(){_this.props.showTooltip(_this.refs.el)},_this.showPopup=function(){var info=createPopupInfo("customPopupBody",{el:_this.refs.el,pos:_this.props.getBound(_this.refs.el),popup:_this.props.item.popup});info&&_this.props.setPopupInfo(info)},_this}return __extends(CustomToolbarItemComp,_super),CustomToolbarItemComp.prototype.mounted=function(){var _a=this.props,setItemWidth=_a.setItemWidth,item=_a.item;this.refs.el.appendChild(item.el),setItemWidth&&setItemWidth(item.name,getOuterWidth(this.refs.el)),item.onMounted&&item.onMounted(this.props.execCommand)},CustomToolbarItemComp.prototype.updated=function(prevProps){var _a,_b=this.props,item=_b.item,active=_b.active,disabled=_b.disabled;prevProps.active===active&&prevProps.disabled===disabled||null===(_a=item.onUpdated)||void 0===_a||_a.call(item,{active:active,disabled:disabled})},CustomToolbarItemComp.prototype.render=function(){var _this=this,_a=this.props,disabled=_a.disabled,item,style={display:_a.item.hidden?"none":"inline-block"},getListener=function(listener){return disabled?null:listener};return template(customToolbarItem_templateObject_1||(customToolbarItem_templateObject_1=__makeTemplateObject(["\n      <div\n        ref=","\n        style=","\n        class=","\n        onClick=","\n        onMouseover=","\n        onMouseout=","\n      ></div>\n    "],["\n      <div\n        ref=","\n        style=","\n        class=","\n        onClick=","\n        onMouseover=","\n        onMouseout=","\n      ></div>\n    "])),(function(el){return _this.refs.el=el}),style,cls("toolbar-item-wrapper"),getListener(this.showPopup),getListener(this.showTooltip),getListener(this.props.hideTooltip))},CustomToolbarItemComp}(Component)),customToolbarItem_templateObject_1,ToolbarGroup=function(_super){function ToolbarGroup(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(ToolbarGroup,_super),ToolbarGroup.prototype.render=function(){var _this=this,_a=this.props,group=_a.group,hiddenDivider=_a.hiddenDivider,groupStyle=group.hidden?{display:"none"}:null,dividerStyle=hiddenDivider?{display:"none"}:null;return template(toolbarGroup_templateObject_2||(toolbarGroup_templateObject_2=__makeTemplateObject(['\n      <div class="','" style=',">\n        ",'\n        <div class="','" style=',"></div>\n      </div>\n    "],['\n      <div class="','" style=',">\n        ",'\n        <div class="','" style=',"></div>\n      </div>\n    "])),cls("toolbar-group"),groupStyle,group.map((function(item){var Comp=item.el?CustomToolbarItem:ToolbarButton;return template(toolbarGroup_templateObject_1||(toolbarGroup_templateObject_1=__makeTemplateObject(["<"," key="," ..."," item="," />"],["<"," key="," ..."," item="," />"])),Comp,item.name,_this.props,item)})),cls("toolbar-divider"),dividerStyle)},ToolbarGroup}(Component),toolbarGroup_templateObject_1,toolbarGroup_templateObject_2,POPUP_INDENT=4,DropdownToolbarButtonComp,DropdownToolbarButton=connectHOC(function(_super){function DropdownToolbarButtonComp(props){var _this=_super.call(this,props)||this;return _this.handleClickDocument=function(_a){var target=_a.target;closest(target,"."+cls("dropdown-toolbar"))||closest(target,".more")||_this.setState({showDropdown:!1,dropdownPos:null})},_this.showTooltip=function(){_this.props.showTooltip(_this.refs.el)},_this.state={showDropdown:!1,dropdownPos:null},_this}return __extends(DropdownToolbarButtonComp,_super),DropdownToolbarButtonComp.prototype.getBound=function(){var rect=this.props.getBound(this.refs.el);return rect.top+=4,__assign(__assign({},rect),{left:null,right:10})},DropdownToolbarButtonComp.prototype.mounted=function(){document.addEventListener("click",this.handleClickDocument)},DropdownToolbarButtonComp.prototype.updated=function(){this.state.showDropdown&&!this.state.dropdownPos&&this.setState({dropdownPos:this.getBound()})},DropdownToolbarButtonComp.prototype.beforeDestroy=function(){document.removeEventListener("click",this.handleClickDocument)},DropdownToolbarButtonComp.prototype.render=function(){var _this=this,_a=this.state,showDropdown=_a.showDropdown,dropdownPos=_a.dropdownPos,_b=this.props,disabled=_b.disabled,item=_b.item,items=_b.items,hideTooltip=_b.hideTooltip,visibleItems=items.filter((function(dropdownItem){return!dropdownItem.hidden})),groupStyle=visibleItems.length?null:{display:"none"},dropdownStyle=showDropdown?null:{display:"none"};return template(dropdownToolbarButton_templateObject_2||(dropdownToolbarButton_templateObject_2=__makeTemplateObject(['\n      <div class="','" style=',">\n        <button\n          ref=",'\n          type="button"\n          class=',"\n          onClick=","\n          onMouseover=","\n          onMouseout=","\n          disabled=",'\n        ></button>\n        <div\n          class="','"\n          style=',"\n          ref=","\n        >\n          ","\n        </div>\n      </div>\n    "],['\n      <div class="','" style=',">\n        <button\n          ref=",'\n          type="button"\n          class=',"\n          onClick=","\n          onMouseover=","\n          onMouseout=","\n          disabled=",'\n        ></button>\n        <div\n          class="','"\n          style=',"\n          ref=","\n        >\n          ","\n        </div>\n      </div>\n    "])),cls("toolbar-group"),groupStyle,(function(el){return _this.refs.el=el}),item.className,(function(){return _this.setState({showDropdown:!0})}),this.showTooltip,hideTooltip,disabled,cls("dropdown-toolbar"),__assign(__assign({},dropdownStyle),dropdownPos),(function(el){return _this.refs.dropdownEl=el}),visibleItems.length?visibleItems.map((function(group,index){var _a;return template(dropdownToolbarButton_templateObject_1||(dropdownToolbarButton_templateObject_1=__makeTemplateObject(["\n                  <","\n                    group=","\n                    hiddenDivider=","\n                    ...","\n                  />\n                "],["\n                  <","\n                    group=","\n                    hiddenDivider=","\n                    ...","\n                  />\n                "])),ToolbarGroup,group,index===visibleItems.length-1||(null===(_a=visibleItems[index+1])||void 0===_a?void 0:_a.hidden),_this.props)})):null)},DropdownToolbarButtonComp}(Component)),dropdownToolbarButton_templateObject_1,dropdownToolbarButton_templateObject_2,DROPDOWN_WIDTH=120,toolbar_DEFAULT_WIDTH=80,Toolbar=function(_super){function Toolbar(props){var _this=_super.call(this,props)||this;return _this.toggleTab=function(_,activeTab){var eventEmitter=_this.props.eventEmitter;if(_this.state.activeTab!==activeTab){var event="write"===activeTab?"changePreviewTabWrite":"changePreviewTabPreview";eventEmitter.emit(event),_this.setState({activeTab:activeTab})}},_this.setItemWidth=function(name,width){_this.itemWidthMap[name]=width},_this.setPopupInfo=function(popupInfo){_this.setState({showPopup:!0,popupInfo:popupInfo})},_this.openPopup=function(popupName,initialValues){void 0===initialValues&&(initialValues={});var el=document.querySelector("."+cls("toolbar-group")+" ."+popupName);if(el){var _a=getTotalOffset(el,closest(el,"."+cls("toolbar"))),offsetLeft=_a.offsetLeft,offsetTop=_a.offsetTop,info=createPopupInfo(popupName,{el:el,pos:{left:offsetLeft,top:el.offsetHeight+offsetTop},initialValues:initialValues});info&&_this.setPopupInfo(info)}},_this.hidePopup=function(){_this.state.showPopup&&_this.setState({showPopup:!1})},_this.execCommand=function(command,payload){var eventEmitter;_this.props.eventEmitter.emit("command",command,payload),_this.hidePopup()},_this.tabs=[{name:"write",text:"Write"},{name:"preview",text:"Preview"}],_this.itemWidthMap={},_this.initialItems=groupToolbarItems(props.toolbarItems||[],_this.hiddenScrollSync()),_this.state={items:_this.initialItems,dropdownItems:[],showPopup:!1,popupInfo:{},activeTab:"write"},_this.tooltipRef={current:null},_this.addEvent(),_this}return __extends(Toolbar,_super),Toolbar.prototype.insertToolbarItem=function(indexList,item){var groupIndex=indexList.groupIndex,itemIndex=indexList.itemIndex,group=this.initialItems[groupIndex];item=createToolbarItemInfo(item),group?group.splice(itemIndex,0,item):this.initialItems.push([item]),this.setState(this.classifyToolbarItems())},Toolbar.prototype.removeToolbarItem=function(name){var _this=this;forEachArray_default()(this.initialItems,(function(group){var found=!1;return forEachArray_default()(group,(function(item,index){return item.name!==name||(found=!0,group.splice(index,1),_this.setState(_this.classifyToolbarItems()),!1)})),!found}))},Toolbar.prototype.addEvent=function(){var _this=this;this.props.eventEmitter.listen("openPopup",this.openPopup),this.handleResize=throttle_default()((function(){return _this.setState(_this.classifyToolbarItems())}),200),window.addEventListener("resize",this.handleResize)},Toolbar.prototype.appendTooltipToRoot=function(){var tooltip='<div class="'+cls("tooltip")+'" style="display:none">\n        <div class="arrow"></div>\n        <span class="text"></span>\n      </div>';this.tooltipRef.current=createElementWith(tooltip,this.refs.el)},Toolbar.prototype.hiddenScrollSync=function(){return"wysiwyg"===this.props.editorType||"tab"===this.props.previewStyle},Toolbar.prototype.classifyToolbarItems=function(){var _this=this,totalWidth=0,clientWidth=this.refs.el.clientWidth,divider=this.refs.el.querySelector("."+cls("toolbar-divider")),dividerWidth=divider?getOuterWidth(divider):0,items=[],dropdownItems=[];return this.initialItems.forEach((function(initialGroup,index){var group=[],dropdownGroup=[];initialGroup.forEach((function(item){var target;((totalWidth+=_this.itemWidthMap[item.name]||80)>=clientWidth-120?dropdownGroup:group).push(item)})),group.length&&(setGroupState(group),items.push(group)),dropdownGroup.length&&(setGroupState(dropdownGroup),dropdownItems.push(dropdownGroup)),index<_this.state.items.length-1&&(totalWidth+=dividerWidth)})),{items:items,dropdownItems:dropdownItems}},Toolbar.prototype.mounted=function(){"tab"===this.props.previewStyle&&this.props.eventEmitter.emit("changePreviewTabWrite"),this.setState(this.classifyToolbarItems()),this.appendTooltipToRoot()},Toolbar.prototype.updated=function(prevProps){var _a=this.props,editorType=_a.editorType,previewStyle=_a.previewStyle,eventEmitter=_a.eventEmitter,changedStyle=previewStyle!==prevProps.previewStyle,changedType=editorType!==prevProps.editorType;if(changedStyle||changedType){toggleScrollSync(this.initialItems,this.hiddenScrollSync());var newState=this.classifyToolbarItems();(changedStyle||"tab"===previewStyle&&"markdown"===editorType)&&(eventEmitter.emit("changePreviewTabWrite"),newState.activeTab="write"),this.setState(newState)}},Toolbar.prototype.beforeDestroy=function(){window.removeEventListener("resize",this.handleResize),removeNode(this.tooltipRef.current)},Toolbar.prototype.render=function(){var _this=this,_a=this.props,previewStyle=_a.previewStyle,eventEmitter=_a.eventEmitter,editorType=_a.editorType,_b=this.state,popupInfo=_b.popupInfo,showPopup=_b.showPopup,activeTab=_b.activeTab,items=_b.items,dropdownItems=_b.dropdownItems,props={eventEmitter:eventEmitter,tooltipRef:this.tooltipRef,disabled:"markdown"===editorType&&"tab"===previewStyle&&"preview"===activeTab,execCommand:this.execCommand,setPopupInfo:this.setPopupInfo},toolbarStyle="tab"===previewStyle?{borderTopLeftRadius:0}:null;return template(toolbar_templateObject_2||(toolbar_templateObject_2=__makeTemplateObject(['\n      <div class="','">\n        <div\n          class="','"\n          style="display: ','"\n        >\n          <'," tabs="," activeTab="," onClick=",' />\n        </div>\n        <div\n          class="','"\n          ref=',"\n          style=","\n        >\n          ","\n          <","\n            item=","\n            items=","\n            ...","\n          />\n        </div>\n        <","\n          info=","\n          show=","\n          eventEmitter=","\n          hidePopup=","\n          execCommand=","\n        />\n      </div>\n    "],['\n      <div class="','">\n        <div\n          class="','"\n          style="display: ','"\n        >\n          <'," tabs="," activeTab="," onClick=",' />\n        </div>\n        <div\n          class="','"\n          ref=',"\n          style=","\n        >\n          ","\n          <","\n            item=","\n            items=","\n            ...","\n          />\n        </div>\n        <","\n          info=","\n          show=","\n          eventEmitter=","\n          hidePopup=","\n          execCommand=","\n        />\n      </div>\n    "])),cls("toolbar"),cls("md-tab-container"),"wysiwyg"===editorType||"vertical"===previewStyle?"none":"block",Tabs,this.tabs,activeTab,this.toggleTab,cls("defaultUI-toolbar"),(function(el){return _this.refs.el=el}),toolbarStyle,items.map((function(group,index){var _a;return template(toolbar_templateObject_1||(toolbar_templateObject_1=__makeTemplateObject(["\n              <","\n                group=","\n                hiddenDivider=","\n                setItemWidth=","\n                ...","\n              />\n            "],["\n              <","\n                group=","\n                hiddenDivider=","\n                setItemWidth=","\n                ...","\n              />\n            "])),ToolbarGroup,group,index===items.length-1||(null===(_a=items[index+1])||void 0===_a?void 0:_a.hidden),_this.setItemWidth,props)})),DropdownToolbarButton,createToolbarItemInfo("more"),dropdownItems,props,Popup,popupInfo,showPopup,eventEmitter,this.hidePopup,this.execCommand)},Toolbar}(Component),toolbar_templateObject_1,toolbar_templateObject_2,ContextMenu=function(_super){function ContextMenu(props){var _this=_super.call(this,props)||this;return _this.handleClickDocument=function(ev){closest(ev.target,"."+cls("context-menu"))||_this.setState({pos:null})},_this.state={pos:null,menuGroups:[]},_this.addEvent(),_this}return __extends(ContextMenu,_super),ContextMenu.prototype.addEvent=function(){var _this=this;this.props.eventEmitter.listen("contextmenu",(function(_a){var pos=_a.pos,menuGroups=_a.menuGroups;_this.setState({pos:pos,menuGroups:menuGroups})}))},ContextMenu.prototype.mounted=function(){document.addEventListener("click",this.handleClickDocument)},ContextMenu.prototype.beforeDestroy=function(){document.removeEventListener("click",this.handleClickDocument)},ContextMenu.prototype.getMenuGroupElements=function(){var _this=this,_a=this.state,pos=_a.pos,menuGroups=_a.menuGroups;return pos?menuGroups.reduce((function(acc,group){var menuItem=[];return group.forEach((function(_a){var label=_a.label,_b=_a.className,className=void 0!==_b&&_b,disabled=_a.disabled,onClick=_a.onClick,handleClick=function(){disabled||(onClick(),_this.setState({pos:null}))};menuItem.push(template(contextMenu_templateObject_1||(contextMenu_templateObject_1=__makeTemplateObject(["\n                <li onClick=",' class="menu-item','">\n                  <span class="','">',"</span>\n                </li>\n              "],["\n                <li onClick=",' class="menu-item','">\n                  <span class="','">',"</span>\n                </li>\n              "])),handleClick,disabled?" disabled":"",className,label))})),acc.push(template(contextMenu_templateObject_2||(contextMenu_templateObject_2=__makeTemplateObject(['<ul class="menu-group">\n              ',"\n            </ul>"],['<ul class="menu-group">\n              ',"\n            </ul>"])),menuItem)),acc}),[]):[]},ContextMenu.prototype.render=function(){var style=__assign({display:this.state.pos?"block":"none"},this.state.pos);return template(contextMenu_templateObject_3||(contextMenu_templateObject_3=__makeTemplateObject(['<div class="','" style=',">\n      ","\n    </div>"],['<div class="','" style=',">\n      ","\n    </div>"])),cls("context-menu"),style,this.getMenuGroupElements())},ContextMenu}(Component),contextMenu_templateObject_1,contextMenu_templateObject_2,contextMenu_templateObject_3,Layout=function(_super){function Layout(props){var _this=_super.call(this,props)||this;_this.changeMode=function(editorType){editorType!==_this.state.editorType&&_this.setState({editorType:editorType})},_this.changePreviewStyle=function(previewStyle){previewStyle!==_this.state.previewStyle&&_this.setState({previewStyle:previewStyle})},_this.hide=function(){_this.setState({hide:!0})},_this.show=function(){_this.setState({hide:!1})};var editorType=props.editorType,previewStyle=props.previewStyle;return _this.state={editorType:editorType,previewStyle:previewStyle,hide:!1},_this.addEvent(),_this}return __extends(Layout,_super),Layout.prototype.mounted=function(){var _a=this.props.slots,wwEditor=_a.wwEditor,mdEditor=_a.mdEditor,mdPreview=_a.mdPreview;this.refs.wwContainer.appendChild(wwEditor),this.refs.mdContainer.insertAdjacentElement("afterbegin",mdEditor),this.refs.mdContainer.appendChild(mdPreview)},Layout.prototype.insertToolbarItem=function(indexList,item){this.toolbar.insertToolbarItem(indexList,item)},Layout.prototype.removeToolbarItem=function(name){this.toolbar.removeToolbarItem(name)},Layout.prototype.render=function(){var _this=this,_a=this.props,eventEmitter=_a.eventEmitter,hideModeSwitch=_a.hideModeSwitch,toolbarItems=_a.toolbarItems,theme=_a.theme,_b=this.state,hide=_b.hide,previewStyle=_b.previewStyle,editorType=_b.editorType,displayClassName=hide?" hidden":"",editorTypeClassName=cls("markdown"===editorType?"md-mode":"ww-mode"),previewClassName=cls("md")+"-"+previewStyle+"-style",themeClassName=cls(["light"!==theme,theme+" "]);return template(layout_templateObject_2||(layout_templateObject_2=__makeTemplateObject(['\n      <div\n        class="',"","",'"\n        ref=',"\n      >\n        <","\n          ref=","\n          eventEmitter=","\n          previewStyle=","\n          toolbarItems=","\n          editorType=",'\n        />\n        <div\n          class="'," ",'"\n          ref=','\n        >\n          <div\n            class="'," ",'"\n            ref=','\n          >\n            <div class="','"></div>\n          </div>\n          <div\n            class="','"\n            ref=',"\n          />\n        </div>\n        ","\n        <"," eventEmitter="," />\n      </div>\n    "],['\n      <div\n        class="',"","",'"\n        ref=',"\n      >\n        <","\n          ref=","\n          eventEmitter=","\n          previewStyle=","\n          toolbarItems=","\n          editorType=",'\n        />\n        <div\n          class="'," ",'"\n          ref=','\n        >\n          <div\n            class="'," ",'"\n            ref=','\n          >\n            <div class="','"></div>\n          </div>\n          <div\n            class="','"\n            ref=',"\n          />\n        </div>\n        ","\n        <"," eventEmitter="," />\n      </div>\n    "])),themeClassName,cls("defaultUI"),displayClassName,(function(el){return _this.refs.el=el}),Toolbar,(function(toolbar){return _this.toolbar=toolbar}),eventEmitter,previewStyle,toolbarItems,editorType,cls("main"),editorTypeClassName,(function(el){return _this.refs.editorSection=el}),cls("md-container"),previewClassName,(function(el){return _this.refs.mdContainer=el}),cls("md-splitter"),cls("ww-container"),(function(el){return _this.refs.wwContainer=el}),!hideModeSwitch&&template(layout_templateObject_1||(layout_templateObject_1=__makeTemplateObject(["<"," eventEmitter="," editorType="," />"],["<"," eventEmitter="," editorType="," />"])),Switch,eventEmitter,editorType),ContextMenu,eventEmitter)},Layout.prototype.addEvent=function(){var eventEmitter=this.props.eventEmitter;eventEmitter.listen("hide",this.hide),eventEmitter.listen("show",this.show),eventEmitter.listen("changeMode",this.changeMode),eventEmitter.listen("changePreviewStyle",this.changePreviewStyle)},Layout}(Component),layout_templateObject_1,layout_templateObject_2,ToastUIEditor,editor=function(_super){function ToastUIEditor(options){var _a,_this=_super.call(this,options)||this,layoutComp,destroy=render(_this.options.el,template(editor_templateObject_1||(editor_templateObject_1=__makeTemplateObject(["\n        <","\n          ref=","\n          eventEmitter=","\n          slots=","\n          hideModeSwitch=","\n          toolbarItems=","\n          previewStyle=","\n          editorType=","\n          theme=","\n        />\n      "],["\n        <","\n          ref=","\n          eventEmitter=","\n          slots=","\n          hideModeSwitch=","\n          toolbarItems=","\n          previewStyle=","\n          editorType=","\n          theme=","\n        />\n      "])),Layout,(function(layout){return layoutComp=layout}),_this.eventEmitter,_this.getEditorElements(),_this.options.hideModeSwitch,_this.options.toolbarItems,_this.options.previewStyle,_this.options.initialEditType,_this.options.theme));return _this.setMinHeight(_this.options.minHeight),_this.setHeight(_this.options.height),_this.defaultUI={insertToolbarItem:layoutComp.insertToolbarItem.bind(layoutComp),removeToolbarItem:layoutComp.removeToolbarItem.bind(layoutComp),destroy:destroy},null===(_a=_this.pluginInfo.toolbarItems)||void 0===_a||_a.forEach((function(toolbarItem){var groupIndex=toolbarItem.groupIndex,itemIndex=toolbarItem.itemIndex,item=toolbarItem.item;_this.defaultUI.insertToolbarItem({groupIndex:groupIndex,itemIndex:itemIndex},item)})),_this}return __extends(ToastUIEditor,_super),ToastUIEditor.factory=function(options){return options.viewer?new viewer(options):new ToastUIEditor(options)},ToastUIEditor.prototype.insertToolbarItem=function(indexInfo,item){this.defaultUI.insertToolbarItem(indexInfo,item)},ToastUIEditor.prototype.removeToolbarItem=function(itemName){this.defaultUI.removeToolbarItem(itemName)},ToastUIEditor.prototype.destroy=function(){_super.prototype.destroy.call(this),this.defaultUI.destroy()},ToastUIEditor}(editorCore),editor_templateObject_1;editorCore.setLanguage(["en","en-US"],{Markdown:"Markdown",WYSIWYG:"WYSIWYG",Write:"Write",Preview:"Preview",Headings:"Headings",Paragraph:"Paragraph",Bold:"Bold",Italic:"Italic",Strike:"Strike",Code:"Inline code",Line:"Line",Blockquote:"Blockquote","Unordered list":"Unordered list","Ordered list":"Ordered list",Task:"Task",Indent:"Indent",Outdent:"Outdent","Insert link":"Insert link","Insert CodeBlock":"Insert codeBlock","Insert table":"Insert table","Insert image":"Insert image",Heading:"Heading","Image URL":"Image URL","Select image file":"Select image file","Choose a file":"Choose a file","No file":"No file",Description:"Description",OK:"OK",More:"More",Cancel:"Cancel",File:"File",URL:"URL","Link text":"Link text","Add row to up":"Add row to up","Add row to down":"Add row to down","Add column to left":"Add column to left","Add column to right":"Add column to right","Remove row":"Remove row","Remove column":"Remove column","Align column to left":"Align column to left","Align column to center":"Align column to center","Align column to right":"Align column to right","Remove table":"Remove table","Would you like to paste as table?":"Would you like to paste as table?","Text color":"Text color","Auto scroll enabled":"Auto scroll enabled","Auto scroll disabled":"Auto scroll disabled","Choose language":"Choose language"});var src=editor}(),__webpack_exports__=__webpack_exports__.default}()}));